(this["webpackJsonpsurvey-editor"]=this["webpackJsonpsurvey-editor"]||[]).push([[0],{310:function(e,n,t){},311:function(e,n,t){},382:function(e,n,t){"use strict";t.r(n);var o=t(0),r=t.n(o),a=t(18),i=t.n(a),c=(t(310),t(7)),s=t(26),l=t(31),u=t(404),d=t(89),h=t(82),f=t(32),b=(t(311),t(29)),p=t.n(b),j={yes:!0,no:!1,TRUE:!0,FALSE:!1,true:!0,false:!1},v=function(e){return{survey:e||{type:"",typeParameters:[],row:{type:"",name:"data",label:{"English (en)":"[empty survey]"}},children:[],indentationLevel:0,rowIndex:-1},nodesToAnswers:new Map,evaluationResults:new Map,stackDepth:0,knownLiteralsWithoutDollarSign:j}},m=o.createContext({schema:new p.a({}),context:v(),language:"English (en)",languageCode:"en",languageName:"English",debug:!0,xlsForm:void 0,setContext:function(){},onChangeAnswer:function(){},onChangeCell:function(){},onMoveNode:function(){},onSpliceRows:function(){},onRemoveRowAndChildren:function(){},onRenameNode:function(){},onNestNode:function(){},onUngroupNode:function(){},onAddNode:function(){}}),g=t(125),O=t(3),x=t(54),y=t(64),w=t(27),k=t(61);t(395),t(403);function E(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,t=Object(k.d)(e);return t.opacity*=n,t.toString()}var N=t(17),T=t(35),A=t.n(T),S=t(45),C=t(10),R=t(55),L=t(16),I=t(21),_=t(19),D=t(20),M=t(159);function F(e,n){var t,o,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.survey;if((null===(t=r.row)||void 0===t?void 0:t.name)===e)return r;if(null===(o=r.children)||void 0===o?void 0:o.length)for(var a=0;a<r.children.length;a+=1){var i,c=r.children[a];if((null===(i=c.row)||void 0===i?void 0:i.name)===e)return c;var s=F(e,n,c);if(s)return s}}function P(e,n,t){var o;if((null===(o=t.row)||void 0===o?void 0:o.name)===e)return t;if(t.children)for(var r=0;r<t.children.length;r+=1){var a,i=t.children[r];if((null===(a=i.row)||void 0===a?void 0:a.name)===e)return i}var c=K(t,n),s=null===c||void 0===c?void 0:c[c.length-1];return s&&P(e,n,s)||void 0}function B(e,n){var t,o,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.survey,a=e[0];if("."===a)o=r;else if("/"===a)o=n.survey;else if(".."===a){if(r===n.survey)throw new Error("Reached root - Can\u2019t traverse further up the hierarchy.");var i=K(r,n);o=null===i||void 0===i?void 0:i[i.length-1]}else if(a===r.row.name)o=r;else if(null===(t=r.children)||void 0===t?void 0:t.length)for(var c=0;c<r.children.length;c+=1){var s=r.children[c];if(s.row.name===a){o=s;break}}return 1===e.length?o:B(e.slice(1),n,o)}function U(e,n){var t,o;if(!e)return["/"];if(!(null===e||void 0===e||null===(t=e.row)||void 0===t?void 0:t.name))throw new Error("Encountered a row without a name (row #".concat(e.rowIndex,"). This should not happen. Please ensure the survey data is valid."));var r=K(e,n);return[null===(o=e.row)||void 0===o?void 0:o.name].concat(Object(N.a)(U(null===r||void 0===r?void 0:r[r.length-1],n)))}function G(e,n){var t;return null===(t=U(e,n))||void 0===t?void 0:t.reverse()}function z(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";return G(e,n).slice(1).join(t)}function V(e,n){var t,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(Object(w.isEqual)(e,n))return o;if(null===(t=n.children)||void 0===t?void 0:t.length)for(var r=0;r<n.children.length;r+=1){o.push(r);var a=n.children[r],i=V(e,a,o);if(void 0!==i)return i;o.pop()}}function $(e,n){return V(e,n.survey)}function H(e,n){var t,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(Object(w.isEqual)(e,n))return o;if(null===(t=n.children)||void 0===t?void 0:t.length){o.push(n);for(var r=0;r<n.children.length;r+=1){var a=n.children[r],i=H(e,a,o);if(i)return i}o.pop()}}function K(e,n){return H(e,n.survey)}var W,X=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(){var e;Object(L.a)(this,t);for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return(e=n.call.apply(n,[this].concat(r))).token=void 0,e}return Object(I.a)(t,[{key:"toMarkdown",value:function(){return this.message}}]),t}(Object(M.a)(Error)),q=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o,r,a,i){var c,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0;Object(L.a)(this,t),(c=n.call(this,e)).type=o,c.expression=r,c.context=a,c.scope=i,c.underlyingEvaluationError=s,c.nodeStack=void 0;var l=H(i,a.survey);return c.nodeStack=[].concat(Object(N.a)(l||[]),[i]),c}return Object(I.a)(t,[{key:"toMarkdown",value:function(){return this.message}}]),t}(X),J=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o,r){var a;return Object(L.a)(this,t),(a=n.call(this,o)).type=e,a.tokens=r,a}return Object(I.a)(t,[{key:"toMarkdown",value:function(){return this.message}}]),t}(X),Y=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o){var r;return Object(L.a)(this,t),(r=n.call(this,o)).token=e,r.message=o,r}return t}(X),Q=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(){return Object(L.a)(this,t),n.apply(this,arguments)}return t}(X),Z=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(){return Object(L.a)(this,t),n.apply(this,arguments)}return t}(X),ee=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e){return Object(L.a)(this,t),n.call(this,"The `".concat(e,"` function is not supported yet. If you need it, please contact the developers."))}return t}(X);!function(e){e[e.LEFT_PAREN=0]="LEFT_PAREN",e[e.RIGHT_PAREN=1]="RIGHT_PAREN",e[e.COMMA=2]="COMMA",e[e.ASSIGN=3]="ASSIGN",e[e.PLUS=4]="PLUS",e[e.MINUS=5]="MINUS",e[e.ASTERISK=6]="ASTERISK",e[e.DOLLAR=7]="DOLLAR",e[e.LEFT_BRACE=8]="LEFT_BRACE",e[e.RIGHT_BRACE=9]="RIGHT_BRACE",e[e.GREATER_THAN=10]="GREATER_THAN",e[e.LESS_THAN=11]="LESS_THAN",e[e.SLASH=12]="SLASH",e[e.POINT=13]="POINT",e[e.CARET=14]="CARET",e[e.TILDE=15]="TILDE",e[e.BANG=16]="BANG",e[e.BACKSLASH=17]="BACKSLASH",e[e.QUESTION=18]="QUESTION",e[e.COLON=19]="COLON",e[e.SINGLE_QUOTE=20]="SINGLE_QUOTE",e[e.DOUBLE_QUOTE=21]="DOUBLE_QUOTE",e[e.MODULO=22]="MODULO",e[e.BOOLEAN_AND=23]="BOOLEAN_AND",e[e.BOOLEAN_OR=24]="BOOLEAN_OR",e[e.COMPARISON=25]="COMPARISON",e[e.NAME=26]="NAME",e[e.LITERAL=27]="LITERAL",e[e.NUMBER_LITERAL=28]="NUMBER_LITERAL",e[e.FLOAT_LITERAL=29]="FLOAT_LITERAL",e[e.INT_LITERAL=30]="INT_LITERAL",e[e.STRING_LITERAL=31]="STRING_LITERAL",e[e.BOOLEAN_LITERAL=32]="BOOLEAN_LITERAL",e[e.SELECTOR=33]="SELECTOR",e[e.WHITESPACE=34]="WHITESPACE",e[e.UNKNOWN=35]="UNKNOWN",e[e.EOF=36]="EOF",e[e.INVALID=37]="INVALID",e[e.INTERNAL_LEXER_ERROR=38]="INTERNAL_LEXER_ERROR"}(W||(W={}));W.LEFT_PAREN,W.RIGHT_PAREN,W.COMMA,W.ASSIGN,W.PLUS,W.MINUS,W.ASTERISK,W.GREATER_THAN,W.LESS_THAN,W.BOOLEAN_AND,W.BOOLEAN_OR,W.SLASH,W.CARET,W.TILDE,W.BANG,W.MODULO,W.COMPARISON,W.BACKSLASH,W.QUESTION,W.COLON,W.SINGLE_QUOTE,W.DOUBLE_QUOTE,W.NAME,W.LITERAL,W.NUMBER_LITERAL,W.INT_LITERAL,W.FLOAT_LITERAL,W.STRING_LITERAL,W.BOOLEAN_LITERAL,W.WHITESPACE,W.UNKNOWN,W.EOF,W.INVALID;function ne(e){switch(e){case W.LEFT_PAREN:return"(";case W.RIGHT_PAREN:return")";case W.COMMA:return",";case W.ASSIGN:return"=";case W.PLUS:return"+";case W.MINUS:return"-";case W.ASTERISK:return"*";case W.SLASH:return"/";case W.CARET:return"^";case W.TILDE:return"~";case W.BANG:return"!";case W.BACKSLASH:return"\\";case W.QUESTION:return"?";case W.COLON:return":";default:return"[undefined punctuator]"}}var te=function e(){Object(L.a)(this,e),this.kind=void 0,this.tokens=void 0,this.children=void 0},oe=[[W.STRING_LITERAL,/^'(\\\\|\\'|[^'])*'/],[W.STRING_LITERAL,/^"(\\\\|\\"|[^"])*"/],[W.SLASH,/^div/],[W.MODULO,/^mod/],[W.BOOLEAN_AND,/^and/],[W.BOOLEAN_OR,/^or/],[W.FLOAT_LITERAL,/^-?\d+\.\d+/],[W.INT_LITERAL,/^-?\d+/],[W.NAME,/^\$?{[^}]+}/],[W.NAME,/^[a-zA-Z_\w_][a-zA-Z_\w_-]*/],[W.SELECTOR,/^\/(\/?[\w*]+(?:\[[^]+?]\B)?)/],[W.LEFT_PAREN,/^\(/],[W.RIGHT_PAREN,/^\)/],[W.COMMA,/^,/],[W.PLUS,/^\+/],[W.MINUS,/^-/],[W.ASTERISK,/^\*/],[W.COMPARISON,/^(>=|>|<=|<|=|!=)/],[W.COMPARISON,/^(>=|>|<=|<|=|!=)/],[W.INVALID,/^(\w+|[\s\S])/]],re=function(){function e(n){Object(L.a)(this,e),this.text=n,this.index=0}return Object(I.a)(e,[{key:"next",value:function(){if(this.index>=this.text.length)return{value:{type:W.EOF,text:"",index:this.index}};for(;" "===this.text[this.index];)this.index+=1;for(var e=0;e<oe.length;e+=1){var n=oe[e],t=Object(s.a)(n,2),o=t[0],r=t[1],a=this.text.slice(this.index).match(r);if(null!==a){var i=a[0],c={type:o,text:this.text.substr(this.index,i.length),index:this.index};return this.index+=i.length,{value:c}}}var l={type:W.INTERNAL_LEXER_ERROR,text:this.text[this.index],index:this.index};throw new Y(l,"Lexer should never get here. If we get here, this means there is no invalid token defined at the end of the pattern list. This invalid token should match at least one character that is not recognized by all other patterns.")}}]),e}(),ae=function e(){Object(L.a)(this,e)},ie=function e(){Object(L.a)(this,e)},ce=function(){function e(n){Object(L.a)(this,e),this.options=n,this.readTokens=[],this.prefixParselets=new Map,this.infixParselets=new Map}return Object(I.a)(e,[{key:"register",value:function(e,n){if(n instanceof ie)this.prefixParselets.set(e,n);else{if(!(n instanceof ae))throw new Error("Found a parselet that was neither an infix nor a prefix parselet: No idea what to do with it\u2026");this.infixParselets.set(e,n)}}},{key:"parseExpression",value:function(){var e,n,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=this.consumeAnything();if(!o)throw new J("prematureEOF","Parser encountered end of tokens. This should not happen.");var r=this.prefixParselets.get(o.type);if(!r)throw new J("undefinedPrefix","Expected start of a new expression, but `".concat(o.text,"` is not an allowed prefix."),[o]);for(var a=r.parse(this,o);t<this.getPrecedence();){var i=this.consumeAnything();if(!i)throw new J("prematureEndOfTokens","Parser encountered end of tokens. This should not happen.");var c=this.infixParselets.get(i.type);if(!c)throw new J("undefinedInfix","`".concat(i.text,"` is not an allowed infix."),[i]);a=c.parse(this,a,i)}return null===(e=(n=this.options).onExpression)||void 0===e||e.call(n,a),a}},{key:"match",value:function(e){if(this.lookAhead(0).type===e)return this.consumeAnything()}},{key:"consume",value:function(e){var n=this.lookAhead(0);if(n.type!==e)throw new Error("Expected token "+e+" and found "+n.type);if(!this.consumeAnything())throw new Error("Could not consume token "+e);return n}},{key:"consumeAnything",value:function(){return this.lookAhead(0),this.readTokens.shift()}},{key:"lookAhead",value:function(e){for(;e>=this.readTokens.length;){var n,t,o=this.options.tokens.next();o.value&&(null===(n=(t=this.options).onToken)||void 0===n||n.call(t,o.value)),this.readTokens.push(o.value)}return this.readTokens[e]}},{key:"getPrecedence",value:function(){var e=this.infixParselets.get(this.lookAhead(0).type);return e?e.getPrecedence():0}}]),e}(),se=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o,r){var a;return Object(L.a)(this,t),(a=n.call(this)).tokens=e,a.name=o,a.text=r,a.kind="name",a.children=a.tokens,a}return Object(I.a)(t,[{key:"print",value:function(e){e(this.name)}}]),t}(te),le=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o,r,a){var i;return Object(L.a)(this,t),(i=n.call(this)).tokens=e,i.left=o,i.operatorToken=r,i.right=a,i.kind="operator",i.children=[i.left,i.operatorToken,i.right],i}return Object(I.a)(t,[{key:"print",value:function(e){e("("),this.left.print(e),e(" "),e(this.operatorToken.text),e(" "),this.right.print(e),e(")")}}]),t}(te),ue=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o){var r;return Object(L.a)(this,t),(r=n.call(this)).precedence=e,r.isRight=o,r}return Object(I.a)(t,[{key:"parse",value:function(e,n,t){var o=e.parseExpression(this.precedence-(this.isRight?1:0));return new le([].concat(Object(N.a)(n.tokens),[t],Object(N.a)(o.tokens)),n,t,o)}},{key:"getPrecedence",value:function(){return this.precedence}}]),t}(ae),de=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o,r,a,i){var c;return Object(L.a)(this,t),(c=n.call(this)).tokens=e,c.fn=o,c.leftParenToken=r,c.argsAndDelimiters=a,c.rightParenToken=i,c.kind="call",c.args=void 0,c.children=[c.fn,c.leftParenToken].concat(Object(N.a)(c.argsAndDelimiters),[c.rightParenToken]),c.args=a.filter((function(e){return e instanceof te})),c}return Object(I.a)(t,[{key:"print",value:function(e){this.fn.print(e),e("(");for(var n=0;n<this.args.length;n++)this.args[n].print(e),n<this.args.length-1&&e(", ");e(")")}}]),t}(te),he=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o,r){var a;return Object(L.a)(this,t),(a=n.call(this)).rightParenTokenType=e,a.argumentDelimiterTokenType=o,a.precedence=r,a}return Object(I.a)(t,[{key:"parse",value:function(e,n,t){var o=[],r=e.match(this.rightParenTokenType),a=[].concat(Object(N.a)(n.tokens),[t]),i=[];if(r)a.push(r);else{var c;do{var s=e.parseExpression();o.push(s),a.push.apply(a,Object(N.a)(s.tokens)),i.push(s),(c=e.match(this.argumentDelimiterTokenType))&&(a.push(c),i.push(c))}while(c);(r=e.consume(this.rightParenTokenType))&&a.push(r)}return new de(a,n,t,i,r)}},{key:"getPrecedence",value:function(){return this.precedence}}]),t}(ae),fe=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o,r,a,i,c){var s;return Object(L.a)(this,t),(s=n.call(this)).tokens=e,s.condition=o,s.questionMarkToken=r,s.thenArm=a,s.colonToken=i,s.elseArm=c,s.kind="conditional",s.children=[s.condition,s.questionMarkToken,s.thenArm,s.colonToken,s.elseArm],s}return Object(I.a)(t,[{key:"print",value:function(e){e("("),this.condition.print(e),e(" ? "),this.thenArm.print(e),e(" : "),this.elseArm.print(e),e(")")}}]),t}(te),be=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e){var o;return Object(L.a)(this,t),(o=n.call(this)).precedence=e,o}return Object(I.a)(t,[{key:"parse",value:function(e,n,t){var o=e.parseExpression(),r=e.consume(W.COLON),a=e.parseExpression(this.precedence-1);return new fe([].concat(Object(N.a)(n.tokens),[t],Object(N.a)(o.tokens),[r],Object(N.a)(a.tokens)),n,t,o,r,a)}},{key:"getPrecedence",value:function(){return this.precedence}}]),t}(ae),pe=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e){var o;return Object(L.a)(this,t),(o=n.call(this)).rightParenTokenType=e,o}return Object(I.a)(t,[{key:"parse",value:function(e,n){var t=e.parseExpression(),o=e.consume(this.rightParenTokenType);return t.tokens=[n].concat(Object(N.a)(t.tokens),[o]),t.children=[n,t,o],t}}]),t}(ie),je=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e};return Object(L.a)(this,t),(e=n.call(this)).getName=o,e}return Object(I.a)(t,[{key:"parse",value:function(e,n){var t=this.getName(n.text);return new se([n],t,n.text)}}]),t}(ie),ve=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o,r){var a;return Object(L.a)(this,t),(a=n.call(this)).tokens=e,a.left=o,a.operatorToken=r,a.kind="postfix",a.children=[a.left,a.operatorToken],a}return Object(I.a)(t,[{key:"print",value:function(e){e("("),this.left.print(e),e(ne(this.operatorToken.type)),e(")")}}]),t}(te),me=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e){var o;return Object(L.a)(this,t),(o=n.call(this)).precedence=e,o}return Object(I.a)(t,[{key:"parse",value:function(e,n,t){return new ve([].concat(Object(N.a)(n.tokens),[t]),n,t)}},{key:"getPrecedence",value:function(){return this.precedence}}]),t}(ae),ge=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o,r){var a;return Object(L.a)(this,t),(a=n.call(this)).tokens=e,a.operatorToken=o,a.right=r,a.kind="prefix",a.children=[a.right],a}return Object(I.a)(t,[{key:"print",value:function(e){e("("),e(ne(this.operatorToken.type)),this.right.print(e),e(")")}}]),t}(te),Oe=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e){var o;return Object(L.a)(this,t),(o=n.call(this)).precedence=e,o}return Object(I.a)(t,[{key:"parse",value:function(e,n){var t=e.parseExpression(this.precedence);return new ge([n].concat(Object(N.a)(t.tokens)),n,t)}},{key:"getPrecedence",value:function(){return this.precedence}}]),t}(ie),xe=ce,ye=function e(){Object(L.a)(this,e)};ye.BOOLEAN_OP=1,ye.CONDITIONAL=2,ye.ASSIGNMENT=3,ye.SUM=4,ye.PRODUCT=5,ye.EXPONENT=6,ye.PREFIX=7,ye.POSTFIX=8,ye.CALL=9;var we=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o,r){var a;return Object(L.a)(this,t),(a=n.call(this)).tokens=e,a.type=o,a.value=r,a.kind="literal",a.children=a.tokens,a}return Object(I.a)(t,[{key:"print",value:function(e){"string"!==this.type?(e("["),e(this.type),e(" "),e(String(this.value)),e("]")):e("'".concat(this.value,"'"))}}]),t}(te),ke=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o){var r;return Object(L.a)(this,t),(r=n.call(this)).getValue=e,r.getType=o,r}return Object(I.a)(t,[{key:"parse",value:function(e,n){var t=this.getValue(n),o=this.getType(n);return new we([n],o,t)}}]),t}(ie),Ee=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o){var r;return Object(L.a)(this,t),(r=n.call(this)).selectorToken=e,r.selector=o,r.kind="selector",r.children=[r.selectorToken],r.tokens=[r.selectorToken],r}return Object(I.a)(t,[{key:"print",value:function(e){e(this.selectorToken.text)}}]),t}(te),Ne=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e){var o;return Object(L.a)(this,t),(o=n.call(this)).getSelector=e,o}return Object(I.a)(t,[{key:"parse",value:function(e,n){var t=this.getSelector(n.text);return new Ee(n,t)}}]),t}(ie),Te=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e){var o;return Object(L.a)(this,t),(o=n.call(this,Object(c.a)({onExpression:function(e){return o.expressions.push(e)},onToken:function(e){return o.tokens.push(e)}},e))).expressions=[],o.tokens=[],o.register(W.NAME,new je((function(e){return e.startsWith("$")?e.slice(2,e.length-1):e}))),o.register(W.SELECTOR,new Ne((function(e){return e.split("/")}))),o.register(W.FLOAT_LITERAL,new ke((function(e){return parseFloat(e.text)}),(function(){return"float"}))),o.register(W.INT_LITERAL,new ke((function(e){return parseInt(e.text,10)}),(function(){return"int"}))),o.register(W.STRING_LITERAL,new ke((function(e){return e.text.slice(1,e.text.length-1)}),(function(){return"string"}))),o.register(W.QUESTION,new be(ye.CONDITIONAL)),o.register(W.LEFT_PAREN,new pe(W.RIGHT_PAREN)),o.register(W.LEFT_PAREN,new he(W.RIGHT_PAREN,W.COMMA,ye.CALL)),o.infixRight(W.COMPARISON,ye.CONDITIONAL),o.infixLeft(W.BOOLEAN_AND,ye.BOOLEAN_OP),o.infixLeft(W.BOOLEAN_OR,ye.BOOLEAN_OP),o.infixLeft(W.PLUS,ye.SUM),o.infixLeft(W.MINUS,ye.SUM),o.infixLeft(W.ASTERISK,ye.PRODUCT),o.infixLeft(W.SLASH,ye.PRODUCT),o.infixLeft(W.MODULO,ye.EXPONENT),o}return Object(I.a)(t,[{key:"postfix",value:function(e,n){this.register(e,new me(n))}},{key:"prefix",value:function(e,n){this.register(e,new Oe(n))}},{key:"infixLeft",value:function(e,n){this.register(e,new ue(n,!1))}},{key:"infixRight",value:function(e,n){this.register(e,new ue(n,!0))}}]),t}(xe),Ae=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(c.a)({type:Object,blackbox:!0,custom:function(){var e=this.value;if(void 0!==e){if("string"===typeof e)return"notAllowed";for(var n=Object.keys(e),t=0;t<n.length;t+=1){if("string"!==typeof e[n[t]])return"notAllowed"}}}},e)},Se=Ae,Ce=Se({optional:!0}),Re=Ae({optional:!0}),Le=function(){try{var e=new re(this.value);new Te({tokens:e}).parseExpression()}catch(n){this.addValidationErrors([{name:this.key,type:"Invalid formula: ".concat(n.message),value:this.value}])}},Ie=new p.a({type:{type:String},name:{type:String,optional:!0,custom:function(){if(!["end_group","end_repeat"].includes(this.field("type").value)){var e=p.a.ErrorTypes.REQUIRED;if(this.operator){if(this.isSet){if("$set"===this.operator&&null===this.value||""===this.value)return e;if("$unset"===this.operator)return e;if("$rename"===this.operator)return e}}else if(!this.isSet||null===this.value||""===this.value)return e}}},constraint:{type:String,optional:!0,custom:Le},constraint_message:Ce,label:Ce,image:Ce,video:Ce,hint:Ce,guidance_hint:Ce,required_message:Ce,relevant:{type:String,optional:!0,custom:Le},choice_filter:{type:String,optional:!0},calculation:{type:String,optional:!0,custom:Le},trigger:{type:String,optional:!0,custom:Le},readonly:{type:String,optional:!0},required:{type:String,optional:!0,custom:Le},parameters:{type:String,optional:!0},repeat_count:{type:String,optional:!0,custom:Le},appearance:{type:String,optional:!0},default:{type:String,optional:!0},instance:Re,bind:Re,body:Re}),_e=new p.a({"list name":{type:String},name:{type:String},label:Se()}),De=new p.a({form_title:{type:String,optional:!0},form_id:{type:String,optional:!0},public_key:{type:String,optional:!0},submission_url:{type:String,optional:!0},default_language:{type:String,optional:!0},version:{type:String,optional:!0}});function Me(e){return Ie.validate(e)}var Fe=t(151);function Pe(e,n){if(e.type.match(/^end[ _](?:group|repeat)$/))throw new Z("Found '".concat(e.type,"' without a matching start marker in row ").concat(n+2,". Please check that the group/repeat nesting is correct. The row: ").concat(e))}function Be(e){var n={};return e.rows.forEach((function(e){var t=e["list name"],o=e.name,r=n[t]||{};r[o]=e,n[t]=r})),n}function Ue(e,n,t,o){var r=[];return{worksheets:{settings:t,choices:o,survey:e},rootSurveyGroup:function(e){for(var n=e.rows,t=e.defaultLanguage,o=e.formRootNameFromSettings,r=void 0===o?"data":o,a=e.titleFromSettings,i=void 0===a?"":a,c=e.onRow,s={children:[],type:"",typeParameters:[],rowIndex:-1,indentationLevel:0,row:{name:r,type:"",label:Object(C.a)({},t,i)}},l=[s],u=0;u<n.length;){var d=n[u],h=Ve(d.type).split(" "),f=Object(Fe.a)(h),b=f[0],p=f.slice(1),j=l[l.length-1];if("begin_group"===j.type&&"end_group"===b)l.pop(),null===c||void 0===c||c(d,j);else if("begin_repeat"===j.type&&"end_repeat"===d.type)l.pop(),null===c||void 0===c||c(d,j);else if(b.match(/^begin_(?:repeat|group)$/)){var v={row:d,type:b,typeParameters:p,children:[],indentationLevel:l.length-1,rowIndex:u};j.children.push(v),l.push(v),null===c||void 0===c||c(d,v)}else{Pe(d,u);var m={row:d,type:b,typeParameters:p,indentationLevel:l.length-1,rowIndex:u,children:[]};j.children.push(m),null===c||void 0===c||c(d,m)}u+=1}return{node:s}}({rows:e.rows,defaultLanguage:n,onRow:function(e,n){return r.push(n)}}).node,choicesByName:o?Be(o):{},languages:e.languages,flatNodes:r}}function Ge(e,n,t){var o=Object(c.a)({},e),r=new Set;return t&&n.forEach((function(e){o[e]&&(o["".concat(e,"::").concat(t)]=o[e]),r.add(t),delete o[e]})),n.forEach((function(e){Object.keys(o).filter((function(n){return n.startsWith(e)})).forEach((function(e){var n=e.split(/::/),t=Object(s.a)(n,2),a=t[0],i=t[1],c=o[a],l=String(o[e]);if(void 0===c)o[a]=Object(C.a)({},i,l),r.add(i);else{if("object"!==typeof c)throw new Q("Can't handle `".concat(a,"` column. Columns with prefix `").concat(a,"` must be namespaced with `::`. See chapter [\u2018Advanced use and extensibility\u2019](https://xlsform.org/en/#advanced-use-and-extensibility) in the documentation."));c[i]=l,r.add(i)}delete o[e]}))})),{result:o,foundSuffixes:r}}function ze(e){for(var n=[],t=0;t<e.length;t+=1){var o,r=(null===(o=e[t])||void 0===o?void 0:o.toString())||"";n.push(r.replace(/^constraint-msg\B/,"constraint_message").replace(/^requiredMsg\B/,"required_message").replace(/^bind::required$/,"required").replace(/^repeat-count$/,"repeat_count").replace(/^media::(image|audio|video)\B/,"$1").replace(/^photo\B/,"image").replace(/^list_name$/,"list name"))}return Object.freeze(n)}function Ve(e){return e.replace(/^media::(image|audio|video)\B/,"$1").replace(/^imei$/,"deviceid").replace(/^phone_number$/,"phonenumber").replace(/^select one\B/,"select_one").replace(/^select multiple\B/,"select_multiple").replace(/^location$/,"geopoint").replace(/^photo\B/,"image").replace(/^trigger$/,"acknowledge").replace(/^begin group$/,"begin_group").replace(/^end group$/,"end_group").replace(/^begin repeat$/,"begin_repeat").replace(/^end repeat$/,"end_repeat")}var $e={getAutoValues:!0,trimStrings:!0,mutate:!1};function He(e){var n=Ie.clean(Object(c.a)(Object(c.a)({},e),{},{type:Ve(String(e.type))}),$e);return Me(n),n}function Ke(e){var n=_e.clean(e,Object(c.a)(Object(c.a)({},$e),{},{filter:!1}));return function(e){_e.validate(e,{keys:["list name","name"]})}(n),n}function We(e){var n=De.clean(e,$e);return function(e){De.validate(e)}(n),n}var Xe=["label","hint","constraint_message","required_message","image","audio","video"];function qe(e,n,t,o){var r=e.getWorksheet(n),a=[];if(r){var i=r.getRows(1,1)[0];if(!(i.values instanceof Array))throw new Q("First row of the \u2018".concat(n,"\u2019 worksheet must be an array structure, but is a ").concat(typeof i.values," instead. Please fix this."));var c=i.values.slice(1).map((function(e){return(null===e||void 0===e?void 0:e.toString())||""})),s=ze(c),l=function(e,n){var t={};return e.forEach((function(e){t[e]=!0})),Ge(t,Xe,n).foundSuffixes}(s,o);return r.eachRow((function(e,n){1!==n&&a.push(function(e){var n=e.row,t=e.columnNames,o=e.defaultLanguage,r=e.loadRowFn,a={};n.values.slice(1).forEach((function(e,n){var o=t[n];a[o]="".concat(e)}));var i=Ge(a,Xe,o),c=Ge(i.result,["instance","bind","body"]).result;try{return r(c)}catch(s){throw new Q("Could not load row ".concat(JSON.stringify(c,null,2),": ").concat(s," / ").concat(JSON.stringify(s.details)))}}({row:e,columnNames:s,defaultLanguage:o,loadRowFn:t}))})),{rows:a,languages:l,columnNames:c,columnNamesNormalized:s}}}function Je(e){return Ye.apply(this,arguments)}function Ye(){return(Ye=Object(S.a)(A.a.mark((function e(n){var t,o,r,a,i;return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=qe(n,"settings",We),o=(null===t||void 0===t?void 0:t.rows[0].default_language)||"English (en)",r=qe(n,"choices",Ke,o),a=qe(n,"survey",He,o)){e.next=6;break}throw new Error("No `survey` sheet found in workbook. Please define a sheet named `survey` and try again.");case 6:return i=Ue(a,o,t,r),e.abrupt("return",i);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qe(e,n){var t={};return n.forEach((function(n){t[n]=e})),t}var Ze=0;var en=["calculation","required","relevant","readonly","constraint"];function nn(e,n){var t,o;if(!n)return!1;var r=null===(t=n.evaluationResults.get(e))||void 0===t||null===(o=t.get("relevant"))||void 0===o?void 0:o.result;return void 0===r||r}function tn(e){return"begin_group"===e.type||"begin_repeat"===e.type}function on(e,n,t){var o=n.row.name,r=[],a=new RegExp("\\${".concat(o,"}"));return e.flatNodes.forEach((function(i){var c,s,l=!1,u=Xe.flatMap((function(n){return Object(N.a)(e.languages.values()).map((function(e){return"".concat(n,".").concat(e)}))}));(c=Object(w.without)(en,"choice_filter")).concat.apply(c,Object(N.a)(u)).forEach((function(e){var r=Object(w.get)(i.row,e);if("string"!==typeof r&&void 0!==r)throw new Error("Replacing variable names works only with string cells. Please ensure the ".concat(e," cell of the ").concat(n.row.name," row has a string value."));if(null===r||void 0===r?void 0:r.match(a)){if(t){var c=null===r||void 0===r?void 0:r.replaceAll("${".concat(o,"}"),"${".concat(t,"}"));s=s||Object(w.cloneDeep)(i.row),Object(w.set)(s,e,c)}l=!0}})),l&&r.push({node:i,index:i.rowIndex,row:s||i.row})})),r}function rn(e){return e&&Object(N.a)(e.keys()).find((function(n){var t;return null===e||void 0===e||null===(t=e.get(n))||void 0===t?void 0:t.error}))}var an,cn=o.createContext({node:(an=new Set(["English (en)"]),Ze+=1,Object.freeze({row:{type:"text",name:"empty_node_".concat(Ze),label:Qe("Empty node ".concat(Ze),an)},type:"text",typeParameters:[],children:[],indentationLevel:0,rowIndex:-2}))}),sn={integer:"numerical",decimal:"numerical",range:"horizontal-distribution",text:"edit",select_one:"selection",select_one_from_file:"selection",select_multiple:"multi-select",select_multiple_from_file:"multi-select",rank:"sort-numerical",note:"lightbulb",geopoint:"map-marker",geotrace:"geofence",geoshape:"geofence",date:"calendar",time:"time",datetime:"time",image:"media",audio:"headset",video:"video",file:"upload",barcode:"barcode",calculate:"function",acknowledge:"switch",hidden:"eye-off","xml-external":"layout-hierarchy",start:"time",end:"time",today:"calendar",deviceid:"desktop",simserial:"sim-card",subscriberid:"id-number",phonenumber:"phone",username:"person",email:"envelope",audit:"shield",begin_group:"group-objects",begin_repeat:"repeat"},ln={integer:"Integer number",decimal:"Decimal number",range:"Slider",text:"Text field",select_one:"Single choice",select_one_from_file:"Single choice from file",select_multiple:"Multiple choice",select_multiple_from_file:"Multiple choice from file",rank:"Rank items",note:"Note / Hint",geopoint:"Locate a point",geotrace:"Trace a line",geoshape:"Draw a shape",date:"Date",time:"Time",datetime:"Date and time",image:"Image",audio:"Audio",video:"Video",file:"File",barcode:"Scan a code",acknowledge:"Checkbox",calculate:"Calculate formula",hidden:"Hidden field","xml-external":"External XML reference",start:"Survey start date and time",end:"Survey submission date and time",today:"Survey start day",deviceid:"Device ID",simserial:"SIM serial number",subscriberid:"Subscriber ID",phonenumber:"Phone number",username:"Username",email:"Email address",audit:"Audit trail",begin_group:"Field group",begin_repeat:"Repeat group"},un={literal:"edit",choice:"selection",geo:"globe",time:"time",media:"upload",stats:"scatter-plot",track:"person",special:"small-minus",grouping:"layout-hierarchy"},dn={literal:"Enter value",choice:"Choice",geo:"Maps",time:"Date and time",media:"Upload",special:"Other",stats:"Statistics",track:"Personal data",grouping:"Grouping"},hn={text:"literal",acknowledge:"literal",integer:"literal",decimal:"literal",range:"literal",barcode:"literal",select_one:"choice",select_one_from_file:"choice",select_multiple:"choice",select_multiple_from_file:"choice",rank:"choice",geopoint:"geo",geotrace:"geo",geoshape:"geo",date:"time",time:"time",datetime:"time",image:"media",audio:"media",video:"media",file:"media",note:"special",calculate:"special",hidden:"special","xml-external":"special",start:"stats",end:"stats",today:"stats",deviceid:"track",simserial:"track",subscriberid:"track",phonenumber:"track",username:"track",email:"track",audit:"track",begin_group:"grouping",begin_repeat:"grouping"},fn=[void 0,"","start","end","today","username","simserial","subscriberid","deviceid","phonenumber","calculate"],bn=o.createContext({onDropNode:function(){}});function pn(e){var n=function(){throw new Error("Given data is not a valid ODK node.")};"object"!==typeof e&&n(),Me(e.row),"string"===typeof e.type&&e.typeParameters instanceof Array&&e.typeParameters.every((function(e){return"string"===typeof e}))&&"number"===typeof e.indentationLevel&&"number"===typeof e.rowIndex&&(void 0===e.resultIsInvalid||"boolean"===typeof e.resultIsInvalid)||n(),e.children.forEach(pn)}var jn,vn=t(1),mn=f.a.code(jn||(jn=Object(l.a)(['\n  font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",\n    "Courier New", monospace;\n\n  .expression.has-error {\n    text-decoration: underline wavy ',";\n    text-decoration-skip: none;\n    text-decoration-skip-ink: none;\n    text-decoration-color: "," !important;\n\n    a {\n      text-decoration: underline wavy ",";\n      text-decoration-skip: none;\n      text-decoration-skip-ink: none;\n      text-decoration-color: "," !important;\n    }\n  }\n\n  .expression-name {\n    color: ",";\n  }\n\n  &.expression-call > .expression-name:first-child,\n  .expression-call > .expression-name:first-child {\n    color: ",";\n  }\n\n  .expression-name {\n    word-break: break-word;\n  }\n\n  .token-STRING_LITERAL {\n    color: ",";\n  }\n\n  .token-NUMBER_LITERAL {\n    color: ",";\n  }\n\n  .token-COMMA {\n    color: ",";\n  }\n\n  .token-LEFT_PAREN,\n  .token-RIGHT_PAREN {\n    color: ",";\n    font-weight: bold;\n  }\n\n  .token-INVALID {\n    border: 2px "," solid;\n    padding: 2px;\n    margin: -2px;\n    color: ",';\n  }\n\n  .token-COMMA::after {\n    content: "\xa0";\n  }\n\n  .expression-operator {\n    clear: left;\n  }\n\n  .token-COMPARISON {\n    &::after,\n    &::before {\n      content: "\u2002";\n    }\n    font-weight: bold;\n    color: ',";\n  }\n\n  .token-COLON,\n  .token-BOOLEAN_AND,\n  .token-BOOLEAN_OR,\n  .token-PLUS,\n  .token-GREATER_THAN,\n  .token-LESS_THAN,\n  .token-MODULO,\n  .token-QUESTION {\n    word-break: break-word;\n    display: block;\n    font-weight: bold;\n    color: ",";\n  }\n"])),g.a.RED2,g.a.RED2,g.a.RED2,g.a.RED2,g.a.GREEN3,g.a.BLUE3,g.a.ORANGE3,g.a.ORANGE4,g.a.GRAY1,g.a.BLUE2,g.a.RED5,g.a.RED5,g.a.RED2,g.a.RED2);function gn(e){var n=e.token,t=e.expression,r=e.parentExpression,a=e.node,i="token token-".concat(W[n.type]),c=o.useContext(m);if(n.type===W.NAME&&"call"===(null===r||void 0===r?void 0:r.kind)&&t instanceof se&&n===r.tokens[0])return Object(vn.jsx)("a",{href:"https://getodk.github.io/xforms-spec/#fn:".concat(n.text),className:i,target:"docs",children:n.text});if(n.type===W.NAME&&t instanceof se&&n.text.startsWith("$")&&c.context){var s=P(t.name,c.context,a)||F(t.name,c.context,c.context.survey);return!s||s instanceof Array?Object(vn.jsx)("var",{className:i,"data-referenced-node":s,children:n.text}):Object(vn.jsxs)("var",{children:["${",Object(vn.jsx)(Zn,{node:s,editable:!1,nameOfOnlyShownTab:"calculation"}),"}"]})}return Object(vn.jsx)("span",{className:i,children:n.text})}function On(e){var n;if(!e.tokens)return Object(vn.jsx)(mn,{style:e.style,className:"".concat(e.className||""," expression expression-invalid"),children:e.code});var t=e.tokens[e.tokens.length-1],o=t.index+t.text.length;return Object(vn.jsxs)(mn,{style:e.style,className:"".concat(e.className||""," expression expression-invalid"),children:[e.tokens.map((function(n){return Object(vn.jsx)(gn,{token:n,node:e.node},n.index)})),Object(vn.jsx)("span",{className:O.a.TEXT_DISABLED,children:null===(n=e.code)||void 0===n?void 0:n.slice(o)})]})}function xn(e){if(!e.expression)return Object(vn.jsx)(On,Object(c.a)({},e));var n=e.error instanceof q&&e.error.expression===e.expression;return Object(vn.jsx)(mn,{style:e.style,className:"".concat(e.className||""," expression expression-").concat(e.expression.kind," ").concat(n?"has-error":""),children:e.expression.children.map((function(n,t){return n instanceof te?Object(vn.jsx)(xn,{code:n.tokens.map((function(e){return e.text})).join(""),expression:n,parentExpression:e.expression,tokens:n.tokens,error:e.error,node:e.node}):Object(vn.jsx)(gn,{token:n,expression:e.expression,parentExpression:e.parentExpression,node:e.node},n.index)}))})}function yn(e){var n=e.split(/\n/).find((function(e){return e.replace(/\s/,"").length>0}));if(!n)return e;var t=n.match(/^\s+/);if(!t)return e;var o=t[0];if(!o)return e;var r=new RegExp("^".concat(o));return e.split(/\n/).map((function(e){return e.replace(r,"")})).join("\n")}var wn=t(155),kn=t.n(wn);function En(e){var n;return"string"!==typeof e.children?Object(vn.jsx)(d.e,{intent:"danger",children:"Markdown content must be a string."}):Object(vn.jsx)("div",Object(c.a)(Object(c.a)({},Object(w.omit)(e,"children","marked")),{},{dangerouslySetInnerHTML:{__html:null===(n=e.marked)||void 0===n?void 0:n.call(e,yn(e.children))}}))}var Nn,Tn=function(e){return Object(vn.jsx)(En,Object(c.a)(Object(c.a)({},e),{},{marked:kn.a}))},An=Object(f.a)(Tn)(Nn||(Nn=Object(l.a)(['\n  h1,\n  h2,\n  h3,\n  h4,\n  h5 {\n    margin: 1em 0;\n  }\n\n  code,\n  pre {\n    font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",\n      "Courier New", monospace;\n    color: ',";\n    /* border: 1px solid rgba(0, 0, 0, 0.2); */\n    margin: -1px;\n    padding: 2px 3px;\n    background-color: rgba(255, 255, 255, 0.3);\n  }\n\n  pre {\n    padding: 0.5em 0.55em;\n    margin: 0.5em 0;\n    line-height: 1.3em;\n    background: white;\n    white-space: pre-wrap;\n  }\n\n  code {\n    font-weight: 600;\n  }\n\n  p {\n    margin-block-end: 16px;\n  }\n  p:last-child {\n    margin-block-end: 0;\n  }\n\n  ul,\n  ol {\n    margin: 1em 1.25em;\n  }\n"])),g.a.DARK_GRAY1);function Sn(e){var n=e.answer,t=e.columnName,o=e.nodeName;return Object(vn.jsx)(d.N,{className:O.a.TEXT_MUTED,children:{calculation:void 0===n||""===n?Object(vn.jsxs)(vn.Fragment,{children:["This survey field has no entered answer yet, and the"," ",Object(vn.jsx)("code",{children:t})," cell is empty."]}):Object(vn.jsxs)(vn.Fragment,{children:["This is the answer value entered in the ",Object(vn.jsx)("code",{children:o})," ","field."]}),required:Object(vn.jsxs)(vn.Fragment,{children:["This means users are not required to enter this field. This is the default when the ",Object(vn.jsx)("code",{children:t})," cell is empty."]}),relevant:Object(vn.jsxs)(vn.Fragment,{children:["This means the survey field is always shown. This is the default behavior when the ",Object(vn.jsx)("code",{children:t})," cell is empty."]}),readonly:Object(vn.jsxs)(vn.Fragment,{children:["This means the survey field enables input. This is the default behavior when the ",Object(vn.jsx)("code",{children:t})," cell is empty."]}),constraint:Object(vn.jsxs)(vn.Fragment,{children:["If the cell contains a formula that evaluates to ",Object(vn.jsx)("code",{children:"true"})," ","or if there is no formula in the ",Object(vn.jsx)("code",{children:t})," cell, the field accepts any input."]})}[t]})}function Cn(e){var n=e.results,t=e.columnName,o=e.formulaIsTrivial;return Object(vn.jsx)(d.N,{className:O.a.TEXT_MUTED,children:{calculation:!o&&Object(vn.jsx)(vn.Fragment,{children:"This is the result of the formula."}),required:"This means you ".concat((null===n||void 0===n?void 0:n.result)?"can\u2019t":"can"," complete the survey without entering data in this field."),relevant:"This means the survey field is ".concat((null===n||void 0===n?void 0:n.result)?"shown":"hidden","."),readonly:"This means the survey field is ".concat((null===n||void 0===n?void 0:n.result)?"read-only":"editable","."),constraint:"This means the survey field contains an input that is ".concat((null===n||void 0===n?void 0:n.result)?"allowed":"not allowed"," by the constraint formula..")}[t]})}function Rn(e){var n,t,r,a,i=e.node,s=e.columnName,l=e.nodeEvaluationResults,u=e.style,h=o.useContext(m),f=i.row[s],b=null===l||void 0===l?void 0:l.get(s),p=void 0===f,j="literal"===(null===b||void 0===b||null===(n=b.expression)||void 0===n?void 0:n.kind),v="name"===(null===b||void 0===b||null===(t=b.expression)||void 0===t?void 0:t.kind),O=null===(r=h.context)||void 0===r?void 0:r.nodesToAnswers.get(i),x=h.context?z(i,h.context):i.row.name,y=(null===b||void 0===b?void 0:b.expression)instanceof we||(null===b||void 0===b?void 0:b.expression)instanceof se&&(null===b||void 0===b?void 0:b.expression.name)===(null===b||void 0===b?void 0:b.expression.text),w="Result";return p?"calculation"===s?void 0!==O&&(w="Using answer value"):w="Default value":w=Object(vn.jsxs)(vn.Fragment,{children:[Object(vn.jsx)(d.x,{icon:"function"})," ","calculation"===s?"Formula":"Condition"]}),Object(vn.jsxs)(qn,{lang:"en",style:Object(c.a)({backgroundColor:g.a.LIGHT_GRAY5,marginTop:"0",padding:"20px",background:"linear-gradient(".concat(E(g.a.BLUE3,.06),", ").concat(E(g.a.BLUE3,.05)," 5px, ").concat(E(g.a.BLUE3,.01)," 10px, transparent 30px)"),borderTop:"solid 1px ".concat(g.a.LIGHT_GRAY3)},u),children:[Object(vn.jsx)("h4",{children:w}),!p&&Object(vn.jsx)(vn.Fragment,{children:Object(vn.jsx)(Xn,{style:{fontSize:j||v?"20px":"16px",lineHeight:"28px"},children:Object(vn.jsx)(xn,{node:i,state:null===b||void 0===b?void 0:b.state,error:null===b||void 0===b?void 0:b.error,expression:null===b||void 0===b?void 0:b.expression,code:String(f),tokens:null===b||void 0===b||null===(a=b.parser)||void 0===a?void 0:a.tokens})})}),(p||!y)&&Object(vn.jsxs)(vn.Fragment,{children:[!p&&!b&&Object(vn.jsx)(d.e,{intent:"none",children:"Not calculated yet."}),"error"!==(null===b||void 0===b?void 0:b.state)&&Object(vn.jsx)(Xn,{style:{fontSize:"20px",lineHeight:"28px"},children:void 0===(null===b||void 0===b?void 0:b.result)?"undefined":JSON.stringify(b.result)})]}),"error"===(null===b||void 0===b?void 0:b.state)&&Object(vn.jsxs)(Jn,{intent:"danger",children:[b.error instanceof q&&Object(vn.jsxs)(vn.Fragment,{children:["Error in\xa0",Object(vn.jsx)("code",{children:Object(vn.jsx)(xn,{node:i,expression:b.error.expression})}),":"]}),Object(vn.jsx)(An,{children:b.error.toMarkdown()})]}),!p&&void 0!==(null===b||void 0===b?void 0:b.result)&&Object(vn.jsx)(Cn,{results:b,columnName:s,formulaIsTrivial:y}),p&&Object(vn.jsx)(Sn,{answer:O,columnName:s,nodeName:x})]})}var Ln=t(67);function In(e){var n=e.xlsForm,t=e.node,r=null===n||void 0===n?void 0:n.choicesByName,a=r?Object.keys(r):[],i=o.useContext(m),s=o.useCallback((function(e){var n=e.currentTarget.checked,o=e.currentTarget.value,r=Object(N.a)(t.typeParameters);n?r.push(o):r=Object(w.without)(r,o);var a=[t.type].concat(Object(N.a)(r)).join(" "),s=Object(c.a)(Object(c.a)({},t.row),{},{type:a});i.onSpliceRows("survey",[{rowIndex:t.rowIndex,numberOfRowsToRemove:1,rowsToAdd:[s]}])}),[i,t]);return Object(vn.jsxs)(d.z,{children:[Object(vn.jsx)("li",{className:"bp3-menu-header",children:Object(vn.jsx)("h6",{className:"bp3-heading",children:"Set which choice lists should be visible."})}),Object(vn.jsx)(d.i,{style:{margin:"16px 8px 4px"},vertical:!0,children:a.map((function(e){var n=t.typeParameters.includes(e),o=e,a=r[e],i=Object.keys(a),c=Object(w.sortBy)(i.map((function(e){return a[e]})),(function(e){return e.name.toLowerCase()})),l=c.slice(0,4).map((function(e){return Object(vn.jsx)("li",{children:Object(vn.jsx)(d.g,{style:{marginInline:"1px"},children:e.name},e.name)})})),u=c.length>4&&Object(vn.jsxs)("span",{className:O.a.UI_TEXT,style:{lineHeight:"24px",marginLeft:"4px",paddingRight:"2px"},"aria-label":"and ".concat(c.length-4," more"),children:["+ ",c.length-4]}),h=Object(vn.jsxs)(d.i,{fill:!0,style:{display:"inline-flex"},children:[Object(vn.jsx)("header",{"aria-label":"Choice list ".concat(e,", allowed values:"),children:Object(vn.jsx)(d.N,{children:o})}),Object(vn.jsx)("ul",{className:O.a.LIST_UNSTYLED,children:Object(vn.jsxs)(d.i,{style:{justifyContent:"flex-end",marginLeft:"16px"},children:[l,u]})})]});return Object(vn.jsx)(d.f,{value:e,onChange:s,large:!0,checked:n,disabled:1===t.typeParameters.length&&e===t.typeParameters[0],children:h})}))}),Object(vn.jsxs)(d.e,{intent:"primary",children:["The content of these lists is defined in the ",Object(vn.jsx)("code",{children:"choices"})," Excel sheet."]})]})}function _n(){var e=o.useContext(m),n=o.useContext(cn).node,t=o.useCallback((function(t){var o=t.currentTarget.dataset.type,r=(null===o||void 0===o?void 0:o.match(/^select/))?n.typeParameters:[],a=[o].concat(Object(N.a)(r)).join(" "),i=Object(c.a)(Object(c.a)({},n.row),{},{type:a});e.onSpliceRows("survey",[{rowIndex:n.rowIndex,numberOfRowsToRemove:1,rowsToAdd:[i]}])}),[e,n]);return Object(vn.jsxs)(d.z,{children:[Object(vn.jsx)("li",{className:"bp3-menu-header",children:Object(vn.jsx)("h6",{className:"bp3-heading",children:"Set a field type."})}),Object.keys(un).filter((function(e){return"special"!==e&&"grouping"!==e})).map((function(e){return Object(vn.jsx)(d.B,{text:dn[e],icon:un[e],children:Object.keys(hn).filter((function(n){return hn[n]===e})).map((function(e){return Object(vn.jsx)(d.B,{text:ln[e],icon:sn[e],onClick:t,"data-type":e})}))})})),Object(vn.jsx)(d.A,{}),Object.keys(hn).filter((function(e){return"special"===hn[e]})).map((function(e){return Object(vn.jsx)(d.B,{text:ln[e],icon:sn[e],onClick:t,"data-type":e})}))]})}function Dn(e){var n=e.node,t=e.showType,r=tn(n),a=o.useContext(m).xlsForm,i=!!a&&Object.keys(null===a||void 0===a?void 0:a.choicesByName).length>0,c=a&&Object(vn.jsx)(In,{xlsForm:a,node:n}),s=function(){var e=o.useContext(m),n=o.useCallback((function(){var n,t=(null===(n=e.xlsForm)||void 0===n?void 0:n.languages)||new Set(["English (en)"]),o=[{"list name":"yes_no_maybe",name:"yes",label:Qe("yes",t)},{"list name":"yes_no_maybe",name:"no",label:Qe("no",t)},{"list name":"yes_no_maybe",name:"maybe",label:Qe("maybe",t)}];e.onSpliceRows("choices",[{rowIndex:0,numberOfRowsToRemove:0,rowsToAdd:o}])}),[e]),t=Object(vn.jsx)(d.c,{large:!0,intent:"primary",onClick:n,children:"Create example choice list"});return Object(vn.jsx)(d.i,{style:{padding:"16px"},children:Object(vn.jsx)(d.D,{icon:"selection",action:t,title:"Sometimes, we have no choice.",description:Object(vn.jsx)(vn.Fragment,{children:"This survey has no choice lists yet. Please add one first to make it available for this survey question."})})})}(),l=ln[n.type],u=sn[n.type],h=n.typeParameters.length>0;return r?Object(vn.jsxs)("span",{className:[O.a.TEXT_MUTED].join(" "),style:{alignSelf:"center",marginLeft:"8px"},children:[Object(vn.jsx)(d.x,{icon:u}),"\xa0",l]}):Object(vn.jsxs)(d.d,{children:[t&&Object(vn.jsx)(x.a,{content:Object(vn.jsx)(_n,{}),lazy:!0,children:Object(vn.jsx)(d.c,{icon:u||"blank",fill:!1,minimal:!0,children:l})}),n.type.match(/^select/)&&Object(vn.jsx)(x.a,{lazy:!0,content:i?c:s,children:Object(vn.jsxs)(d.c,{fill:!0,minimal:!0,intent:h?"none":"warning",children:[!h&&"Set visible choices",h&&Object(vn.jsx)(d.F,{observeParents:!0,minVisibleItems:2,collapseFrom:Ln.a.END,items:n.typeParameters,visibleItemRenderer:function(e){return Object(vn.jsx)(d.g,{children:e})},overflowRenderer:function(e){return Object(vn.jsx)("span",{children:"+ ".concat(e.length)})},style:{transition:"width 0.1s ease-out",maxWidth:"200px"}})]})})]})}function Mn(e){var n=e.path,t=e.width;return Object(vn.jsx)(d.b,{items:n.map((function(e,t){return{href:"#//".concat(n.slice(0,t+1).join("/")),text:e}})),collapseFrom:"start",overflowListProps:{minVisibleItems:1,style:{transition:"width 0.1s ease-out",width:"".concat(t,"px")}}})}var Fn,Pn,Bn,Un,Gn=t(58),zn=t(33),Vn=d.O.create({className:"recipe-toaster",position:zn.a.TOP});function $n(e){var n,t,r=o.useContext(m);return Object(vn.jsxs)(d.z,{children:[Object(vn.jsx)("li",{className:"bp3-menu-header",children:Object(vn.jsxs)("h6",{className:"bp3-heading",children:[1===e.references.length?"There is one link":"There are ".concat(null===(n=e.references)||void 0===n?void 0:n.length," links")," ","to this field."]})}),null===(t=e.references)||void 0===t?void 0:t.map((function(e){var n;if(!r.context)return null;var t="#//".concat(z(e.node,r.context,"/"));return Object(vn.jsx)(d.B,{text:Object(vn.jsx)("code",{children:null===(n=e.node)||void 0===n?void 0:n.row.name}),icon:sn[e.node.type],href:t})}))]})}function Hn(e){var n=e.node,t=e.position,r=e.icon,a=e.group,i=e.omitAction,c=Object(o.useContext)(m),s=Object(vn.jsxs)(vn.Fragment,{children:[i?null:"Add ".concat(a?"group":"field")," ",t," ",Object(vn.jsx)(d.g,{children:n.row.name})]}),l=Object(o.useCallback)((function(){c.onAddNode({position:t,node:n,group:a})}),[c,a,n,t]);return Object(vn.jsx)(d.B,{icon:r,onClick:l,text:s})}function Kn(e){var n,t=Object(o.useContext)(m),r=e.node;if(!r)return null;var a=tn(r),i=a?"Rename group\u2026":"Rename field\u2026",c=t.language&&(null===(n=r.row.hint)||void 0===n?void 0:n[t.language]);return Object(vn.jsxs)(vn.Fragment,{children:[Object(vn.jsx)(d.B,{icon:"edit",text:i,onClick:e.renameNode}),!c&&Object(vn.jsx)(d.B,{icon:"lightbulb",text:"Add hint",onClick:e.addHintToNode}),Object(vn.jsx)(d.A,{}),Object(vn.jsxs)(d.B,{icon:"group-objects",text:"Add group",children:[Object(vn.jsx)(Hn,{node:r,position:"before",icon:"arrow-up",group:!0,omitAction:!0}),a&&Object(vn.jsx)(Hn,{node:r,position:"inside",icon:"key-enter",group:!0,omitAction:!0}),Object(vn.jsx)(Hn,{node:r,position:"after",icon:"arrow-down",group:!0,omitAction:!0})]}),Object(vn.jsxs)(d.B,{icon:"manually-entered-data",text:"Add field",children:[Object(vn.jsx)(Hn,{node:r,position:"before",icon:"arrow-up",group:!1,omitAction:!0}),a&&Object(vn.jsx)(Hn,{node:r,position:"inside",icon:"key-enter",group:!1,omitAction:!0}),Object(vn.jsx)(Hn,{node:r,position:"after",icon:"arrow-down",group:!1,omitAction:!0})]}),Object(vn.jsx)(d.A,{}),Object(vn.jsx)(d.B,{icon:"group-objects",text:"Nest in new group",onClick:e.nestNode}),a&&Object(vn.jsx)(d.B,{icon:"ungroup-objects",text:"Ungroup",onClick:e.ungroupNode}),Object(vn.jsx)(d.A,{}),Object(vn.jsx)(d.B,{intent:"danger",icon:"trash",text:"Remove ".concat(a?"group":"field","\u2026"),onClick:e.removeNode})]})}function Wn(e){var n=Object(o.useContext)(m),t=function(e){var n=Object(o.useContext)(m),t=Object(o.useState)(!1),r=Object(s.a)(t,2),a=r[0],i=r[1],c=e&&tn(e),l=Object(o.useCallback)((function(){i(!1)}),[]),u=Object(o.useCallback)((function(){e&&(Vn.show({intent:"none",message:Object(vn.jsxs)(vn.Fragment,{children:[Object(vn.jsx)("code",{children:e.row.name})," field removed."]})}),n.onRemoveRowAndChildren(e),i(!1))}),[n,e]);return{showRemoveConfirmationDialog:Object(o.useCallback)((function(){i(!0)}),[]),alert:Object(vn.jsxs)(d.a,{cancelButtonText:"Cancel",confirmButtonText:"Delete",icon:"trash",intent:Gn.a.DANGER,isOpen:a,onCancel:l,onConfirm:u,canOutsideClickCancel:!0,canEscapeKeyCancel:!0,children:[Object(vn.jsxs)("p",{children:["Are you sure you want to remove the ",Object(vn.jsx)("code",{children:null===e||void 0===e?void 0:e.row.name})," ",c?"group":"field","?"]}),c&&(null===e||void 0===e?void 0:e.children.length)&&Object(vn.jsx)("p",{children:"This will also remove the group\u2019s nested fields."})]})}}(e),r=t.alert,a=t.showRemoveConfirmationDialog,i=function(e){var n=Object(o.useContext)(m),t=Object(o.useState)(!1),r=Object(s.a)(t,2),a=r[0],i=r[1],c=Object(o.useState)(""),l=Object(s.a)(c,2),u=l[0],h=l[1],f=Object(o.useState)([]),b=Object(s.a)(f,2),p=b[0],j=b[1];Object(o.useEffect)((function(){h("")}),[null===e||void 0===e?void 0:e.row.name,e]),Object(o.useEffect)((function(){n.xlsForm&&e&&j(on(n.xlsForm,e,u))}),[null===e||void 0===e?void 0:e.row.name,e,n.xlsForm,u]);var v=Object(o.useCallback)((function(e){h(e.currentTarget.value)}),[]),g=Object(o.useCallback)((function(){i(!1)}),[]),y=Object(o.useCallback)((function(t){t.preventDefault(),e&&(n.onRenameNode(e,u),Vn.show({intent:"none",message:Object(vn.jsxs)(vn.Fragment,{children:["The field has been renamed to \u2018",Object(vn.jsx)("code",{children:u}),"\u2019."]})}),i(!1))}),[n,u,e]),w=Object(o.useCallback)((function(){i(!0)}),[]),k=p.length>0?Object(vn.jsx)(x.a,{content:Object(vn.jsx)($n,{references:p}),lazy:!0,children:Object(vn.jsxs)(d.c,{minimal:!0,intent:"primary",children:["See ",p.length," updates\u2026"]})}):void 0,E=e&&tn(e);return{showRenameDialog:w,dialog:Object(vn.jsx)(d.j,{title:Object(vn.jsxs)(vn.Fragment,{children:["Rename \u2018",Object(vn.jsx)("code",{children:null===e||void 0===e?void 0:e.row.name}),"\u2019 ",E?"group":"field","\u2026"]}),icon:"edit",isOpen:a,canOutsideClickClose:!0,canEscapeKeyClose:!0,isCloseButtonShown:!0,onClose:g,lazy:!0,children:Object(vn.jsxs)("form",{onSubmit:y,children:[Object(vn.jsx)("div",{className:O.a.DIALOG_BODY,children:Object(vn.jsx)(d.n,{label:"Please enter a new name for this ".concat(E?"group":"field",":"),labelFor:"newName",style:{display:"flex"},children:Object(vn.jsx)(d.y,{id:"newName",placeholder:"Enter a field name\u2026",defaultValue:null===e||void 0===e?void 0:e.row.name,large:!0,onChange:v,pattern:"[\\w\\d_-]+"})})}),Object(vn.jsx)("div",{className:O.a.DIALOG_FOOTER,children:Object(vn.jsxs)("div",{className:O.a.DIALOG_FOOTER_ACTIONS,children:[Object(vn.jsx)("div",{children:k}),Object(vn.jsx)(d.c,{onClick:g,type:"button",children:"Close"}),Object(vn.jsx)(d.c,{intent:Gn.a.PRIMARY,type:"submit",disabled:""===u,children:"Rename"})]})})]})})}}(e),c=i.dialog,l=i.showRenameDialog,u=Object(vn.jsxs)(vn.Fragment,{children:[r,c]}),h=Object(o.useCallback)((function(){e&&n.onChangeCell("survey",null===e||void 0===e?void 0:e.rowIndex,"hint"," ",e)}),[n,e]),f=Object(o.useCallback)((function(){var t;e&&(null===(t=n.xlsForm)||void 0===t||t.languages.forEach((function(t){n.onChangeCell("survey",null===e||void 0===e?void 0:e.rowIndex,"hint","",e,t)})))}),[n,e]);return{nodeActionDialogs:u,nodeActionMenuItems:e&&Object(vn.jsx)(Kn,{node:e,removeNode:a,renameNode:l,nestNode:n.onNestNode.bind(void 0,e),ungroupNode:n.onUngroupNode.bind(void 0,e),addHintToNode:h,removeHintFromNode:f})}}var Xn=Object(f.a)(d.g)(Fn||(Fn=Object(l.a)(["\n  overflow: auto;\n  word-break: break-all;\n  font-size: 16px;\n  line-height: 20px;\n  display: block;\n  border: none;\n  box-shadow: none;\n  background: transparent;\n  padding: 0;\n"]))),qn=f.a.div(Pn||(Pn=Object(l.a)(["\n  display: grid;\n  gap: 8px;\n\n  h1,\n  h2,\n  h3,\n  h4,\n  h5 {\n    margin: 0;\n    &:not(:first-child) {\n      margin-top: 8px;\n    }\n  }\n"]))),Jn=Object(f.a)(d.e)(Bn||(Bn=Object(l.a)(['\n  > code,\n  pre {\n    font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",\n      "Courier New", monospace;\n    color: ',';\n    /* border: 1px solid rgba(0, 0, 0, 0.2); */\n    margin: -1px;\n    padding: 2px 4px;\n    background-color: rgba(255, 255, 255, 0.3);\n  }\n\n  pre {\n    padding: 0.5em 0.55em;\n    margin: 0.5em 0;\n    line-height: 1.3em;\n    background: white;\n    white-space: pre-wrap;\n  }\n\n  code {\n    font-weight: 600;\n    font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",\n      "Courier New", monospace;\n  }\n'])),g.a.DARK_GRAY1),Yn=f.a.div(Un||(Un=Object(l.a)(["\n  position: absolute;\n  top: 0px;\n  left: -20px;\n  width: calc(100% + 40px);\n  height: 5px;\n  background-color: ",";\n  z-index: 10000000;\n"])),g.a.BLUE3);function Qn(e){var n=e.detailsButtonCaption,t=e.hasTypeIcon,r=o.useContext(m),a=o.useContext(cn),i=a.node,l=a.nodeEvaluationResults,u=!fn.includes(i.type)&&nn(i,r.context),h=i.type.match(/^select/)&&0===i.typeParameters.length,f=!!rn(l),b=o.useState(!1),p=Object(s.a)(b,2),j=p[0],v=p[1],g=function(e){var n=e.context,t=e.node,r=e.setIsDraggedOver,a=o.useContext(bn).onDropNode,i=o.useCallback((function(e){n&&e.dataTransfer.setData("application/json",JSON.stringify({sourceNode:t,sourcePath:z(t,n)}))}),[n,t]),c=o.useCallback((function(e){e.preventDefault(),n&&r(!0)}),[n,r]),s=o.useCallback((function(e){if(n){var o=z(t,n),i=JSON.parse(e.dataTransfer.getData("application/json")),c=i.sourcePath,s=i.sourceNode;pn(s),console.log("Dropped on path",o),r(!1),a({sourceNode:s,sourcePath:c,destinationNode:t,position:"before"})}}),[n,t,a,r]);return{draggable:!0,onDragStart:i,onDragOver:c,onDragLeave:o.useCallback((function(e){if(n){var o=z(t,n);console.log("Left dragging at path",o),r(!1)}}),[n,t,r]),onDrop:s}}({context:r.context,node:i,setIsDraggedOver:v});return Object(vn.jsxs)(d.i,Object(c.a)(Object(c.a)({style:{display:"inline-flex",flex:"none",position:"relative",overflow:"visible"}},g),{},{children:[j&&Object(vn.jsx)(Yn,{}),Object(vn.jsx)(d.c,{minimal:!0,small:!0,lang:"en",intent:f?"danger":h?"warning":"none",rightIcon:f?"error":void 0,icon:t?sn[i.type]:void 0,style:{color:f||h?void 0:"inherit",fontSize:"inherit",padding:0},className:[!f&&!u&&O.a.TEXT_MUTED].filter(Boolean).join(" "),children:Object(vn.jsxs)(d.i,{children:[n||Object(vn.jsx)("code",{style:{color:"inherit"},children:i.row.name}),!u&&Object(vn.jsxs)(vn.Fragment,{children:["\xa0",Object(vn.jsx)(d.x,{icon:"eye-off",style:{opacity:.5,color:"inherit"}})]})]})})]}))}function Zn(e){var n,t=e.node,r=e.editable,a=e.nameOfOnlyShownTab,i=e.detailsButtonCaption,c=e.hasTypeIcon,l=o.useContext(m),u=null===(n=l.context)||void 0===n?void 0:n.evaluationResults.get(t),h=rn(u),f=t.row,b=fn.includes(t.type)?Object(w.without)(en,"relevant","readonly"):en,p=b.find((function(e){var n=f[e];return"string"===typeof n&&n.length>0})),j=o.useState(100),v=Object(s.a)(j,2),k=v[0],N=v[1],T=o.useCallback((function(e){setTimeout((function(){var n,t=null===(n=e[0])||void 0===n?void 0:n.contentRect.width;Math.abs(t-k)>10&&N(t)}),50)}),[k]),A=o.useState(h||p||"calculation"),S=Object(s.a)(A,2),C=S[0],R=S[1],L=o.useMemo((function(){return(null===l||void 0===l?void 0:l.xlsForm)&&on(l.xlsForm,t)}),[l,t]),I=Wn(t),_=I.nodeActionMenuItems,D=I.nodeActionDialogs;if(!l.context)return null;var M=G(t,l.context).slice(1),F=function(e){var n=e.references,t=e.editable,o=n&&(1===n.length?"One dependency":"".concat(n.length," dependencies"));return t&&n&&n.length>0&&Object(vn.jsx)(x.a,{content:Object(vn.jsx)($n,{references:n}),lazy:!0,children:Object(vn.jsx)(d.c,{icon:"link",fill:!1,minimal:!0,title:o,"aria-label":o,children:n.length})})}({references:L,editable:r}),P=Object(vn.jsxs)(d.i,{style:{margin:"-20px",marginBottom:"12px",backgroundColor:g.a.LIGHT_GRAY5,background:"linear-gradient(\n          ".concat(E(g.a.BLUE3,0)," 0px,\n          ").concat(E(g.a.BLUE3,.05)," 22px,\n          ").concat(E(g.a.BLUE3,.06)," 32px)"),borderBottom:"solid 1px ".concat(g.a.LIGHT_GRAY3),gap:"8px"},children:[Object(vn.jsx)(Dn,{node:t,showType:!0}),Object(vn.jsx)("div",{className:O.a.FLEX_EXPANDER}),F,Object(vn.jsx)(d.d,{fill:!1,children:Object(vn.jsx)(x.a,{content:Object(vn.jsx)(d.z,{children:_}),lazy:!0,children:Object(vn.jsx)(d.c,{icon:"more",minimal:!0,title:"Actions"})})})]}),B=Object(vn.jsxs)(d.i,{vertical:!0,children:[r&&P,Object(vn.jsx)(d.J,{onResize:T,observeParents:!0,children:Object(vn.jsx)(d.i,{style:{width:"100%",marginBottom:"8px"},children:Object(vn.jsx)(Mn,{path:M,width:k})})}),a?Object(vn.jsx)(Rn,{node:t,columnName:a,nodeEvaluationResults:u,style:{margin:"0 -20px 0 -20px"}}):Object(vn.jsx)(d.M,{onChange:R,selectedTabId:C,renderActiveTabPanelOnly:!1,children:b.map((function(e){return function(e){var n=e.nodeEvaluationResults,t=e.node,o=e.columnName,r=null===n||void 0===n?void 0:n.get(o),a=Object(vn.jsx)(Rn,{node:t,columnName:o,nodeEvaluationResults:n,style:{margin:"-20px"}});return Object(vn.jsx)(d.L,{id:o,panel:a,title:Object(vn.jsxs)(vn.Fragment,{children:[o,"error"===(null===r||void 0===r?void 0:r.state)&&Object(vn.jsxs)(vn.Fragment,{children:["\xa0",Object(vn.jsx)(d.x,{icon:"warning-sign",intent:"warning"})]})]})})}({node:t,nodeEvaluationResults:u,columnName:e})}))})]});return Object(vn.jsxs)(cn.Provider,{value:{node:t,nodeEvaluationResults:u},children:[D,Object(vn.jsx)(x.a,{lazy:!0,interactionKind:"click",popoverClassName:y.a.POPOVER2_CONTENT_SIZING,minimal:!1,placement:"bottom",rootBoundary:"viewport",onOpening:function(){return N(0)},modifiers:{arrow:{enabled:!0},preventOverflow:{enabled:!0}},content:B,fill:!1,targetTagName:"span",children:Object(vn.jsx)(Qn,{detailsButtonCaption:i,hasTypeIcon:c})})]})}function et(e){var n,t,r=e.node,a=o.useContext(m),i=null===(n=a.context)||void 0===n?void 0:n.evaluationResults.get(r);if(!i)return Object(vn.jsx)(d.x,{icon:"calculator",intent:"none"});var c=en.filter((function(e){var n;return null===(n=i.get(e))||void 0===n?void 0:n.error})),s=null===(t=a.context)||void 0===t?void 0:t.nodesToAnswers.get(r),l=void 0===s?null:JSON.stringify(s),u=Object(vn.jsx)("span",{children:l}),h="Node has errors in the following columns: ".concat(c.map((function(e){return"\u2018".concat(e,"\u2019")})).join(", ")),f=c.length?Object(vn.jsx)(d.x,{icon:"error",intent:"danger",title:h,htmlTitle:h}):null;return Object(vn.jsxs)(vn.Fragment,{children:[u,f]})}function nt(e,n,t){return 0===e.children.length?t({id:G(e,n).join("."),label:e.row.name,childNodes:[],nodeData:e}):t({id:G(e,n).join("."),label:e.row.name,childNodes:e.children.map((function(e){return nt(e,n,t)})),nodeData:e})}function tt(e){var n=e.xlsForm,t=o.useContext(m),r=t.context,a=o.useMemo((function(){return n&&r?nt(n.rootSurveyGroup,r,(function(e){var n,o=e.nodeData;if(!o)throw new Error("Encountered a tree node that is not associated with a node. Please fix this.");if(!t.context)throw new Error("No context defined. Please define a context before using this component.");var r=Object(vn.jsx)(Zn,{node:o,editable:!0,hasTypeIcon:!0});return Object(c.a)(Object(c.a)({},e),{},{label:r,key:o.row.name,isExpanded:!0,hasCaret:!(0===(null===(n=e.childNodes)||void 0===n?void 0:n.length)),secondaryLabel:o&&Object(vn.jsx)(et,{node:o})})})):null}),[t.context,r,n]);return a?Object(vn.jsx)(d.P,{contents:[a]}):Object(vn.jsx)("div",{})}function ot(e){var n=rt(e).onFileChange;return Object(vn.jsx)(d.m,{onInputChange:n,large:!0})}function rt(e){var n=e.setXLSForm,t=e.setLanguage,r=o.useCallback(function(){var e=Object(S.a)(A.a.mark((function e(o){var r,a,i;return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Je(o);case 2:i=e.sent,n(i),t((null===(r=i.worksheets.settings)||void 0===r?void 0:r.rows[0].default_language)||Object(N.a)(null===(a=i.languages)||void 0===a?void 0:a.values())[0]||"English (en)");case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[t,n]);return{onFileChange:o.useCallback((function(e){var n=e.target.files[0],t=new R.Workbook,o=new FileReader;o.readAsArrayBuffer(n),o.onload=function(){var e=o.result;if(!(e instanceof ArrayBuffer))throw new Error("Buffer was not defined as Buffer object after reading.");t.xlsx.load(e).then((function(e){r(t)}))}}),[r])}}function at(e){var n=e.setXLSForm,t=e.setLanguage,r=Object(vn.jsx)(ot,{setXLSForm:n,setLanguage:t}),a=Object(o.useCallback)(Object(S.a)(A.a.mark((function e(){var t,o;return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new R.Workbook).addWorksheet("survey"),t.addWorksheet("choices"),(o=t.addWorksheet("settings")).addRow(["default_language"]),o.addRow(["English (en)"]),e.t0=n,e.next=9,Je(t);case 9:e.t1=e.sent,(0,e.t0)(e.t1);case 11:case"end":return e.stop()}}),e)}))),[n]),i=Object(vn.jsxs)(d.i,{vertical:!0,children:[Object(vn.jsx)("p",{children:r}),Object(vn.jsx)("p",{children:"or"}),Object(vn.jsx)("p",{children:Object(vn.jsx)(d.c,{large:!0,onClick:a,children:"Start from scratch"})})]});return Object(vn.jsx)(d.D,{icon:"document-open",title:"Open an XLSForm Excel file to start.",action:i})}function it(e){return ct.apply(this,arguments)}function ct(){return(ct=Object(S.a)(A.a.mark((function e(n){var t,o,r,a,i,c,s;return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(o=new R.Workbook).modified=o.created=new Date,o.creator="Sozialheld*innen Survey Editor",["survey","choices","settings"].forEach((function(e){var t=null===n||void 0===n?void 0:n.worksheets[e];if(t){var r=o.addWorksheet(e),a=Object(N.a)((null===t||void 0===t?void 0:t.rows)||[]),i=ze(t.columnNames).map((function(e){return e.replace(/::/,".")}));r.columns=i.map((function(e){return{header:e,key:e,width:10}})),r.addRows(a.map((function(e){return i.map((function(n){return Xe.includes(n)&&(n="".concat(n,".English (en)")),Object(w.get)(e,n)}))})))}})),r=(null===n||void 0===n||null===(t=n.worksheets.settings)||void 0===t?void 0:t.rows[0].form_title)||"Untitled XLSForm survey",o.model.title=r,e.next=9,o.xlsx.writeBuffer();case 9:a=e.sent,i=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c=document.createElement("a"),document.body.appendChild(c),s=window.URL.createObjectURL(i),c.href=s,c.download=r,c.click(),setTimeout((function(){window.URL.revokeObjectURL(s),document.body.removeChild(c)}),0);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function st(e){var n=e.xlsForm,t=e.setXLSForm,o=e.setLanguage,a=r.a.createRef(),i=rt({setXLSForm:t,setLanguage:o}).onFileChange,c=r.a.useCallback((function(){t(void 0)}),[t]),s=r.a.useCallback(Object(S.a)(A.a.mark((function e(){return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=3;break}return e.next=3,it(n);case 3:case"end":return e.stop()}}),e)}))),[n]),l=Object(vn.jsxs)(d.z,{children:[Object(vn.jsx)("label",{htmlFor:"open-file-input",children:Object(vn.jsx)(d.B,{icon:"folder-open",text:"Open\u2026"})}),Object(vn.jsx)(d.B,{text:"Download",icon:"download",children:Object(vn.jsx)(d.B,{text:"Microsoft Excel (.xlsx)",onClick:s,disabled:!n})}),Object(vn.jsx)(d.B,{icon:"folder-close",text:"Close",onClick:c})]}),u=Object(vn.jsx)(d.c,{className:"bp3-minimal",icon:"folder-close",rightIcon:"caret-down"});return Object(vn.jsxs)(vn.Fragment,{children:[Object(vn.jsx)("input",{id:"open-file-input",type:"file",onChange:i,ref:a,style:{display:"none"}}),Object(vn.jsx)(x.a,{content:l,lazy:!0,placement:"bottom-end",minimal:!0,children:u})]})}var lt=t(400).a.ofType(),ut=function(e,n){return Object(vn.jsx)(d.B,{text:e,onClick:n.handleClick,shouldDismissPopover:!1})};function dt(e){var n=o.useCallback((function(n){e.onChange(n)}),[e]);return Object(vn.jsx)(lt,{items:e.languages,itemRenderer:ut,activeItem:e.language,noResults:Object(vn.jsx)(d.B,{disabled:!0,text:"No languages loaded yet."}),onItemSelect:n,filterable:!1,children:Object(vn.jsx)(d.c,{text:e.language,rightIcon:"double-caret-vertical",icon:"globe",minimal:!0})})}function ht(e){return Object(vn.jsx)("div",Object(c.a)(Object(c.a)({},e),{},{style:Object(c.a)({overflow:"auto",flex:1},e.style),children:e.children}))}var ft={table:!1,debug:!0,json:!1};function bt(e){return Object(vn.jsx)(d.K,{checked:e.checked,label:e.label,onChange:e.onChange,inline:!0,style:{marginBottom:"0"}})}var pt=t(80);function jt(e,n){if("string"!==typeof e){var t=Object(pt.ordinalize)(String(n+1));throw new Z("Expected a string value as ".concat(t," parameter, but got `").concat(e,"`."))}}function vt(e,n){if("number"!==typeof e){var t=Object(pt.ordinalize)(String(n+1));throw new Z("Expected a number value as ".concat(t," parameter, but got `").concat(e,"`."))}}function mt(e,n){if("boolean"!==typeof e){var t=Object(pt.ordinalize)(String(n+1));throw new Z("Expected a boolean value as ".concat(t," parameter, but got `").concat(e,"`."))}}var gt={if:function(e,n,t){return mt(e,0),e?n:t},true:function(){return!0},false:function(){return!1},not:function(e){return mt(e,0),!e},coalesce:function(e,n){return"undefined"!==typeof e&&""!==e?e:"undefined"!==typeof n&&""!==n?n:""},boolean:function(e){return"number"===typeof e?0!==e:"string"===typeof e?""!==e:e instanceof Array?e.length>0:"boolean"===typeof e&&e},position:function(e){throw new ee("position")},once:function(e){throw new ee("once")},selected:function(e,n){return void 0!==e&&(jt(e,0),jt(n,1),0!==e.length&&0!==n.length&&e.split(" ").includes(n))},"selected-at":function(e,n){throw new ee("selected-at")},"count-selected":function(e){throw new ee("count-selected")},"jr:choice-name":function(e,n){throw new ee("jr:choice-name")},"indexed-repeat":function(e,n,t,o,r,a,i){throw new ee("):")},count:function(e){throw new ee("count")},"count-non-empty":function(e){throw new ee("count-non-empty")},sum:function(e){throw new ee("sum")},max:function(e){throw new ee("max")},min:function(e){throw new ee("min")},regex:function(e,n){return jt(e,0),jt(n,0),!!e.match(new RegExp(n))},contains:function(e,n){return jt(e,0),jt(n,1),!!e.match(n)},"starts-with":function(e,n){return jt(e,0),jt(n,1),e.startsWith(n)},"ends-with":function(e,n){return jt(e,0),jt(n,1),e.endsWith(n)},substr:function(e,n,t){return jt(e,0),vt(n,1),vt(t,2),e.substring(n,t)},"substring-before":function(e,n){throw new ee("substring-before")},"substring-after":function(e,n){throw new ee("substring-after")},translate:function(e,n,t){throw new ee("translate")},"string-length":function(e){return jt(e,0),e.length},"normalize-space":function(e){return jt(e,0),e.trim()},concat:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return n.join("")},join:function(e,n){throw new ee("join")},"boolean-from-string":function(e){return"true"===e||"1"===e},string:function(e){return String(e)},round:function(e,n){return vt(e,0),vt(n,1),Math.round(e*Math.pow(10,n))/Math.pow(10,n)},int:function(e){return vt(e,0),Math.floor(e)},number:function(e){return"boolean"===typeof e?e?1:0:"string"===typeof e&&e.trim().match(/-?\d+(\.\d+)?/)?Number(e):"number"===typeof e?e:NaN},digest:function(e,n,t){throw new ee("digest")},pow:function(e,n){return vt(e,0),vt(n,1),Math.pow(e,n)},log:function(e){return vt(e,0),Math.log(e)},log10:function(e){return vt(e,0),Math.log10(e)},abs:function(e){return vt(e,0),Math.abs(e)},sin:function(e){return vt(e,0),Math.sin(e)},cos:function(e){return vt(e,0),Math.cos(e)},tan:function(e){return vt(e,0),Math.tan(e)},asin:function(e){return vt(e,0),Math.asin(e)},acos:function(e){return vt(e,0),Math.acos(e)},atan:function(e){return vt(e,0),Math.atan(e)},atan2:function(e,n){return vt(e,0),vt(n,1),Math.atan2(e,n)},sqrt:function(e){return vt(e,0),Math.sqrt(e)},exp:function(e){return vt(e,0),Math.exp(e)},exp10:function(e){return vt(e,0),Math.pow(10,e)},pi:function(){return Math.PI},today:function(){var e=new Date;return e.setHours(0,0,0,0),e},now:function(){return(new Date).toISOString()},"decimal-date-time":function(e){throw new ee("decimal-date-time")},date:function(e){throw new ee("date")},"decimal-time":function(e){throw new ee("decimal-time")},"format-date":function(e,n){throw new ee("format-date")},"format-date-time":function(e,n){throw new ee("format-date-time")},area:function(e){throw new ee("area")},distance:function(e){throw new ee("distance")},random:Math.random,randomize:function(e,n){throw new ee("randomize")},uuid:function(e){throw new ee("uuid")},checklist:function(e,n){throw new ee("checklist")},"weighted-checklist":function(e,n,t){throw new ee("weighted-checklist")}};function Ot(e,n,t){var o;if(n.stackDepth>1e4)throw new q("Stack overflow while evaluating `".concat(JSON.stringify(e),"`"),"stackOverflow",e,n,t);var r=Object(c.a)(Object(c.a)({},n),{},{stackDepth:n.stackDepth+1});if(e instanceof we)o=function(e){return e.value}(e);else if(e instanceof se)o=wt(e,r,t);else if(e instanceof Ee)o=function(e,n,t){var o=B(e.selector,n,t);if(o instanceof Array)return o.map((function(e){return Nt(e,n,"calculation",n.nodesToAnswers.get(e))}));return o&&Nt(o,n,"calculation",n.nodesToAnswers.get(o))}(e,r,t);else if(e instanceof le)o=function(e,n,t){var o,r,a=Ot(e.left,n,t),i=Ot(e.right,n,t),c=e.operatorToken.text;if("="===c)return a==i;if("!="===c)return a!=i;if("and"===c||"or"===c)switch("boolean"===typeof a&&(o=a),"number"===typeof a&&(o=Boolean(a)),"boolean"===typeof i&&(r=i),"number"===typeof i&&(r=Boolean(i)),yt(o,a,e,n,t),yt(r,i,e,n,t),c){case"or":return o||r;case"and":return o&&r}"number"===typeof a&&(o=a);"string"===typeof a&&(o=parseFloat(a));"number"===typeof i&&(r=i);"string"===typeof i&&(r=parseFloat(i));if("number"!==typeof o)throw new q("Left operand is `".concat(JSON.stringify(a),"`, which is no number. Arithmetic and relative comparison operators only work with operands that are numeric."),"invalidOperandType",e,n,t);if("number"!==typeof r)throw new q("Right operand is `".concat(JSON.stringify(i),"`, which no number. Arithmetic and relative comparison operators only work with operands that are numeric."),"invalidOperandType",e,n,t);switch(c){case"+":return o+r;case"-":return o-r;case"*":return o*r;case"div":return o/r;case"mod":return o%r;case">":return o>r;case">=":return o>=r;case"<":return o<r;case"<=":return o<=r;default:throw new q("The `".concat(c,"` operator is not supported"),"unsupportedOperator",e,n,t)}}(e,r,t);else{if(!(e instanceof de))throw new q("Don\u2019t know how to evaluate `".concat(e,"`."),"unsupportedExpressionType",e,r,t);o=function(e,n,t){var o=e.fn instanceof se?e.fn:Ot(e.fn,n,t),r=void 0;if(o instanceof se)r=wt(o,n,t,!0,gt);else{if("string"!==typeof o)throw new q("Can\u2019t call a function without knowing its name \u2014 the name must be either defined as string, return a name string or a function reference.","functionNotFound",e,n,t);r=gt[o]}if(!r)throw new q("Could not find a function named `".concat(xt(o),"`."),"functionNotFound",e,n,t);var a=e.args.map((function(r,a){try{return Ot(r,n,t)}catch(c){var i=Object(pt.ordinalize)(String(a+1));throw new q("Error in ".concat(i," argument in `").concat(xt(o),"() function call`: ").concat(c.message),"functionEvalError",e,n,t,c)}}));if("function"!==typeof r)throw new q("Found name `".concat(r,"`, but it is not a function."),"functionNotFound",e,n,t);try{return r.apply(n,a)}catch(c){var i="";throw e.print((function(e){return i+=e})),new q("Error while calling `".concat(i,"`: ").concat(c.message),"functionEvalError",e,n,t,c)}}(e,r,t)}return n.stackDepth-=1,o}function xt(e){if("string"===typeof e)return e;var n="";return e.print((function(e){return n+=e})),n}function yt(e,n,t,o,r){if("boolean"!==typeof e)throw new q("Found operand `".concat(JSON.stringify(n),"` that is no boolean value. Boolean operators only work with values that are `true` or `false`."),"invalidOperandType",t,o,r)}function wt(e,n,t){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n.knownLiteralsWithoutDollarSign;if(e.text.startsWith("$")){var a=P(e.name,n,t)||F(e.name,n);if(!a)throw new q("Could not find a node with name `".concat(e.name,"`."),"nodeNotFound",e,n,t);if(a instanceof Array)return a.map((function(e){return Nt(e,n,"calculation",n.nodesToAnswers.get(e))}));var i=Nt(a,n,"calculation",n.nodesToAnswers.get(a));if(i.error)throw new q("Error in expression ".concat(e.text,"."),"unsupportedNameExpression",e,n,t,i.error instanceof q?i.error:void 0);return i.result}if(e.text===e.name){var c=n.evaluateNonDollarNameFn?n.evaluateNonDollarNameFn({expression:e,context:n,scope:t}):r[e.name];if(void 0!==c||o)return c;throw new q("Unknown name `".concat(e.text,"` \u2014 did you mean to use `${").concat(e.name,"}` instead of `").concat(e.name,"`?"),"unknownNameWithoutDollarSign",e,n,t)}throw new q("Don\u2019t know how to evaluate ".concat(e,"."),"unsupportedNameExpression",e,n,t)}function kt(e){if(!e)throw new Z("Formula was not evaluated to an expression, but no error was encountered. This means an error handler is missing for this case.")}function Et(e,n){var t,o,r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.survey,i=new re(e),c=new Te({tokens:i});try{if(!(r=c.parseExpression()))throw new Error("Parsing given formula `".concat(e,"` returned an empty expression. This should not happen, it means the underlying code should have thrown an exception earlier."));return o=Ot(r,n,a),kt(r),{parser:c,state:"success",expression:r,result:o,error:void 0}}catch(s){if(!(s instanceof X))throw s;t=s}return{parser:c,state:"error",expression:r,error:t,result:null}}function Nt(e,n,t,o){var r,a=null===(r=e.row)||void 0===r?void 0:r[t];if(void 0!==a&&"string"!==typeof a)throw new Error("Sorry, multilingual formulas are not supported yet.");var i=null===a||void 0===a?void 0:a.trim();if(""===i||void 0===i){var c=o,s="select_multiple"===e.type&&c instanceof Array?c.join(" "):c;return{state:"success",result:s,expression:new we([],s instanceof Array?"array":typeof s,s),error:void 0}}var l=e.row,u=void 0;try{u=Et(i,n,e)}catch(h){var d;throw new q("Error in `".concat(t,"` column of the \u2018").concat(null===l||void 0===l?void 0:l.name,"\u2019 question (row #").concat(e.rowIndex,"). It contains the formula `").concat(null===l||void 0===l?void 0:l[t],"`. Please ensure the formula is valid. The error was: ").concat(h),"calculationError",null===(d=u)||void 0===d?void 0:d.expression,n,e,h)}return u}function Tt(e,n,t){var o,r={relevant:!0,calculation:n.nodesToAnswers.get(e),required:!1,readonly:!1,constraint:!0};en.forEach((function(o){t(e,o,Nt(e,n,o,r[o]))})),null===(o=e.children)||void 0===o||o.forEach((function(e){return Tt(e,n,t)}))}function At(e,n){Tt(e.rootSurveyGroup,n,(function(e,t,o){var r,a=n.evaluationResults.get(e);a||(a=new Map,n.evaluationResults.set(e,a)),null===(r=a)||void 0===r||r.set(t,o)}))}var St=t(87);var Ct=0;var Rt=0;function Lt(e){return{beginMarkerRow:{type:"begin_group",name:"untitled_group_".concat(Rt+=1),label:Qe("",e.languages)},endMarkerRow:{type:"end_group"}}}function It(e,n){return tn(n)?e.flatNodes.findIndex((function(e,t){return t>n.rowIndex&&Object(w.isEqual)(e,n)})):n.rowIndex}function _t(e){var n=e.xlsForm,t=e.language,r=e.setXLSForm,a=Object(o.useState)(),i=Object(s.a)(a,2),l=i[0],u=i[1];Object(o.useEffect)((function(){u(n?function(e){if(e&&e.survey===n.rootSurveyGroup)return console.log("Context exists already and survey is the same, keeping context."),e;var t=v(n.rootSurveyGroup);return t.nodesToAnswers=new Map,t.survey=n.rootSurveyGroup,t.stackDepth=0,t.knownLiteralsWithoutDollarSign=j,At(n,t),console.log("Setting up new evaluation context",t),t}:void 0)}),[n,null===n||void 0===n?void 0:n.rootSurveyGroup]);var h=o.useCallback((function(e,t){Vn.clear(),Vn.show({message:Object(vn.jsxs)(vn.Fragment,{children:[t.schemaKey," \u2192 ",Object(vn.jsx)(d.g,{children:JSON.stringify(e)})]})}),n&&l&&u((function(o){if(o){var r=new Map(o.nodesToAnswers.entries());r.set(t.node,e);var a=Object(c.a)(Object(c.a)({},o),{},{nodesToAnswers:r});return At(n,a),a}}))}),[l,n]),f=o.useCallback((function(e,o,a,i,c,s){if(n&&l){var u=s||t;u&&r(function(e){var n=e.worksheetName,t=e.xlsForm,o=e.rowIndex,r=e.node,a=e.context,i=e.language,c=e.columnName,s=e.value,l=r&&$(r,a),u=Xe.includes(c)?[c,i]:[c],d="survey"===n;return Object(St.a)(t,(function(e){Object(w.set)(e,["worksheets",n,"rows",o].concat(u),s),d&&(Object(w.set)(e,["flatNodes",o,"row"].concat(u),s),l&&Object(w.set)(e,["rootSurveyGroup"].concat(Object(N.a)(l.map((function(e){return["children",e]})).flat()),["row"],u),s)),void 0===i||e.languages.has(i)||e.languages.add(i);var t=e.worksheets[n];if(t){void 0===i||t.languages.has(i)||t.languages.add(i),t.columnNames.includes(c)||t.columnNames.push(c);var r=ze([c])[0];t.columnNamesNormalized.includes(r)||t.columnNamesNormalized.push(r)}}))}({worksheetName:e,xlsForm:n,node:c,rowIndex:o,columnName:a,language:u,value:i,context:l}))}}),[n,l,t,r]),b=o.useCallback((function(e,t){n&&l&&r((function(n){var o,r,a=null===n||void 0===n?void 0:n.worksheets.survey;if(!a)throw new Error("No survey worksheet defined.");var i=null===n||void 0===n?void 0:n.worksheets[e];if(!i)return n;var s=Object(N.a)(null===i||void 0===i?void 0:i.rows);t.forEach((function(e){var n=e.rowIndex,t=e.numberOfRowsToRemove,o=e.rowsToAdd;return s.splice.apply(s,[n,t].concat(Object(N.a)(o)))}));var l=Object(c.a)(Object(c.a)({},i),{},{rows:s});return Ue("survey"===e?l:a,(null===n||void 0===n||null===(o=n.worksheets.settings)||void 0===o||null===(r=o.rows[0])||void 0===r?void 0:r.default_language)||"English (en)","settings"===e?l:null===n||void 0===n?void 0:n.worksheets.settings,"choices"===e?l:null===n||void 0===n?void 0:n.worksheets.choices)}))}),[l,r,n]),p=o.useCallback((function(e){if(n&&l){if(!$(e,l))throw new Error("Can\u2019t remove a node that isn\u2019t reachable from survey root. Please ensure the node is actually part of the survey.");var t=It(n,e)-e.rowIndex+1,o=e.rowIndex;b("survey",[{rowIndex:o,numberOfRowsToRemove:t,rowsToAdd:[]}])}}),[l,b,n]),m=o.useCallback((function(e,t){n&&l&&(on(n,e,t).forEach((function(e){var n=e.index,t=e.row;b("survey",[{rowIndex:n,numberOfRowsToRemove:1,rowsToAdd:[Object(c.a)({},t)]}])})),b("survey",[{rowIndex:e.rowIndex,numberOfRowsToRemove:1,rowsToAdd:[Object(c.a)(Object(c.a)({},e.row),{},{name:t})]}]))}),[l,b,n]),g=o.useCallback((function(e){if(n&&l){var t=Lt(n),o=t.beginMarkerRow,r=t.endMarkerRow,a=e.rowIndex,i=It(n,e);b("survey",[{rowIndex:i+1,numberOfRowsToRemove:0,rowsToAdd:[r]},{rowIndex:a,numberOfRowsToRemove:0,rowsToAdd:[o]}])}}),[l,b,n]),O=o.useCallback((function(e){if(n&&l){var t=e.rowIndex,o=It(n,e);b("survey",[{rowIndex:o,numberOfRowsToRemove:1,rowsToAdd:[]},{rowIndex:t,numberOfRowsToRemove:1,rowsToAdd:[]}])}}),[l,b,n]),x=o.useCallback((function(e){var t=e.position,o=e.node,r=e.group;if(n&&l){var a=function(e){return{type:"text",name:"untitled_field_".concat(Ct++),label:Qe("",e.languages)}}(n),i=Lt(n),c=i.beginMarkerRow,s=i.endMarkerRow,u=r?[c,a,s]:[a],d=0,h=o&&tn(o);d=o&&h?{after:It(n,o)+1,before:o.rowIndex,inside:o.rowIndex+1}[t]:{after:o?o.rowIndex+1:0,before:o?o.rowIndex:0,inside:0}[t],b("survey",[{rowIndex:d,numberOfRowsToRemove:0,rowsToAdd:u}])}}),[l,b,n]),y=o.useCallback((function(e){e.sourcePath;var o,r=e.sourceNode,a=e.destinationNode;e.position;if(n&&l&&t)if(null===(o=K(a,l))||void 0===o?void 0:o.find((function(e){return Object(w.isEqual)(e,r)})))Vn.show({intent:"warning",icon:"error",message:"Can\u2019t move a node into its own descendants."},"cant-drop-node-on-own-descendant");else{var i=It(n,r)-r.rowIndex+1,c=Object(N.a)(n.worksheets.survey.rows).slice(r.rowIndex,r.rowIndex+i),s=a.rowIndex<r.rowIndex,u={rowIndex:a.rowIndex,numberOfRowsToRemove:0,rowsToAdd:c},d={rowIndex:r.rowIndex+(s?i:0),numberOfRowsToRemove:i,rowsToAdd:[]};b("survey",[u,d])}}),[l,t,b,n]);return{context:l,setContext:u,onChangeAnswer:h,onChangeCell:f,onMoveNode:y,onSpliceRows:b,onRemoveRowAndChildren:p,onRenameNode:m,onNestNode:g,onUngroupNode:O,onAddNode:x}}function Dt(e){var n=e.setWorksheetName,t=e.worksheetName;return Object(vn.jsxs)(d.C.Group,{align:h.a.LEFT,children:[Object(vn.jsxs)(d.d,{children:[Object(vn.jsx)(d.c,{onClick:function(){return n("survey")},active:"survey"===t,children:"Survey"}),Object(vn.jsx)(d.c,{onClick:function(){return n("choices")},active:"choices"===t,children:"Choices"}),Object(vn.jsx)(d.c,{onClick:function(){return n("settings")},active:"settings"===t,children:"Settings"})]}),Object(vn.jsx)(d.C.Divider,{})]})}function Mt(){var e,n,t,r,a=o.useContext(m),i=null===(e=a.xlsForm)||void 0===e||null===(n=e.worksheets.settings)||void 0===n?void 0:n.rows[0].form_title,c=o.useState(),l=Object(s.a)(c,2),u=l[0],h=l[1],f=o.useCallback((function(e){void 0!==u&&""!==u&&(a.onChangeCell("settings",0,"form_title",u),h(void 0))}),[u,a]),b=null===(t=a.xlsForm)||void 0===t||null===(r=t.worksheets.settings)||void 0===r?void 0:r.rows[0].form_title,p=void 0!==b&&""!==b.trim();return Object(vn.jsx)(d.l,{onChange:h,onConfirm:f,confirmOnEnterKey:!0,className:[!p&&O.a.TEXT_MUTED,O.a.TEXT_LARGE].filter(Boolean).join(" "),placeholder:"Enter a survey title\u2026",value:void 0===u?i:u,minWidth:100})}function Ft(e){return Object(vn.jsx)("div",{props:e,style:Object(c.a)({margin:"".concat(e.horizontal,"rem ").concat(e.vertical,"rem")},e.style),children:e.children})}var Pt=t(118),Bt=t(149);function Ut(e){return Object(vn.jsx)(d.e,{intent:"warning",children:Object(vn.jsx)("h4",{children:"Object arrays are not implemented yet."})})}function Gt(e){var n,t=e.node,r=e.debug,a=o.useContext(m),i=a.onChangeCell,c=a.language,l=o.useState(),u=Object(s.a)(l,2),h=u[0],f=u[1],b=o.useCallback((function(e){i("survey",t.rowIndex,"hint",e,t),f(void 0)}),[t,i]);if(void 0===c)return null;var p=null===(n=t.row.hint)||void 0===n?void 0:n[c],j=void 0===h?p:h,v=""===(null===j||void 0===j?void 0:j.trim())?void 0:j;return void 0!==p&&""!==p&&Object(vn.jsxs)(d.e,{intent:"primary",children:[r&&Object(vn.jsx)(d.l,{multiline:!0,onChange:f,onConfirm:b,placeholder:"Enter a hint text in ".concat(a.languageName,"\u2026"),value:v,minWidth:100}),!r&&p]})||null}function zt(e){var n,t,r=o.useContext(m).onChangeCell,a=e.schema,i=e.schemaKey,l=e.node,u=a.objectKeys(i),h=o.useContext(m),f=h.debug,b=a.get(i,"label"),p=h.context&&G(l,h.context).join("/"),j=o.useState(),v=Object(s.a)(j,2),g=v[0],O=v[1],x=o.useCallback((function(e){e===b||void 0===b&&""===e||(r("survey",l.rowIndex,"label",e,l),O(void 0))}),[l,r,b]),y=l!==(null===(n=h.context)||void 0===n?void 0:n.survey)&&Object(vn.jsx)(d.l,{multiline:!0,onChange:O,onConfirm:x,confirmOnEnterKey:!0,placeholder:"Enter a title for `".concat(l.row.name,"`in ").concat(h.languageName,"\u2026"),value:void 0===g?b:g,minWidth:100}),w=[d.o,d.p,d.q,d.r,d.s][l.indentationLevel]||d.s;return nn(l,h.context)||f?Object(vn.jsxs)(d.i,{vertical:!0,style:{padding:"".concat(6/(l.indentationLevel+1),"rem 0")},children:[Object(vn.jsxs)(d.i,{fill:!1,style:{alignItems:"baseline"},children:[Object(vn.jsx)(w,{style:{flex:1},id:p,children:f?Object(vn.jsx)(vn.Fragment,{children:y}):b}),f&&l!==(null===(t=h.context)||void 0===t?void 0:t.survey)&&Object(vn.jsx)(Zn,Object(c.a)(Object(c.a)({},Object(c.a)({},e)),{},{editable:!0}))]}),Object(vn.jsx)(Gt,{node:l,debug:f}),u.map((function(n){return Object(vn.jsx)(ho,{schemaKey:[i,n].join("."),relevant:e.relevant,readonly:e.readonly},n)}))]}):null}function Vt(e){var n=e.value,t=e.labelElement,o=e.relevant,r=e.readonly;return void 0!==n&&"boolean"!==typeof n?Object(vn.jsx)(d.e,{intent:"warning",children:Object(vn.jsxs)("h4",{children:["Value must be a ",Object(vn.jsx)(d.g,{children:"boolean"})," for this field to work"]})}):Object(vn.jsx)(d.f,{large:!0,disabled:!1===o||r,labelElement:t,onChange:e.onInputChange,defaultChecked:"boolean"===typeof e.defaultValue?e.defaultValue:void 0})}function $t(e){var n=e.value,t=e.node,r=e.relevant,a=e.readonly,i=o.useContext(m),c=i.language,s=i.onChangeAnswer,l=void 0!==n&&"string"!==typeof n&&(!(n instanceof Array)||n.find((function(e){return"string"!==typeof e}))),u=o.useMemo((function(){return"string"===typeof n?new Set(""===n?[]:null===n||void 0===n?void 0:n.split(" ")):n instanceof Array||n instanceof Set?new Set(n):new Set}),[n]),h=o.useCallback((function(n){var t=n.currentTarget.name,o=new Set(u);n.currentTarget.checked?o.add(t):o.delete(t),s(Array.from(o),e)}),[e,s,u]);return"string"!==typeof c?null:l?Object(vn.jsx)(d.e,{intent:"warning",children:Object(vn.jsxs)("h4",{children:["Value must be a ",Object(vn.jsx)(d.g,{children:"string"})," or Array of ",Object(vn.jsx)(d.g,{children:"string"}),"s for this field to work."]})}):i.debug&&0===t.typeParameters.length?Object(vn.jsx)(d.e,{intent:"warning",title:"No choice list set.",children:Object(vn.jsx)(Dn,{node:t,showType:!1})}):Object(vn.jsx)(d.i,{vertical:!0,children:t.typeParameters.map((function(e){var n,t=null===(n=i.xlsForm)||void 0===n?void 0:n.choicesByName[e];return t?Object.keys(t).map((function(e){var n,o=t[e],i=null===o||void 0===o||null===(n=o.label)||void 0===n?void 0:n[c],s="undefined"===i?null===o||void 0===o?void 0:o.name:i;return Object(vn.jsx)(d.f,{disabled:!1===r||a,label:s,checked:"string"===typeof e&&u.has(e),name:e,inline:!0,large:!0,onChange:h})})):null}))})}var Ht=t(402),Kt={formatDate:function(e){return e.toLocaleDateString()},parseDate:function(e){return e.length?new Date(e):null},placeholder:"YYYY-MM-DD"};function Wt(e){var n=e.value,t=e.relevant,r=e.readonly,a=o.useContext(m).onChangeAnswer,i=o.useCallback((function(n,t){t&&a(n,e)}),[e,a]);if(void 0!==n&&!(n instanceof Date))return Object(vn.jsx)(d.e,{intent:"warning",children:Object(vn.jsxs)("h4",{children:["Value must be a ",Object(vn.jsx)(d.g,{children:"Date"})," for this field to work"]})});var s=void 0;return"string"===typeof e.defaultValue?s=Kt.parseDate(e.defaultValue):e.defaultValue instanceof Date&&(s=e.defaultValue),Object(vn.jsx)(Ht.a,Object(c.a)(Object(c.a)({},Kt),{},{onChange:i,defaultValue:s||void 0,disabled:!1===t||r}))}function Xt(e){var n,t=e.schema,r=e.schemaKey,a=e.node,i=e.debug,c=e.relevant,l=e.isEditable,u=e.children,h=o.useContext(m),f=null===(n=a.row.label)||void 0===n?void 0:n[h.language||"English (en)"],b=t.get(r,"label"),p=o.useContext(m).onChangeCell,j=h.context&&G(a,h.context).join("/"),v=o.useState(),g=Object(s.a)(v,2),x=g[0],y=g[1],w=o.useCallback((function(e){e===f||void 0===f&&""===e||(p("survey",a.rowIndex,"label",e,a),y(void 0))}),[f,a,p]),k=l&&i?Object(vn.jsx)(d.l,{onChange:y,onConfirm:w,placeholder:"Enter a title for `".concat(a.row.name,"` in ").concat(h.languageName,"\u2026"),value:void 0===x?f:x,minWidth:100,confirmOnEnterKey:!0,multiline:!0}):b;return u?Object(vn.jsxs)(d.i,{style:{alignItems:"center"},lang:h.languageCode,children:[Object(vn.jsx)("span",{id:j,className:c?"":O.a.TEXT_DISABLED,style:{flex:1},children:i?k:Object(vn.jsx)(An,{children:b})}),u]}):Object(vn.jsx)("span",{id:j,className:c?"":O.a.TEXT_DISABLED,style:{flex:1},lang:h.languageCode,children:i?k:Object(vn.jsx)(An,{children:b})})}function qt(e){var n=e.value,t=e.schemaKey,r=e.relevant,a=e.readonly,i=o.useContext(m).onChangeAnswer,c=o.useCallback((function(n){i(n,e)}),[e,i]);return void 0!==n&&"string"!==typeof n&&"number"!==typeof n?Object(vn.jsx)(d.e,{intent:"warning",children:Object(vn.jsxs)("h4",{children:["Value must be a ",Object(vn.jsx)(d.g,{children:"number"})," for this field to work."]})}):Object(vn.jsx)(d.E,{id:t,disabled:!1===r||a,name:t,large:!0,allowNumericCharactersOnly:!1,placeholder:"Enter a number\u2026",value:n,onValueChange:c,defaultValue:"number"===typeof e.defaultValue||"string"===typeof e.defaultValue?e.defaultValue:void 0})}var Jt,Yt,Qt,Zt,eo,no=t(13);function to(e){var n=e.value,t=e.onInputChange,r=e.allowedValues,a=e.node,i=e.relevant,c=e.readonly,s=o.useContext(m),l=s.language;return void 0!==n&&"string"!==typeof n?Object(vn.jsx)(d.e,{intent:"warning",children:Object(vn.jsxs)("h4",{children:["Value must be a ",Object(vn.jsx)(d.g,{children:"string"})," for this field to work"]})}):void 0===l?null:s.debug&&0===a.typeParameters.length?Object(vn.jsx)(d.e,{intent:"warning",children:Object(vn.jsxs)(d.i,{fill:!0,children:[Object(vn.jsx)(d.r,{children:"No choice list set."}),Object(vn.jsx)("div",{className:no.FLEX_EXPANDER}),Object(vn.jsx)(Dn,{node:a,showType:!1})]})}):Object(vn.jsx)(d.I,{onChange:t,selectedValue:n,inline:!0,disabled:!1===i||c,children:r.map((function(e){var n,t,o,r=a.typeParameters[0],i=null===(n=s.xlsForm)||void 0===n||null===(t=n.choicesByName[r])||void 0===t?void 0:t[e],c=null===i||void 0===i||null===(o=i.label)||void 0===o?void 0:o[l],u="undefined"===c?null===i||void 0===i?void 0:i.name:c;return Object(vn.jsx)(d.H,{label:u,value:null===i||void 0===i?void 0:i.name,inline:!0,large:!0},null===i||void 0===i?void 0:i.name)}))})}function oo(e){var n=e.value,t=e.schemaKey,o=e.relevant,r=e.readonly;return void 0!==n&&"string"!==typeof n&&"number"!==typeof n?Object(vn.jsx)(d.e,{intent:"warning",children:Object(vn.jsxs)("h4",{children:["Value must be a ",Object(vn.jsx)(d.g,{children:"string"})," or ",Object(vn.jsx)(d.g,{children:"number"})," for this field to work."]})}):Object(vn.jsx)(d.y,{id:t,disabled:!1===o||r,name:t,placeholder:"",large:!0,onChange:e.onInputChange,defaultValue:"string"===typeof e.defaultValue?e.defaultValue:void 0})}function ro(e){var n=e.quickType,t=e.schema,o=e.schemaKey;if("number"===n)return Object(vn.jsx)(qt,Object(c.a)({},e));if("date"===n)return Object(vn.jsx)(Wt,Object(c.a)({},e));if("boolean"===n)return Object(vn.jsx)(Vt,Object(c.a)({},e));if("stringArray"===n){var r=t.get(o+".$","allowedValues");if(r instanceof Array)return Object(vn.jsx)($t,Object(c.a)({},Object(c.a)(Object(c.a)({},e),{},{allowedValues:r})))}var a=t.get(o,"allowedValues");return a instanceof Array?Object(vn.jsx)(to,Object(c.a)({},Object(c.a)(Object(c.a)({},e),{},{allowedValues:a}))):Object(vn.jsx)(oo,Object(c.a)({},e))}function ao(e){var n=e.node,t="boolean"===e.quickType,r=o.useContext(m),a=r.language,i=r.debug,s=r.context,l=r.onChangeAnswer,u=o.useCallback((function(n){var t=n.currentTarget,o={checkbox:t.checked,date:t.valueAsDate,number:t.valueAsNumber,text:t.value,radio:t.value}[t.type];l(o,e)}),[l,e]);if(!a||!s)return null;var h=fn.includes(n.type);if(h&&!r.debug)return null;var f=Object(vn.jsx)(Zn,Object(c.a)(Object(c.a)({},Object(c.a)({},e)),{},{editable:!0})),b=Object(vn.jsx)(Gt,{node:n,debug:i}),p=Object(vn.jsx)(Xt,Object(c.a)(Object(c.a)({},Object(c.a)(Object(c.a)({},e),{},{debug:i,isEditable:!t&&!h})),{},{children:"boolean"!==e.quickType&&i&&f})),j=Nt(n,s,"calculation",s.nodesToAnswers.get(n)),v=Object(c.a)(Object(c.a)({},e),{},{labelElement:p,onInputChange:u,value:j.result,defaultValue:n.row.default}),g=Object(vn.jsx)(ro,Object(c.a)({},v));return t?Object(vn.jsxs)(d.n,{labelFor:n.row.name,style:{display:"flex"},children:[i&&f,g,b]}):"note"===n.type?Object(vn.jsx)(d.e,{intent:"primary",children:p}):Object(vn.jsxs)(d.n,{label:p,labelFor:n.row.name,children:[g,Object(vn.jsx)(Gt,{node:n,debug:i})]})}var io=f.a.div(Jt||(Jt=Object(l.a)(['\n  &:after {\n    content: "";\n    position: absolute;\n    left: 0px;\n    width: 1px;\n    bottom: 0;\n    top: 0;\n    background-color: transparent;\n  }\n']))),co=f.a.div(Yt||(Yt=Object(l.a)(["\n  position: absolute;\n  left: 0px;\n  height: 44px;\n  width: 44px;\n  background-color: transparent;\n  cursor: pointer;\n"]))),so=Object(f.a)(co)(Qt||(Qt=Object(l.a)(["\n  top: 0;\n  &:hover {\n    background: linear-gradient(\n      135deg,\n      ",",\n      "," 50%\n    );\n  }\n"])),E(g.a.BLUE3,.1),E(g.a.BLUE3,0)),lo=Object(f.a)(co)(Zt||(Zt=Object(l.a)(["\n  bottom: 0;\n  &:hover {\n    background: linear-gradient(\n      45deg,\n      ",",\n      "," 50%\n    );\n  }\n"])),E(g.a.BLUE3,.1),E(g.a.BLUE3,0)),uo=f.a.div(eo||(eo=Object(l.a)(["\n  padding: 16px 16px 8px;\n  margin: 0;\n  position: relative;\n\n  &:not(:hover):not(:focus-within) {\n    "," {\n      background: none;\n    }\n  }\n  &:hover,\n  :focus-within {\n    background: ",";\n\n    "," {\n      &:after {\n        background: ",";\n      }\n    }\n  }\n"])),io,E(g.a.BLUE3,.03),io,E(g.a.BLUE3,.1));function ho(e){var n=e.schemaKey,t=o.useContext(m),r=t.schema,a=t.context,i=t.debug,s=null===r||void 0===r?void 0:r.getQuickTypeForKey(n),l=["."].concat(Object(N.a)(n.replace(/\.\$/g,"").split("."))),u=(null===a||void 0===a?void 0:a.survey)&&B(l,a,a.survey),h=Wn(u instanceof Array?void 0:u),f=h.nodeActionMenuItems,b=h.nodeActionDialogs;if(!a||!r)return null;if(u instanceof Array)return i?Object(vn.jsx)(d.e,{intent:"warning",children:Object(vn.jsxs)(d.r,{children:["Found multiple nodes with path ",Object(vn.jsx)(d.g,{children:l.join("/")}),". This should not happen."]})}):null;if(!u)return i?Object(vn.jsx)(d.e,{intent:"warning",children:Object(vn.jsxs)(d.r,{children:["No node found for"," ",Object(vn.jsx)(d.g,{children:l[l.length-1]})]})}):null;var p=e.relevant;if("boolean"!==typeof p||!0===p){var j,v=null===(j=a.evaluationResults.get(u))||void 0===j?void 0:j.get("relevant");p="boolean"===typeof(null===v||void 0===v?void 0:v.result)?v.result:null!==(null===v||void 0===v?void 0:v.result)}var g=!1;if("undefined"!==typeof e.readonly||!0===e.readonly){var y,w=null===(y=a.evaluationResults.get(u))||void 0===y?void 0:y.get("readonly");g="boolean"===typeof(null===w||void 0===w?void 0:w.result)?w.result:e.readonly}var k,E={schema:r,node:u,schemaKey:n,quickType:s,relevant:p,readonly:g};if(!i&&!p)return null;switch(s){case"object":k=Object(vn.jsx)(zt,Object(c.a)({},E));break;case"objectArray":k=Object(vn.jsx)(Ut,Object(c.a)({},E));break;default:k=Object(vn.jsx)(ao,Object(c.a)({},E))}if(i&&u!==a.survey){var T=Object(vn.jsx)(d.z,{children:f});return Object(vn.jsxs)(vn.Fragment,{children:[b,Object(vn.jsx)(Bt.a,{content:T,children:Object(vn.jsxs)(uo,{children:[Object(vn.jsx)(io,{}),Object(vn.jsx)(x.a,{content:Object(vn.jsxs)("ul",{className:O.a.LIST_UNSTYLED,children:[Object(vn.jsx)(Hn,{icon:"arrow-up",node:u,position:"before",group:!1}),Object(vn.jsx)(Hn,{icon:"arrow-up",node:u,position:"before",group:!0}),Object(vn.jsx)(d.A,{}),f]}),lazy:!0,interactionKind:"click",placement:"left",renderTarget:function(e){e.isOpen;var n=e.ref,t=Object(Pt.a)(e,["isOpen","ref"]);return Object(vn.jsx)(so,Object(c.a)(Object(c.a)({},t),{},{ref:n}))},hoverOpenDelay:0,hoverCloseDelay:0}),Object(vn.jsx)(x.a,{content:Object(vn.jsxs)("ul",{className:O.a.LIST_UNSTYLED,children:[f,Object(vn.jsx)(d.A,{}),Object(vn.jsx)(Hn,{icon:"arrow-down",node:u,position:"after",group:!1}),Object(vn.jsx)(Hn,{icon:"arrow-down",node:u,position:"after",group:!0})]}),lazy:!0,interactionKind:"click",placement:"left",renderTarget:function(e){e.isOpen;var n=e.ref,t=Object(Pt.a)(e,["isOpen","ref"]);return Object(vn.jsx)(lo,Object(c.a)(Object(c.a)({},t),{},{ref:n}))},hoverOpenDelay:0,hoverCloseDelay:0}),k]})})]})}return k}function fo(){var e=Object(o.useContext)(m),n=Object(o.useCallback)((function(){e.onAddNode({position:"after",group:!1})}),[e]),t=Object(o.useCallback)((function(){e.onAddNode({position:"after",group:!0})}),[e]),r=Object(vn.jsxs)(vn.Fragment,{children:[Object(vn.jsx)("p",{children:Object(vn.jsx)(d.c,{text:"Add a field",large:!0,intent:"primary",onClick:n})}),Object(vn.jsx)("p",{children:Object(vn.jsx)(d.c,{text:"Add a group of fields",intent:"none",onClick:t})})]});return Object(vn.jsx)(d.D,{title:"This survey is empty.",action:r})}var bo,po=t(401),jo=t(399),vo=t(158),mo=Object(f.a)(po.a)(bo||(bo=Object(l.a)(["\n  /* flex: 1; */\n"])));function go(e){var n=e.language,t=e.xlsForm,r=e.worksheetName,a=o.useContext(m).onChangeCell,i=t.worksheets[e.worksheetName],s=null===i||void 0===i?void 0:i.rows.length,l=o.useMemo((function(){return Object(w.uniq)(null===i||void 0===i?void 0:i.columnNamesNormalized.map((function(e){return e.replace(/::.*$/,"")})))}),[t,i,null===i||void 0===i?void 0:i.columnNamesNormalized,null===i||void 0===i?void 0:i.rows]),u=o.useCallback((function(e,n,o){if(void 0!==o&&void 0!==n){var c=null===i||void 0===i?void 0:i.rows[n];if(!c)throw new Error("Tried to change a row that doesn\u2019t exist");var s=l[o];c[s]!==e&&a(r,n,s,e,t.flatNodes[n])}}),[l,a,null===i||void 0===i?void 0:i.rows,r,t.flatNodes]),h=o.useMemo((function(){return function(e,a){var c=null===i||void 0===i?void 0:i.rows[e];if(!c)return Object(vn.jsx)(vn.Fragment,{});var s=l[a],d=c[s],h="survey"===r?t.flatNodes[e]:void 0,f=[r,e,s].join("-");return void 0!==d&&"string"!==typeof d?Xe.includes(s)?Object(o.createElement)(jo.a,{rowIndex:e,columnIndex:a,onConfirm:u,value:d[n],key:f}):Object(o.createElement)(jo.a,{rowIndex:e,columnIndex:a,onConfirm:u,value:JSON.stringify(d),key:f}):Object(o.createElement)(jo.a,{rowIndex:e,columnIndex:a,onConfirm:u,value:d,key:f,style:["type","name"].includes(s)?{paddingLeft:"".concat(4+8*((null===h||void 0===h?void 0:h.indentationLevel)||0),"px")}:{}},d)}}),[null===i||void 0===i?void 0:i.rows,l,r,t.flatNodes,u,n]);return i?Object(vn.jsx)(ht,{style:Object(c.a)({},e.style),children:Object(vn.jsx)(mo,{numRows:s,enableRowResizing:!1,children:l.map((function(e){return Object(vn.jsx)(vo.a,{name:e,cellRenderer:h},e)}))})}):Object(vn.jsx)(ht,{style:Object(c.a)({},e.style),children:Object(vn.jsxs)(d.e,{intent:"warning",children:["No ",e.worksheetName," sheet defined"]})})}function Oo(e,n){return function(){return void 0!==e.row.relevant&&""!==e.row.relevant&&!Et(e.row.relevant,n,e)||!(void 0===e.row.required||""===e.row.required||Et(e.row.required,n,e))}}function xo(e,n,t){return!!e.match(/\${([^}]+)}/)?function(){return e.replaceAll(/\${([^}]+)}/g,(function(e,o,r){try{var a=e,i=Ot(new se([{type:W.NAME,text:a,index:r}],o,e),n,t);return String(i)}catch(c){if(c instanceof X)return c.toMarkdown();throw c}}))}:e}var yo=function(e,n){var t;return t={},Object(C.a)(t,e,Object(c.a)({type:Object},n)),Object(C.a)(t,"".concat(e,".maxValue"),{type:Number,optional:!0}),Object(C.a)(t,"".concat(e,".minValue"),{type:Number,optional:!0}),Object(C.a)(t,"".concat(e,".unitCode"),{type:Text,optional:!0}),Object(C.a)(t,"".concat(e,".unitText"),{type:Text,optional:!0}),Object(C.a)(t,"".concat(e,".value"),{type:p.a.oneOf(Number,String,Boolean)}),t},wo=function(e,n){var t;return Object(c.a)(Object(c.a)((t={},Object(C.a)(t,e,Object(c.a)({type:Object},n)),Object(C.a)(t,"".concat(e,".bitrate"),{type:String,label:"The bitrate of the media object.",optional:!0}),Object(C.a)(t,"".concat(e,".contentSize"),{type:String,label:"File size in (mega/kilo) bytes."}),Object(C.a)(t,"".concat(e,".contentUrl"),{type:String,regEx:p.a.RegEx.Url,label:"Actual bytes of the media object, for example the image file or video file."}),Object(C.a)(t,"".concat(e,".duration"),{type:String,label:"The duration of the item (movie, audio recording, event, etc.) in ISO 8601 date format.",optional:!0}),Object(C.a)(t,"".concat(e,".embedUrl"),{type:String,regEx:p.a.RegEx.Url,label:"A URL pointing to a player for a specific video. In general, this is the information in the src element of an embed tag and should not be the same as the content of the loc tag.",optional:!0}),Object(C.a)(t,"".concat(e,".encodingFormat"),{type:String,label:"Media type typically expressed using a MIME format (see IANA site and MDN reference) e.g. application/zip for a SoftwareApplication binary, audio/mpeg for .mp3 etc.)."}),Object(C.a)(t,"".concat(e,".endTime"),{type:Date,label:"the time offset of the end of a clip within a larger file.",optional:!0}),Object(C.a)(t,"".concat(e,".startTime"),{type:Date,label:"the time offset of the start of a clip within a larger file.",optional:!0}),Object(C.a)(t,"".concat(e,".uploadDate"),{type:Date,label:"Date when this media object was uploaded to this site.",optional:!0}),t),yo("".concat(e,".height"),{type:p.a.oneOf(String,Object),label:"The height of the item."})),yo("".concat(e,".width"),{type:p.a.oneOf(String,Object),label:"The width of the item."}))},ko=function e(n){var t,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0;return Object(c.a)(Object(c.a)((t={},Object(C.a)(t,n,Object(c.a)({type:Object},r)),Object(C.a)(t,"".concat(n,".exifData"),{type:Object,blackbox:!0,label:" or Text\texif data for this object.",optional:!0}),Object(C.a)(t,"".concat(n,".representativeOfPage"),{type:Boolean,label:"Indicates whether this image is representative of the content of the page.",optional:!0}),t),wo("".concat(n,".caption"),{label:"The caption for this object. For downloadable machine formats (closed caption, subtitles etc.) use MediaObject and indicate the encodingFormat.",optional:!0})),o?e("".concat(n,".thumbnail"),!1,{label:"Thumbnail image for an image or video.",optional:!0}):{})};function Eo(e){var n,t=e.node.typeParameters,o=Object.keys(e.xlsForm.choicesByName),r=e.node.row.type;if(!(void 0!==o[0]))throw new Z("Node `".concat(e.key,"` uses `").concat(r,"` as its `type`, but the \u2018choices\u2019 worksheet seems to be empty or invalid. Please define some valid choice lists first."));var a=e.xlsForm.choicesByName,i=Object(w.compact)(t.map((function(n){return n.trim().startsWith("$")?function(e,n,t){var o=Et(e,n.context,n.node);if("error"===o.state)throw new q("Error evaluating `".concat(e,"` to determine available selection choices."),"invalidDynamicChoices",o.expression,n.context,n.node);if("string"!==typeof o.result)throw new q("Evaluating `".concat(e,"` did not yield a `string`. Please ensure the referenced field returns a string."),"invalidDynamicChoices",o.expression,n.context,n.node);var r=o.result;if(!t[r])throw new q("Evaluating `".concat(e,"` yielded string `'").concat(r,"'`, but the according choices list does not exist. Please ensure that the field calculates an existing list name."),"invalidDynamicChoices",o.expression,n.context,n.node);return r}(n,e,a):n}))).filter((function(e){return void 0!==e&&""!==e})),s=i.map((function(e){return a[e]})).filter((function(e){return void 0!==e}));if(s.length!==i.length)throw new Z("Node `".concat(e.key,"` (row #").concat(e.node.rowIndex+2,") refers to list names `").concat(i,"`. One of these lists is either not defined in the \u2018choices\u2019 worksheet, or could not be loaded correctly. Found list names:\n\n").concat(o.map((function(e){return"`".concat(e,"`")})).join(", ")));var l=null===(n=e.node.row.choice_filter)||void 0===n?void 0:n.trim();return l&&""!==l?function(e,n,t,o){var r=new re(e),a=new Te({tokens:r}).parseExpression();return function(){return n.flatMap((function(e){return Object.values(e)})).filter((function(e){var n=Ot(a,Object(c.a)(Object(c.a)({},o),{},{evaluateNonDollarNameFn:function(n){return e[n.expression.name]||j[n.expression.name]}}),t);if("boolean"!==typeof n)throw new q("`choice_filter` formula did not evaluate to a `boolean`. Please ensure the formula returns a `boolean`.","invalidDynamicChoices",a,o,t);return n})).map((function(e){return e.name}))}}(l,s,e.node,e.context):s.flatMap((function(e){return Object.keys(e)}))}var No,To,Ao={"":function(){return{}},integer:function(e){return Object(C.a)({},e.key,{type:p.a.Integer})},decimal:function(e){return Object(C.a)({},e.key,{type:Number})},range:function(e){return Object(C.a)({},e.key,{type:Number})},text:function(e){return Object(C.a)({},e.key,{type:String})},select_one:function(e){return Object(C.a)({},e.key,{type:String,allowedValues:Eo(e)})},select_multiple:function(e){var n;return n={},Object(C.a)(n,e.key,{type:Array}),Object(C.a)(n,e.key+".$",{type:String,allowedValues:Eo(e)}),n},select_one_from_file:function(e){return Object(C.a)({},e.key,{type:String})},select_multiple_from_file:function(e){var n;return n={},Object(C.a)(n,e.key,{type:Array}),Object(C.a)(n,e.key+".$",{type:String}),n},rank:function(e){return Object(C.a)({},e.key,{type:String})},note:function(e){return Object(C.a)({},e.key,{type:String})},geopoint:function(e){return function(e){var n;return n={},Object(C.a)(n,e,{type:Object}),Object(C.a)(n,"".concat(e,".type"),{type:String,allowedValues:["Point"],defaultValue:"Point"}),Object(C.a)(n,"".concat(e,".coordinates"),{type:Array,minCount:2,maxCount:2}),Object(C.a)(n,"".concat(e,".coordinates.$"),{type:Number,min:-180,max:180}),n}(e.key)},geotrace:function(e){return function(e){var n;return n={},Object(C.a)(n,e,{type:Object}),Object(C.a)(n,"".concat(e,".type"),{type:String,allowedValues:["LineString"],defaultValue:"LineString"}),Object(C.a)(n,"".concat(e,".coordinates"),{type:Array,minCount:2}),Object(C.a)(n,"".concat(e,".coordinates.$"),{type:Array,minCount:2,maxCount:2}),Object(C.a)(n,"".concat(e,".coordinates.$.$"),{type:Number,min:-180,max:180}),n}(e.key)},geoshape:function(e){return function(e){var n;return n={},Object(C.a)(n,e,{type:Object}),Object(C.a)(n,"type",{type:String,allowedValues:["Polygon"],defaultValue:"Polygon"}),Object(C.a)(n,"".concat(e,".coordinates"),{type:Array,minCount:1}),Object(C.a)(n,"".concat(e,".coordinates.$"),{type:Array,minCount:2}),Object(C.a)(n,"".concat(e,".coordinates.$.$"),{type:Array,minCount:4,maxCount:4}),Object(C.a)(n,"".concat(e,".coordinates.$.$.$"),{type:Number,min:-180,max:180}),n}(e.key)},date:function(e){return Object(C.a)({},e.key,{type:Date})},time:function(e){return Object(C.a)({},e.key,{type:Date})},datetime:function(e){return Object(C.a)({},e.key,{type:Date})},image:function(e){return ko(e.key)},audio:function(e){return function(e,n){var t;return Object(c.a)((t={},Object(C.a)(t,e,Object(c.a)({type:Object},n)),Object(C.a)(t,"".concat(e,".transcript"),{type:String,optional:!0}),t),wo("".concat(e,".caption"),{type:p.a.oneOf(String,Object),label:"The caption for this object. For downloadable machine formats (closed caption, subtitles etc.) use MediaObject and indicate the encodingFormat.",optional:!0}))}(e.key)},video:function(e){return function(e,n){var t;return Object(c.a)((t={},Object(C.a)(t,e,Object(c.a)({type:Object},n)),Object(C.a)(t,"".concat(e,".caption"),{type:wo("".concat(e,".caption")),label:" or Text\tThe caption for this object. For downloadable machine formats (closed caption, subtitles etc.) use MediaObject and indicate the encodingFormat.",optional:!0}),Object(C.a)(t,"".concat(e,".transcript"),{type:String,label:"If this MediaObject is an AudioObject or VideoObject, the transcript of that object.",optional:!0}),Object(C.a)(t,"".concat(e,".videoFrameSize"),{type:String,label:"The frame size of the video.",optional:!0}),Object(C.a)(t,"".concat(e,".videoQuality"),{type:String,optional:!0}),t),ko("".concat(e,".thumbnail"),!0,{label:"Thumbnail image for an image or video.",optional:!0}))}(e.key)},file:function(e){return wo(e.key)},barcode:function(e){return Object(C.a)({},e.key,{type:String})},calculate:function(e){return Object(C.a)({},e.key,{type:String})},acknowledge:function(e){return Object(C.a)({},e.key,{type:Boolean})},hidden:function(e){return Object(C.a)({},e.key,{type:String})},"xml-external":function(e){return Object(C.a)({},e.key,{type:String})},start:function(e){return Object(C.a)({},e.key,{type:Date})},end:function(e){return Object(C.a)({},e.key,{type:Date})},today:function(e){return Object(C.a)({},e.key,{type:Date})},deviceid:function(e){return Object(C.a)({},e.key,{type:String})},simserial:function(e){return Object(C.a)({},e.key,{type:String})},subscriberid:function(e){return Object(C.a)({},e.key,{type:String})},phonenumber:function(e){return Object(C.a)({},e.key,{type:String})},username:function(e){return Object(C.a)({},e.key,{type:String})},email:function(e){return Object(C.a)({},e.key,{type:String,regEx:p.a.RegEx.EmailWithTLD})},audit:function(e){return Object(C.a)({},e.key,{type:String})}};function So(e){var n,t,o,r=e.node,a=e.language,i=e.xlsForm,s=e.context,l=e.key,u={label:xo((null===(n=r.row.label)||void 0===n?void 0:n[a])||"",s,r),optional:Oo(r,s)};if(null===(t=r.row)||void 0===t?void 0:t.type.match(/^begin_repeat$/)){var d=r.children.map((function(n){return So(Object(c.a)(Object(c.a)({},e),{},{node:n,key:l+".$."+n.row.name}))}));o=Object.assign.apply(Object,[Object(C.a)({},l,Object(c.a)(Object(c.a)({},u),{},{type:Array}))].concat(Object(N.a)(d)))}else if(r.row.type.match(/^begin_group$/)||r===i.rootSurveyGroup){var h=r.children.map((function(n){return n.row,So(Object(c.a)(Object(c.a)({},e),{},{node:n,key:l+"."+n.row.name}))}));o=Object.assign.apply(Object,[Object(C.a)({},l,Object(c.a)(Object(c.a)({},u),{},{type:Object}))].concat(Object(N.a)(h)))}else o=function(e,n,t,o,r){var a,i=e.row;if(!i)throw new Error("Node needs an associated row for creating a schema.");var s=(null===(a=i.label)||void 0===a?void 0:a[n])||"",l={type:String,label:xo(s,o,e),optional:Oo(e,o)},u=Ao[e.type];if(!u)throw new Error("Could not find schema generator for node type ".concat(JSON.stringify(i)));var d=u({key:r,node:e,xlsForm:t,context:o}),h=d[Object.keys(d)[0]];return Object.assign(h,l,Object(c.a)({},h)),d}(r,a,i,s,l);return o}u.a.onlyShowFocusOnTabs();var Co=Object(f.a)((function(e){var n=o.useContext(m),t=n.languageCode,r=n.debug,a=0===e.xlsForm.flatNodes.length,i=Object(vn.jsx)(fo,{});return Object(vn.jsx)(Ft,{horizontal:2,vertical:2,className:e.className,style:{maxWidth:r?"60rem":"50rem",padding:"4rem",margin:"auto"},lang:t,children:a?i:Object(vn.jsx)("form",{children:Object(vn.jsx)(ho,{schemaKey:"data"},"data")})})}))(No||(No=Object(l.a)(["\n  max-width: 800px;\n  margin: auto;\n\n  font-size: 20px;\n  .bp3-small {\n    font-size: 16px;\n  }\n\n  .bp3-large {\n    font-size: 20px;\n  }\n\n  .bp3-form-helper-text {\n    font-size: 16px;\n  }\n\n  .bp3-form-group {\n    margin: 0 0 40px;\n  }\n\n  .bp3-control {\n    margin-bottom: 10px;\n  }\n"]))),Ro=f.a.div(To||(To=Object(l.a)(["\n  flex: 1;\n  overflow: hidden;\n  display: flex;\n  flex-direction: row;\n  align-items: stretch;\n"])));var Lo=function(){var e=r.a.useState(),n=Object(s.a)(e,2),t=n[0],o=n[1],a=r.a.useState(),i=Object(s.a)(a,2),l=i[0],u=i[1],f=r.a.useState("survey"),b=Object(s.a)(f,2),j=b[0],v=b[1],g=t&&Object(vn.jsx)(ht,{className:"bp3-code-block",style:{padding:"1rem",margin:"0",whiteSpace:"pre"},children:Object(vn.jsx)(tt,{xlsForm:t})}),y=_t({language:l,xlsForm:t,setXLSForm:o}),w=y.context,k=(null===l||void 0===l?void 0:l.match(/^(.*) \((\w+)\)$/))||[],E=Object(s.a)(k,3),N=E[1],T=E[2],A=r.a.useMemo((function(){if(t&&l&&w)return function(e,n,t){var o=So({node:e.rootSurveyGroup,xlsForm:e,context:n,language:t,key:e.rootSurveyGroup.row.name});return new p.a(new p.a(o).mergedSchema())}(t,w,l)}),[t,l,w]),S=function(){var e=r.a.useState(ft),n=Object(s.a)(e,2),t=n[0],o=n[1],a=r.a.useCallback((function(e){o(Object(c.a)(Object(c.a)({},t),{},{debug:!e.currentTarget.checked}))}),[t]),i=r.a.useCallback((function(e){o(Object(c.a)(Object(c.a)({},t),{},{table:e.currentTarget.checked}))}),[t]),l=r.a.useCallback((function(e){o(Object(c.a)(Object(c.a)({},t),{},{json:e.currentTarget.checked}))}),[t]);return{viewMenuButton:Object(vn.jsx)(x.a,{content:Object(vn.jsxs)(d.z,{children:[Object(vn.jsx)("li",{className:O.a.MENU_ITEM,children:Object(vn.jsx)(bt,{checked:t.table,label:"Table",onChange:i})}),Object(vn.jsx)("li",{className:O.a.MENU_ITEM,children:Object(vn.jsx)(bt,{checked:!t.debug,label:"Live View",onChange:a})}),Object(vn.jsx)("li",{className:O.a.MENU_ITEM,children:Object(vn.jsx)(bt,{checked:t.json,label:"JSON",onChange:l})})]}),lazy:!0,children:Object(vn.jsx)(d.c,{icon:"column-layout",minimal:!0,rightIcon:"caret-down",title:"View"})}),viewOptions:t}}(),C=S.viewMenuButton,R=S.viewOptions;return Object(vn.jsx)(bn.Provider,{value:{onDropNode:y.onMoveNode},children:Object(vn.jsxs)(m.Provider,{value:Object(c.a)({schema:A,language:l,languageCode:T,languageName:N,debug:R.debug,xlsForm:t},y),children:[t&&Object(vn.jsxs)(d.C,{children:[Object(vn.jsxs)(d.C.Group,{children:[Object(vn.jsx)(st,{setXLSForm:o,setLanguage:u,xlsForm:t}),Object(vn.jsx)(d.C.Divider,{}),R.table&&Object(vn.jsx)(Dt,{setWorksheetName:v,worksheetName:j}),Object(vn.jsx)(Mt,{})]}),Object(vn.jsxs)(d.C.Group,{align:h.a.RIGHT,children:[Object(vn.jsx)(d.C.Divider,{}),C,Object(vn.jsx)(d.C.Divider,{}),t&&l&&Object(vn.jsx)(dt,{languages:Array.from(t.languages.values()),language:l,onChange:u})]})]}),Object(vn.jsxs)(Ro,{children:[!t&&Object(vn.jsx)(ht,{children:Object(vn.jsx)(at,{setXLSForm:o,setLanguage:u})}),t&&l&&R.table&&Object(vn.jsx)(go,{xlsForm:t,language:l,debug:R.debug,style:{width:"50%"},worksheetName:j}),t&&l&&Object(vn.jsx)(ht,{style:{boxShadow:"0 0px 30px #9fb7c2",zIndex:1},children:Object(vn.jsx)(Co,{xlsForm:t,language:l,debug:R.debug})}),t&&l&&R.json&&g]})]})})},Io=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,405)).then((function(n){var t=n.getCLS,o=n.getFID,r=n.getFCP,a=n.getLCP,i=n.getTTFB;t(e),o(e),r(e),a(e),i(e)}))};Object(St.b)(),Object(St.c)(),i.a.render(Object(vn.jsx)(r.a.StrictMode,{children:Object(vn.jsx)(Lo,{})}),document.getElementById("root")),Io()}},[[382,1,2]]]);
//# sourceMappingURL=main.6da8d89d.chunk.js.map