(this["webpackJsonpsurvey-editor"]=this["webpackJsonpsurvey-editor"]||[]).push([[0],{310:function(e,n,t){},312:function(e,n,t){},382:function(e,n,t){"use strict";t.r(n);var o=t(0),r=t.n(o),a=t(17),i=t.n(a),c=(t(310),t(7)),s=t(49),l=t.n(s),u=t(21),d=t(83),h=t(26),f=t(31),b=t(404),p=t(88),j=t(80),v=t(32),m=(t(312),t(29)),O=t.n(m),g={yes:!0,no:!1,TRUE:!0,FALSE:!1,true:!0,false:!1},x=function(e){return{survey:e||{type:"",typeParameters:[],row:{type:"",name:"data",label:{"English (en)":"[empty survey]"}},children:[],indentationLevel:0,rowIndex:-1},nodesToAnswers:new Map,evaluationResults:new Map,stackDepth:0,knownLiteralsWithoutDollarSign:g}},y=o.createContext({schema:new O.a({}),context:x(),language:"English (en)",languageCode:"en",languageName:"English",debug:!0,xlsForm:void 0,setContext:function(){},onChangeAnswer:function(){},onChangeCell:function(){},onMoveNode:function(){},onSpliceRows:function(){},onRemoveRowAndChildren:function(){},onRenameNode:function(){},onNestNode:function(){},onUngroupNode:function(){},onAddNode:function(){}}),w=t(147),k=t(3),E=t(53),N=t(79),T=t(59);t(395),t(403);function A(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,t=Object(T.d)(e);return t.opacity*=n,t.toString()}var S=t(28),R=t(10),C=t(100),L=t(16),I=t(20),_=t(18),D=t(19),M=t(159);function F(e,n){var t,o,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.survey;if((null===(t=r.row)||void 0===t?void 0:t.name)===e)return r;if(null===(o=r.children)||void 0===o?void 0:o.length)for(var a=0;a<r.children.length;a+=1){var i,c=r.children[a];if((null===(i=c.row)||void 0===i?void 0:i.name)===e)return c;var s=F(e,n,c);if(s)return s}}function P(e,n,t){var o;if((null===(o=t.row)||void 0===o?void 0:o.name)===e)return t;if(t.children)for(var r=0;r<t.children.length;r+=1){var a,i=t.children[r];if((null===(a=i.row)||void 0===a?void 0:a.name)===e)return i}var c=K(t,n),s=null===c||void 0===c?void 0:c[c.length-1];return s&&P(e,n,s)||void 0}function B(e,n){var t,o,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.survey,a=e[0];if("."===a)o=r;else if("/"===a)o=n.survey;else if(".."===a){if(r===n.survey)throw new Error("Reached root - Can\u2019t traverse further up the hierarchy.");var i=K(r,n);o=null===i||void 0===i?void 0:i[i.length-1]}else if(a===r.row.name)o=r;else if(null===(t=r.children)||void 0===t?void 0:t.length)for(var c=0;c<r.children.length;c+=1){var s=r.children[c];if(s.row.name===a){o=s;break}}return 1===e.length?o:B(e.slice(1),n,o)}function U(e,n){var t,o;if(!e)return["/"];if(!(null===e||void 0===e||null===(t=e.row)||void 0===t?void 0:t.name))throw new Error("Encountered a row without a name (row #".concat(e.rowIndex,"). This should not happen. Please ensure the survey data is valid."));var r=K(e,n);return[null===(o=e.row)||void 0===o?void 0:o.name].concat(Object(u.a)(U(null===r||void 0===r?void 0:r[r.length-1],n)))}function G(e,n){var t;return null===(t=U(e,n))||void 0===t?void 0:t.reverse()}function V(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";return G(e,n).slice(1).join(t)}function $(e,n){var t,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(Object(S.isEqual)(e,n))return o;if(null===(t=n.children)||void 0===t?void 0:t.length)for(var r=0;r<n.children.length;r+=1){o.push(r);var a=n.children[r],i=$(e,a,o);if(void 0!==i)return i;o.pop()}}function z(e,n){return $(e,n.survey)}function H(e,n){var t,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(Object(S.isEqual)(e,n))return o;if(null===(t=n.children)||void 0===t?void 0:t.length){o.push(n);for(var r=0;r<n.children.length;r+=1){var a=n.children[r],i=H(e,a,o);if(i)return i}o.pop()}}function K(e,n){return H(e,n.survey)}var q,W=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(){var e;Object(L.a)(this,t);for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return(e=n.call.apply(n,[this].concat(r))).token=void 0,e}return Object(I.a)(t,[{key:"toMarkdown",value:function(){return this.message}}]),t}(Object(M.a)(Error)),X=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o,r,a,i){var c,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0;Object(L.a)(this,t),(c=n.call(this,e)).type=o,c.expression=r,c.context=a,c.scope=i,c.underlyingEvaluationError=s,c.nodeStack=void 0;var l=H(i,a.survey);return c.nodeStack=[].concat(Object(u.a)(l||[]),[i]),c}return Object(I.a)(t,[{key:"toMarkdown",value:function(){return this.message}}]),t}(W),J=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o,r){var a;return Object(L.a)(this,t),(a=n.call(this,o)).type=e,a.tokens=r,a}return Object(I.a)(t,[{key:"toMarkdown",value:function(){return this.message}}]),t}(W),Y=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o){var r;return Object(L.a)(this,t),(r=n.call(this,o)).token=e,r.message=o,r}return t}(W),Q=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(){return Object(L.a)(this,t),n.apply(this,arguments)}return t}(W),Z=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(){return Object(L.a)(this,t),n.apply(this,arguments)}return t}(W),ee=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e){return Object(L.a)(this,t),n.call(this,"The `".concat(e,"` function is not supported yet. If you need it, please contact the developers."))}return t}(W);!function(e){e[e.LEFT_PAREN=0]="LEFT_PAREN",e[e.RIGHT_PAREN=1]="RIGHT_PAREN",e[e.COMMA=2]="COMMA",e[e.ASSIGN=3]="ASSIGN",e[e.PLUS=4]="PLUS",e[e.MINUS=5]="MINUS",e[e.ASTERISK=6]="ASTERISK",e[e.DOLLAR=7]="DOLLAR",e[e.LEFT_BRACE=8]="LEFT_BRACE",e[e.RIGHT_BRACE=9]="RIGHT_BRACE",e[e.GREATER_THAN=10]="GREATER_THAN",e[e.LESS_THAN=11]="LESS_THAN",e[e.SLASH=12]="SLASH",e[e.POINT=13]="POINT",e[e.CARET=14]="CARET",e[e.TILDE=15]="TILDE",e[e.BANG=16]="BANG",e[e.BACKSLASH=17]="BACKSLASH",e[e.QUESTION=18]="QUESTION",e[e.COLON=19]="COLON",e[e.SINGLE_QUOTE=20]="SINGLE_QUOTE",e[e.DOUBLE_QUOTE=21]="DOUBLE_QUOTE",e[e.MODULO=22]="MODULO",e[e.BOOLEAN_AND=23]="BOOLEAN_AND",e[e.BOOLEAN_OR=24]="BOOLEAN_OR",e[e.COMPARISON=25]="COMPARISON",e[e.NAME=26]="NAME",e[e.LITERAL=27]="LITERAL",e[e.NUMBER_LITERAL=28]="NUMBER_LITERAL",e[e.FLOAT_LITERAL=29]="FLOAT_LITERAL",e[e.INT_LITERAL=30]="INT_LITERAL",e[e.STRING_LITERAL=31]="STRING_LITERAL",e[e.BOOLEAN_LITERAL=32]="BOOLEAN_LITERAL",e[e.SELECTOR=33]="SELECTOR",e[e.WHITESPACE=34]="WHITESPACE",e[e.UNKNOWN=35]="UNKNOWN",e[e.EOF=36]="EOF",e[e.INVALID=37]="INVALID",e[e.INTERNAL_LEXER_ERROR=38]="INTERNAL_LEXER_ERROR"}(q||(q={}));q.LEFT_PAREN,q.RIGHT_PAREN,q.COMMA,q.ASSIGN,q.PLUS,q.MINUS,q.ASTERISK,q.GREATER_THAN,q.LESS_THAN,q.BOOLEAN_AND,q.BOOLEAN_OR,q.SLASH,q.CARET,q.TILDE,q.BANG,q.MODULO,q.COMPARISON,q.BACKSLASH,q.QUESTION,q.COLON,q.SINGLE_QUOTE,q.DOUBLE_QUOTE,q.NAME,q.LITERAL,q.NUMBER_LITERAL,q.INT_LITERAL,q.FLOAT_LITERAL,q.STRING_LITERAL,q.BOOLEAN_LITERAL,q.WHITESPACE,q.UNKNOWN,q.EOF,q.INVALID;function ne(e){switch(e){case q.LEFT_PAREN:return"(";case q.RIGHT_PAREN:return")";case q.COMMA:return",";case q.ASSIGN:return"=";case q.PLUS:return"+";case q.MINUS:return"-";case q.ASTERISK:return"*";case q.SLASH:return"/";case q.CARET:return"^";case q.TILDE:return"~";case q.BANG:return"!";case q.BACKSLASH:return"\\";case q.QUESTION:return"?";case q.COLON:return":";default:return"[undefined punctuator]"}}var te=function e(){Object(L.a)(this,e),this.kind=void 0,this.tokens=void 0,this.children=void 0},oe=[[q.STRING_LITERAL,/^'(\\\\|\\'|[^'])*'/],[q.STRING_LITERAL,/^"(\\\\|\\"|[^"])*"/],[q.SLASH,/^div/],[q.MODULO,/^mod/],[q.BOOLEAN_AND,/^and/],[q.BOOLEAN_OR,/^or/],[q.FLOAT_LITERAL,/^-?\d+\.\d+/],[q.INT_LITERAL,/^-?\d+/],[q.NAME,/^\$?{[^}]+}/],[q.NAME,/^[a-zA-Z_\w_][a-zA-Z_\w_-]*/],[q.SELECTOR,/^\/(\/?[\w*]+(?:\[[^]+?]\B)?)/],[q.LEFT_PAREN,/^\(/],[q.RIGHT_PAREN,/^\)/],[q.COMMA,/^,/],[q.PLUS,/^\+/],[q.MINUS,/^-/],[q.ASTERISK,/^\*/],[q.COMPARISON,/^(>=|>|<=|<|=|!=)/],[q.COMPARISON,/^(>=|>|<=|<|=|!=)/],[q.INVALID,/^(\w+|[\s\S])/]],re=function(){function e(n){Object(L.a)(this,e),this.text=n,this.index=0}return Object(I.a)(e,[{key:"next",value:function(){if(this.index>=this.text.length)return{value:{type:q.EOF,text:"",index:this.index}};for(;" "===this.text[this.index];)this.index+=1;for(var e=0;e<oe.length;e+=1){var n=oe[e],t=Object(h.a)(n,2),o=t[0],r=t[1],a=this.text.slice(this.index).match(r);if(null!==a){var i=a[0],c={type:o,text:this.text.substr(this.index,i.length),index:this.index};return this.index+=i.length,{value:c}}}var s={type:q.INTERNAL_LEXER_ERROR,text:this.text[this.index],index:this.index};throw new Y(s,"Lexer should never get here. If we get here, this means there is no invalid token defined at the end of the pattern list. This invalid token should match at least one character that is not recognized by all other patterns.")}}]),e}(),ae=function e(){Object(L.a)(this,e)},ie=function e(){Object(L.a)(this,e)},ce=function(){function e(n){Object(L.a)(this,e),this.options=n,this.readTokens=[],this.prefixParselets=new Map,this.infixParselets=new Map}return Object(I.a)(e,[{key:"register",value:function(e,n){if(n instanceof ie)this.prefixParselets.set(e,n);else{if(!(n instanceof ae))throw new Error("Found a parselet that was neither an infix nor a prefix parselet: No idea what to do with it\u2026");this.infixParselets.set(e,n)}}},{key:"parseExpression",value:function(){var e,n,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=this.consumeAnything();if(!o)throw new J("prematureEOF","Parser encountered end of tokens. This should not happen.");var r=this.prefixParselets.get(o.type);if(!r)throw new J("undefinedPrefix","Expected start of a new expression, but `".concat(o.text,"` is not an allowed prefix."),[o]);for(var a=r.parse(this,o);t<this.getPrecedence();){var i=this.consumeAnything();if(!i)throw new J("prematureEndOfTokens","Parser encountered end of tokens. This should not happen.");var c=this.infixParselets.get(i.type);if(!c)throw new J("undefinedInfix","`".concat(i.text,"` is not an allowed infix."),[i]);a=c.parse(this,a,i)}return null===(e=(n=this.options).onExpression)||void 0===e||e.call(n,a),a}},{key:"match",value:function(e){if(this.lookAhead(0).type===e)return this.consumeAnything()}},{key:"consume",value:function(e){var n=this.lookAhead(0);if(n.type!==e)throw new Error("Expected token "+e+" and found "+n.type);if(!this.consumeAnything())throw new Error("Could not consume token "+e);return n}},{key:"consumeAnything",value:function(){return this.lookAhead(0),this.readTokens.shift()}},{key:"lookAhead",value:function(e){for(;e>=this.readTokens.length;){var n,t,o=this.options.tokens.next();o.value&&(null===(n=(t=this.options).onToken)||void 0===n||n.call(t,o.value)),this.readTokens.push(o.value)}return this.readTokens[e]}},{key:"getPrecedence",value:function(){var e=this.infixParselets.get(this.lookAhead(0).type);return e?e.getPrecedence():0}}]),e}(),se=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o,r){var a;return Object(L.a)(this,t),(a=n.call(this)).tokens=e,a.name=o,a.text=r,a.kind="name",a.children=a.tokens,a}return Object(I.a)(t,[{key:"print",value:function(e){e(this.name)}}]),t}(te),le=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o,r,a){var i;return Object(L.a)(this,t),(i=n.call(this)).tokens=e,i.left=o,i.operatorToken=r,i.right=a,i.kind="operator",i.children=[i.left,i.operatorToken,i.right],i}return Object(I.a)(t,[{key:"print",value:function(e){e("("),this.left.print(e),e(" "),e(this.operatorToken.text),e(" "),this.right.print(e),e(")")}}]),t}(te),ue=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o){var r;return Object(L.a)(this,t),(r=n.call(this)).precedence=e,r.isRight=o,r}return Object(I.a)(t,[{key:"parse",value:function(e,n,t){var o=e.parseExpression(this.precedence-(this.isRight?1:0));return new le([].concat(Object(u.a)(n.tokens),[t],Object(u.a)(o.tokens)),n,t,o)}},{key:"getPrecedence",value:function(){return this.precedence}}]),t}(ae),de=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o,r,a,i){var c;return Object(L.a)(this,t),(c=n.call(this)).tokens=e,c.fn=o,c.leftParenToken=r,c.argsAndDelimiters=a,c.rightParenToken=i,c.kind="call",c.args=void 0,c.children=[c.fn,c.leftParenToken].concat(Object(u.a)(c.argsAndDelimiters),[c.rightParenToken]),c.args=a.filter((function(e){return e instanceof te})),c}return Object(I.a)(t,[{key:"print",value:function(e){this.fn.print(e),e("(");for(var n=0;n<this.args.length;n++)this.args[n].print(e),n<this.args.length-1&&e(", ");e(")")}}]),t}(te),he=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o,r){var a;return Object(L.a)(this,t),(a=n.call(this)).rightParenTokenType=e,a.argumentDelimiterTokenType=o,a.precedence=r,a}return Object(I.a)(t,[{key:"parse",value:function(e,n,t){var o=[],r=e.match(this.rightParenTokenType),a=[].concat(Object(u.a)(n.tokens),[t]),i=[];if(r)a.push(r);else{var c;do{var s=e.parseExpression();o.push(s),a.push.apply(a,Object(u.a)(s.tokens)),i.push(s),(c=e.match(this.argumentDelimiterTokenType))&&(a.push(c),i.push(c))}while(c);(r=e.consume(this.rightParenTokenType))&&a.push(r)}return new de(a,n,t,i,r)}},{key:"getPrecedence",value:function(){return this.precedence}}]),t}(ae),fe=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o,r,a,i,c){var s;return Object(L.a)(this,t),(s=n.call(this)).tokens=e,s.condition=o,s.questionMarkToken=r,s.thenArm=a,s.colonToken=i,s.elseArm=c,s.kind="conditional",s.children=[s.condition,s.questionMarkToken,s.thenArm,s.colonToken,s.elseArm],s}return Object(I.a)(t,[{key:"print",value:function(e){e("("),this.condition.print(e),e(" ? "),this.thenArm.print(e),e(" : "),this.elseArm.print(e),e(")")}}]),t}(te),be=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e){var o;return Object(L.a)(this,t),(o=n.call(this)).precedence=e,o}return Object(I.a)(t,[{key:"parse",value:function(e,n,t){var o=e.parseExpression(),r=e.consume(q.COLON),a=e.parseExpression(this.precedence-1);return new fe([].concat(Object(u.a)(n.tokens),[t],Object(u.a)(o.tokens),[r],Object(u.a)(a.tokens)),n,t,o,r,a)}},{key:"getPrecedence",value:function(){return this.precedence}}]),t}(ae),pe=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e){var o;return Object(L.a)(this,t),(o=n.call(this)).rightParenTokenType=e,o}return Object(I.a)(t,[{key:"parse",value:function(e,n){var t=e.parseExpression(),o=e.consume(this.rightParenTokenType);return t.tokens=[n].concat(Object(u.a)(t.tokens),[o]),t.children=[n,t,o],t}}]),t}(ie),je=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e};return Object(L.a)(this,t),(e=n.call(this)).getName=o,e}return Object(I.a)(t,[{key:"parse",value:function(e,n){var t=this.getName(n.text);return new se([n],t,n.text)}}]),t}(ie),ve=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o,r){var a;return Object(L.a)(this,t),(a=n.call(this)).tokens=e,a.left=o,a.operatorToken=r,a.kind="postfix",a.children=[a.left,a.operatorToken],a}return Object(I.a)(t,[{key:"print",value:function(e){e("("),this.left.print(e),e(ne(this.operatorToken.type)),e(")")}}]),t}(te),me=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e){var o;return Object(L.a)(this,t),(o=n.call(this)).precedence=e,o}return Object(I.a)(t,[{key:"parse",value:function(e,n,t){return new ve([].concat(Object(u.a)(n.tokens),[t]),n,t)}},{key:"getPrecedence",value:function(){return this.precedence}}]),t}(ae),Oe=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o,r){var a;return Object(L.a)(this,t),(a=n.call(this)).tokens=e,a.operatorToken=o,a.right=r,a.kind="prefix",a.children=[a.right],a}return Object(I.a)(t,[{key:"print",value:function(e){e("("),e(ne(this.operatorToken.type)),this.right.print(e),e(")")}}]),t}(te),ge=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e){var o;return Object(L.a)(this,t),(o=n.call(this)).precedence=e,o}return Object(I.a)(t,[{key:"parse",value:function(e,n){var t=e.parseExpression(this.precedence);return new Oe([n].concat(Object(u.a)(t.tokens)),n,t)}},{key:"getPrecedence",value:function(){return this.precedence}}]),t}(ie),xe=ce,ye=function e(){Object(L.a)(this,e)};ye.BOOLEAN_OP=1,ye.CONDITIONAL=2,ye.ASSIGNMENT=3,ye.SUM=4,ye.PRODUCT=5,ye.EXPONENT=6,ye.PREFIX=7,ye.POSTFIX=8,ye.CALL=9;var we=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o,r){var a;return Object(L.a)(this,t),(a=n.call(this)).tokens=e,a.type=o,a.value=r,a.kind="literal",a.children=a.tokens,a}return Object(I.a)(t,[{key:"print",value:function(e){"string"!==this.type?(e("["),e(this.type),e(" "),e(String(this.value)),e("]")):e("'".concat(this.value,"'"))}}]),t}(te),ke=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o){var r;return Object(L.a)(this,t),(r=n.call(this)).getValue=e,r.getType=o,r}return Object(I.a)(t,[{key:"parse",value:function(e,n){var t=this.getValue(n),o=this.getType(n);return new we([n],o,t)}}]),t}(ie),Ee=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e,o){var r;return Object(L.a)(this,t),(r=n.call(this)).selectorToken=e,r.selector=o,r.kind="selector",r.children=[r.selectorToken],r.tokens=[r.selectorToken],r}return Object(I.a)(t,[{key:"print",value:function(e){e(this.selectorToken.text)}}]),t}(te),Ne=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e){var o;return Object(L.a)(this,t),(o=n.call(this)).getSelector=e,o}return Object(I.a)(t,[{key:"parse",value:function(e,n){var t=this.getSelector(n.text);return new Ee(n,t)}}]),t}(ie),Te=function(e){Object(_.a)(t,e);var n=Object(D.a)(t);function t(e){var o;return Object(L.a)(this,t),(o=n.call(this,Object(c.a)({onExpression:function(e){return o.expressions.push(e)},onToken:function(e){return o.tokens.push(e)}},e))).expressions=[],o.tokens=[],o.register(q.NAME,new je((function(e){return e.startsWith("$")?e.slice(2,e.length-1):e}))),o.register(q.SELECTOR,new Ne((function(e){return e.split("/")}))),o.register(q.FLOAT_LITERAL,new ke((function(e){return parseFloat(e.text)}),(function(){return"float"}))),o.register(q.INT_LITERAL,new ke((function(e){return parseInt(e.text,10)}),(function(){return"int"}))),o.register(q.STRING_LITERAL,new ke((function(e){return e.text.slice(1,e.text.length-1)}),(function(){return"string"}))),o.register(q.QUESTION,new be(ye.CONDITIONAL)),o.register(q.LEFT_PAREN,new pe(q.RIGHT_PAREN)),o.register(q.LEFT_PAREN,new he(q.RIGHT_PAREN,q.COMMA,ye.CALL)),o.infixRight(q.COMPARISON,ye.CONDITIONAL),o.infixLeft(q.BOOLEAN_AND,ye.BOOLEAN_OP),o.infixLeft(q.BOOLEAN_OR,ye.BOOLEAN_OP),o.infixLeft(q.PLUS,ye.SUM),o.infixLeft(q.MINUS,ye.SUM),o.infixLeft(q.ASTERISK,ye.PRODUCT),o.infixLeft(q.SLASH,ye.PRODUCT),o.infixLeft(q.MODULO,ye.EXPONENT),o}return Object(I.a)(t,[{key:"postfix",value:function(e,n){this.register(e,new me(n))}},{key:"prefix",value:function(e,n){this.register(e,new ge(n))}},{key:"infixLeft",value:function(e,n){this.register(e,new ue(n,!1))}},{key:"infixRight",value:function(e,n){this.register(e,new ue(n,!0))}}]),t}(xe),Ae=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(c.a)({type:Object,blackbox:!0,custom:function(){var e=this.value;if(void 0!==e){if("string"===typeof e)return"notAllowed";for(var n=Object.keys(e),t=0;t<n.length;t+=1){if("string"!==typeof e[n[t]])return"notAllowed"}}}},e)},Se=Ae,Re=Se({optional:!0}),Ce=Ae({optional:!0}),Le=function(){try{var e=new re(this.value);new Te({tokens:e}).parseExpression()}catch(n){this.addValidationErrors([{name:this.key,type:"Invalid formula: ".concat(n.message),value:this.value}])}},Ie=new O.a({type:{type:String},name:{type:String,optional:!0,custom:function(){if(!["end_group","end_repeat"].includes(this.field("type").value)){var e=O.a.ErrorTypes.REQUIRED;if(this.operator){if(this.isSet){if("$set"===this.operator&&null===this.value||""===this.value)return e;if("$unset"===this.operator)return e;if("$rename"===this.operator)return e}}else if(!this.isSet||null===this.value||""===this.value)return e}}},constraint:{type:String,optional:!0,custom:Le},constraint_message:Re,label:Re,image:Re,video:Re,hint:Re,guidance_hint:Re,required_message:Re,relevant:{type:String,optional:!0,custom:Le},choice_filter:{type:String,optional:!0},calculation:{type:String,optional:!0,custom:Le},trigger:{type:String,optional:!0,custom:Le},readonly:{type:String,optional:!0},required:{type:String,optional:!0,custom:Le},parameters:{type:String,optional:!0},repeat_count:{type:String,optional:!0,custom:Le},appearance:{type:String,optional:!0},default:{type:String,optional:!0},instance:Ce,bind:Ce,body:Ce}),_e=new O.a({"list name":{type:String},name:{type:String},label:Se()}),De=new O.a({form_title:{type:String,optional:!0},form_id:{type:String,optional:!0},public_key:{type:String,optional:!0},submission_url:{type:String,optional:!0},default_language:{type:String,optional:!0},version:{type:String,optional:!0}});function Me(e){return Ie.validate(e)}var Fe=t(151);function Pe(e,n){if(e.type.match(/^end[ _](?:group|repeat)$/))throw new Z("Found '".concat(e.type,"' without a matching start marker in row ").concat(n+2,". Please check that the group/repeat nesting is correct. The row: ").concat(e))}function Be(e){var n={};return e.rows.forEach((function(e){var t=e["list name"],o=e.name,r=n[t]||{};r[o]=e,n[t]=r})),n}function Ue(e,n,t,o){var r=[];return{worksheets:{settings:t,choices:o,survey:e},rootSurveyGroup:function(e){for(var n=e.rows,t=e.defaultLanguage,o=e.formRootNameFromSettings,r=void 0===o?"data":o,a=e.titleFromSettings,i=void 0===a?"":a,c=e.onRow,s={children:[],type:"",typeParameters:[],rowIndex:-1,indentationLevel:0,row:{name:r,type:"",label:Object(R.a)({},t,i)}},l=[s],u=0;u<n.length;){var d=n[u],h=Ve(d.type).split(" "),f=Object(Fe.a)(h),b=f[0],p=f.slice(1),j=l[l.length-1];if("begin_group"===j.type&&"end_group"===b)l.pop(),null===c||void 0===c||c(d,j);else if("begin_repeat"===j.type&&"end_repeat"===d.type)l.pop(),null===c||void 0===c||c(d,j);else if(b.match(/^begin_(?:repeat|group)$/)){var v={row:d,type:b,typeParameters:p,children:[],indentationLevel:l.length-1,rowIndex:u};j.children.push(v),l.push(v),null===c||void 0===c||c(d,v)}else{Pe(d,u);var m={row:d,type:b,typeParameters:p,indentationLevel:l.length-1,rowIndex:u,children:[]};j.children.push(m),null===c||void 0===c||c(d,m)}u+=1}return{node:s}}({rows:e.rows,defaultLanguage:n,onRow:function(e,n){return r.push(n)}}).node,choicesByName:o?Be(o):{},languages:e.languages,flatNodes:r}}function Ge(e,n,t){var o=Object(c.a)({},e),r=new Set;return t&&n.forEach((function(e){o[e]&&(o["".concat(e,"::").concat(t)]=o[e]),r.add(t),delete o[e]})),n.forEach((function(e){Object.keys(o).filter((function(n){return n.startsWith(e)})).forEach((function(e){var n=e.split(/::/),t=Object(h.a)(n,2),a=t[0],i=t[1],c=o[a],s=String(o[e]);if(void 0===c)o[a]=Object(R.a)({},i,s),r.add(i);else{if("object"!==typeof c)throw new Q("Can't handle `".concat(a,"` column. Columns with prefix `").concat(a,"` must be namespaced with `::`. See chapter [\u2018Advanced use and extensibility\u2019](https://xlsform.org/en/#advanced-use-and-extensibility) in the documentation."));c[i]=s,r.add(i)}delete o[e]}))})),{result:o,foundSuffixes:r}}function Ve(e){return e.replace(/^media::(image|audio|video)\B/,"$1").replace(/^imei$/,"deviceid").replace(/^phone_number$/,"phonenumber").replace(/^select one\B/,"select_one").replace(/^select multiple\B/,"select_multiple").replace(/^location$/,"geopoint").replace(/^photo\B/,"image").replace(/^trigger$/,"acknowledge").replace(/^begin group$/,"begin_group").replace(/^end group$/,"end_group").replace(/^begin repeat$/,"begin_repeat").replace(/^end repeat$/,"end_repeat")}var $e={getAutoValues:!0,trimStrings:!0,mutate:!1};function ze(e){var n=Ie.clean(Object(c.a)(Object(c.a)({},e),{},{type:Ve(String(e.type))}),$e);return Me(n),n}function He(e){var n=_e.clean(e,Object(c.a)(Object(c.a)({},$e),{},{filter:!1}));return function(e){_e.validate(e,{keys:["list name","name"]})}(n),n}function Ke(e){var n=De.clean(e,$e);return function(e){De.validate(e)}(n),n}var qe=["label","hint","constraint_message","required_message","image","audio","video"];function We(e,n,t,o){var r=e.getWorksheet(n),a=[];if(r){var i=r.getRows(1,1)[0];if(!(i.values instanceof Array))throw new Q("First row of the \u2018".concat(n,"\u2019 worksheet must be an array structure, but is a ").concat(typeof i.values," instead. Please fix this."));var c=i.values.slice(1).map((function(e){return(null===e||void 0===e?void 0:e.toString())||""})),s=function(e){for(var n=[],t=0;t<e.length;t+=1){var o,r=(null===(o=e[t])||void 0===o?void 0:o.toString())||"";n.push(r.replace(/^constraint-msg\B/,"constraint_message").replace(/^requiredMsg\B/,"required_message").replace(/^bind::required$/,"required").replace(/^repeat-count$/,"repeat_count").replace(/^media::(image|audio|video)\B/,"$1").replace(/^photo\B/,"image").replace(/^list_name$/,"list name"))}return Object.freeze(n)}(c),l=function(e,n){var t={};return e.forEach((function(e){t[e]=!0})),Ge(t,qe,n).foundSuffixes}(s,o);return r.eachRow((function(e,n){1!==n&&a.push(function(e){var n=e.row,t=e.columnNames,o=e.defaultLanguage,r=e.loadRowFn,a={};n.values.slice(1).forEach((function(e,n){var o=t[n];a[o]="".concat(e)}));var i=Ge(a,qe,o),c=Ge(i.result,["instance","bind","body"]).result;try{return r(c)}catch(s){throw new Q("Could not load row ".concat(JSON.stringify(c,null,2),": ").concat(s," / ").concat(JSON.stringify(s.details)))}}({row:e,columnNames:s,defaultLanguage:o,loadRowFn:t}))})),{rows:a,languages:l,columnNames:c,columnNamesNormalized:s}}}function Xe(e){return Je.apply(this,arguments)}function Je(){return(Je=Object(d.a)(l.a.mark((function e(n){var t,o,r,a,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=We(n,"settings",Ke),o=(null===t||void 0===t?void 0:t.rows[0].default_language)||"English (en)",r=We(n,"choices",He,o),a=We(n,"survey",ze,o)){e.next=6;break}throw new Error("No `survey` sheet found in workbook. Please define a sheet named `survey` and try again.");case 6:return i=Ue(a,o,t,r),e.abrupt("return",i);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ye(e,n){var t={};return n.forEach((function(n){t[n]=e})),t}var Qe=0;var Ze=["calculation","required","relevant","readonly","constraint"];function en(e,n){var t,o;if(!n)return!1;var r=null===(t=n.evaluationResults.get(e))||void 0===t||null===(o=t.get("relevant"))||void 0===o?void 0:o.result;return void 0===r||r}function nn(e){return"begin_group"===e.type||"begin_repeat"===e.type}function tn(e,n,t){var o=n.row.name,r=[],a=new RegExp("\\${".concat(o,"}"));return e.flatNodes.forEach((function(i){var c,s,l=!1,d=qe.flatMap((function(n){return Object(u.a)(e.languages.values()).map((function(e){return"".concat(n,".").concat(e)}))}));(c=Object(S.without)(Ze,"choice_filter")).concat.apply(c,Object(u.a)(d)).forEach((function(e){var r=Object(S.get)(i.row,e);if("string"!==typeof r&&void 0!==r)throw new Error("Replacing variable names works only with string cells. Please ensure the ".concat(e," cell of the ").concat(n.row.name," row has a string value."));if(null===r||void 0===r?void 0:r.match(a)){if(t){var c=null===r||void 0===r?void 0:r.replaceAll("${".concat(o,"}"),"${".concat(t,"}"));s=s||Object(S.cloneDeep)(i.row),Object(S.set)(s,e,c)}l=!0}})),l&&r.push({node:i,index:i.rowIndex,row:s||i.row})})),r}function on(e){return e&&Object(u.a)(e.keys()).find((function(n){var t;return null===e||void 0===e||null===(t=e.get(n))||void 0===t?void 0:t.error}))}var rn,an=o.createContext({node:(rn=new Set(["English (en)"]),Qe+=1,Object.freeze({row:{type:"text",name:"empty_node_".concat(Qe),label:Ye("Empty node ".concat(Qe),rn)},type:"text",typeParameters:[],children:[],indentationLevel:0,rowIndex:-2}))}),cn={integer:"numerical",decimal:"numerical",range:"horizontal-distribution",text:"edit",select_one:"selection",select_one_from_file:"selection",select_multiple:"multi-select",select_multiple_from_file:"multi-select",rank:"sort-numerical",note:"lightbulb",geopoint:"map-marker",geotrace:"geofence",geoshape:"geofence",date:"calendar",time:"time",datetime:"time",image:"media",audio:"headset",video:"video",file:"upload",barcode:"barcode",calculate:"function",acknowledge:"switch",hidden:"eye-off","xml-external":"layout-hierarchy",start:"time",end:"time",today:"calendar",deviceid:"desktop",simserial:"sim-card",subscriberid:"id-number",phonenumber:"phone",username:"person",email:"envelope",audit:"shield",begin_group:"group-objects",begin_repeat:"repeat"},sn={integer:"Integer number",decimal:"Decimal number",range:"Slider",text:"Text field",select_one:"Single choice",select_one_from_file:"Single choice from file",select_multiple:"Multiple choice",select_multiple_from_file:"Multiple choice from file",rank:"Rank items",note:"Note / Hint",geopoint:"Locate a point",geotrace:"Trace a line",geoshape:"Draw a shape",date:"Date",time:"Time",datetime:"Date and time",image:"Image",audio:"Audio",video:"Video",file:"File",barcode:"Scan a code",acknowledge:"Checkbox",calculate:"Calculate formula",hidden:"Hidden field","xml-external":"External XML reference",start:"Survey start date and time",end:"Survey submission date and time",today:"Survey start day",deviceid:"Device ID",simserial:"SIM serial number",subscriberid:"Subscriber ID",phonenumber:"Phone number",username:"Username",email:"Email address",audit:"Audit trail",begin_group:"Field group",begin_repeat:"Repeat group"},ln={literal:"edit",choice:"selection",geo:"globe",time:"time",media:"upload",stats:"scatter-plot",track:"person",special:"small-minus",grouping:"layout-hierarchy"},un={literal:"Enter value",choice:"Choice",geo:"Maps",time:"Date and time",media:"Upload",special:"Other",stats:"Statistics",track:"Personal data",grouping:"Grouping"},dn={text:"literal",acknowledge:"literal",integer:"literal",decimal:"literal",range:"literal",barcode:"literal",select_one:"choice",select_one_from_file:"choice",select_multiple:"choice",select_multiple_from_file:"choice",rank:"choice",geopoint:"geo",geotrace:"geo",geoshape:"geo",date:"time",time:"time",datetime:"time",image:"media",audio:"media",video:"media",file:"media",note:"special",calculate:"special",hidden:"special","xml-external":"special",start:"stats",end:"stats",today:"stats",deviceid:"track",simserial:"track",subscriberid:"track",phonenumber:"track",username:"track",email:"track",audit:"track",begin_group:"grouping",begin_repeat:"grouping"},hn=t(56),fn=t(33),bn=p.O.create({className:"recipe-toaster",position:fn.a.TOP}),pn=t(1);function jn(){var e=Object(o.useContext)(y),n=Object(o.useState)(!1),t=Object(h.a)(n,2),r=t[0],a=t[1],i=Object(o.useState)(),c=Object(h.a)(i,2),s=c[0],l=c[1],u=s&&nn(s),d=Object(o.useCallback)((function(){a(!1)}),[]),f=Object(o.useCallback)((function(){s&&(bn.show({intent:"none",message:Object(pn.jsxs)(pn.Fragment,{children:[Object(pn.jsx)("code",{children:s.row.name})," field removed."]})}),e.onRemoveRowAndChildren(s),a(!1))}),[e,s]);return{showRemoveConfirmationDialog:Object(o.useCallback)((function(e){l(e),a(!0)}),[]),alert:Object(pn.jsxs)(p.a,{cancelButtonText:"Cancel",confirmButtonText:"Delete",icon:"trash",intent:hn.a.DANGER,isOpen:r,onCancel:d,onConfirm:f,canOutsideClickCancel:!0,canEscapeKeyCancel:!0,children:[Object(pn.jsxs)("p",{children:["Are you sure you want to remove the ",Object(pn.jsx)("code",{children:null===s||void 0===s?void 0:s.row.name})," ",u?"group":"field","?"]}),u&&(null===s||void 0===s?void 0:s.children.length)&&Object(pn.jsx)("p",{children:"This will also remove the group\u2019s nested fields."})]})}}function vn(e){var n,t,r=o.useContext(y);return Object(pn.jsxs)(p.z,{children:[Object(pn.jsx)("li",{className:"bp3-menu-header",children:Object(pn.jsxs)("h6",{className:"bp3-heading",children:[1===e.references.length?"There is one link":"There are ".concat(null===(n=e.references)||void 0===n?void 0:n.length," links")," ","to this field."]})}),null===(t=e.references)||void 0===t?void 0:t.map((function(e){var n;if(r.context){var t="#//".concat(V(e.node,r.context,"/"));return Object(pn.jsx)(p.B,{text:Object(pn.jsx)("code",{children:null===(n=e.node)||void 0===n?void 0:n.row.name}),icon:cn[e.node.type],href:t})}}))]})}function mn(){var e=Object(o.useContext)(y),n=Object(o.useState)(!1),t=Object(h.a)(n,2),r=t[0],a=t[1],i=Object(o.useState)(),c=Object(h.a)(i,2),s=c[0],l=c[1],u=Object(o.useState)(""),d=Object(h.a)(u,2),f=d[0],b=d[1],j=Object(o.useState)([]),v=Object(h.a)(j,2),m=v[0],O=v[1];Object(o.useEffect)((function(){b("")}),[null===s||void 0===s?void 0:s.row.name,s]),Object(o.useEffect)((function(){e.xlsForm&&s&&O(tn(e.xlsForm,s,f))}),[null===s||void 0===s?void 0:s.row.name,s,e.xlsForm,f]);var g=Object(o.useCallback)((function(e){b(e.currentTarget.value)}),[]),x=Object(o.useCallback)((function(){a(!1)}),[]),w=Object(o.useCallback)((function(n){n.preventDefault(),s&&(e.onRenameNode(s,f),bn.show({intent:"none",message:Object(pn.jsxs)(pn.Fragment,{children:["The field has been renamed to \u2018",Object(pn.jsx)("code",{children:f}),"\u2019."]})}),a(!1))}),[e,f,s]),N=Object(o.useCallback)((function(e){l(e),a(!0)}),[]),T=m.length>0?Object(pn.jsx)(E.a,{content:Object(pn.jsx)(vn,{references:m}),lazy:!0,children:Object(pn.jsxs)(p.c,{minimal:!0,intent:"primary",children:["See ",m.length," updates\u2026"]})}):void 0,A=s&&nn(s);return{showRenameDialog:N,dialog:Object(pn.jsx)(p.j,{title:Object(pn.jsxs)(pn.Fragment,{children:["Rename \u2018",Object(pn.jsx)("code",{children:null===s||void 0===s?void 0:s.row.name}),"\u2019 ",A?"group":"field","\u2026"]}),icon:"edit",isOpen:r,canOutsideClickClose:!0,canEscapeKeyClose:!0,isCloseButtonShown:!0,onClose:x,lazy:!0,children:Object(pn.jsxs)("form",{onSubmit:w,children:[Object(pn.jsx)("div",{className:k.a.DIALOG_BODY,children:Object(pn.jsx)(p.n,{label:"Please enter a new name for this ".concat(A?"group":"field",":"),labelFor:"newName",style:{display:"flex"},children:Object(pn.jsx)(p.y,{id:"newName",placeholder:"Enter a field name\u2026",defaultValue:null===s||void 0===s?void 0:s.row.name,large:!0,onChange:g,pattern:"[\\w\\d_-]+"})})}),Object(pn.jsx)("div",{className:k.a.DIALOG_FOOTER,children:Object(pn.jsxs)("div",{className:k.a.DIALOG_FOOTER_ACTIONS,children:[Object(pn.jsx)("div",{children:T}),Object(pn.jsx)(p.c,{onClick:x,type:"button",children:"Close"}),Object(pn.jsx)(p.c,{intent:hn.a.PRIMARY,type:"submit",disabled:""===f,children:"Rename"})]})})]})})}}var On,gn=o.createContext({onDropNode:function(){}});function xn(e){var n=function(){throw new Error("Given data is not a valid ODK node.")};"object"!==typeof e&&n(),Me(e.row),"string"===typeof e.type&&e.typeParameters instanceof Array&&e.typeParameters.every((function(e){return"string"===typeof e}))&&"number"===typeof e.indentationLevel&&"number"===typeof e.rowIndex&&(void 0===e.resultIsInvalid||"boolean"===typeof e.resultIsInvalid)||n(),e.children.forEach(xn)}var yn=v.a.code(On||(On=Object(f.a)(['\n  font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",\n    "Courier New", monospace;\n\n  .expression.has-error {\n    text-decoration: underline wavy ',";\n    text-decoration-skip: none;\n    text-decoration-skip-ink: none;\n    text-decoration-color: "," !important;\n\n    a {\n      text-decoration: underline wavy ",";\n      text-decoration-skip: none;\n      text-decoration-skip-ink: none;\n      text-decoration-color: "," !important;\n    }\n  }\n\n  .expression-name {\n    color: ",";\n  }\n\n  &.expression-call > .expression-name:first-child,\n  .expression-call > .expression-name:first-child {\n    color: ",";\n  }\n\n  .expression-name {\n    word-break: break-word;\n  }\n\n  .token-STRING_LITERAL {\n    color: ",";\n  }\n\n  .token-NUMBER_LITERAL {\n    color: ",";\n  }\n\n  .token-COMMA {\n    color: ",";\n  }\n\n  .token-LEFT_PAREN,\n  .token-RIGHT_PAREN {\n    color: ",";\n    font-weight: bold;\n  }\n\n  .token-INVALID {\n    border: 2px "," solid;\n    padding: 2px;\n    margin: -2px;\n    color: ",';\n  }\n\n  .token-COMMA::after {\n    content: "\xa0";\n  }\n\n  .expression-operator {\n    clear: left;\n  }\n\n  .token-COMPARISON {\n    &::after,\n    &::before {\n      content: "\u2002";\n    }\n    font-weight: bold;\n    color: ',";\n  }\n\n  .token-COLON,\n  .token-BOOLEAN_AND,\n  .token-BOOLEAN_OR,\n  .token-PLUS,\n  .token-GREATER_THAN,\n  .token-LESS_THAN,\n  .token-MODULO,\n  .token-QUESTION {\n    word-break: break-word;\n    display: block;\n    font-weight: bold;\n    color: ",";\n  }\n"])),w.a.RED2,w.a.RED2,w.a.RED2,w.a.RED2,w.a.GREEN3,w.a.BLUE3,w.a.ORANGE3,w.a.ORANGE4,w.a.GRAY1,w.a.BLUE2,w.a.RED5,w.a.RED5,w.a.RED2,w.a.RED2);function wn(e){var n=e.token,t=e.expression,r=e.parentExpression,a=e.node,i="token token-".concat(q[n.type]),c=o.useContext(y);if(n.type===q.NAME&&"call"===(null===r||void 0===r?void 0:r.kind)&&t instanceof se&&n===r.tokens[0])return Object(pn.jsx)("a",{href:"https://getodk.github.io/xforms-spec/#fn:".concat(n.text),className:i,target:"docs",children:n.text});if(n.type===q.NAME&&t instanceof se&&n.text.startsWith("$")&&c.context){var s=P(t.name,c.context,a)||F(t.name,c.context,c.context.survey);return!s||s instanceof Array?Object(pn.jsx)("var",{className:i,"data-referenced-node":s,children:n.text}):Object(pn.jsxs)("var",{children:["${",Object(pn.jsx)(Qn,{node:s,editable:!1,nameOfOnlyShownTab:"calculation"}),"}"]})}return Object(pn.jsx)("span",{className:i,children:n.text})}function kn(e){var n;if(!e.tokens)return Object(pn.jsx)(yn,{style:e.style,className:"".concat(e.className||""," expression expression-invalid"),children:e.code});var t=e.tokens[e.tokens.length-1],o=t.index+t.text.length;return Object(pn.jsxs)(yn,{style:e.style,className:"".concat(e.className||""," expression expression-invalid"),children:[e.tokens.map((function(n){return Object(pn.jsx)(wn,{token:n,node:e.node},n.index)})),Object(pn.jsx)("span",{className:k.a.TEXT_DISABLED,children:null===(n=e.code)||void 0===n?void 0:n.slice(o)})]})}function En(e){if(!e.expression)return Object(pn.jsx)(kn,Object(c.a)({},e));var n=e.error instanceof X&&e.error.expression===e.expression;return Object(pn.jsx)(yn,{style:e.style,className:"".concat(e.className||""," expression expression-").concat(e.expression.kind," ").concat(n?"has-error":""),children:e.expression.children.map((function(n,t){return n instanceof te?Object(pn.jsx)(En,{code:n.tokens.map((function(e){return e.text})).join(""),expression:n,parentExpression:e.expression,tokens:n.tokens,error:e.error,node:e.node}):Object(pn.jsx)(wn,{token:n,expression:e.expression,parentExpression:e.parentExpression,node:e.node},n.index)}))})}function Nn(e){var n=e.split(/\n/).find((function(e){return e.replace(/\s/,"").length>0}));if(!n)return e;var t=n.match(/^\s+/);if(!t)return e;var o=t[0];if(!o)return e;var r=new RegExp("^".concat(o));return e.split(/\n/).map((function(e){return e.replace(r,"")})).join("\n")}var Tn=t(156),An=t.n(Tn);function Sn(e){var n;return"string"!==typeof e.children?Object(pn.jsx)(p.e,{intent:"danger",children:"Markdown content must be a string."}):Object(pn.jsx)("div",Object(c.a)(Object(c.a)({},Object(S.omit)(e,"children","marked")),{},{dangerouslySetInnerHTML:{__html:null===(n=e.marked)||void 0===n?void 0:n.call(e,Nn(e.children))}}))}var Rn,Cn=function(e){return Object(pn.jsx)(Sn,Object(c.a)(Object(c.a)({},e),{},{marked:An.a}))},Ln=Object(v.a)(Cn)(Rn||(Rn=Object(f.a)(['\n  h1,\n  h2,\n  h3,\n  h4,\n  h5 {\n    margin: 1em 0;\n  }\n\n  code,\n  pre {\n    font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",\n      "Courier New", monospace;\n    color: ',";\n    /* border: 1px solid rgba(0, 0, 0, 0.2); */\n    margin: -1px;\n    padding: 2px 3px;\n    background-color: rgba(255, 255, 255, 0.3);\n  }\n\n  pre {\n    padding: 0.5em 0.55em;\n    margin: 0.5em 0;\n    line-height: 1.3em;\n    background: white;\n    white-space: pre-wrap;\n  }\n\n  code {\n    font-weight: 600;\n  }\n\n  p {\n    margin-block-end: 16px;\n  }\n  p:last-child {\n    margin-block-end: 0;\n  }\n\n  ul,\n  ol {\n    margin: 1em 1.25em;\n  }\n"])),w.a.DARK_GRAY1);function In(e){var n=e.answer,t=e.columnName,o=e.nodeName;return Object(pn.jsx)(p.N,{className:k.a.TEXT_MUTED,children:{calculation:void 0===n||""===n?Object(pn.jsxs)(pn.Fragment,{children:["This survey field has no entered answer yet, and the"," ",Object(pn.jsx)("code",{children:t})," cell is empty."]}):Object(pn.jsxs)(pn.Fragment,{children:["This is the answer value entered in the ",Object(pn.jsx)("code",{children:o})," ","field."]}),required:Object(pn.jsxs)(pn.Fragment,{children:["This means users are not required to enter this field. This is the default when the ",Object(pn.jsx)("code",{children:t})," cell is empty."]}),relevant:Object(pn.jsxs)(pn.Fragment,{children:["This means the survey field is always shown. This is the default behavior when the ",Object(pn.jsx)("code",{children:t})," cell is empty."]}),readonly:Object(pn.jsxs)(pn.Fragment,{children:["This means the survey field enables input. This is the default behavior when the ",Object(pn.jsx)("code",{children:t})," cell is empty."]}),constraint:Object(pn.jsxs)(pn.Fragment,{children:["If the cell contains a formula that evaluates to ",Object(pn.jsx)("code",{children:"true"})," ","or if there is no formula in the ",Object(pn.jsx)("code",{children:t})," cell, the field accepts any input."]})}[t]})}function _n(e){var n=e.results,t=e.columnName;return Object(pn.jsx)(p.N,{className:k.a.TEXT_MUTED,children:{calculation:Object(pn.jsx)(pn.Fragment,{children:"This is the result of the formula."}),required:"This means you ".concat((null===n||void 0===n?void 0:n.result)?"can\u2019t":"can"," complete the survey without entering data in this field."),relevant:"This means the survey field is ".concat((null===n||void 0===n?void 0:n.result)?"shown":"hidden","."),readonly:"This means the survey field is ".concat((null===n||void 0===n?void 0:n.result)?"read-only":"editable","."),constraint:"This means the survey field contains an input that is ".concat((null===n||void 0===n?void 0:n.result)?"allowed":"not allowed"," by the constraint formula..")}[t]})}function Dn(e){var n,t,r,a,i=e.node,s=e.columnName,l=e.nodeEvaluationResults,u=e.style,d=o.useContext(y),h=i.row[s],f=null===l||void 0===l?void 0:l.get(s),b=void 0===h,j="literal"===(null===f||void 0===f||null===(n=f.expression)||void 0===n?void 0:n.kind),v="name"===(null===f||void 0===f||null===(t=f.expression)||void 0===t?void 0:t.kind),m=null===(r=d.context)||void 0===r?void 0:r.nodesToAnswers.get(i),O=d.context?V(i,d.context):i.row.name,g=(null===f||void 0===f?void 0:f.expression)instanceof we||(null===f||void 0===f?void 0:f.expression)instanceof se&&(null===f||void 0===f?void 0:f.expression.name)===(null===f||void 0===f?void 0:f.expression.text),x="Result";return b?"calculation"===s?void 0!==m&&(x="Using answer value"):x="Default value":x=Object(pn.jsxs)(pn.Fragment,{children:[Object(pn.jsx)(p.x,{icon:"function"})," ","calculation"===s?"Formula":"Condition"]}),Object(pn.jsxs)(Wn,{lang:"en",style:Object(c.a)({backgroundColor:w.a.LIGHT_GRAY5,marginTop:"0",padding:"20px",background:"linear-gradient(".concat(A(w.a.BLUE3,.06),", ").concat(A(w.a.BLUE3,.05)," 5px, ").concat(A(w.a.BLUE3,.01)," 10px, transparent 30px)"),borderTop:"solid 1px ".concat(w.a.LIGHT_GRAY3)},u),children:[Object(pn.jsx)("h4",{children:x}),!b&&Object(pn.jsx)(pn.Fragment,{children:Object(pn.jsx)(qn,{style:{fontSize:j||v?"20px":"16px",lineHeight:"28px"},children:Object(pn.jsx)(En,{node:i,state:null===f||void 0===f?void 0:f.state,error:null===f||void 0===f?void 0:f.error,expression:null===f||void 0===f?void 0:f.expression,code:String(h),tokens:null===f||void 0===f||null===(a=f.parser)||void 0===a?void 0:a.tokens})})}),(b||!g)&&Object(pn.jsxs)(pn.Fragment,{children:[!b&&!f&&Object(pn.jsx)(p.e,{intent:"none",children:"Not calculated yet."}),"error"!==(null===f||void 0===f?void 0:f.state)&&Object(pn.jsx)(qn,{style:{fontSize:"20px",lineHeight:"28px"},children:void 0===(null===f||void 0===f?void 0:f.result)?"undefined":JSON.stringify(f.result)})]}),"error"===(null===f||void 0===f?void 0:f.state)&&Object(pn.jsxs)(Xn,{intent:"danger",children:[f.error instanceof X&&Object(pn.jsxs)(pn.Fragment,{children:["Error in\xa0",Object(pn.jsx)("code",{children:Object(pn.jsx)(En,{node:i,expression:f.error.expression})}),":"]}),Object(pn.jsx)(Ln,{children:f.error.toMarkdown()})]}),!b&&void 0!==(null===f||void 0===f?void 0:f.result)&&Object(pn.jsx)(_n,{results:f,columnName:s}),b&&Object(pn.jsx)(In,{answer:m,columnName:s,nodeName:O})]})}var Mn,Fn,Pn,Bn,Un=t(64);function Gn(e){var n=e.xlsForm,t=e.node,r=null===n||void 0===n?void 0:n.choicesByName,a=r?Object.keys(r):[],i=o.useContext(y),s=o.useCallback((function(e){var n=e.currentTarget.checked,o=e.currentTarget.value,r=Object(u.a)(t.typeParameters);n?r.push(o):r=Object(S.without)(r,o);var a=[t.type].concat(Object(u.a)(r)).join(" "),s=Object(c.a)(Object(c.a)({},t.row),{},{type:a});i.onSpliceRows("survey",[{rowIndex:t.rowIndex,numberOfRowsToRemove:1,rowsToAdd:[s]}])}),[i,t]);return Object(pn.jsxs)(p.z,{children:[Object(pn.jsx)("li",{className:"bp3-menu-header",children:Object(pn.jsx)("h6",{className:"bp3-heading",children:"Set which choice lists should be visible."})}),Object(pn.jsx)(p.i,{style:{margin:"16px 8px 4px"},vertical:!0,children:a.map((function(e){var n=t.typeParameters.includes(e),o=e,a=r[e],i=Object.keys(a),c=Object(S.sortBy)(i.map((function(e){return a[e]})),(function(e){return e.name.toLowerCase()})),l=c.slice(0,4).map((function(e){return Object(pn.jsx)("li",{children:Object(pn.jsx)(p.g,{style:{marginInline:"1px"},children:e.name},e.name)})})),u=c.length>4&&Object(pn.jsxs)("span",{className:k.a.UI_TEXT,style:{lineHeight:"24px",marginLeft:"4px",paddingRight:"2px"},"aria-label":"and ".concat(c.length-4," more"),children:["+ ",c.length-4]}),d=Object(pn.jsxs)(p.i,{fill:!0,style:{display:"inline-flex"},children:[Object(pn.jsx)("header",{"aria-label":"Choice list ".concat(e,", allowed values:"),children:Object(pn.jsx)(p.N,{children:o})}),Object(pn.jsx)("ul",{className:k.a.LIST_UNSTYLED,children:Object(pn.jsxs)(p.i,{style:{justifyContent:"flex-end",marginLeft:"16px"},children:[l,u]})})]});return Object(pn.jsx)(p.f,{value:e,onChange:s,large:!0,checked:n,disabled:1===t.typeParameters.length&&e===t.typeParameters[0],children:d})}))}),Object(pn.jsxs)(p.e,{intent:"primary",children:["The content of these lists is defined in the ",Object(pn.jsx)("code",{children:"choices"})," Excel sheet."]})]})}function Vn(){var e=o.useContext(y),n=o.useContext(an).node,t=o.useCallback((function(t){var o=t.currentTarget.dataset.type,r=(null===o||void 0===o?void 0:o.match(/^select/))?n.typeParameters:[],a=[o].concat(Object(u.a)(r)).join(" "),i=Object(c.a)(Object(c.a)({},n.row),{},{type:a});e.onSpliceRows("survey",[{rowIndex:n.rowIndex,numberOfRowsToRemove:1,rowsToAdd:[i]}])}),[e,n]);return Object(pn.jsxs)(p.z,{children:[Object(pn.jsx)("li",{className:"bp3-menu-header",children:Object(pn.jsx)("h6",{className:"bp3-heading",children:"Set a field type."})}),Object.keys(ln).filter((function(e){return"special"!==e&&"grouping"!==e})).map((function(e){return Object(pn.jsx)(p.B,{text:un[e],icon:ln[e],children:Object.keys(dn).filter((function(n){return dn[n]===e})).map((function(e){return Object(pn.jsx)(p.B,{text:sn[e],icon:cn[e],onClick:t,"data-type":e})}))})})),Object(pn.jsx)(p.A,{}),Object.keys(dn).filter((function(e){return"special"===dn[e]})).map((function(e){return Object(pn.jsx)(p.B,{text:sn[e],icon:cn[e],onClick:t,"data-type":e})}))]})}function $n(e){var n=e.node,t=e.showType,r=nn(n),a=o.useContext(y).xlsForm,i=!!a&&Object.keys(null===a||void 0===a?void 0:a.choicesByName).length>0,c=a&&Object(pn.jsx)(Gn,{xlsForm:a,node:n}),s=function(){var e=o.useContext(y),n=o.useCallback((function(){var n,t=(null===(n=e.xlsForm)||void 0===n?void 0:n.languages)||new Set(["English (en)"]),o=[{"list name":"yes_no_maybe",name:"yes",label:Ye("yes",t)},{"list name":"yes_no_maybe",name:"no",label:Ye("no",t)},{"list name":"yes_no_maybe",name:"maybe",label:Ye("maybe",t)}];e.onSpliceRows("choices",[{rowIndex:0,numberOfRowsToRemove:0,rowsToAdd:o}])}),[e]),t=Object(pn.jsx)(p.c,{large:!0,intent:"primary",onClick:n,children:"Create example choice list"});return Object(pn.jsx)(p.i,{style:{padding:"16px"},children:Object(pn.jsx)(p.D,{icon:"selection",action:t,title:"Sometimes, we have no choice.",description:Object(pn.jsx)(pn.Fragment,{children:"This survey has no choice lists yet. Please add one first to make it available for this survey question."})})})}(),l=sn[n.type],u=cn[n.type],d=n.typeParameters.length>0;return r?Object(pn.jsxs)("span",{className:[k.a.TEXT_MUTED].join(" "),style:{alignSelf:"center",marginLeft:"8px"},children:[Object(pn.jsx)(p.x,{icon:u}),"\xa0",l]}):Object(pn.jsxs)(p.d,{children:[t&&Object(pn.jsx)(E.a,{content:Object(pn.jsx)(Vn,{}),lazy:!0,children:Object(pn.jsx)(p.c,{icon:u||"blank",fill:!1,minimal:!0,children:l})}),n.type.match(/^select/)&&Object(pn.jsx)(E.a,{lazy:!0,content:i?c:s,children:Object(pn.jsxs)(p.c,{fill:!0,minimal:!0,intent:d?"none":"warning",children:[!d&&"Set visible choices",d&&Object(pn.jsx)(p.F,{observeParents:!0,minVisibleItems:2,collapseFrom:Un.a.END,items:n.typeParameters,visibleItemRenderer:function(e){return Object(pn.jsx)(p.g,{children:e})},overflowRenderer:function(e){return Object(pn.jsx)("span",{children:"+ ".concat(e.length)})},style:{transition:"width 0.1s ease-out",maxWidth:"200px"}})]})})]})}function zn(e){var n=e.path,t=e.width;return Object(pn.jsx)(p.b,{items:n.map((function(e,t){return{href:"#//".concat(n.slice(0,t+1).join("/")),text:e}})),collapseFrom:"start",overflowListProps:{minVisibleItems:1,style:{transition:"width 0.1s ease-out",width:"".concat(t,"px")}}})}function Hn(e){var n=e.node,t=e.position,r=e.icon,a=e.group,i=e.omitAction,c=Object(o.useContext)(y),s=Object(pn.jsxs)(pn.Fragment,{children:[i?null:"Add ".concat(a?"group":"field")," ",t," ",Object(pn.jsx)(p.g,{children:n.row.name})]}),l=Object(o.useCallback)((function(){c.onAddNode({position:t,node:n,group:a})}),[c,a,n,t]);return Object(pn.jsx)(p.B,{icon:r,onClick:l,text:s})}function Kn(e){var n=e.node,t=e.onRemove,r=e.onRename,a=e.onNestField,i=e.onUngroupField,c=Object(o.useCallback)((function(){t(n)}),[n,t]),s=Object(o.useCallback)((function(){r(n)}),[n,r]),l=Object(o.useCallback)((function(){a(n)}),[n,a]),u=Object(o.useCallback)((function(){i(n)}),[n,i]),d=nn(n),h=d?"Rename group\u2026":"Rename field\u2026";return Object(pn.jsxs)(pn.Fragment,{children:[Object(pn.jsx)(p.B,{icon:"edit",text:h,onClick:s}),Object(pn.jsx)(p.A,{}),Object(pn.jsxs)(p.B,{icon:"group-objects",text:"Add group",children:[Object(pn.jsx)(Hn,{node:n,position:"before",icon:"arrow-up",group:!0,omitAction:!0}),d&&Object(pn.jsx)(Hn,{node:n,position:"inside",icon:"key-enter",group:!0,omitAction:!0}),Object(pn.jsx)(Hn,{node:n,position:"after",icon:"arrow-down",group:!0,omitAction:!0})]}),Object(pn.jsxs)(p.B,{icon:"manually-entered-data",text:"Add field",children:[Object(pn.jsx)(Hn,{node:n,position:"before",icon:"arrow-up",group:!1,omitAction:!0}),d&&Object(pn.jsx)(Hn,{node:n,position:"inside",icon:"key-enter",group:!1,omitAction:!0}),Object(pn.jsx)(Hn,{node:n,position:"after",icon:"arrow-down",group:!1,omitAction:!0})]}),Object(pn.jsx)(p.A,{}),Object(pn.jsx)(p.B,{icon:"group-objects",text:"Nest in new group",onClick:l}),d&&Object(pn.jsx)(p.B,{icon:"ungroup-objects",text:"Ungroup",onClick:u}),Object(pn.jsx)(p.A,{}),Object(pn.jsx)(p.B,{intent:"danger",icon:"trash",text:"Remove ".concat(d?"group":"field","\u2026"),onClick:c})]})}var qn=Object(v.a)(p.g)(Mn||(Mn=Object(f.a)(["\n  overflow: auto;\n  word-break: break-all;\n  font-size: 16px;\n  line-height: 20px;\n  display: block;\n  border: none;\n  box-shadow: none;\n  background: transparent;\n  padding: 0;\n"]))),Wn=v.a.div(Fn||(Fn=Object(f.a)(["\n  display: grid;\n  gap: 8px;\n\n  h1,\n  h2,\n  h3,\n  h4,\n  h5 {\n    margin: 0;\n    &:not(:first-child) {\n      margin-top: 8px;\n    }\n  }\n"]))),Xn=Object(v.a)(p.e)(Pn||(Pn=Object(f.a)(['\n  > code,\n  pre {\n    font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",\n      "Courier New", monospace;\n    color: ',';\n    /* border: 1px solid rgba(0, 0, 0, 0.2); */\n    margin: -1px;\n    padding: 2px 4px;\n    background-color: rgba(255, 255, 255, 0.3);\n  }\n\n  pre {\n    padding: 0.5em 0.55em;\n    margin: 0.5em 0;\n    line-height: 1.3em;\n    background: white;\n    white-space: pre-wrap;\n  }\n\n  code {\n    font-weight: 600;\n    font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",\n      "Courier New", monospace;\n  }\n'])),w.a.DARK_GRAY1),Jn=v.a.div(Bn||(Bn=Object(f.a)(["\n  position: absolute;\n  top: 0px;\n  left: -20px;\n  width: calc(100% + 40px);\n  height: 5px;\n  background-color: ",";\n  z-index: 10000000;\n"])),w.a.BLUE3);function Yn(e){var n=e.detailsButtonCaption,t=e.hasTypeIcon,r=o.useContext(y),a=o.useContext(an),i=a.node,s=a.nodeEvaluationResults,l=en(i,r.context),u=i.type.match(/^select/)&&0===i.typeParameters.length,d=!!on(s),f=o.useState(!1),b=Object(h.a)(f,2),j=b[0],v=b[1],m=function(e){var n=e.context,t=e.node,r=e.setIsDraggedOver,a=o.useContext(gn).onDropNode,i=o.useCallback((function(e){n&&e.dataTransfer.setData("application/json",JSON.stringify({sourceNode:t,sourcePath:V(t,n)}))}),[n,t]),c=o.useCallback((function(e){e.preventDefault(),n&&(e.dataTransfer.getData("application/json"),r(!0))}),[n,r]),s=o.useCallback((function(e){if(n){var o=V(t,n),i=JSON.parse(e.dataTransfer.getData("application/json")),c=i.sourcePath,s=i.sourceNode;xn(s),console.log("Dropped on path",o),r(!1),a({sourceNode:s,sourcePath:c,destinationNode:t,position:"before"})}}),[n,t,a,r]);return{draggable:!0,onDragStart:i,onDragOver:c,onDragLeave:o.useCallback((function(e){if(n){var o=V(t,n);console.log("Left dragging at path",o),r(!1)}}),[n,t,r]),onDrop:s}}({context:r.context,node:i,setIsDraggedOver:v});return Object(pn.jsxs)(p.i,Object(c.a)(Object(c.a)({style:{display:"inline-flex",flex:"none",position:"relative",overflow:"visible"}},m),{},{children:[j&&Object(pn.jsx)(Jn,{}),Object(pn.jsx)(p.c,{minimal:!0,small:!0,lang:"en",intent:d?"danger":u?"warning":"none",rightIcon:d?"error":void 0,icon:t?cn[i.type]:void 0,style:{color:d||u?void 0:"inherit",fontSize:"inherit",padding:0},className:[!d&&!l&&k.a.TEXT_MUTED].filter(Boolean).join(" "),children:Object(pn.jsxs)(p.i,{children:[n||Object(pn.jsx)("code",{style:{color:"inherit"},children:i.row.name}),!l&&Object(pn.jsxs)(pn.Fragment,{children:["\xa0",Object(pn.jsx)(p.x,{icon:"eye-off",style:{opacity:.5,color:"inherit"}})]})]})})]}))}function Qn(e){var n,t=e.node,r=e.editable,a=e.nameOfOnlyShownTab,i=e.detailsButtonCaption,c=e.hasTypeIcon,s=o.useContext(y),l=null===(n=s.context)||void 0===n?void 0:n.evaluationResults.get(t),u=on(l),d=t.row,f=Ze.find((function(e){var n=d[e];return"string"===typeof n&&n.length>0})),b=o.useState(100),j=Object(h.a)(b,2),v=j[0],m=j[1],O=o.useCallback((function(e){setTimeout((function(){var n,t=null===(n=e[0])||void 0===n?void 0:n.contentRect.width;Math.abs(t-v)>10&&m(t)}),50)}),[v]),g=o.useState(u||f||"calculation"),x=Object(h.a)(g,2),T=x[0],S=x[1],R=o.useMemo((function(){return(null===s||void 0===s?void 0:s.xlsForm)&&tn(s.xlsForm,t)}),[s,t]),C=jn(),L=C.alert,I=C.showRemoveConfirmationDialog,_=mn(),D=_.dialog,M=_.showRenameDialog;if(!s.context)return null;var F=G(t,s.context).slice(1),P=function(e){var n=e.references,t=e.editable,o=n&&(1===n.length?"One dependency":"".concat(n.length," dependencies"));return t&&n&&n.length>0&&Object(pn.jsx)(E.a,{content:Object(pn.jsx)(vn,{references:n}),lazy:!0,children:Object(pn.jsx)(p.c,{icon:"link",fill:!1,minimal:!0,title:o,"aria-label":o,children:n.length})})}({references:R,editable:r}),B=Object(pn.jsxs)(p.i,{style:{margin:"-20px",marginBottom:"12px",backgroundColor:w.a.LIGHT_GRAY5,background:"linear-gradient(\n          ".concat(A(w.a.BLUE3,0)," 0px,\n          ").concat(A(w.a.BLUE3,.05)," 22px,\n          ").concat(A(w.a.BLUE3,.06)," 32px)"),borderBottom:"solid 1px ".concat(w.a.LIGHT_GRAY3),gap:"8px"},children:[Object(pn.jsx)($n,{node:t,showType:!0}),Object(pn.jsx)("div",{className:k.a.FLEX_EXPANDER}),P,Object(pn.jsx)(p.d,{fill:!1,children:Object(pn.jsx)(E.a,{content:Object(pn.jsx)(p.z,{children:Object(pn.jsx)(Kn,{node:t,onRemove:I,onRename:M,onNestField:s.onNestNode,onUngroupField:s.onUngroupNode})}),lazy:!0,children:Object(pn.jsx)(p.c,{icon:"more",minimal:!0,title:"Actions"})})})]}),U=Object(pn.jsxs)(p.i,{vertical:!0,children:[r&&B,Object(pn.jsx)(p.J,{onResize:O,observeParents:!0,children:Object(pn.jsx)(p.i,{style:{width:"100%",marginBottom:"8px"},children:Object(pn.jsx)(zn,{path:F,width:v})})}),a?Object(pn.jsx)(Dn,{node:t,columnName:a,nodeEvaluationResults:l,style:{margin:"0 -20px 0 -20px"}}):Object(pn.jsx)(p.M,{onChange:S,selectedTabId:T,renderActiveTabPanelOnly:!1,children:Ze.map((function(e){return function(e){var n=e.nodeEvaluationResults,t=e.node,o=e.columnName,r=null===n||void 0===n?void 0:n.get(o),a=Object(pn.jsx)(Dn,{node:t,columnName:o,nodeEvaluationResults:n,style:{margin:"-20px"}});return Object(pn.jsx)(p.L,{id:o,panel:a,title:Object(pn.jsxs)(pn.Fragment,{children:[o,"error"===(null===r||void 0===r?void 0:r.state)&&Object(pn.jsxs)(pn.Fragment,{children:["\xa0",Object(pn.jsx)(p.x,{icon:"warning-sign",intent:"warning"})]})]})})}({node:t,nodeEvaluationResults:l,columnName:e})}))})]});return Object(pn.jsxs)(an.Provider,{value:{node:t,nodeEvaluationResults:l},children:[L,D,Object(pn.jsx)(E.a,{lazy:!0,interactionKind:"click",popoverClassName:N.a.POPOVER2_CONTENT_SIZING,minimal:!1,placement:"bottom",rootBoundary:"viewport",onOpening:function(){return m(0)},modifiers:{arrow:{enabled:!0},preventOverflow:{enabled:!0}},content:U,fill:!1,targetTagName:"span",children:Object(pn.jsx)(Yn,{detailsButtonCaption:i,hasTypeIcon:c})})]})}function Zn(e){var n,t,r=e.node,a=o.useContext(y),i=null===(n=a.context)||void 0===n?void 0:n.evaluationResults.get(r);if(!i)return Object(pn.jsx)(p.x,{icon:"calculator",intent:"none"});var c=Ze.filter((function(e){var n;return null===(n=i.get(e))||void 0===n?void 0:n.error})),s=null===(t=a.context)||void 0===t?void 0:t.nodesToAnswers.get(r),l=void 0===s?null:JSON.stringify(s),u=Object(pn.jsx)("span",{children:l}),d="Node has errors in the following columns: ".concat(c.map((function(e){return"\u2018".concat(e,"\u2019")})).join(", ")),h=c.length?Object(pn.jsx)(p.x,{icon:"error",intent:"danger",title:d,htmlTitle:d}):null;return Object(pn.jsxs)(pn.Fragment,{children:[u,h]})}function et(e,n,t){return 0===e.children.length?t({id:G(e,n).join("."),label:e.row.name,childNodes:[],nodeData:e}):t({id:G(e,n).join("."),label:e.row.name,childNodes:e.children.map((function(e){return et(e,n,t)})),nodeData:e})}function nt(e){var n=e.xlsForm,t=o.useContext(y),r=t.context,a=o.useMemo((function(){return n&&r?et(n.rootSurveyGroup,r,(function(e){var n,o=e.nodeData;if(!o)throw new Error("Encountered a tree node that is not associated with a node. Please fix this.");if(!t.context)throw new Error("No context defined. Please define a context before using this component.");V(o,t.context);var r=Object(pn.jsx)(Qn,{node:o,editable:!0,hasTypeIcon:!0});return Object(c.a)(Object(c.a)({},e),{},{label:r,key:o.row.name,isExpanded:!0,hasCaret:!(0===(null===(n=e.childNodes)||void 0===n?void 0:n.length)),secondaryLabel:o&&Object(pn.jsx)(Zn,{node:o})})})):null}),[t.context,r,n]);return a?Object(pn.jsx)(p.P,{contents:[a]}):Object(pn.jsx)("div",{})}function tt(e){var n=o.useCallback((function(n){var t=n.target.files[0],o=new C.Workbook,r=new FileReader;r.readAsArrayBuffer(t),r.onload=function(){var n=r.result;if(!(n instanceof ArrayBuffer))throw new Error("Buffer was not defined as Buffer object after reading.");o.xlsx.load(n).then((function(n){console.log(n,"workbook instance"),e.onLoadWorkbook(o)}))}}),[e]);return Object(pn.jsx)(p.m,{onInputChange:n})}var ot=t(400).a.ofType(),rt=function(e,n){return Object(pn.jsx)(p.B,{text:e,onClick:n.handleClick,shouldDismissPopover:!1})};function at(e){var n=o.useCallback((function(n){e.onChange(n)}),[e]);return Object(pn.jsx)(ot,{items:e.languages,itemRenderer:rt,activeItem:e.language,noResults:Object(pn.jsx)(p.B,{disabled:!0,text:"No languages loaded yet."}),onItemSelect:n,filterable:!1,children:Object(pn.jsx)(p.c,{text:e.language,rightIcon:"double-caret-vertical"})})}function it(e){return Object(pn.jsx)("div",Object(c.a)(Object(c.a)({},e),{},{style:Object(c.a)({overflow:"auto",flex:1},e.style),children:e.children}))}var ct=t(77);function st(e,n){if("string"!==typeof e){var t=Object(ct.ordinalize)(String(n+1));throw new Z("Expected a string value as ".concat(t," parameter, but got `").concat(e,"`."))}}function lt(e,n){if("number"!==typeof e){var t=Object(ct.ordinalize)(String(n+1));throw new Z("Expected a number value as ".concat(t," parameter, but got `").concat(e,"`."))}}function ut(e,n){if("boolean"!==typeof e){var t=Object(ct.ordinalize)(String(n+1));throw new Z("Expected a boolean value as ".concat(t," parameter, but got `").concat(e,"`."))}}var dt={if:function(e,n,t){return ut(e,0),e?n:t},true:function(){return!0},false:function(){return!1},not:function(e){return ut(e,0),!e},coalesce:function(e,n){return"undefined"!==typeof e&&""!==e?e:"undefined"!==typeof n&&""!==n?n:""},boolean:function(e){return"number"===typeof e?0!==e:"string"===typeof e?""!==e:e instanceof Array?e.length>0:"boolean"===typeof e&&e},position:function(e){throw new ee("position")},once:function(e){throw new ee("once")},selected:function(e,n){return void 0!==e&&(st(e,0),st(n,1),0!==e.length&&0!==n.length&&e.split(" ").includes(n))},"selected-at":function(e,n){throw new ee("selected-at")},"count-selected":function(e){throw new ee("count-selected")},"jr:choice-name":function(e,n){throw new ee("jr:choice-name")},"indexed-repeat":function(e,n,t,o,r,a,i){throw new ee("):")},count:function(e){throw new ee("count")},"count-non-empty":function(e){throw new ee("count-non-empty")},sum:function(e){throw new ee("sum")},max:function(e){throw new ee("max")},min:function(e){throw new ee("min")},regex:function(e,n){return st(e,0),st(n,0),!!e.match(new RegExp(n))},contains:function(e,n){return st(e,0),st(n,1),!!e.match(n)},"starts-with":function(e,n){return st(e,0),st(n,1),e.startsWith(n)},"ends-with":function(e,n){return st(e,0),st(n,1),e.endsWith(n)},substr:function(e,n,t){return st(e,0),lt(n,1),lt(t,2),e.substring(n,t)},"substring-before":function(e,n){throw new ee("substring-before")},"substring-after":function(e,n){throw new ee("substring-after")},translate:function(e,n,t){throw new ee("translate")},"string-length":function(e){return st(e,0),e.length},"normalize-space":function(e){return st(e,0),e.trim()},concat:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return n.join("")},join:function(e,n){throw new ee("join")},"boolean-from-string":function(e){return"true"===e||"1"===e},string:function(e){return String(e)},round:function(e,n){return lt(e,0),lt(n,1),Math.round(e*Math.pow(10,n))/Math.pow(10,n)},int:function(e){return lt(e,0),Math.floor(e)},number:function(e){return"boolean"===typeof e?e?1:0:"string"===typeof e&&e.trim().match(/-?\d+(\.\d+)?/)?Number(e):"number"===typeof e?e:NaN},digest:function(e,n,t){throw new ee("digest")},pow:function(e,n){return lt(e,0),lt(n,1),Math.pow(e,n)},log:function(e){return lt(e,0),Math.log(e)},log10:function(e){return lt(e,0),Math.log10(e)},abs:function(e){return lt(e,0),Math.abs(e)},sin:function(e){return lt(e,0),Math.sin(e)},cos:function(e){return lt(e,0),Math.cos(e)},tan:function(e){return lt(e,0),Math.tan(e)},asin:function(e){return lt(e,0),Math.asin(e)},acos:function(e){return lt(e,0),Math.acos(e)},atan:function(e){return lt(e,0),Math.atan(e)},atan2:function(e,n){return lt(e,0),lt(n,1),Math.atan2(e,n)},sqrt:function(e){return lt(e,0),Math.sqrt(e)},exp:function(e){return lt(e,0),Math.exp(e)},exp10:function(e){return lt(e,0),Math.pow(10,e)},pi:function(){return Math.PI},today:function(){var e=new Date;return e.setHours(0,0,0,0),e},now:function(){return(new Date).toISOString()},"decimal-date-time":function(e){throw new ee("decimal-date-time")},date:function(e){throw new ee("date")},"decimal-time":function(e){throw new ee("decimal-time")},"format-date":function(e,n){throw new ee("format-date")},"format-date-time":function(e,n){throw new ee("format-date-time")},area:function(e){throw new ee("area")},distance:function(e){throw new ee("distance")},random:Math.random,randomize:function(e,n){throw new ee("randomize")},uuid:function(e){throw new ee("uuid")},checklist:function(e,n){throw new ee("checklist")},"weighted-checklist":function(e,n,t){throw new ee("weighted-checklist")}};function ht(e,n,t){var o;if(n.stackDepth>1e4)throw new X("Stack overflow while evaluating `".concat(JSON.stringify(e),"`"),"stackOverflow",e,n,t);var r=Object(c.a)(Object(c.a)({},n),{},{stackDepth:n.stackDepth+1});if(e instanceof we)o=function(e){return e.value}(e);else if(e instanceof se)o=pt(e,r,t);else if(e instanceof Ee)o=function(e,n,t){var o=B(e.selector,n,t);if(o instanceof Array)return o.map((function(e){return mt(e,n,"calculation",n.nodesToAnswers.get(e))}));return o&&mt(o,n,"calculation",n.nodesToAnswers.get(o))}(e,r,t);else if(e instanceof le)o=function(e,n,t){var o,r,a=ht(e.left,n,t),i=ht(e.right,n,t),c=e.operatorToken.text;if("="===c)return a==i;if("!="===c)return a!=i;if("and"===c||"or"===c)switch("boolean"===typeof a&&(o=a),"number"===typeof a&&(o=Boolean(a)),"boolean"===typeof i&&(r=i),"number"===typeof i&&(r=Boolean(i)),bt(o,a,e,n,t),bt(r,i,e,n,t),c){case"or":return o||r;case"and":return o&&r}"number"===typeof a&&(o=a);"string"===typeof a&&(o=parseFloat(a));"number"===typeof i&&(r=i);"string"===typeof i&&(r=parseFloat(i));if("number"!==typeof o)throw new X("Left operand is `".concat(JSON.stringify(a),"`, which is no number. Arithmetic and relative comparison operators only work with operands that are numeric."),"invalidOperandType",e,n,t);if("number"!==typeof r)throw new X("Right operand is `".concat(JSON.stringify(i),"`, which no number. Arithmetic and relative comparison operators only work with operands that are numeric."),"invalidOperandType",e,n,t);switch(c){case"+":return o+r;case"-":return o-r;case"*":return o*r;case"div":return o/r;case"mod":return o%r;case">":return o>r;case">=":return o>=r;case"<":return o<r;case"<=":return o<=r;default:throw new X("The `".concat(c,"` operator is not supported"),"unsupportedOperator",e,n,t)}}(e,r,t);else{if(!(e instanceof de))throw new X("Don\u2019t know how to evaluate `".concat(e,"`."),"unsupportedExpressionType",e,r,t);o=function(e,n,t){var o=e.fn instanceof se?e.fn:ht(e.fn,n,t),r=void 0;if(o instanceof se)r=pt(o,n,t,!0,dt);else{if("string"!==typeof o)throw new X("Can\u2019t call a function without knowing its name \u2014 the name must be either defined as string, return a name string or a function reference.","functionNotFound",e,n,t);r=dt[o]}if(!r)throw new X("Could not find a function named `".concat(ft(o),"`."),"functionNotFound",e,n,t);var a=e.args.map((function(r,a){try{return ht(r,n,t)}catch(c){var i=Object(ct.ordinalize)(String(a+1));throw new X("Error in ".concat(i," argument in `").concat(ft(o),"() function call`: ").concat(c.message),"functionEvalError",e,n,t,c)}}));if("function"!==typeof r)throw new X("Found name `".concat(r,"`, but it is not a function."),"functionNotFound",e,n,t);try{return r.apply(n,a)}catch(c){var i="";throw e.print((function(e){return i+=e})),new X("Error while calling `".concat(i,"`: ").concat(c.message),"functionEvalError",e,n,t,c)}}(e,r,t)}return n.stackDepth-=1,o}function ft(e){if("string"===typeof e)return e;var n="";return e.print((function(e){return n+=e})),n}function bt(e,n,t,o,r){if("boolean"!==typeof e)throw new X("Found operand `".concat(JSON.stringify(n),"` that is no boolean value. Boolean operators only work with values that are `true` or `false`."),"invalidOperandType",t,o,r)}function pt(e,n,t){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n.knownLiteralsWithoutDollarSign;if(e.text.startsWith("$")){var a=P(e.name,n,t)||F(e.name,n);if(!a)throw new X("Could not find a node with name `".concat(e.name,"`."),"nodeNotFound",e,n,t);if(a instanceof Array)return a.map((function(e){return mt(e,n,"calculation",n.nodesToAnswers.get(e))}));var i=mt(a,n,"calculation",n.nodesToAnswers.get(a));if(i.error)throw new X("Error in expression ".concat(e.text,"."),"unsupportedNameExpression",e,n,t,i.error instanceof X?i.error:void 0);return i.result}if(e.text===e.name){var c=n.evaluateNonDollarNameFn?n.evaluateNonDollarNameFn({expression:e,context:n,scope:t}):r[e.name];if(void 0!==c||o)return c;throw new X("Unknown name `".concat(e.text,"` \u2014 did you mean to use `${").concat(e.name,"}` instead of `").concat(e.name,"`?"),"unknownNameWithoutDollarSign",e,n,t)}throw new X("Don\u2019t know how to evaluate ".concat(e,"."),"unsupportedNameExpression",e,n,t)}function jt(e){if(!e)throw new Z("Formula was not evaluated to an expression, but no error was encountered. This means an error handler is missing for this case.")}function vt(e,n){var t,o,r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.survey,i=new re(e),c=new Te({tokens:i});try{if(!(r=c.parseExpression()))throw new Error("Parsing given formula `".concat(e,"` returned an empty expression. This should not happen, it means the underlying code should have thrown an exception earlier."));return o=ht(r,n,a),jt(r),{parser:c,state:"success",expression:r,result:o,error:void 0}}catch(s){if(!(s instanceof W))throw s;t=s}return{parser:c,state:"error",expression:r,error:t,result:null}}function mt(e,n,t,o){var r,a=null===(r=e.row)||void 0===r?void 0:r[t];if(void 0!==a&&"string"!==typeof a)throw new Error("Sorry, multilingual formulas are not supported yet.");var i=null===a||void 0===a?void 0:a.trim();if(""===i||void 0===i){var c=o,s="select_multiple"===e.type&&c instanceof Array?c.join(" "):c;return{state:"success",result:s,expression:new we([],s instanceof Array?"array":typeof s,s),error:void 0}}var l=e.row,u=void 0;try{u=vt(i,n,e)}catch(h){var d;throw new X("Error in `".concat(t,"` column of the \u2018").concat(null===l||void 0===l?void 0:l.name,"\u2019 question (row #").concat(e.rowIndex,"). It contains the formula `").concat(null===l||void 0===l?void 0:l[t],"`. Please ensure the formula is valid. The error was: ").concat(h),"calculationError",null===(d=u)||void 0===d?void 0:d.expression,n,e,h)}return u}function Ot(e,n,t){var o,r={relevant:!0,calculation:n.nodesToAnswers.get(e),required:!1,readonly:!1,constraint:!0};Ze.forEach((function(o){t(e,o,mt(e,n,o,r[o]))})),null===(o=e.children)||void 0===o||o.forEach((function(e){return Ot(e,n,t)}))}function gt(e,n){Ot(e.rootSurveyGroup,n,(function(e,t,o){var r,a=n.evaluationResults.get(e);a||(a=new Map,n.evaluationResults.set(e,a)),null===(r=a)||void 0===r||r.set(t,o)}))}var xt=t(86);var yt=0;var wt=0;function kt(e){return{beginMarkerRow:{type:"begin_group",name:"untitled_group_".concat(wt+=1),label:Ye("",e.languages)},endMarkerRow:{type:"end_group"}}}function Et(e,n){return nn(n)?e.flatNodes.findIndex((function(e,t){return t>n.rowIndex&&Object(S.isEqual)(e,n)})):n.rowIndex}function Nt(e){var n=e.xlsForm,t=e.language,r=e.setXLSForm,a=Object(o.useState)(),i=Object(h.a)(a,2),s=i[0],l=i[1];Object(o.useEffect)((function(){l(n?function(e){if(e&&e.survey===n.rootSurveyGroup)return console.log("Context exists already and survey is the same, keeping context."),e;var t=x(n.rootSurveyGroup);return t.nodesToAnswers=new Map,t.survey=n.rootSurveyGroup,t.stackDepth=0,t.knownLiteralsWithoutDollarSign=g,gt(n,t),console.log("Setting up new evaluation context",t),t}:void 0)}),[n,null===n||void 0===n?void 0:n.rootSurveyGroup]);var d=o.useCallback((function(e,t){bn.clear(),bn.show({message:Object(pn.jsxs)(pn.Fragment,{children:[t.schemaKey," \u2192 ",Object(pn.jsx)(p.g,{children:JSON.stringify(e)})]})}),n&&s&&l((function(o){if(o){var r=new Map(o.nodesToAnswers.entries());r.set(t.node,e);var a=Object(c.a)(Object(c.a)({},o),{},{nodesToAnswers:r});return gt(n,a),a}}))}),[s,n]),f=o.useCallback((function(e,o,a,i,c){n&&s&&t&&r(function(e){var n=e.worksheetName,t=e.xlsForm,o=e.rowIndex,r=e.node,a=e.context,i=e.language,c=e.columnName,s=e.value,l=r&&z(r,a),d=qe.includes(c)?[c,i]:[c],h="survey"===n;return Object(xt.a)(t,(function(e){Object(S.set)(e,["worksheets",n,"rows",o].concat(d),s),h&&(Object(S.set)(e,["flatNodes",o,"row"].concat(d),s),l&&Object(S.set)(e,["rootSurveyGroup"].concat(Object(u.a)(l.map((function(e){return["children",e]})).flat()),["row"],d),s))}))}({worksheetName:e,xlsForm:n,node:c,rowIndex:o,columnName:a,language:t,value:i,context:s}))}),[n,s,t,r]),b=o.useCallback((function(e,t){n&&s&&r((function(n){var o,r,a=null===n||void 0===n?void 0:n.worksheets.survey;if(!a)throw new Error("No survey worksheet defined.");var i=null===n||void 0===n?void 0:n.worksheets[e];if(!i)return n;var s=Object(u.a)(null===i||void 0===i?void 0:i.rows);t.forEach((function(e){var n=e.rowIndex,t=e.numberOfRowsToRemove,o=e.rowsToAdd;return s.splice.apply(s,[n,t].concat(Object(u.a)(o)))}));var l=Object(c.a)(Object(c.a)({},i),{},{rows:s});return Ue("survey"===e?l:a,(null===n||void 0===n||null===(o=n.worksheets.settings)||void 0===o||null===(r=o.rows[0])||void 0===r?void 0:r.default_language)||"English (en)","settings"===e?l:null===n||void 0===n?void 0:n.worksheets.settings,"choices"===e?l:null===n||void 0===n?void 0:n.worksheets.choices)}))}),[s,r,n]),j=o.useCallback((function(e){if(n&&s){if(!z(e,s))throw new Error("Can\u2019t remove a node that isn\u2019t reachable from survey root. Please ensure the node is actually part of the survey.");var t=Et(n,e)-e.rowIndex+1,o=e.rowIndex;b("survey",[{rowIndex:o,numberOfRowsToRemove:t,rowsToAdd:[]}])}}),[s,b,n]),v=o.useCallback((function(e,t){n&&s&&(tn(n,e,t).forEach((function(e){var n=e.index,t=e.row;b("survey",[{rowIndex:n,numberOfRowsToRemove:1,rowsToAdd:[Object(c.a)({},t)]}])})),b("survey",[{rowIndex:e.rowIndex,numberOfRowsToRemove:1,rowsToAdd:[Object(c.a)(Object(c.a)({},e.row),{},{name:t})]}]))}),[s,b,n]),m=o.useCallback((function(e){if(n&&s){var t=kt(n),o=t.beginMarkerRow,r=t.endMarkerRow,a=e.rowIndex,i=Et(n,e);b("survey",[{rowIndex:i+1,numberOfRowsToRemove:0,rowsToAdd:[r]},{rowIndex:a,numberOfRowsToRemove:0,rowsToAdd:[o]}])}}),[s,b,n]),O=o.useCallback((function(e){if(n&&s){var t=e.rowIndex,o=Et(n,e);b("survey",[{rowIndex:o,numberOfRowsToRemove:1,rowsToAdd:[]},{rowIndex:t,numberOfRowsToRemove:1,rowsToAdd:[]}])}}),[s,b,n]),y=o.useCallback((function(e){var t=e.position,o=e.node,r=e.group;if(n&&s){var a=function(e){return{type:"text",name:"untitled_field_".concat(yt++),label:Ye("",e.languages)}}(n),i=kt(n),c=i.beginMarkerRow,l=i.endMarkerRow,u=r?[c,a,l]:[a],d=0;d=nn(o)?{after:Et(n,o)+1,before:o.rowIndex,inside:o.rowIndex+1}[t]:{after:o.rowIndex+1,before:o.rowIndex,inside:0}[t],b("survey",[{rowIndex:d,numberOfRowsToRemove:0,rowsToAdd:u}])}}),[s,b,n]),w=o.useCallback((function(e){e.sourcePath;var o=e.sourceNode,r=e.destinationNode;e.position;if(n&&s&&t){var a=Et(n,o)-o.rowIndex+1,i=Object(u.a)(n.worksheets.survey.rows).slice(o.rowIndex,o.rowIndex+a),c=r.rowIndex<o.rowIndex,l={rowIndex:r.rowIndex,numberOfRowsToRemove:0,rowsToAdd:i},d={rowIndex:o.rowIndex+(c?a:0),numberOfRowsToRemove:a,rowsToAdd:[]};b("survey",[l,d])}}),[s,t,b,n]);return{context:s,setContext:l,onChangeAnswer:d,onChangeCell:f,onMoveNode:w,onSpliceRows:b,onRemoveRowAndChildren:j,onRenameNode:v,onNestNode:m,onUngroupNode:O,onAddNode:y}}function Tt(e){var n=e.setWorksheetName,t=e.worksheetName;return Object(pn.jsx)(p.C.Group,{align:j.a.LEFT,children:Object(pn.jsxs)(p.d,{children:[Object(pn.jsx)(p.c,{onClick:function(){return n("survey")},active:"survey"===t,children:"Survey"}),Object(pn.jsx)(p.c,{onClick:function(){return n("choices")},active:"choices"===t,children:"Choices"}),Object(pn.jsx)(p.c,{onClick:function(){return n("settings")},active:"settings"===t,children:"Settings"})]})})}function At(e){return Object(pn.jsx)("div",{props:e,style:Object(c.a)({margin:"".concat(e.horizontal,"rem ").concat(e.vertical,"rem")},e.style),children:e.children})}var St=t(118),Rt=t(149);function Ct(e){return Object(pn.jsx)(p.e,{intent:"warning",children:Object(pn.jsx)("h4",{children:"Object arrays are not implemented yet."})})}function Lt(e){var n,t,r,a,i,s,l=o.useContext(y).onChangeCell,u=e.schema,d=e.schemaKey,h=e.node,f=u.objectKeys(d),b=o.useContext(y),j=b.debug,v=h===(null===(n=b.context)||void 0===n?void 0:n.survey)?null===(t=b.xlsForm)||void 0===t||null===(r=t.worksheets.settings)||void 0===r?void 0:r.rows[0].form_title:u.get(d,"label"),m=b.context&&G(h,b.context).join("/"),O=o.useCallback((function(e){e===v||void 0===v&&""===e||l("settings",0,"form_title",e)}),[l,v]),g=o.useCallback((function(e){e===v||void 0===v&&""===e||l("survey",h.rowIndex,"label",e,h)}),[h,l,v]),x=h===(null===(a=b.context)||void 0===a?void 0:a.survey)?Object(pn.jsx)(p.l,{onChange:O,onConfirm:O,placeholder:"Enter a survey title\u2026",value:v,minWidth:100}):Object(pn.jsx)(p.l,{multiline:!0,onChange:g,onConfirm:g,placeholder:"Enter a title for `".concat(h.row.name,"`in ").concat(b.languageName,"\u2026"),value:v,minWidth:100}),w=[p.o,p.p,p.q,p.r,p.s][h.indentationLevel]||p.s,k="string"===typeof b.language&&(null===(i=h.row.hint)||void 0===i?void 0:i[b.language]);return en(h,b.context)||j?Object(pn.jsxs)(p.i,{vertical:!0,style:{padding:"".concat(6/(h.indentationLevel+1),"rem 0")},children:[Object(pn.jsxs)(p.i,{fill:!1,style:{alignItems:"baseline"},children:[Object(pn.jsx)(w,{style:{flex:1},id:m,children:j?Object(pn.jsx)(pn.Fragment,{children:x}):v}),j&&h!==(null===(s=b.context)||void 0===s?void 0:s.survey)&&Object(pn.jsx)(Qn,Object(c.a)(Object(c.a)({},Object(c.a)({},e)),{},{editable:!0}))]}),f.map((function(n){return Object(pn.jsx)(to,{schemaKey:[d,n].join("."),relevant:e.relevant,readonly:e.readonly},n)})),k&&Object(pn.jsx)(p.e,{intent:"primary",children:k})]}):null}var It=[void 0,"","start","end","today","username","simserial","subscriberid","deviceid","phonenumber","calculate"];function _t(e){var n=e.value,t=e.labelElement,o=e.relevant,r=e.readonly;return void 0!==n&&"boolean"!==typeof n?Object(pn.jsx)(p.e,{intent:"warning",children:Object(pn.jsxs)("h4",{children:["Value must be a ",Object(pn.jsx)(p.g,{children:"boolean"})," for this field to work"]})}):Object(pn.jsx)(p.f,{large:!0,disabled:!1===o||r,labelElement:t,onChange:e.onInputChange,defaultChecked:"boolean"===typeof e.defaultValue?e.defaultValue:void 0})}function Dt(e){var n=e.value,t=e.node,r=e.relevant,a=e.readonly,i=o.useContext(y),c=i.language,s=i.onChangeAnswer,l=void 0!==n&&"string"!==typeof n&&(!(n instanceof Array)||n.find((function(e){return"string"!==typeof e}))),u=o.useMemo((function(){return"string"===typeof n?new Set(""===n?[]:null===n||void 0===n?void 0:n.split(" ")):n instanceof Array||n instanceof Set?new Set(n):new Set}),[n]),d=o.useCallback((function(n){var t=n.currentTarget.name,o=new Set(u);n.currentTarget.checked?o.add(t):o.delete(t),s(Array.from(o),e)}),[e,s,u]);return"string"!==typeof c?null:l?Object(pn.jsx)(p.e,{intent:"warning",children:Object(pn.jsxs)("h4",{children:["Value must be a ",Object(pn.jsx)(p.g,{children:"string"})," or Array of ",Object(pn.jsx)(p.g,{children:"string"}),"s for this field to work."]})}):i.debug&&0===t.typeParameters.length?Object(pn.jsx)(p.e,{intent:"warning",title:"No choice list set.",children:Object(pn.jsx)($n,{node:t,showType:!1})}):Object(pn.jsx)(p.i,{vertical:!0,children:t.typeParameters.map((function(e){var n,t=null===(n=i.xlsForm)||void 0===n?void 0:n.choicesByName[e];return t?Object.keys(t).map((function(e){var n,o=t[e],i=null===o||void 0===o||null===(n=o.label)||void 0===n?void 0:n[c],s="undefined"===i?null===o||void 0===o?void 0:o.name:i;return Object(pn.jsx)(p.f,{disabled:!1===r||a,label:s,checked:"string"===typeof e&&u.has(e),name:e,inline:!0,large:!0,onChange:d})})):null}))})}var Mt=t(402),Ft={formatDate:function(e){return e.toLocaleDateString()},parseDate:function(e){return e.length?new Date(e):null},placeholder:"YYYY-MM-DD"};function Pt(e){var n=e.value,t=e.relevant,r=e.readonly,a=o.useContext(y).onChangeAnswer,i=o.useCallback((function(n,t){t&&a(n,e)}),[e,a]);if(void 0!==n&&!(n instanceof Date))return Object(pn.jsx)(p.e,{intent:"warning",children:Object(pn.jsxs)("h4",{children:["Value must be a ",Object(pn.jsx)(p.g,{children:"Date"})," for this field to work"]})});var s=void 0;return"string"===typeof e.defaultValue?s=Ft.parseDate(e.defaultValue):e.defaultValue instanceof Date&&(s=e.defaultValue),Object(pn.jsx)(Mt.a,Object(c.a)(Object(c.a)({},Ft),{},{onChange:i,defaultValue:s||void 0,disabled:!1===t||r}))}function Bt(e){var n,t=e.schema,r=e.schemaKey,a=e.node,i=e.debug,c=e.relevant,s=e.isEditable,l=e.children,u=o.useContext(y),d=null===(n=a.row.label)||void 0===n?void 0:n[u.language||"English (en)"],f=t.get(r,"label"),b=o.useContext(y).onChangeCell,j=u.context&&G(a,u.context).join("/"),v=o.useState(d),m=Object(h.a)(v,2),O=m[0],g=m[1],x=o.useCallback((function(e){g(e)}),[]);o.useEffect((function(){g(d)}),[d]);var w=o.useCallback((function(e){e===d||void 0===d&&""===e||b("survey",a.rowIndex,"label",e,a)}),[a,b,d]),E=s&&i?Object(pn.jsx)(p.l,{onChange:x,onConfirm:w,placeholder:"Enter a title for `".concat(a.row.name,"` in ").concat(u.languageName,"\u2026"),value:O,minWidth:100,minLines:1,maxLines:5,multiline:!0}):f;return l?Object(pn.jsxs)(p.i,{style:{alignItems:"center"},lang:u.languageCode,children:[Object(pn.jsx)("span",{id:j,className:c?"":k.a.TEXT_DISABLED,style:{flex:1},children:i?E:Object(pn.jsx)(Ln,{children:f})}),l]}):Object(pn.jsx)("span",{id:j,className:c?"":k.a.TEXT_DISABLED,style:{flex:1},lang:u.languageCode,children:i?E:Object(pn.jsx)(Ln,{children:f})})}function Ut(e){var n=e.value,t=e.schemaKey,r=e.relevant,a=e.readonly,i=o.useContext(y).onChangeAnswer,c=o.useCallback((function(n){i(n,e)}),[e,i]);return void 0!==n&&"string"!==typeof n&&"number"!==typeof n?Object(pn.jsx)(p.e,{intent:"warning",children:Object(pn.jsxs)("h4",{children:["Value must be a ",Object(pn.jsx)(p.g,{children:"number"})," for this field to work."]})}):Object(pn.jsx)(p.E,{id:t,disabled:!1===r||a,name:t,large:!0,allowNumericCharactersOnly:!1,placeholder:"Enter a number\u2026",value:n,onValueChange:c,defaultValue:"number"===typeof e.defaultValue||"string"===typeof e.defaultValue?e.defaultValue:void 0})}var Gt,Vt,$t,zt,Ht,Kt=t(13);function qt(e){var n=e.value,t=e.onInputChange,r=e.allowedValues,a=e.node,i=e.relevant,c=e.readonly,s=o.useContext(y),l=s.language;return void 0!==n&&"string"!==typeof n?Object(pn.jsx)(p.e,{intent:"warning",children:Object(pn.jsxs)("h4",{children:["Value must be a ",Object(pn.jsx)(p.g,{children:"string"})," for this field to work"]})}):void 0===l?null:s.debug&&0===a.typeParameters.length?Object(pn.jsx)(p.e,{intent:"warning",children:Object(pn.jsxs)(p.i,{fill:!0,children:[Object(pn.jsx)(p.r,{children:"No choice list set."}),Object(pn.jsx)("div",{className:Kt.FLEX_EXPANDER}),Object(pn.jsx)($n,{node:a,showType:!1})]})}):Object(pn.jsx)(p.I,{onChange:t,selectedValue:n,inline:!0,disabled:!1===i||c,children:r.map((function(e){var n,t,o,r=a.typeParameters[0],i=null===(n=s.xlsForm)||void 0===n||null===(t=n.choicesByName[r])||void 0===t?void 0:t[e],c=null===i||void 0===i||null===(o=i.label)||void 0===o?void 0:o[l],u="undefined"===c?null===i||void 0===i?void 0:i.name:c;return Object(pn.jsx)(p.H,{label:u,value:null===i||void 0===i?void 0:i.name,inline:!0,large:!0})}))})}function Wt(e){var n=e.value,t=e.schemaKey,o=e.relevant,r=e.readonly;return void 0!==n&&"string"!==typeof n&&"number"!==typeof n?Object(pn.jsx)(p.e,{intent:"warning",children:Object(pn.jsxs)("h4",{children:["Value must be a ",Object(pn.jsx)(p.g,{children:"string"})," or ",Object(pn.jsx)(p.g,{children:"number"})," for this field to work."]})}):Object(pn.jsx)(p.y,{id:t,disabled:!1===o||r,name:t,placeholder:"",large:!0,onChange:e.onInputChange,defaultValue:"string"===typeof e.defaultValue?e.defaultValue:void 0})}function Xt(e){var n=e.quickType,t=e.schema,o=e.schemaKey;if("number"===n)return Object(pn.jsx)(Ut,Object(c.a)({},e));if("date"===n)return Object(pn.jsx)(Pt,Object(c.a)({},e));if("boolean"===n)return Object(pn.jsx)(_t,Object(c.a)({},e));if("stringArray"===n){var r=t.get(o+".$","allowedValues");if(r instanceof Array)return Object(pn.jsx)(Dt,Object(c.a)({},Object(c.a)(Object(c.a)({},e),{},{allowedValues:r})))}var a=t.get(o,"allowedValues");return a instanceof Array?Object(pn.jsx)(qt,Object(c.a)({},Object(c.a)(Object(c.a)({},e),{},{allowedValues:a}))):Object(pn.jsx)(Wt,Object(c.a)({},e))}function Jt(e){var n,t,r=e.node,a="boolean"===e.quickType,i=o.useContext(y),s=i.language,l=i.debug,u=i.context,d=i.onChangeAnswer,h=o.useCallback((function(n){var t=n.currentTarget,o={checkbox:t.checked,date:t.valueAsDate,number:t.valueAsNumber,text:t.value,radio:t.value}[t.type];d(o,e)}),[d,e]);if(!s||!u)return null;var f=It.includes(r.type);if(f&&!i.debug)return null;var b=Object(pn.jsx)(Qn,Object(c.a)(Object(c.a)({},Object(c.a)({},e)),{},{editable:!0})),j=(null===(n=r.row.hint)||void 0===n?void 0:n[s])&&Object(pn.jsx)(p.e,{intent:"primary",children:null===(t=r.row.hint)||void 0===t?void 0:t[s]}),v=Object(pn.jsx)(Bt,Object(c.a)(Object(c.a)({},Object(c.a)(Object(c.a)({},e),{},{debug:l,isEditable:!a&&!f})),{},{children:"boolean"!==e.quickType&&l&&b})),m=mt(r,u,"calculation",u.nodesToAnswers.get(r)),O=Object(c.a)(Object(c.a)({},e),{},{labelElement:v,onInputChange:h,value:m.result,defaultValue:r.row.default}),g=Object(pn.jsx)(Xt,Object(c.a)({},O));return a?Object(pn.jsxs)(p.n,{labelFor:r.row.name,style:{display:"flex"},children:[l&&b,g,j]}):"note"===r.type?v:Object(pn.jsxs)(p.n,{label:v,labelFor:r.row.name,children:[g,j]})}var Yt=v.a.div(Gt||(Gt=Object(f.a)(['\n  &:after {\n    content: "";\n    position: absolute;\n    left: 0px;\n    width: 1px;\n    bottom: 0;\n    top: 0;\n    background-color: transparent;\n  }\n']))),Qt=v.a.div(Vt||(Vt=Object(f.a)(["\n  position: absolute;\n  left: 0px;\n  height: 44px;\n  width: 44px;\n  background-color: transparent;\n  cursor: pointer;\n"]))),Zt=Object(v.a)(Qt)($t||($t=Object(f.a)(["\n  top: 0;\n  &:hover {\n    background: linear-gradient(\n      135deg,\n      ",",\n      "," 50%\n    );\n  }\n"])),A(w.a.BLUE3,.1),A(w.a.BLUE3,0)),eo=Object(v.a)(Qt)(zt||(zt=Object(f.a)(["\n  bottom: 0;\n  &:hover {\n    background: linear-gradient(\n      45deg,\n      ",",\n      "," 50%\n    );\n  }\n"])),A(w.a.BLUE3,.1),A(w.a.BLUE3,0)),no=v.a.div(Ht||(Ht=Object(f.a)(["\n  padding: 16px 16px 8px;\n  margin: 0;\n  position: relative;\n\n  &:not(:hover):not(:focus-within) {\n    "," {\n      background: none;\n    }\n  }\n  &:hover,\n  :focus-within {\n    background: ",";\n\n    "," {\n      &:after {\n        background: ",";\n      }\n    }\n  }\n"])),Yt,A(w.a.BLUE3,.03),Yt,A(w.a.BLUE3,.1));function to(e){var n=e.schemaKey,t=o.useContext(y),r=t.schema,a=t.context,i=t.debug,s=t.onNestNode,l=t.onUngroupNode,d=jn(),h=d.alert,f=d.showRemoveConfirmationDialog,b=mn(),j=b.dialog,v=b.showRenameDialog;if(!a||!r)return null;var m=r.getQuickTypeForKey(n),O=["."].concat(Object(u.a)(n.replace(/\.\$/g,"").split("."))),g=B(O,a,a.survey);if(g instanceof Array)return i?Object(pn.jsx)(p.e,{intent:"warning",children:Object(pn.jsxs)(p.r,{children:["Found multiple nodes with path ",Object(pn.jsx)(p.g,{children:O.join("/")}),". This should not happen."]})}):null;if(!g)return i?Object(pn.jsx)(p.e,{intent:"warning",children:Object(pn.jsxs)(p.r,{children:["No node found for"," ",Object(pn.jsx)(p.g,{children:O[O.length-1]})]})}):null;var x=e.relevant;if("boolean"!==typeof x||!0===x){var w,N=null===(w=a.evaluationResults.get(g))||void 0===w?void 0:w.get("relevant");x="boolean"===typeof(null===N||void 0===N?void 0:N.result)?N.result:null!==(null===N||void 0===N?void 0:N.result)}var T=!1;if("undefined"!==typeof e.readonly||!0===e.readonly){var A,S=null===(A=a.evaluationResults.get(g))||void 0===A?void 0:A.get("readonly");T="boolean"===typeof(null===S||void 0===S?void 0:S.result)?S.result:e.readonly}var R,C={schema:r,node:g,schemaKey:n,quickType:m,relevant:x,readonly:T};if(!i&&!x)return null;switch(m){case"object":R=Object(pn.jsx)(Lt,Object(c.a)({},C));break;case"objectArray":R=Object(pn.jsx)(Ct,Object(c.a)({},C));break;default:R=Object(pn.jsx)(Jt,Object(c.a)({},C))}if(i&&g!==a.survey){var L=Object(pn.jsx)(Kn,{node:g,onRemove:f,onRename:v,onNestField:s,onUngroupField:l}),I=Object(pn.jsx)(p.z,{children:L});return Object(pn.jsxs)(pn.Fragment,{children:[h,j,Object(pn.jsx)(Rt.a,{content:I,children:Object(pn.jsxs)(no,{children:[Object(pn.jsx)(Yt,{}),Object(pn.jsx)(E.a,{content:Object(pn.jsxs)("ul",{className:k.a.LIST_UNSTYLED,children:[Object(pn.jsx)(Hn,{icon:"arrow-up",node:g,position:"before",group:!1}),Object(pn.jsx)(Hn,{icon:"arrow-up",node:g,position:"before",group:!0}),Object(pn.jsx)(p.A,{}),Object(pn.jsx)(p.B,{text:"Actions",icon:"more",children:L})]}),lazy:!0,interactionKind:"click",placement:"left",renderTarget:function(e){e.isOpen;var n=e.ref,t=Object(St.a)(e,["isOpen","ref"]);return Object(pn.jsx)(Zt,Object(c.a)(Object(c.a)({},t),{},{ref:n}))},hoverOpenDelay:0,hoverCloseDelay:0}),Object(pn.jsx)(E.a,{content:Object(pn.jsxs)("ul",{className:k.a.LIST_UNSTYLED,children:[Object(pn.jsx)(p.B,{text:"Actions",icon:"more",children:L}),Object(pn.jsx)(p.A,{}),Object(pn.jsx)(Hn,{icon:"arrow-down",node:g,position:"after",group:!1}),Object(pn.jsx)(Hn,{icon:"arrow-down",node:g,position:"after",group:!0})]}),lazy:!0,interactionKind:"click",placement:"left",renderTarget:function(e){e.isOpen;var n=e.ref,t=Object(St.a)(e,["isOpen","ref"]);return Object(pn.jsx)(eo,Object(c.a)(Object(c.a)({},t),{},{ref:n}))},hoverOpenDelay:0,hoverCloseDelay:0}),R]})})]})}return R}var oo,ro=t(401),ao=t(399),io=t(158),co=Object(v.a)(ro.a)(oo||(oo=Object(f.a)(["\n  /* flex: 1; */\n"])));function so(e){var n=e.language,t=e.xlsForm,r=e.worksheetName,a=o.useContext(y).onChangeCell,i=t.worksheets[e.worksheetName],s=null===i||void 0===i?void 0:i.rows.length,l=o.useMemo((function(){return Object(S.uniq)(null===i||void 0===i?void 0:i.columnNamesNormalized.map((function(e){return e.replace(/::.*$/,"")})))}),[t,i]),u=o.useCallback((function(e,n,o){if(void 0!==o&&void 0!==n){var c=null===i||void 0===i?void 0:i.rows[n];if(!c)throw new Error("Tried to change a row that doesn\u2019t exist");var s=l[o];c[s]!==e&&a(r,n,s,e,t.flatNodes[n])}}),[l,a,null===i||void 0===i?void 0:i.rows,r,t.flatNodes]),d=o.useMemo((function(){return function(e,o){var r=null===i||void 0===i?void 0:i.rows[e];if(!r)return Object(pn.jsx)(pn.Fragment,{});var a=l[o],c=r[a],s=t.flatNodes[e];return void 0!==c&&"string"!==typeof c?qe.includes(a)?Object(pn.jsx)(ao.a,{rowIndex:e,columnIndex:o,onConfirm:u,value:c[n]}):Object(pn.jsx)(ao.a,{rowIndex:e,columnIndex:o,onConfirm:u,value:JSON.stringify(c)}):Object(pn.jsx)(ao.a,{rowIndex:e,columnIndex:o,onConfirm:u,value:c,style:["type","name"].includes(a)?{paddingLeft:"".concat(4+8*(null===s||void 0===s?void 0:s.indentationLevel),"px")}:{},children:c})}}),[null===i||void 0===i?void 0:i.rows,l,t.flatNodes,u,n]);return i?Object(pn.jsx)(it,{style:Object(c.a)({},e.style),children:Object(pn.jsx)(co,{numRows:s,enableRowResizing:!1,children:l.map((function(e){return Object(pn.jsx)(io.a,{name:e,cellRenderer:d})}))})}):Object(pn.jsxs)(p.e,{intent:"warning",children:["No ",e.worksheetName," sheet defined"]})}function lo(e,n){return function(){return void 0!==e.row.relevant&&""!==e.row.relevant&&!vt(e.row.relevant,n,e)||!(void 0===e.row.required||""===e.row.required||vt(e.row.required,n,e))}}function uo(e,n,t){return!!e.match(/\${([^}]+)}/)?function(){return e.replaceAll(/\${([^}]+)}/g,(function(e,o,r){try{var a=e,i=ht(new se([{type:q.NAME,text:a,index:r}],o,e),n,t);return String(i)}catch(c){if(c instanceof W)return c.toMarkdown();throw c}}))}:e}var ho=function(e,n){var t;return t={},Object(R.a)(t,e,Object(c.a)({type:Object},n)),Object(R.a)(t,"".concat(e,".maxValue"),{type:Number,optional:!0}),Object(R.a)(t,"".concat(e,".minValue"),{type:Number,optional:!0}),Object(R.a)(t,"".concat(e,".unitCode"),{type:Text,optional:!0}),Object(R.a)(t,"".concat(e,".unitText"),{type:Text,optional:!0}),Object(R.a)(t,"".concat(e,".value"),{type:O.a.oneOf(Number,String,Boolean)}),t},fo=function(e,n){var t;return Object(c.a)(Object(c.a)((t={},Object(R.a)(t,e,Object(c.a)({type:Object},n)),Object(R.a)(t,"".concat(e,".bitrate"),{type:String,label:"The bitrate of the media object.",optional:!0}),Object(R.a)(t,"".concat(e,".contentSize"),{type:String,label:"File size in (mega/kilo) bytes."}),Object(R.a)(t,"".concat(e,".contentUrl"),{type:String,regEx:O.a.RegEx.Url,label:"Actual bytes of the media object, for example the image file or video file."}),Object(R.a)(t,"".concat(e,".duration"),{type:String,label:"The duration of the item (movie, audio recording, event, etc.) in ISO 8601 date format.",optional:!0}),Object(R.a)(t,"".concat(e,".embedUrl"),{type:String,regEx:O.a.RegEx.Url,label:"A URL pointing to a player for a specific video. In general, this is the information in the src element of an embed tag and should not be the same as the content of the loc tag.",optional:!0}),Object(R.a)(t,"".concat(e,".encodingFormat"),{type:String,label:"Media type typically expressed using a MIME format (see IANA site and MDN reference) e.g. application/zip for a SoftwareApplication binary, audio/mpeg for .mp3 etc.)."}),Object(R.a)(t,"".concat(e,".endTime"),{type:Date,label:"the time offset of the end of a clip within a larger file.",optional:!0}),Object(R.a)(t,"".concat(e,".startTime"),{type:Date,label:"the time offset of the start of a clip within a larger file.",optional:!0}),Object(R.a)(t,"".concat(e,".uploadDate"),{type:Date,label:"Date when this media object was uploaded to this site.",optional:!0}),t),ho("".concat(e,".height"),{type:O.a.oneOf(String,Object),label:"The height of the item."})),ho("".concat(e,".width"),{type:O.a.oneOf(String,Object),label:"The width of the item."}))},bo=function e(n){var t,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0;return Object(c.a)(Object(c.a)((t={},Object(R.a)(t,n,Object(c.a)({type:Object},r)),Object(R.a)(t,"".concat(n,".exifData"),{type:Object,blackbox:!0,label:" or Text\texif data for this object.",optional:!0}),Object(R.a)(t,"".concat(n,".representativeOfPage"),{type:Boolean,label:"Indicates whether this image is representative of the content of the page.",optional:!0}),t),fo("".concat(n,".caption"),{label:"The caption for this object. For downloadable machine formats (closed caption, subtitles etc.) use MediaObject and indicate the encodingFormat.",optional:!0})),o?e("".concat(n,".thumbnail"),!1,{label:"Thumbnail image for an image or video.",optional:!0}):{})};function po(e){var n,t=e.node.typeParameters,o=Object.keys(e.xlsForm.choicesByName),r=e.node.row.type;if(!(void 0!==o[0]))throw new Z("Node `".concat(e.key,"` uses `").concat(r,"` as its `type`, but the \u2018choices\u2019 worksheet seems to be empty or invalid. Please define some valid choice lists first."));var a=e.xlsForm.choicesByName,i=Object(S.compact)(t.map((function(n){return n.trim().startsWith("$")?function(e,n,t){var o=vt(e,n.context,n.node);if("error"===o.state)throw new X("Error evaluating `".concat(e,"` to determine available selection choices."),"invalidDynamicChoices",o.expression,n.context,n.node);if("string"!==typeof o.result)throw new X("Evaluating `".concat(e,"` did not yield a `string`. Please ensure the referenced field returns a string."),"invalidDynamicChoices",o.expression,n.context,n.node);var r=o.result;if(!t[r])throw new X("Evaluating `".concat(e,"` yielded string `'").concat(r,"'`, but the according choices list does not exist. Please ensure that the field calculates an existing list name."),"invalidDynamicChoices",o.expression,n.context,n.node);return r}(n,e,a):n}))).filter((function(e){return void 0!==e&&""!==e})),s=i.map((function(e){return a[e]})).filter((function(e){return void 0!==e}));if(s.length!==i.length)throw new Z("Node `".concat(e.key,"` (row #").concat(e.node.rowIndex+2,") refers to list names `").concat(i,"`. One of these lists is either not defined in the \u2018choices\u2019 worksheet, or could not be loaded correctly. Found list names:\n\n").concat(o.map((function(e){return"`".concat(e,"`")})).join(", ")));var l=null===(n=e.node.row.choice_filter)||void 0===n?void 0:n.trim();return l&&""!==l?function(e,n,t,o){var r=new re(e),a=new Te({tokens:r}).parseExpression();return function(){return n.flatMap((function(e){return Object.values(e)})).filter((function(e){var n=ht(a,Object(c.a)(Object(c.a)({},o),{},{evaluateNonDollarNameFn:function(n){return e[n.expression.name]||g[n.expression.name]}}),t);if("boolean"!==typeof n)throw new X("`choice_filter` formula did not evaluate to a `boolean`. Please ensure the formula returns a `boolean`.","invalidDynamicChoices",a,o,t);return n})).map((function(e){return e.name}))}}(l,s,e.node,e.context):s.flatMap((function(e){return Object.keys(e)}))}var jo,vo,mo={"":function(){return{}},integer:function(e){return Object(R.a)({},e.key,{type:O.a.Integer})},decimal:function(e){return Object(R.a)({},e.key,{type:Number})},range:function(e){return Object(R.a)({},e.key,{type:Number})},text:function(e){return Object(R.a)({},e.key,{type:String})},select_one:function(e){return Object(R.a)({},e.key,{type:String,allowedValues:po(e)})},select_multiple:function(e){var n;return n={},Object(R.a)(n,e.key,{type:Array}),Object(R.a)(n,e.key+".$",{type:String,allowedValues:po(e)}),n},select_one_from_file:function(e){return Object(R.a)({},e.key,{type:String})},select_multiple_from_file:function(e){var n;return n={},Object(R.a)(n,e.key,{type:Array}),Object(R.a)(n,e.key+".$",{type:String}),n},rank:function(e){return Object(R.a)({},e.key,{type:String})},note:function(e){return Object(R.a)({},e.key,{type:String})},geopoint:function(e){return function(e){var n;return n={},Object(R.a)(n,e,{type:Object}),Object(R.a)(n,"".concat(e,".type"),{type:String,allowedValues:["Point"],defaultValue:"Point"}),Object(R.a)(n,"".concat(e,".coordinates"),{type:Array,minCount:2,maxCount:2}),Object(R.a)(n,"".concat(e,".coordinates.$"),{type:Number,min:-180,max:180}),n}(e.key)},geotrace:function(e){return function(e){var n;return n={},Object(R.a)(n,e,{type:Object}),Object(R.a)(n,"".concat(e,".type"),{type:String,allowedValues:["LineString"],defaultValue:"LineString"}),Object(R.a)(n,"".concat(e,".coordinates"),{type:Array,minCount:2}),Object(R.a)(n,"".concat(e,".coordinates.$"),{type:Array,minCount:2,maxCount:2}),Object(R.a)(n,"".concat(e,".coordinates.$.$"),{type:Number,min:-180,max:180}),n}(e.key)},geoshape:function(e){return function(e){var n;return n={},Object(R.a)(n,e,{type:Object}),Object(R.a)(n,"type",{type:String,allowedValues:["Polygon"],defaultValue:"Polygon"}),Object(R.a)(n,"".concat(e,".coordinates"),{type:Array,minCount:1}),Object(R.a)(n,"".concat(e,".coordinates.$"),{type:Array,minCount:2}),Object(R.a)(n,"".concat(e,".coordinates.$.$"),{type:Array,minCount:4,maxCount:4}),Object(R.a)(n,"".concat(e,".coordinates.$.$.$"),{type:Number,min:-180,max:180}),n}(e.key)},date:function(e){return Object(R.a)({},e.key,{type:Date})},time:function(e){return Object(R.a)({},e.key,{type:Date})},datetime:function(e){return Object(R.a)({},e.key,{type:Date})},image:function(e){return bo(e.key)},audio:function(e){return function(e,n){var t;return Object(c.a)((t={},Object(R.a)(t,e,Object(c.a)({type:Object},n)),Object(R.a)(t,"".concat(e,".transcript"),{type:String,optional:!0}),t),fo("".concat(e,".caption"),{type:O.a.oneOf(String,Object),label:"The caption for this object. For downloadable machine formats (closed caption, subtitles etc.) use MediaObject and indicate the encodingFormat.",optional:!0}))}(e.key)},video:function(e){return function(e,n){var t;return Object(c.a)((t={},Object(R.a)(t,e,Object(c.a)({type:Object},n)),Object(R.a)(t,"".concat(e,".caption"),{type:fo("".concat(e,".caption")),label:" or Text\tThe caption for this object. For downloadable machine formats (closed caption, subtitles etc.) use MediaObject and indicate the encodingFormat.",optional:!0}),Object(R.a)(t,"".concat(e,".transcript"),{type:String,label:"If this MediaObject is an AudioObject or VideoObject, the transcript of that object.",optional:!0}),Object(R.a)(t,"".concat(e,".videoFrameSize"),{type:String,label:"The frame size of the video.",optional:!0}),Object(R.a)(t,"".concat(e,".videoQuality"),{type:String,optional:!0}),t),bo("".concat(e,".thumbnail"),!0,{label:"Thumbnail image for an image or video.",optional:!0}))}(e.key)},file:function(e){return fo(e.key)},barcode:function(e){return Object(R.a)({},e.key,{type:String})},calculate:function(e){return Object(R.a)({},e.key,{type:String})},acknowledge:function(e){return Object(R.a)({},e.key,{type:Boolean})},hidden:function(e){return Object(R.a)({},e.key,{type:String})},"xml-external":function(e){return Object(R.a)({},e.key,{type:String})},start:function(e){return Object(R.a)({},e.key,{type:Date})},end:function(e){return Object(R.a)({},e.key,{type:Date})},today:function(e){return Object(R.a)({},e.key,{type:Date})},deviceid:function(e){return Object(R.a)({},e.key,{type:String})},simserial:function(e){return Object(R.a)({},e.key,{type:String})},subscriberid:function(e){return Object(R.a)({},e.key,{type:String})},phonenumber:function(e){return Object(R.a)({},e.key,{type:String})},username:function(e){return Object(R.a)({},e.key,{type:String})},email:function(e){return Object(R.a)({},e.key,{type:String,regEx:O.a.RegEx.EmailWithTLD})},audit:function(e){return Object(R.a)({},e.key,{type:String})}};function Oo(e){var n,t,o,r=e.node,a=e.language,i=e.xlsForm,s=e.context,l=e.key,d={label:uo((null===(n=r.row.label)||void 0===n?void 0:n[a])||"",s,r),optional:lo(r,s)};if(null===(t=r.row)||void 0===t?void 0:t.type.match(/^begin_repeat$/)){var h=r.children.map((function(n){return Oo(Object(c.a)(Object(c.a)({},e),{},{node:n,key:l+".$."+n.row.name}))}));o=Object.assign.apply(Object,[Object(R.a)({},l,Object(c.a)(Object(c.a)({},d),{},{type:Array}))].concat(Object(u.a)(h)))}else if(r.row.type.match(/^begin_group$/)||r===i.rootSurveyGroup){var f=r.children.map((function(n){return n.row,Oo(Object(c.a)(Object(c.a)({},e),{},{node:n,key:l+"."+n.row.name}))}));o=Object.assign.apply(Object,[Object(R.a)({},l,Object(c.a)(Object(c.a)({},d),{},{type:Object}))].concat(Object(u.a)(f)))}else o=function(e,n,t,o,r){var a,i=e.row;if(!i)throw new Error("Node needs an associated row for creating a schema.");var s=(null===(a=i.label)||void 0===a?void 0:a[n])||"",l={type:String,label:uo(s,o,e),optional:lo(e,o)},u=mo[e.type];if(!u)throw new Error("Could not find schema generator for node type ".concat(JSON.stringify(i)));var d=u({key:r,node:e,xlsForm:t,context:o}),h=d[Object.keys(d)[0]];return Object.assign(h,l,Object(c.a)({},h)),d}(r,a,i,s,l);return o}b.a.onlyShowFocusOnTabs();var go=Object(v.a)((function(e){var n=o.useContext(y),t=n.schema,r=n.languageCode,a=n.debug,i=null===t||void 0===t?void 0:t.objectKeys().map((function(e){return Object(pn.jsx)(to,{schemaKey:e},e)}));return Object(pn.jsx)(At,{horizontal:2,vertical:2,className:e.className,style:{maxWidth:a?"60rem":"50rem",padding:"4rem",margin:"auto"},lang:r,children:Object(pn.jsx)("form",{children:i})})}))(jo||(jo=Object(f.a)(["\n  max-width: 800px;\n  margin: auto;\n\n  font-size: 20px;\n  .bp3-small {\n    font-size: 16px;\n  }\n\n  .bp3-large {\n    font-size: 20px;\n  }\n\n  .bp3-form-helper-text {\n    font-size: 16px;\n  }\n\n  .bp3-form-group {\n    margin: 0 0 40px;\n  }\n\n  .bp3-control {\n    margin-bottom: 10px;\n  }\n"]))),xo=v.a.div(vo||(vo=Object(f.a)(["\n  flex: 1;\n  overflow: hidden;\n  display: flex;\n  flex-direction: row;\n  align-items: stretch;\n"])));function yo(e){return Object(pn.jsx)(p.K,{checked:e.checked,label:e.label,onChange:e.onChange,inline:!0,style:{marginBottom:"0"}})}var wo=function(){var e=r.a.useState(),n=Object(h.a)(e,2),t=n[0],o=n[1],a=r.a.useState(),i=Object(h.a)(a,2),s=i[0],f=i[1],b=r.a.useState(!0),v=Object(h.a)(b,2),m=v[0],g=v[1],x=r.a.useState(!1),w=Object(h.a)(x,2),k=w[0],E=w[1],N=r.a.useState(!1),T=Object(h.a)(N,2),A=T[0],S=T[1],R=r.a.useState("survey"),C=Object(h.a)(R,2),L=C[0],I=C[1],_=r.a.useCallback(function(){var e=Object(d.a)(l.a.mark((function e(n){var t,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Xe(n);case 2:a=e.sent,o(a),f((null===(t=a.worksheets.settings)||void 0===t?void 0:t.rows[0].default_language)||Object(u.a)(null===(r=a.languages)||void 0===r?void 0:r.values())[0]||"English (en)");case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[]),D=r.a.useCallback((function(e){g(!e.currentTarget.checked)}),[]),M=r.a.useCallback((function(e){E(e.currentTarget.checked)}),[]),F=r.a.useCallback((function(e){S(e.currentTarget.checked)}),[]),P=Object(pn.jsx)(tt,{onLoadWorkbook:_}),B=r.a.useCallback((function(){o(void 0)}),[]),U=Object(pn.jsx)(p.c,{className:"bp3-minimal",icon:"reset",text:"Reset",onClick:B}),G=t&&Object(pn.jsx)(it,{className:"bp3-code-block",style:{padding:"1rem",margin:"0",whiteSpace:"pre"},children:Object(pn.jsx)(nt,{xlsForm:t})}),V=Nt({language:s,xlsForm:t,setXLSForm:o}),$=V.context,z=(null===s||void 0===s?void 0:s.match(/^(.*) \((\w+)\)$/))||[],H=Object(h.a)(z,3),K=H[1],q=H[2],W=r.a.useMemo((function(){if(t&&s&&$)return function(e,n,t){var o=Oo({node:e.rootSurveyGroup,xlsForm:e,context:n,language:t,key:e.rootSurveyGroup.row.name});return new O.a(new O.a(o).mergedSchema())}(t,$,s)}),[t,s,$]);return Object(pn.jsx)(gn.Provider,{value:{onDropNode:V.onMoveNode},children:Object(pn.jsxs)(y.Provider,{value:Object(c.a)({schema:W,language:s,languageCode:q,languageName:K,debug:m,xlsForm:t},V),children:[t&&Object(pn.jsxs)(p.C,{children:[k&&Object(pn.jsx)(Tt,{setWorksheetName:I,worksheetName:L}),Object(pn.jsxs)(p.C.Group,{align:j.a.RIGHT,children:[U,Object(pn.jsx)(p.C.Divider,{}),Object(pn.jsx)(yo,{checked:!0===k,label:"Table",onChange:M}),Object(pn.jsx)(yo,{checked:!1===m,label:"Live View",onChange:D}),Object(pn.jsx)(yo,{checked:!0===A,label:"JSON",onChange:F}),Object(pn.jsx)(p.C.Divider,{}),t&&s&&Object(pn.jsx)(at,{languages:Array.from(t.languages.values()),language:s,onChange:f})]})]}),Object(pn.jsxs)(xo,{children:[!t&&Object(pn.jsx)(it,{children:Object(pn.jsx)(p.D,{icon:"document-open",title:"Open an XLSForm Excel file to start.",action:P})}),t&&s&&k&&Object(pn.jsx)(so,{xlsForm:t,language:s,debug:m,style:{width:"50%"},worksheetName:L}),t&&s&&Object(pn.jsx)(it,{style:{boxShadow:"0 0px 30px #9fb7c2",zIndex:1},children:Object(pn.jsx)(go,{xlsForm:t,language:s,debug:m})}),t&&s&&A&&G]})]})})},ko=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,405)).then((function(n){var t=n.getCLS,o=n.getFID,r=n.getFCP,a=n.getLCP,i=n.getTTFB;t(e),o(e),r(e),a(e),i(e)}))};Object(xt.b)(),Object(xt.c)(),i.a.render(Object(pn.jsx)(r.a.StrictMode,{children:Object(pn.jsx)(wo,{})}),document.getElementById("root")),ko()}},[[382,1,2]]]);
//# sourceMappingURL=main.d25c9fab.chunk.js.map