(this["webpackJsonpsurvey-editor"]=this["webpackJsonpsurvey-editor"]||[]).push([[0],{368:function(e,t,n){},369:function(e,t,n){},462:function(e,t,n){"use strict";n.r(t);var o=n(0),a=n.n(o),r=n(28),i=n.n(r),c=(n(368),n(6)),l=n(23),s=n(37),u=n(489),d=n(483),h=n(81),b=n(104),f=n(164),p=n(38),j=(n(369),n(127)),v=n(18),m=n(24),g=n(16),O=n(25),x=n(26),y=n(218),w=n(32);function k(e,t){var n,o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.survey;if((null===(n=a.row)||void 0===n?void 0:n.name)===e)return a;if(null===(o=a.children)||void 0===o?void 0:o.length)for(var r=0;r<a.children.length;r+=1){var i,c=a.children[r];if((null===(i=c.row)||void 0===i?void 0:i.name)===e)return c;var l=k(e,t,c);if(l)return l}}function E(e,t,n){var o;if((null===(o=n.row)||void 0===o?void 0:o.name)===e)return n;if(n.children)for(var a=0;a<n.children.length;a+=1){var r,i=n.children[a];if((null===(r=i.row)||void 0===r?void 0:r.name)===e)return i}var c=I(n,t),l=null===c||void 0===c?void 0:c[c.length-1];return l&&E(e,t,l)||void 0}function C(e,t){var n,o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.survey,r=e[0];if("."===r)o=a;else if("/"===r)o=t.survey;else if(".."===r){if(a===t.survey)throw new Error("Reached root - Can\u2019t traverse further up the hierarchy.");var i=I(a,t);o=null===i||void 0===i?void 0:i[i.length-1]}else if(r===a.row.name)o=a;else if(null===(n=a.children)||void 0===n?void 0:n.length)for(var c=0;c<a.children.length;c+=1){var l=a.children[c];if(l.row.name===r){o=l;break}}return 1===e.length?o:C(e.slice(1),t,o)}function T(e,t){var n,o;if(!e)return["/"];if(!(null===e||void 0===e||null===(n=e.row)||void 0===n?void 0:n.name))throw new Error("Encountered a row without a name (row #".concat(e.rowIndex,"). This should not happen. Please ensure the survey data is valid."));var a=I(e,t);return[null===(o=e.row)||void 0===o?void 0:o.name].concat(Object(g.a)(T(null===a||void 0===a?void 0:a[a.length-1],t)))}function N(e,t){var n;return null===(n=T(e,t))||void 0===n?void 0:n.reverse()}function S(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";return N(e,t).slice(1).join(n)}function A(e,t){var n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(Object(w.isEqual)(e,t))return o;if(null===(n=t.children)||void 0===n?void 0:n.length)for(var a=0;a<t.children.length;a+=1){o.push(a);var r=t.children[a],i=A(e,r,o);if(void 0!==i)return i;o.pop()}}function R(e,t){return A(e,t.survey)}function L(e,t){var n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(Object(w.isEqual)(e,t))return o;if(null===(n=t.children)||void 0===n?void 0:n.length){o.push(t);for(var a=0;a<t.children.length;a+=1){var r=t.children[a],i=L(e,r,o);if(i)return i}o.pop()}}function I(e,t){return L(e,t.survey)}var _,F=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(v.a)(this,n);for(var o=arguments.length,a=new Array(o),r=0;r<o;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).token=void 0,e}return Object(m.a)(n,[{key:"toMarkdown",value:function(){return this.message}}]),n}(Object(y.a)(Error)),D=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e,o,a,r,i){var c,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0;Object(v.a)(this,n),(c=t.call(this,e)).type=o,c.expression=a,c.context=r,c.scope=i,c.underlyingEvaluationError=l,c.nodeStack=void 0;var s=L(i,r.survey);return c.nodeStack=[].concat(Object(g.a)(s||[]),[i]),c}return Object(m.a)(n,[{key:"toMarkdown",value:function(){return this.message}}]),n}(F),M=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e,o,a){var r;return Object(v.a)(this,n),(r=t.call(this,o)).type=e,r.tokens=a,r}return Object(m.a)(n,[{key:"toMarkdown",value:function(){return this.message}}]),n}(F),P=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e,o){var a;return Object(v.a)(this,n),(a=t.call(this,o)).token=e,a.message=o,a}return n}(F),U=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(){return Object(v.a)(this,n),t.apply(this,arguments)}return n}(F),B=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(){return Object(v.a)(this,n),t.apply(this,arguments)}return n}(F),G=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){return Object(v.a)(this,n),t.call(this,"The `".concat(e,"` function is not supported yet. If you need it, please contact the developers."))}return n}(F),z=function e(){Object(v.a)(this,e)},V=function e(){Object(v.a)(this,e)};!function(e){e[e.LEFT_PAREN=0]="LEFT_PAREN",e[e.RIGHT_PAREN=1]="RIGHT_PAREN",e[e.COMMA=2]="COMMA",e[e.ASSIGN=3]="ASSIGN",e[e.PLUS=4]="PLUS",e[e.MINUS=5]="MINUS",e[e.ASTERISK=6]="ASTERISK",e[e.DOLLAR=7]="DOLLAR",e[e.LEFT_BRACE=8]="LEFT_BRACE",e[e.RIGHT_BRACE=9]="RIGHT_BRACE",e[e.GREATER_THAN=10]="GREATER_THAN",e[e.LESS_THAN=11]="LESS_THAN",e[e.SLASH=12]="SLASH",e[e.POINT=13]="POINT",e[e.CARET=14]="CARET",e[e.TILDE=15]="TILDE",e[e.BANG=16]="BANG",e[e.BACKSLASH=17]="BACKSLASH",e[e.QUESTION=18]="QUESTION",e[e.COLON=19]="COLON",e[e.SINGLE_QUOTE=20]="SINGLE_QUOTE",e[e.DOUBLE_QUOTE=21]="DOUBLE_QUOTE",e[e.MODULO=22]="MODULO",e[e.BOOLEAN_AND=23]="BOOLEAN_AND",e[e.BOOLEAN_OR=24]="BOOLEAN_OR",e[e.COMPARISON=25]="COMPARISON",e[e.NAME=26]="NAME",e[e.LITERAL=27]="LITERAL",e[e.NUMBER_LITERAL=28]="NUMBER_LITERAL",e[e.FLOAT_LITERAL=29]="FLOAT_LITERAL",e[e.INT_LITERAL=30]="INT_LITERAL",e[e.STRING_LITERAL=31]="STRING_LITERAL",e[e.BOOLEAN_LITERAL=32]="BOOLEAN_LITERAL",e[e.SELECTOR=33]="SELECTOR",e[e.WHITESPACE=34]="WHITESPACE",e[e.UNKNOWN=35]="UNKNOWN",e[e.EOF=36]="EOF",e[e.INVALID=37]="INVALID",e[e.INTERNAL_LEXER_ERROR=38]="INTERNAL_LEXER_ERROR"}(_||(_={}));_.LEFT_PAREN,_.RIGHT_PAREN,_.COMMA,_.ASSIGN,_.PLUS,_.MINUS,_.ASTERISK,_.GREATER_THAN,_.LESS_THAN,_.BOOLEAN_AND,_.BOOLEAN_OR,_.SLASH,_.CARET,_.TILDE,_.BANG,_.MODULO,_.COMPARISON,_.BACKSLASH,_.QUESTION,_.COLON,_.SINGLE_QUOTE,_.DOUBLE_QUOTE,_.NAME,_.LITERAL,_.NUMBER_LITERAL,_.INT_LITERAL,_.FLOAT_LITERAL,_.STRING_LITERAL,_.BOOLEAN_LITERAL,_.WHITESPACE,_.UNKNOWN,_.EOF,_.INVALID;function H(e){switch(e){case _.LEFT_PAREN:return"(";case _.RIGHT_PAREN:return")";case _.COMMA:return",";case _.ASSIGN:return"=";case _.PLUS:return"+";case _.MINUS:return"-";case _.ASTERISK:return"*";case _.SLASH:return"/";case _.CARET:return"^";case _.TILDE:return"~";case _.BANG:return"!";case _.BACKSLASH:return"\\";case _.QUESTION:return"?";case _.COLON:return":";default:return"[undefined punctuator]"}}var W,K=function e(){Object(v.a)(this,e),this.kind=void 0,this.tokens=void 0,this.children=void 0},X=function(){function e(t){Object(v.a)(this,e),this.options=t,this.readTokens=[],this.prefixParselets=new Map,this.infixParselets=new Map}return Object(m.a)(e,[{key:"register",value:function(e,t){if(t instanceof V)this.prefixParselets.set(e,t);else{if(!(t instanceof z))throw new Error("Found a parselet that was neither an infix nor a prefix parselet: No idea what to do with it\u2026");this.infixParselets.set(e,t)}}},{key:"parseExpression",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=this.consumeAnything();if(!o)throw new M("prematureEOF","Parser encountered end of tokens. This should not happen.");var a=this.prefixParselets.get(o.type);if(!a)throw new M("undefinedPrefix","Expected start of a new expression, but `".concat(o.text,"` is not an allowed prefix."),[o]);for(var r=a.parse(this,o);n<this.getPrecedence();){var i=this.consumeAnything();if(!i)throw new M("prematureEndOfTokens","Parser encountered end of tokens. This should not happen.");var c=this.infixParselets.get(i.type);if(!c)throw new M("undefinedInfix","`".concat(i.text,"` is not an allowed infix."),[i]);r=c.parse(this,r,i)}return null===(e=(t=this.options).onExpression)||void 0===e||e.call(t,r),r}},{key:"match",value:function(e){if(this.lookAhead(0).type===e)return this.consumeAnything()}},{key:"consume",value:function(e){var t=this.lookAhead(0);if(t.type!==e){if(t.type===_.EOF)throw new U("Missing `"+H(e)+"` before the end of the formula. Is the formula complete?");throw new U("Expected token `"+_[e]+"` but found `"+_[t.type]+"`")}if(!this.consumeAnything())throw new U("Could not consume token "+e);return t}},{key:"consumeAnything",value:function(){return this.lookAhead(0),this.readTokens.shift()}},{key:"lookAhead",value:function(e){for(;e>=this.readTokens.length;){var t,n,o=this.options.tokens.next();o.value&&(null===(t=(n=this.options).onToken)||void 0===t||t.call(n,o.value)),this.readTokens.push(o.value)}return this.readTokens[e]}},{key:"getPrecedence",value:function(){var e=this.infixParselets.get(this.lookAhead(0).type);return e?e.getPrecedence():0}}]),e}(),$=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e,o,a){var r;return Object(v.a)(this,n),(r=t.call(this)).tokens=e,r.name=o,r.text=a,r.kind="name",r.children=r.tokens,r}return Object(m.a)(n,[{key:"print",value:function(e){e(this.name)}}]),n}(K),q=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e,o,a,r){var i;return Object(v.a)(this,n),(i=t.call(this)).tokens=e,i.left=o,i.operatorToken=a,i.right=r,i.kind="operator",i.children=[i.left,i.operatorToken,i.right],i}return Object(m.a)(n,[{key:"print",value:function(e){e("("),this.left.print(e),e(" "),e(this.operatorToken.text),e(" "),this.right.print(e),e(")")}}]),n}(K),Y=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e,o){var a;return Object(v.a)(this,n),(a=t.call(this)).precedence=e,a.isRight=o,a}return Object(m.a)(n,[{key:"parse",value:function(e,t,n){var o=e.parseExpression(this.precedence-(this.isRight?1:0));return new q([].concat(Object(g.a)(t.tokens),[n],Object(g.a)(o.tokens)),t,n,o)}},{key:"getPrecedence",value:function(){return this.precedence}}]),n}(z),J=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e,o,a,r,i){var c;return Object(v.a)(this,n),(c=t.call(this)).tokens=e,c.fn=o,c.leftParenToken=a,c.argsAndDelimiters=r,c.rightParenToken=i,c.kind="call",c.args=void 0,c.children=[c.fn,c.leftParenToken].concat(Object(g.a)(c.argsAndDelimiters),[c.rightParenToken]),c.args=r.filter((function(e){return e instanceof K})),c}return Object(m.a)(n,[{key:"print",value:function(e){this.fn.print(e),e("(");for(var t=0;t<this.args.length;t++)this.args[t].print(e),t<this.args.length-1&&e(", ");e(")")}}]),n}(K),Q=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e,o,a){var r;return Object(v.a)(this,n),(r=t.call(this)).rightParenTokenType=e,r.argumentDelimiterTokenType=o,r.precedence=a,r}return Object(m.a)(n,[{key:"parse",value:function(e,t,n){var o=[],a=e.match(this.rightParenTokenType),r=[].concat(Object(g.a)(t.tokens),[n]),i=[];if(a)r.push(a);else{var c;do{var l=e.parseExpression();o.push(l),r.push.apply(r,Object(g.a)(l.tokens)),i.push(l),(c=e.match(this.argumentDelimiterTokenType))&&(r.push(c),i.push(c))}while(c);(a=e.consume(this.rightParenTokenType))&&r.push(a)}return new J(r,t,n,i,a)}},{key:"getPrecedence",value:function(){return this.precedence}}]),n}(z),Z=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e,o,a,r,i,c){var l;return Object(v.a)(this,n),(l=t.call(this)).tokens=e,l.condition=o,l.questionMarkToken=a,l.thenArm=r,l.colonToken=i,l.elseArm=c,l.kind="conditional",l.children=[l.condition,l.questionMarkToken,l.thenArm,l.colonToken,l.elseArm],l}return Object(m.a)(n,[{key:"print",value:function(e){e("("),this.condition.print(e),e(" ? "),this.thenArm.print(e),e(" : "),this.elseArm.print(e),e(")")}}]),n}(K),ee=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var o;return Object(v.a)(this,n),(o=t.call(this)).precedence=e,o}return Object(m.a)(n,[{key:"parse",value:function(e,t,n){var o=e.parseExpression(),a=e.consume(_.COLON),r=e.parseExpression(this.precedence-1);return new Z([].concat(Object(g.a)(t.tokens),[n],Object(g.a)(o.tokens),[a],Object(g.a)(r.tokens)),t,n,o,a,r)}},{key:"getPrecedence",value:function(){return this.precedence}}]),n}(z),te=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var o;return Object(v.a)(this,n),(o=t.call(this)).rightParenTokenType=e,o}return Object(m.a)(n,[{key:"parse",value:function(e,t){var n=e.parseExpression(),o=e.consume(this.rightParenTokenType);return n.tokens=[t].concat(Object(g.a)(n.tokens),[o]),n.children=[t,n,o],n}}]),n}(V),ne=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e};return Object(v.a)(this,n),(e=t.call(this)).getName=o,e}return Object(m.a)(n,[{key:"parse",value:function(e,t){var n=this.getName(t.text);return new $([t],n,t.text)}}]),n}(V),oe=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e,o,a){var r;return Object(v.a)(this,n),(r=t.call(this)).tokens=e,r.left=o,r.operatorToken=a,r.kind="postfix",r.children=[r.left,r.operatorToken],r}return Object(m.a)(n,[{key:"print",value:function(e){e("("),this.left.print(e),e(H(this.operatorToken.type)),e(")")}}]),n}(K),ae=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var o;return Object(v.a)(this,n),(o=t.call(this)).precedence=e,o}return Object(m.a)(n,[{key:"parse",value:function(e,t,n){return new oe([].concat(Object(g.a)(t.tokens),[n]),t,n)}},{key:"getPrecedence",value:function(){return this.precedence}}]),n}(z),re=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e,o,a){var r;return Object(v.a)(this,n),(r=t.call(this)).tokens=e,r.operatorToken=o,r.right=a,r.kind="prefix",r.children=[r.right],r}return Object(m.a)(n,[{key:"print",value:function(e){e("("),e(H(this.operatorToken.type)),this.right.print(e),e(")")}}]),n}(K),ie=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var o;return Object(v.a)(this,n),(o=t.call(this)).precedence=e,o}return Object(m.a)(n,[{key:"parse",value:function(e,t){var n=e.parseExpression(this.precedence);return new re([t].concat(Object(g.a)(n.tokens)),t,n)}},{key:"getPrecedence",value:function(){return this.precedence}}]),n}(V),ce=X,le=n(3),se=p.a.code(W||(W=Object(s.a)(['\n  font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",\n    "Courier New", monospace;\n\n  .expression.has-error {\n    text-decoration: underline wavy ',";\n    text-decoration-skip: none;\n    text-decoration-skip-ink: none;\n    text-decoration-color: "," !important;\n\n    a {\n      text-decoration: underline wavy ",";\n      text-decoration-skip: none;\n      text-decoration-skip-ink: none;\n      text-decoration-color: "," !important;\n    }\n  }\n\n  .expression-name {\n    color: ",";\n  }\n\n  &.expression-call > .expression-name:first-child,\n  .expression-call > .expression-name:first-child {\n    color: ",";\n  }\n\n  .expression-name {\n    word-break: break-word;\n  }\n\n  .token-STRING_LITERAL {\n    color: ",";\n  }\n\n  .token-NUMBER_LITERAL {\n    color: ",";\n  }\n\n  .token-COMMA {\n    color: ",";\n  }\n\n  .token-LEFT_PAREN,\n  .token-RIGHT_PAREN {\n    color: "," !important;\n    font-weight: bold;\n  }\n\n  .token-INVALID {\n    border: 2px "," solid;\n    padding: 2px;\n    margin: -2px;\n    color: ",';\n  }\n\n  .token-COMMA::after {\n    content: "\xa0";\n  }\n\n  .expression-operator {\n    clear: left;\n  }\n\n  .token-COMPARISON {\n    &::after,\n    &::before {\n      content: "\u2002";\n    }\n    font-weight: bold;\n    color: ',";\n  }\n\n  .token-COLON,\n  .token-BOOLEAN_AND,\n  .token-BOOLEAN_OR,\n  .token-PLUS,\n  .token-GREATER_THAN,\n  .token-LESS_THAN,\n  .token-MODULO,\n  .token-QUESTION {\n    word-break: break-word;\n    display: block;\n    font-weight: bold;\n    color: ",";\n  }\n"])),f.a.RED2,f.a.RED2,f.a.RED2,f.a.RED2,f.a.VIOLET5,f.a.BLUE3,f.a.ORANGE3,f.a.ORANGE4,f.a.GRAY1,f.a.BLUE2,f.a.RED5,f.a.RED5,f.a.VERMILION3,f.a.VERMILION2),ue=n(42),de=n.n(ue),he={yes:!0,no:!1,TRUE:!0,FALSE:!1,true:!0,false:!1},be=function(e){return{survey:e||{type:"",typeParameters:[],row:{type:"",name:"data",label:{"English (en)":"[empty survey]"}},children:[],indentationLevel:0,rowIndex:-1},nodesToAnswers:new Map,evaluationResults:new Map,stackDepth:0,knownLiteralsWithoutDollarSign:he}},fe=o.createContext({schema:new de.a({}),debug:!0,xlsForm:void 0,evaluationContext:be(),language:"English (en)",languageCode:"en",languageName:"English",setEvaluationContext:function(){},setXLSFormWithPatches:function(){},onChangeAnswer:function(){},onChangeCell:function(){},onMoveNode:function(){},onSpliceRows:function(){},onRemoveRowAndChildren:function(){},onRenameNode:function(){},onNestNode:function(){},onUngroupNode:function(){},onAddNode:function(){}}),pe=n(72),je=n(62),ve=n(1);function me(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches}function ge(e){var t=Oe();return Object(ve.jsx)("div",Object(c.a)(Object(c.a)({},e),{},{className:t?"".concat(e.className," bp3-dark"):e.className,children:e.children}))}function Oe(){var e=o.useState(me()),t=Object(l.a)(e,2),n=t[0],a=t[1],r=o.useCallback((function(e){a(me())}),[]);return o.useEffect((function(){void 0!==window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",r)}),[r]),n}var xe=n(80);n(480),n(488);function ye(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,n=Object(xe.d)(e);return n.opacity*=t,n.toString()}function we(e,t){var n={};return t.forEach((function(t){n[t]=e})),n}var ke=0;var Ee,Ce=o.createContext({node:(Ee=new Set(["English (en)"]),ke+=1,Object.freeze({row:{type:"text",name:"empty_node_".concat(ke),label:we("Empty node ".concat(ke),Ee)},type:"text",typeParameters:[],children:[],indentationLevel:0,rowIndex:-2}))}),Te={integer:"numerical",decimal:"numerical",range:"horizontal-distribution",text:"edit",select_one:"selection",select_one_from_file:"selection",select_multiple:"multi-select",select_multiple_from_file:"multi-select",rank:"sort-numerical",note:"lightbulb",geopoint:"map-marker",geotrace:"draw",geoshape:"geofence",date:"calendar",time:"time",datetime:"time",image:"media",audio:"headset",video:"video",file:"upload",barcode:"barcode",calculate:"function",acknowledge:"switch",hidden:"eye-off","xml-external":"layout-hierarchy",start:"time",end:"time",today:"calendar",deviceid:"desktop",simserial:"sim-card",subscriberid:"id-number",phonenumber:"phone",username:"person",email:"envelope",audit:"shield",begin_group:"group-objects",begin_repeat:"repeat"},Ne=[void 0,"","start","end","today","username","simserial","subscriberid","deviceid","phonenumber","calculate"],Se=["calculation","required","relevant","readonly","constraint"];function Ae(e,t){var n,o;if(!t)return!1;var a=null===(n=t.evaluationResults.get(e))||void 0===n||null===(o=n.get("relevant"))||void 0===o?void 0:o.result;return void 0===a||a}function Re(e){return"begin_group"===e.type||"begin_repeat"===e.type}var Le=n(41),Ie=n.n(Le),_e=n(48),Fe=n(11),De=n(73),Me=[" ","\t","\n"],Pe=[[_.STRING_LITERAL,/^'(\\\\|\\'|[^'])*'/],[_.STRING_LITERAL,/^"(\\\\|\\"|[^"])*"/],[_.SLASH,/^div/],[_.MODULO,/^mod/],[_.BOOLEAN_AND,/^and/],[_.BOOLEAN_OR,/^or/],[_.FLOAT_LITERAL,/^-?\d+\.\d+/],[_.INT_LITERAL,/^-?\d+/],[_.NAME,/^\$?{[^}]+}/],[_.NAME,/^[a-zA-Z_\w_][a-zA-Z_\w_-]*/],[_.SELECTOR,/^\/(\/?[\w*]+(?:\[[^]+?]\B)?)/],[_.LEFT_PAREN,/^\(/],[_.RIGHT_PAREN,/^\)/],[_.COMMA,/^,/],[_.PLUS,/^\+/],[_.MINUS,/^-/],[_.ASTERISK,/^\*/],[_.COMPARISON,/^(>=|>|<=|<|=|!=)/],[_.INVALID,/^(\w+|[\s\S])/]],Ue=function(){function e(t){Object(v.a)(this,e),this.text=t,this.index=0}return Object(m.a)(e,[{key:"next",value:function(){if(this.index>=this.text.length)return{value:{type:_.EOF,text:"",index:this.index}};for(;Me.includes(this.text[this.index]);)this.index+=1;for(var e=0;e<Pe.length;e+=1){var t=Pe[e],n=Object(l.a)(t,2),o=n[0],a=n[1],r=this.text.slice(this.index).match(a);if(null!==r){var i=r[0],c={type:o,text:this.text.substr(this.index,i.length),index:this.index};return this.index+=i.length,{value:c}}}var s={type:_.INTERNAL_LEXER_ERROR,text:this.text[this.index],index:this.index};throw new P(s,"Lexer should never get here. If we get here, this means there is no invalid token defined at the end of the pattern list. This invalid token should match at least one character that is not recognized by all other patterns.")}}]),e}(),Be=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e,o,a){var r;return Object(v.a)(this,n),(r=t.call(this)).tokens=e,r.type=o,r.value=a,r.kind="literal",r.children=r.tokens,r}return Object(m.a)(n,[{key:"print",value:function(e){"string"!==this.type?(e("["),e(this.type),e(" "),e(String(this.value)),e("]")):e("'".concat(this.value,"'"))}}]),n}(K),Ge=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e,o){var a;return Object(v.a)(this,n),(a=t.call(this)).getValue=e,a.getType=o,a}return Object(m.a)(n,[{key:"parse",value:function(e,t){var n=this.getValue(t),o=this.getType(t);return new Be([t],o,n)}}]),n}(V),ze=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e,o){var a;return Object(v.a)(this,n),(a=t.call(this)).selectorToken=e,a.selector=o,a.kind="selector",a.children=[a.selectorToken],a.tokens=[a.selectorToken],a}return Object(m.a)(n,[{key:"print",value:function(e){e(this.selectorToken.text)}}]),n}(K),Ve=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var o;return Object(v.a)(this,n),(o=t.call(this)).getSelector=e,o}return Object(m.a)(n,[{key:"parse",value:function(e,t){var n=this.getSelector(t.text);return new ze(t,n)}}]),n}(V),He=function e(){Object(v.a)(this,e)};He.BOOLEAN_OP=1,He.CONDITIONAL=2,He.ASSIGNMENT=3,He.SUM=4,He.PRODUCT=5,He.EXPONENT=6,He.PREFIX=7,He.POSTFIX=8,He.CALL=9;var We=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var o;return Object(v.a)(this,n),(o=t.call(this,Object(c.a)({onExpression:function(e){return o.expressions.push(e)},onToken:function(e){return o.tokens.push(e)}},e))).expressions=[],o.tokens=[],o.register(_.NAME,new ne((function(e){return e.startsWith("$")?e.slice(2,e.length-1):e}))),o.register(_.SELECTOR,new Ve((function(e){return e.split("/")}))),o.register(_.FLOAT_LITERAL,new Ge((function(e){return parseFloat(e.text)}),(function(){return"float"}))),o.register(_.INT_LITERAL,new Ge((function(e){return parseInt(e.text,10)}),(function(){return"int"}))),o.register(_.STRING_LITERAL,new Ge((function(e){return e.text.slice(1,e.text.length-1)}),(function(){return"string"}))),o.register(_.QUESTION,new ee(He.CONDITIONAL)),o.register(_.LEFT_PAREN,new te(_.RIGHT_PAREN)),o.register(_.LEFT_PAREN,new Q(_.RIGHT_PAREN,_.COMMA,He.CALL)),o.infixRight(_.COMPARISON,He.CONDITIONAL),o.infixLeft(_.BOOLEAN_AND,He.BOOLEAN_OP),o.infixLeft(_.BOOLEAN_OR,He.BOOLEAN_OP),o.infixLeft(_.PLUS,He.SUM),o.infixLeft(_.MINUS,He.SUM),o.infixLeft(_.ASTERISK,He.PRODUCT),o.infixLeft(_.SLASH,He.PRODUCT),o.infixLeft(_.MODULO,He.EXPONENT),o}return Object(m.a)(n,[{key:"postfix",value:function(e,t){this.register(e,new ae(t))}},{key:"prefix",value:function(e,t){this.register(e,new ie(t))}},{key:"infixLeft",value:function(e,t){this.register(e,new Y(t,!1))}},{key:"infixRight",value:function(e,t){this.register(e,new Y(t,!0))}}]),n}(ce),Ke=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(c.a)({type:Object,blackbox:!0,custom:function(){var e=this.value;if(void 0!==e){if("string"===typeof e)return"notAllowed";for(var t=Object.keys(e),n=0;n<t.length;n+=1){if("string"!==typeof e[t[n]])return"notAllowed"}}}},e)},Xe=Ke,$e=Xe({optional:!0}),qe=Ke({optional:!0}),Ye=function(){try{var e=new Ue(this.value);new We({tokens:e}).parseExpression()}catch(t){this.addValidationErrors([{name:this.key,type:"Invalid formula: ".concat(t.message),value:this.value}])}},Je=new de.a({type:{type:String},name:{type:String,optional:!0,custom:function(){if(!["end_group","end_repeat"].includes(this.field("type").value)){var e=de.a.ErrorTypes.REQUIRED;if(this.operator){if(this.isSet){if("$set"===this.operator&&null===this.value||""===this.value)return e;if("$unset"===this.operator)return e;if("$rename"===this.operator)return e}}else if(!this.isSet||null===this.value||""===this.value)return e}}},constraint:{type:String,optional:!0,custom:Ye},constraint_message:$e,label:$e,image:$e,video:$e,hint:$e,guidance_hint:$e,required_message:$e,relevant:{type:String,optional:!0,custom:Ye},choice_filter:{type:String,optional:!0},calculation:{type:String,optional:!0,custom:Ye},trigger:{type:String,optional:!0,custom:Ye},readonly:{type:String,optional:!0},required:{type:String,optional:!0,custom:Ye},parameters:{type:String,optional:!0},repeat_count:{type:String,optional:!0,custom:Ye},appearance:{type:String,optional:!0},default:{type:String,optional:!0},instance:qe,bind:qe,body:qe}),Qe=new de.a({"list name":{type:String},name:{type:String},label:Xe()}),Ze=new de.a({form_title:{type:String,optional:!0},form_id:{type:String,optional:!0},public_key:{type:String,optional:!0},submission_url:{type:String,optional:!0},default_language:{type:String,optional:!0},version:{type:String,optional:!0}});function et(e){return Je.validate(e)}var tt=n(203),nt={multiline:!0,minimal:!0,quick:!0,"no-calendar":!0,"month-year":!0,year:!0,"horizontal-compact":!0,horizontal:!0,likert:!0,compact:!0,quickcompact:!0,"field-list":!0,label:!0,"list-nolabel":!0,"table-list":!0,signature:!0,draw:!0};function ot(e){var t=e.split(" "),n={};return t.forEach((function(e){nt[e]&&(n[e]=!0)})),n}function at(e,t){if(e.type.match(/^end[ _](?:group|repeat)$/))throw new B("Found '".concat(e.type,"' without a matching start marker in row ").concat(t+2,". Please check that the group/repeat nesting is correct. The row: ").concat(e))}function rt(e){var t={};return e.rows.forEach((function(e){var n=e["list name"],o=e.name,a=t[n]||{};a[o]=e,t[n]=a})),t}function it(e,t,n,o){var a=[];return{worksheets:{settings:n,choices:o,survey:e},rootSurveyGroup:function(e){for(var t=e.rows,n=e.defaultLanguage,o=e.formRootNameFromSettings,a=void 0===o?"data":o,r=e.titleFromSettings,i=void 0===r?"":r,c=e.onRow,l={children:[],type:"",typeParameters:[],rowIndex:-1,indentationLevel:0,row:{name:a,type:"",label:Object(Fe.a)({},n,i)}},s=[l],u=0;u<t.length;){var d=t[u],h=ut(d.type).split(" "),b=Object(tt.a)(h),f=b[0],p=b.slice(1),j=d.appearance&&d.appearance.trim().length>0?ot(d.appearance):void 0,v=s[s.length-1];if("begin_group"===v.type&&"end_group"===f)s.pop(),null===c||void 0===c||c(d,v);else if("begin_repeat"===v.type&&"end_repeat"===d.type)s.pop(),null===c||void 0===c||c(d,v);else if(f.match(/^begin_(?:repeat|group)$/)){var m={row:d,type:f,typeParameters:p,appearance:j,children:[],indentationLevel:s.length-1,rowIndex:u};v.children.push(m),s.push(m),null===c||void 0===c||c(d,m)}else{at(d,u);var g={row:d,type:f,typeParameters:p,appearance:j,indentationLevel:s.length-1,rowIndex:u,children:[]};v.children.push(g),null===c||void 0===c||c(d,g)}u+=1}return{node:l}}({rows:e.rows,defaultLanguage:t,onRow:function(e,t){return a.push(t)}}).node,choicesByName:o?rt(o):{},languages:e.languages,flatNodes:a}}var ct=["label","hint","constraint_message","required_message","image","audio","video"];function lt(e,t,n){var o=Object(c.a)({},e),a=new Set;return n&&t.forEach((function(e){o[e]&&(o["".concat(e,"::").concat(n)]=o[e]),a.add(n),delete o[e]})),t.forEach((function(e){Object.keys(o).filter((function(t){return t.startsWith(e)})).forEach((function(e){var t=e.split(/::/),n=Object(l.a)(t,2),r=n[0],i=n[1],c=o[r],s=String(o[e]);if(void 0===c)o[r]=Object(Fe.a)({},i,s),a.add(i);else{if("object"!==typeof c)throw new U("Can't handle `".concat(r,"` column. Columns with prefix `").concat(r,"` must be namespaced with `::`. See chapter [\u2018Advanced use and extensibility\u2019](https://xlsform.org/en/#advanced-use-and-extensibility) in the documentation."));c[i]=s,a.add(i)}delete o[e]}))})),{result:o,foundSuffixes:a}}function st(e){for(var t=[],n=0;n<e.length;n+=1){var o,a=(null===(o=e[n])||void 0===o?void 0:o.toString())||"";t.push(a.replace(/^constraint-msg\B/,"constraint_message").replace(/^requiredMsg\B/,"required_message").replace(/^bind::required$/,"required").replace(/^repeat-count$/,"repeat_count").replace(/^media::(image|audio|video)\B/,"$1").replace(/^photo\B/,"image").replace(/^list_name$/,"list name"))}return Object.freeze(t)}function ut(e){return e.replace(/^media::(image|audio|video)\B/,"$1").replace(/^imei$/,"deviceid").replace(/^phone_number$/,"phonenumber").replace(/^select one\B/,"select_one").replace(/^select multiple\B/,"select_multiple").replace(/^location$/,"geopoint").replace(/^photo\B/,"image").replace(/^trigger$/,"acknowledge").replace(/^begin group$/,"begin_group").replace(/^end group$/,"end_group").replace(/^begin repeat$/,"begin_repeat").replace(/^end repeat$/,"end_repeat")}var dt={getAutoValues:!0,trimStrings:!0,mutate:!1};function ht(e){var t=Je.clean(Object(c.a)(Object(c.a)({},e),{},{type:ut(String(e.type))}),dt);return et(t),t}function bt(e){var t=Qe.clean(e,Object(c.a)(Object(c.a)({},dt),{},{filter:!1}));return function(e){Qe.validate(e,{keys:["list name","name"]})}(t),t}function ft(e){var t=Ze.clean(e,dt);return function(e){Ze.validate(e)}(t),t}function pt(e,t,n,o){var a=e.getWorksheet(t),r=[];if(a){var i=a.getRows(1,1)[0];if(!(i.values instanceof Array))throw new U("First row of the \u2018".concat(t,"\u2019 worksheet must be an array structure, but is a ").concat(typeof i.values," instead. Please fix this."));var c=i.values.slice(1).map((function(e){return(null===e||void 0===e?void 0:e.toString())||""})),l=st(c),s=function(e,t){var n={};return e.forEach((function(e){n[e]=!0})),lt(n,ct,t).foundSuffixes}(l,o);return a.eachRow((function(e,t){1!==t&&r.push(function(e){var t=e.row,n=e.columnNames,o=e.defaultLanguage,a=e.loadRowFn,r={};t.values.slice(1).forEach((function(e,t){var o=n[t];r[o]="".concat(e)}));var i=lt(r,ct,o),c=lt(i.result,["instance","bind","body"]).result;try{return a(c)}catch(l){throw new U("Could not load row ".concat(JSON.stringify(c,null,2),": ").concat(l," / ").concat(JSON.stringify(l.details)))}}({row:e,columnNames:l,defaultLanguage:o,loadRowFn:n}))})),{rows:r,languages:s,columnNames:c,columnNamesNormalized:l}}}function jt(e){return vt.apply(this,arguments)}function vt(){return(vt=Object(_e.a)(Ie.a.mark((function e(t){var n,o,a,r,i;return Ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=pt(t,"settings",ft),o=(null===n||void 0===n?void 0:n.rows[0].default_language)||"English (en)",a=pt(t,"choices",bt,o),r=pt(t,"survey",ht,o)){e.next=6;break}throw new Error("No `survey` sheet found in workbook. Please define a sheet named `survey` and try again.");case 6:return i=it(r,o,n,a),e.abrupt("return",i);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function mt(e,t,n){var o=t.row.name,a=[],r=new RegExp("\\${".concat(o,"}"));return e.flatNodes.forEach((function(i){var c,l,s=ct.flatMap((function(t){return Object(g.a)(e.languages.values()).map((function(e){return"".concat(t,".").concat(e)}))}));(c=Se).concat.apply(c,Object(g.a)(s)).forEach((function(e){var c=Object(w.get)(i.row,e);if("string"!==typeof c&&void 0!==c)throw new Error("Replacing variable names works only with string cells. Please ensure the ".concat(e," cell of the ").concat(t.row.name," row has a string value."));if(null===c||void 0===c?void 0:c.match(r)){if(n){var s=null===c||void 0===c?void 0:c.replaceAll("${".concat(o,"}"),"${".concat(n,"}"));l=l||Object(w.cloneDeep)(i.row),Object(w.set)(l,e,s)}a.push({node:i,index:i.rowIndex,row:l||i.row,columnName:e})}}))})),a}function gt(e){return e&&Object(g.a)(e.keys()).find((function(t){var n;return null===e||void 0===e||null===(n=e.get(t))||void 0===n?void 0:n.error}))}function Ot(e){var t=function(){throw new Error("Given data is not a valid ODK node.")};"object"!==typeof e&&t(),et(e.row),"string"===typeof e.type&&e.typeParameters instanceof Array&&e.typeParameters.every((function(e){return"string"===typeof e}))&&"number"===typeof e.indentationLevel&&"number"===typeof e.rowIndex&&(void 0===e.resultIsInvalid||"boolean"===typeof e.resultIsInvalid)||t(),e.children.forEach(Ot)}var xt=o.createContext({onDropNode:function(){}});var yt=n(204),wt=n.n(yt);function kt(e){var t;if("string"!==typeof e.children)return Object(ve.jsx)(h.e,{intent:"danger",children:"Markdown content must be a string."});var n=null===(t=e.marked)||void 0===t?void 0:t.call(e,function(e){var t=e.split(/\n/).find((function(e){return e.replace(/\s/,"").length>0}));if(!t)return e;var n=t.match(/^\s+/);if(!n)return e;var o=n[0];if(!o)return e;var a=new RegExp("^".concat(o));return e.split(/\n/).map((function(e){return e.replace(a,"")})).join("\n")}(e.children));return e.inline&&(n=n.replaceAll(/<\/?p>/g,"")),Object(ve.jsx)("div",Object(c.a)(Object(c.a)({},Object(w.omit)(e,"children","marked","inline")),{},{dangerouslySetInnerHTML:{__html:n}}))}var Et,Ct=function(e){return Object(ve.jsx)(kt,Object(c.a)(Object(c.a)({},e),{},{marked:wt.a}))},Tt=Object(p.a)(Ct)(Et||(Et=Object(s.a)(['\n  h1,\n  h2,\n  h3,\n  h4,\n  h5 {\n    margin: 1em 0;\n  }\n\n  code,\n  pre {\n    font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",\n      "Courier New", monospace;\n    color: inherit;\n    margin: -1px;\n    padding: 2px 3px;\n    background-color: rgba(255, 255, 255, 0.3);\n    @media (prefers-color-scheme: dark) {\n      background-color: rgba(0, 0, 0, 0.1);\n    }\n  }\n\n  pre {\n    padding: 0.5em 0.55em;\n    margin: 0.5em 0;\n    line-height: 1.3em;\n    white-space: pre-wrap;\n  }\n\n  code {\n    font-weight: 600;\n  }\n\n  p {\n    margin-block-end: 16px;\n  }\n  p:last-child {\n    margin-block-end: 0;\n  }\n\n  ul,\n  ol {\n    margin: 1em 1.25em;\n  }\n'])));function Nt(e){return new Be([{type:_.LITERAL,text:JSON.stringify(e),index:-1}],e instanceof Array?"array":typeof e,e)}function St(e){var t=e.answer,n=e.columnName,o=e.nodeName;return Object(ve.jsx)(h.Q,{className:le.a.TEXT_MUTED,children:{calculation:void 0===t||""===t?Object(ve.jsxs)(ve.Fragment,{children:["This survey field has no entered answer yet, and the"," ",Object(ve.jsx)("code",{children:n})," cell is empty."]}):Object(ve.jsxs)(ve.Fragment,{children:["This is the answer value entered in the ",Object(ve.jsx)("code",{children:o})," ","field."]}),required:Object(ve.jsxs)(ve.Fragment,{children:["This means users are not required to enter this field. This is the default when the ",Object(ve.jsx)("code",{children:n})," cell is empty."]}),relevant:Object(ve.jsxs)(ve.Fragment,{children:["This means the survey field is always shown. This is the default behavior when the ",Object(ve.jsx)("code",{children:n})," cell is empty."]}),readonly:Object(ve.jsxs)(ve.Fragment,{children:["This means the survey field enables input. This is the default behavior when the ",Object(ve.jsx)("code",{children:n})," cell is empty."]}),constraint:Object(ve.jsxs)(ve.Fragment,{children:["If the cell contains a formula that evaluates to ",Object(ve.jsx)("code",{children:"true"})," ","or if there is no formula in the ",Object(ve.jsx)("code",{children:n})," cell, the field accepts any input."]})}[n]})}function At(e){var t=e.results,n=e.columnName,o=e.formulaIsTrivial;return Object(ve.jsx)(h.Q,{className:le.a.TEXT_MUTED,children:{calculation:!o&&(t.error?Object(ve.jsx)(ve.Fragment,{children:"Because of this error, the field has no result yet."}):Object(ve.jsx)(ve.Fragment,{children:"This is the result of the formula."})),required:"This means you ".concat((null===t||void 0===t?void 0:t.result)?"can\u2019t":"can"," complete the survey without entering data in this field."),relevant:"This means the survey field is ".concat((null===t||void 0===t?void 0:t.result)?"shown":"hidden","."),readonly:"This means the survey field is ".concat((null===t||void 0===t?void 0:t.result)?"read-only":"editable","."),constraint:"This means the survey field contains an input that is ".concat((null===t||void 0===t?void 0:t.result)?"allowed":"not allowed"," by the constraint formula..")}[n]})}function Rt(e){var t,n,a,r=e.node,i=e.columnName,l=e.nodeEvaluationResult,s=e.style,u=Oe(),d=o.useContext(fe),b=l,p=void 0===r.row[i],j="literal"===(null===b||void 0===b||null===(t=b.expression)||void 0===t?void 0:t.kind),v="name"===(null===b||void 0===b||null===(n=b.expression)||void 0===n?void 0:n.kind),m=null===(a=d.evaluationContext)||void 0===a?void 0:a.nodesToAnswers.get(r),g=d.evaluationContext?S(r,d.evaluationContext):r.row.name,O=(null===b||void 0===b?void 0:b.expression)instanceof Be||(null===b||void 0===b?void 0:b.expression)instanceof $&&(null===b||void 0===b?void 0:b.expression.name)===(null===b||void 0===b?void 0:b.expression.text),x="Result";return p?"calculation"===i?void 0!==m&&(x="Using answer value"):x="Default value":x=Object(ve.jsxs)(ve.Fragment,{children:[Object(ve.jsx)(h.z,{icon:"function"})," ","calculation"===i?"Formula":"Condition"]}),Object(ve.jsxs)(an,{lang:"en",style:Object(c.a)({backgroundColor:f.a.LIGHT_GRAY5,marginTop:"0",padding:"20px",background:"linear-gradient(".concat(ye(f.a.BLUE3,.06),", ").concat(ye(f.a.BLUE3,.05)," 5px, ").concat(ye(f.a.BLUE3,.01)," 10px, transparent 30px)"),borderTop:"solid 1px ".concat(u?f.a.DARK_GRAY2:f.a.LIGHT_GRAY3)},s),children:[Object(ve.jsx)("h4",{children:x}),!p&&Object(ve.jsx)(ve.Fragment,{children:Object(ve.jsx)(on,{style:{fontSize:j||v?"20px":"16px",lineHeight:"28px"},children:Object(ve.jsx)(mn,{node:r,state:null===b||void 0===b?void 0:b.state,error:null===b||void 0===b?void 0:b.error,expression:null===b||void 0===b?void 0:b.expression})})}),(p||!O)&&Object(ve.jsxs)(ve.Fragment,{children:[!p&&!b&&Object(ve.jsx)(h.e,{intent:"none",children:"Not calculated yet."}),"error"!==(null===b||void 0===b?void 0:b.state)&&Object(ve.jsxs)(on,{style:{fontSize:"20px",lineHeight:"28px"},children:[!O&&Object(ve.jsx)(ve.Fragment,{children:"=\xa0"}),void 0===(null===b||void 0===b?void 0:b.result)?"undefined":Object(ve.jsx)(mn,{node:r,state:null===b||void 0===b?void 0:b.state,error:null===b||void 0===b?void 0:b.error,expression:Nt(null===b||void 0===b?void 0:b.result)})]})]}),"error"===(null===b||void 0===b?void 0:b.state)&&Object(ve.jsxs)(rn,{intent:"danger",children:[b.error instanceof D&&Object(ve.jsxs)(ve.Fragment,{children:["Error in\xa0",Object(ve.jsx)("code",{children:Object(ve.jsx)(mn,{node:r,expression:b.error.expression})}),":"]}),Object(ve.jsx)(Tt,{children:b.error.toMarkdown()})]}),!p&&void 0!==(null===b||void 0===b?void 0:b.result)&&Object(ve.jsx)(At,{results:b,columnName:i,formulaIsTrivial:O}),p&&Object(ve.jsx)(St,{answer:m,columnName:i,nodeName:g})]})}function Lt(e){var t=e.path,n=e.width;return Object(ve.jsx)(h.b,{items:t.map((function(e,n){return{href:"#//".concat(t.slice(0,n+1).join("/")),text:e}})),collapseFrom:"start",overflowListProps:{minVisibleItems:1,style:{transition:"width 0.1s ease-out",width:"".concat(n,"px")}}})}var It=n(85),_t={integer:"Integer number",decimal:"Decimal number",range:"Slider",text:"Text field",select_one:"Single choice",select_one_from_file:"Single choice from file",select_multiple:"Multiple choice",select_multiple_from_file:"Multiple choice from file",rank:"Rank items",note:"Note / Hint",geopoint:"Locate a point",geotrace:"Trace a line",geoshape:"Draw a shape",date:"Date",time:"Time",datetime:"Date and time",image:"Image",audio:"Audio",video:"Video",file:"File",barcode:"Scan a code",acknowledge:"Checkbox",calculate:"Calculate formula",hidden:"Hidden field","xml-external":"External XML reference",start:"Survey start date and time",end:"Survey submission date and time",today:"Survey start day",deviceid:"Device ID",simserial:"SIM serial number",subscriberid:"Subscriber ID",phonenumber:"Phone number",username:"Username",email:"Email address",audit:"Audit trail",begin_group:"Field group",begin_repeat:"Repeat group"};function Ft(e){var t=e.xlsForm,n=e.node,a=null===t||void 0===t?void 0:t.choicesByName,r=a?Object.keys(a):[],i=o.useContext(fe),l=o.useCallback((function(e){var t=e.currentTarget.checked,o=e.currentTarget.value,a=Object(g.a)(n.typeParameters);t?a.push(o):a=Object(w.without)(a,o);var r=[n.type].concat(Object(g.a)(a)).join(" "),l=Object(c.a)(Object(c.a)({},n.row),{},{type:r}),s=t?"Add `".concat(o,"` choice list to `").concat(n.row.name,"`"):"Remove `".concat(o,"` choice list from `").concat(n.row.name,"`");i.onSpliceRows("survey",[{rowIndex:n.rowIndex,numberOfRowsToRemove:1,rowsToAdd:[l]}],s)}),[i,n]);return Object(ve.jsxs)(h.C,{children:[Object(ve.jsx)("li",{className:"bp3-menu-header",children:Object(ve.jsx)("h6",{className:"bp3-heading",children:"Set which choice lists should be visible."})}),Object(ve.jsx)(h.j,{style:{margin:"16px 8px 4px"},vertical:!0,children:r.map((function(e){var t=n.typeParameters.includes(e),o=e,r=a[e],i=Object.keys(r),c=Object(w.sortBy)(i.map((function(e){return r[e]})),(function(e){return e.name.toLowerCase()})),s=c.slice(0,4).map((function(e){return Object(ve.jsx)("li",{children:Object(ve.jsx)(h.h,{style:{marginInline:"1px"},children:e.name},e.name)})})),u=c.length>4&&Object(ve.jsxs)("span",{className:le.a.UI_TEXT,style:{lineHeight:"24px",marginLeft:"4px",paddingRight:"2px"},"aria-label":"and ".concat(c.length-4," more"),children:["+",c.length-4]}),d=Object(ve.jsxs)(h.j,{fill:!0,style:{display:"inline-flex"},children:[Object(ve.jsx)("header",{"aria-label":"Choice list ".concat(e,", allowed values:"),children:Object(ve.jsx)(h.Q,{children:o})}),Object(ve.jsx)("ul",{className:le.a.LIST_UNSTYLED,children:Object(ve.jsxs)(h.j,{style:{justifyContent:"flex-end",marginLeft:"16px"},children:[s,u]})})]});return Object(ve.jsx)(h.g,{value:e,onChange:l,large:!0,checked:t,disabled:1===n.typeParameters.length&&e===n.typeParameters[0],children:d})}))}),Object(ve.jsxs)(h.e,{intent:"primary",children:["The content of these lists is defined in the ",Object(ve.jsx)("code",{children:"choices"})," Excel sheet."]})]})}var Dt=n(86);function Mt(e,t,n){var o=e.worksheets.survey;if(!o)throw new Error("No survey worksheet defined.");var a=e.worksheets[t];if(!a)return[e,[],[]];var r=Object(g.a)(null===a||void 0===a?void 0:a.rows);n.forEach((function(e){var t=e.rowIndex,n=e.numberOfRowsToRemove,o=e.rowsToAdd;return r.splice.apply(r,[t,n].concat(Object(g.a)(o)))}));var i=Object(w.uniq)(r.flatMap((function(e){return Object.keys(e)}))),l=Object(c.a)(Object(c.a)({},a),{},{rows:r,columnNames:i,columnNamesNormalized:st(i)});return Object(Dt.c)(e,(function(n){var a,r;return it("survey"===t?l:o,(null===e||void 0===e||null===(a=e.worksheets.settings)||void 0===a||null===(r=a.rows[0])||void 0===r?void 0:r.default_language)||"English (en)","settings"===t?l:null===e||void 0===e?void 0:e.worksheets.settings,"choices"===t?l:null===e||void 0===e?void 0:e.worksheets.choices)}))}function Pt(e){var t=e.languages||new Set(["English (en)"]);return Mt(e,"choices",[{rowIndex:0,numberOfRowsToRemove:0,rowsToAdd:[{"list name":"yes_no_maybe",name:"yes",label:we("yes",t)},{"list name":"yes_no_maybe",name:"no",label:we("no",t)},{"list name":"yes_no_maybe",name:"maybe",label:we("maybe",t)}]}])}function Ut(e){return e.reduce((function(e,t,n){return[t[0],e[1].concat(t[1]),e[2].concat(t[2])]}))}var Bt={literal:"edit",choice:"selection",geo:"globe",time:"time",media:"upload",stats:"scatter-plot",track:"person",special:"small-minus",grouping:"layout-hierarchy"},Gt={literal:"Enter value",choice:"Choice",geo:"Maps",time:"Date and time",media:"Upload",special:"Other",stats:"Statistics",track:"Personal data",grouping:"Grouping"},zt={text:"literal",acknowledge:"literal",integer:"literal",decimal:"literal",range:"literal",barcode:"literal",select_one:"choice",select_one_from_file:"choice",select_multiple:"choice",select_multiple_from_file:"choice",rank:"choice",geopoint:"geo",geotrace:"geo",geoshape:"geo",date:"time",time:"time",datetime:"time",image:"media",audio:"media",video:"media",file:"media",note:"special",calculate:"special",hidden:"special","xml-external":"special",start:"stats",end:"stats",today:"stats",deviceid:"track",simserial:"track",subscriberid:"track",phonenumber:"track",username:"track",email:"track",audit:"track",begin_group:"grouping",begin_repeat:"grouping"};function Vt(e){var t=e.onSelectType,n=e.header,a=o.useCallback((function(e){var n=e.currentTarget.dataset.type;if(!n)throw new Error("Encountered a menu item without a set field type. This is a bug \u2013 please report this to the developers.");t(n)}),[t]);return Object(ve.jsxs)(h.C,{children:[Object(ve.jsx)("li",{className:"bp3-menu-header",children:Object(ve.jsx)("h6",{className:"bp3-heading",children:n})}),Object.keys(Bt).filter((function(e){return"special"!==e&&"grouping"!==e})).map((function(e){return Object(ve.jsx)(h.E,{text:Gt[e],icon:Bt[e],children:Object.keys(zt).filter((function(t){return zt[t]===e})).map((function(e){return Object(ve.jsx)(h.E,{text:_t[e],icon:Te[e],onClick:a,"data-type":e})}))})})),Object(ve.jsx)(h.D,{}),Object.keys(zt).filter((function(e){return"special"===zt[e]})).map((function(e){return Object(ve.jsx)(h.E,{text:_t[e],icon:Te[e],onClick:a,"data-type":e})}))]})}function Ht(){var e=o.useContext(fe),t=o.useContext(Ce).node,n=o.useCallback((function(n){var o,a,r,i=(null===n||void 0===n?void 0:n.match(/^select/))?t.typeParameters:[],l=[n].concat(Object(g.a)(i)).join(" "),s=Object(c.a)(Object(c.a)({},t.row),{},{type:l});if(e.xlsForm){var u=[];(null===n||void 0===n?void 0:n.match(/^select/))&&!(null===(o=e.xlsForm)||void 0===o||null===(a=o.worksheets.choices)||void 0===a?void 0:a.rows.length)&&u.push(Pt(e.xlsForm)),u.push(Mt((null===(r=u[0])||void 0===r?void 0:r[0])||e.xlsForm,"survey",[{rowIndex:t.rowIndex,numberOfRowsToRemove:1,rowsToAdd:[s]}])),e.setXLSFormWithPatches.apply(e,["Set `".concat(t.row.name,"` type to `").concat(n,"`")].concat(Object(g.a)(Ut(u))))}}),[e,t]);return Object(ve.jsx)(Vt,{onSelectType:n,header:"Set a field type."})}function Wt(e){var t=e.node,n=e.showType,a=Re(t),r=o.useContext(fe).xlsForm,i=!!r&&Object.keys(null===r||void 0===r?void 0:r.choicesByName).length>0,c=r&&Object(ve.jsx)(Ft,{xlsForm:r,node:t}),l=function(){var e=o.useContext(fe),t=o.useCallback((function(){e.xlsForm&&e.setXLSFormWithPatches.apply(e,["Add example choices"].concat(Object(g.a)(Pt(e.xlsForm))))}),[e]),n=Object(ve.jsx)(h.c,{large:!0,intent:"primary",onClick:t,children:"Create example choice list"});return Object(ve.jsx)(h.j,{style:{padding:"16px"},children:Object(ve.jsx)(h.G,{icon:"selection",action:n,title:"Sometimes, we have no choice.",description:Object(ve.jsx)(ve.Fragment,{children:"This survey has no choice lists yet. Please add one first to make it available for this survey question."})})})}(),s=_t[t.type],u=Te[t.type],d=t.typeParameters.length>0;return a?Object(ve.jsxs)("span",{className:[le.a.TEXT_MUTED].join(" "),style:{alignSelf:"center",marginLeft:"8px"},children:[Object(ve.jsx)(h.z,{icon:u}),"\xa0",s]}):Object(ve.jsxs)(h.d,{children:[n&&Object(ve.jsx)(pe.a,{content:Object(ve.jsx)(Ht,{}),lazy:!0,children:Object(ve.jsx)(h.c,{icon:u||"blank",fill:!1,minimal:!0,children:s})}),t.type.match(/^select/)&&Object(ve.jsx)(pe.a,{lazy:!0,content:i?c:l,children:Object(ve.jsxs)(h.c,{fill:!0,minimal:!0,intent:d?"none":"warning",children:[!d&&"Set visible choices",d&&Object(ve.jsx)(h.I,{observeParents:!0,minVisibleItems:2,collapseFrom:It.a.END,items:t.typeParameters,visibleItemRenderer:function(e){return Object(ve.jsx)(h.h,{children:e})},overflowRenderer:function(e){return Object(ve.jsx)("span",{children:"+".concat(e.length)})},style:{transition:"width 0.1s ease-out",maxWidth:"200px"}})]})})]})}var Kt,Xt,$t,qt,Yt=n(77),Jt=n(44),Qt=h.R.create({className:"recipe-toaster",position:Jt.a.BOTTOM_RIGHT});function Zt(e){var t,n,a=o.useContext(fe);return Object(ve.jsxs)(h.C,{children:[Object(ve.jsx)("li",{className:"bp3-menu-header",children:Object(ve.jsxs)("h6",{className:"bp3-heading",children:["This field influences"," ",1===e.references.length?"one other field.":"".concat(null===(t=e.references)||void 0===t?void 0:t.length," other fields.")]})}),null===(n=e.references)||void 0===n?void 0:n.map((function(e){var t;if(!a.evaluationContext)return null;var n="#//".concat(S(e.node,a.evaluationContext,"/"));return Object(ve.jsx)(h.E,{text:Object(ve.jsx)("code",{children:null===(t=e.node)||void 0===t?void 0:t.row.name}),icon:Te[e.node.type],href:n,label:e.columnName})}))]})}function en(e){var t=e.node,n=e.position,a=e.icon,r=e.group,i=e.omitAction,c=Object(o.useContext)(fe),l=Object(ve.jsxs)(ve.Fragment,{children:[i?null:"Add ".concat(r?"group":"field")," ",n," ",Object(ve.jsx)(h.h,{children:t.row.name})]}),s=Object(o.useCallback)((function(e){c.onAddNode({position:n,node:t,group:r,fieldType:e})}),[c,r,t,n]),u=Object(o.useCallback)((function(){c.onAddNode({position:n,node:t,group:r,fieldType:"text"})}),[c,r,t,n]);return r?Object(ve.jsx)(h.E,{icon:a,text:l,onClick:u}):Object(ve.jsx)(h.E,{icon:a,text:l,children:Object(ve.jsx)(Vt,{onSelectType:s,header:"Choose a type for the new field."})})}function tn(e){var t,n=Object(o.useContext)(fe),a=e.node;if(!a)return null;var r=Re(a),i=r?"Rename group\u2026":"Rename field\u2026",c=n.language&&(null===(t=a.row.hint)||void 0===t?void 0:t[n.language]);return Object(ve.jsxs)(ve.Fragment,{children:[Object(ve.jsx)(h.E,{icon:"edit",text:i,onClick:e.renameNode}),!c&&Object(ve.jsx)(h.E,{icon:"lightbulb",text:"Add hint",onClick:e.addHintToNode}),Object(ve.jsx)(h.D,{}),Object(ve.jsxs)(h.E,{icon:"group-objects",text:"Add group",children:[Object(ve.jsx)(en,{node:a,position:"before",icon:"arrow-up",group:!0,omitAction:!0}),r&&Object(ve.jsx)(en,{node:a,position:"inside",icon:"key-enter",group:!0,omitAction:!0}),Object(ve.jsx)(en,{node:a,position:"after",icon:"arrow-down",group:!0,omitAction:!0})]}),Object(ve.jsxs)(h.E,{icon:"manually-entered-data",text:"Add field",children:[Object(ve.jsx)(en,{node:a,position:"before",icon:"arrow-up",group:!1,omitAction:!0}),r&&Object(ve.jsx)(en,{node:a,position:"inside",icon:"key-enter",group:!1,omitAction:!0}),Object(ve.jsx)(en,{node:a,position:"after",icon:"arrow-down",group:!1,omitAction:!0})]}),Object(ve.jsx)(h.D,{}),Object(ve.jsx)(h.E,{icon:"group-objects",text:"Nest in new group",onClick:e.nestNode}),r&&Object(ve.jsx)(h.E,{icon:"ungroup-objects",text:"Ungroup",onClick:e.ungroupNode}),Object(ve.jsx)(h.D,{}),Object(ve.jsx)(h.E,{intent:"danger",icon:"trash",text:"Remove ".concat(r?"group":"field","\u2026"),onClick:e.removeNode})]})}function nn(e){var t=Object(o.useContext)(fe),n=function(e){var t=Object(o.useContext)(fe),n=Object(o.useState)(!1),a=Object(l.a)(n,2),r=a[0],i=a[1],c=e&&Re(e),s=Object(o.useCallback)((function(){i(!1)}),[]),u=Object(o.useCallback)((function(){e&&(Qt.show({intent:"none",message:Object(ve.jsxs)(ve.Fragment,{children:[Object(ve.jsx)("code",{children:e.row.name})," field removed."]})}),t.onRemoveRowAndChildren(e),i(!1))}),[t,e]);return{showRemoveConfirmationDialog:Object(o.useCallback)((function(){i(!0)}),[]),alert:Object(ve.jsxs)(h.a,{cancelButtonText:"Cancel",confirmButtonText:"Delete",icon:"trash",intent:Yt.a.DANGER,isOpen:r,onCancel:s,onConfirm:u,canOutsideClickCancel:!0,canEscapeKeyCancel:!0,children:[Object(ve.jsxs)("p",{children:["Are you sure you want to remove the ",Object(ve.jsx)("code",{children:null===e||void 0===e?void 0:e.row.name})," ",c?"group":"field","?"]}),c&&(null===e||void 0===e?void 0:e.children.length)&&Object(ve.jsx)("p",{children:"This will also remove the group\u2019s nested fields."})]})}}(e),a=n.alert,r=n.showRemoveConfirmationDialog,i=function(e){var t=Object(o.useContext)(fe),n=Object(o.useState)(!1),a=Object(l.a)(n,2),r=a[0],i=a[1],c=Object(o.useState)(""),s=Object(l.a)(c,2),u=s[0],d=s[1],b=Object(o.useState)([]),f=Object(l.a)(b,2),p=f[0],j=f[1];Object(o.useEffect)((function(){d("")}),[null===e||void 0===e?void 0:e.row.name,e]),Object(o.useEffect)((function(){t.xlsForm&&e&&j(mt(t.xlsForm,e,u))}),[null===e||void 0===e?void 0:e.row.name,e,t.xlsForm,u]);var v=Object(o.useCallback)((function(e){d(e.currentTarget.value)}),[]),m=Object(o.useCallback)((function(){i(!1)}),[]),g=Object(o.useCallback)((function(n){n.preventDefault(),e&&(t.onRenameNode(e,u),Qt.show({intent:"none",message:Object(ve.jsxs)(ve.Fragment,{children:["The field has been renamed to \u2018",Object(ve.jsx)("code",{children:u}),"\u2019."]})}),i(!1))}),[t,u,e]),O=Object(o.useCallback)((function(){i(!0)}),[]),x=p.length>0?Object(ve.jsx)(pe.a,{content:Object(ve.jsx)(Zt,{references:p}),lazy:!0,children:Object(ve.jsxs)(h.c,{minimal:!0,intent:"primary",children:["See ",p.length," updates\u2026"]})}):void 0,y=e&&Re(e);return{showRenameDialog:O,dialog:Object(ve.jsx)(h.k,{title:Object(ve.jsxs)(ve.Fragment,{children:["Rename \u2018",Object(ve.jsx)("code",{children:null===e||void 0===e?void 0:e.row.name}),"\u2019 ",y?"group":"field","\u2026"]}),icon:"edit",isOpen:r,canOutsideClickClose:!0,canEscapeKeyClose:!0,isCloseButtonShown:!0,onClose:m,lazy:!0,children:Object(ve.jsxs)("form",{onSubmit:g,children:[Object(ve.jsx)("div",{className:le.a.DIALOG_BODY,children:Object(ve.jsx)(h.o,{label:"Please enter a new name for this ".concat(y?"group":"field",":"),labelFor:"newName",style:{display:"flex"},children:Object(ve.jsx)(h.A,{id:"newName",placeholder:"Enter a field name\u2026",defaultValue:null===e||void 0===e?void 0:e.row.name,large:!0,onChange:v,pattern:"@?[\\w\\d_-]+",autoFocus:!0})})}),Object(ve.jsx)("div",{className:le.a.DIALOG_FOOTER,children:Object(ve.jsxs)("div",{className:le.a.DIALOG_FOOTER_ACTIONS,children:[Object(ve.jsx)("div",{children:x}),Object(ve.jsx)(h.c,{onClick:m,type:"button",children:"Close"}),Object(ve.jsx)(h.c,{intent:Yt.a.PRIMARY,type:"submit",disabled:""===u,children:"Rename"})]})})]})})}}(e),c=i.dialog,s=i.showRenameDialog,u=Object(ve.jsxs)(ve.Fragment,{children:[a,c]}),d=Object(o.useCallback)((function(){e&&t.onChangeCell("survey",null===e||void 0===e?void 0:e.rowIndex,"hint"," ",e)}),[t,e]),b=Object(o.useCallback)((function(){var n;e&&(null===(n=t.xlsForm)||void 0===n||n.languages.forEach((function(n){t.onChangeCell("survey",null===e||void 0===e?void 0:e.rowIndex,"hint","",e,n)})))}),[t,e]);return{nodeActionDialogs:u,nodeActionMenuItems:e&&Object(ve.jsx)(tn,{node:e,removeNode:r,renameNode:s,nestNode:t.onNestNode.bind(void 0,e),ungroupNode:t.onUngroupNode.bind(void 0,e),addHintToNode:d,removeHintFromNode:b})}}var on=Object(p.a)(h.h)(Kt||(Kt=Object(s.a)(["\n  overflow: auto;\n  word-break: break-all;\n  font-size: 16px;\n  line-height: 20px;\n  display: block;\n  border: none;\n  box-shadow: none;\n  background: transparent;\n  padding: 0;\n"]))),an=p.a.div(Xt||(Xt=Object(s.a)(["\n  display: grid;\n  gap: 8px;\n\n  h1,\n  h2,\n  h3,\n  h4,\n  h5 {\n    margin: 0;\n    &:not(:first-child) {\n      margin-top: 8px;\n    }\n  }\n"]))),rn=Object(p.a)(h.e)($t||($t=Object(s.a)(['\n  > code,\n  pre {\n    font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",\n      "Courier New", monospace;\n    color: inherit;\n    margin: -1px;\n    padding: 2px 4px;\n    background-color: rgba(255, 255, 255, 0.3);\n    @media (prefers-color-scheme: dark) {\n      background-color: rgba(0, 0, 0, 0.1);\n    }\n  }\n\n  pre {\n    padding: 0.5em 0.55em;\n    margin: 0.5em 0;\n    line-height: 1.3em;\n    background: white;\n    white-space: pre-wrap;\n  }\n\n  code {\n    font-weight: 600;\n    font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",\n      "Courier New", monospace;\n  }\n']))),cn=p.a.div(qt||(qt=Object(s.a)(["\n  position: absolute;\n  top: 0px;\n  left: -20px;\n  width: calc(100% + 40px);\n  height: 5px;\n  background-color: ",";\n  z-index: 10000000;\n"])),f.a.BLUE3);function ln(e){var t=e.detailsButtonCaption,n=e.hasTypeIcon,a=e.style,r=o.useContext(fe),i=o.useContext(Ce),s=i.node,u=i.nodeEvaluationResults,d=!Ne.includes(s.type)&&Ae(s,r.evaluationContext),b=s.type.match(/^select/)&&0===s.typeParameters.length,p=!!gt(u),j=o.useState(!1),v=Object(l.a)(j,2),m=v[0],g=v[1],O=function(e){var t=e.node,n=e.evaluationContext,a=e.setIsDraggedOver,r=o.useContext(xt).onDropNode,i=o.useCallback((function(e){n&&e.dataTransfer.setData("application/json",JSON.stringify({sourceNode:t,sourcePath:S(t,n)}))}),[n,t]),c=o.useCallback((function(e){e.preventDefault(),n&&a(!0)}),[n,a]),l=o.useCallback((function(e){if(n){var o=S(t,n),i=JSON.parse(e.dataTransfer.getData("application/json")),c=i.sourcePath,l=i.sourceNode;Ot(l),console.log("Dropped on path",o),a(!1),r({sourceNode:l,sourcePath:c,destinationNode:t,position:"before"})}}),[n,t,r,a]);return{draggable:!0,onDragStart:i,onDragOver:c,onDragLeave:o.useCallback((function(){if(n){var e=S(t,n);console.log("Left dragging at path",e),a(!1)}}),[n,t,a]),onDrop:l}}({evaluationContext:r.evaluationContext,node:s,setIsDraggedOver:g}),x=Oe()?f.a.VIOLET5:f.a.VIOLET3;return Object(ve.jsxs)(h.j,Object(c.a)(Object(c.a)({style:Object(c.a)({display:"inline-flex",flex:"none",position:"relative",overflow:"visible"},a)},O),{},{children:[m&&Object(ve.jsx)(cn,{}),Object(ve.jsx)(h.c,{minimal:!0,small:!0,lang:"en",intent:p?"danger":b?"warning":void 0,rightIcon:p?"error":void 0,icon:n?Object(ve.jsx)(h.z,{icon:Te[s.type],color:p||b?void 0:x}):void 0,style:{color:p||b?void 0:x,fontSize:"inherit",padding:0},className:[!p&&!d&&le.a.TEXT_MUTED].filter(Boolean).join(" "),children:Object(ve.jsxs)(h.j,{children:[t||Object(ve.jsx)("code",{style:{color:"inherit"},children:s.row.name}),!d&&Object(ve.jsxs)(ve.Fragment,{children:["\xa0",Object(ve.jsx)(h.z,{icon:"eye-off",style:{opacity:.5,color:"inherit"},title:"Invisible",htmlTitle:"Invisible"})]})]})})]}))}function sn(e){var t,n=e.node,a=e.editable,r=e.nameOfOnlyShownTab,i=e.detailsButtonCaption,c=e.hasTypeIcon,s=o.useContext(fe),u=null===(t=s.evaluationContext)||void 0===t?void 0:t.evaluationResults.get(n),d=gt(u),b=n.row,p=Ne.includes(n.type)?Object(w.without)(Se,"relevant","readonly"):Se,j=p.find((function(e){var t=b[e];return"string"===typeof t&&t.length>0})),v=Oe(),m=o.useState(100),g=Object(l.a)(m,2),O=g[0],x=g[1],y=o.useCallback((function(e){setTimeout((function(){var t,n=null===(t=e[0])||void 0===t?void 0:t.contentRect.width;Math.abs(n-O)>10&&x(n)}),50)}),[O]),k=o.useState(d||j||"calculation"),E=Object(l.a)(k,2),C=E[0],T=E[1],S=o.useMemo((function(){return(null===s||void 0===s?void 0:s.xlsForm)&&mt(s.xlsForm,n)}),[s,n]),A=nn(n),R=A.nodeActionMenuItems,L=A.nodeActionDialogs;if(!s.evaluationContext)return null;var I=N(n,s.evaluationContext).slice(1),_=function(e){var t=e.references,n=e.editable,o=t&&(1===t.length?"One dependency":"".concat(t.length," dependencies"));return n&&t&&t.length>0&&Object(ve.jsx)(pe.a,{content:Object(ve.jsx)(Zt,{references:t}),lazy:!0,children:Object(ve.jsx)(h.c,{icon:"link",fill:!1,minimal:!0,title:o,"aria-label":o,children:t.length})})}({references:S,editable:a}),F=Object(ve.jsxs)(h.j,{style:{margin:"-20px",marginBottom:"24px",backgroundColor:f.a.LIGHT_GRAY5,background:"linear-gradient(\n          ".concat(ye(f.a.BLUE3,0)," 0px,\n          ").concat(ye(f.a.BLUE3,.05)," 22px,\n          ").concat(ye(f.a.BLUE3,.06)," 32px)"),borderBottom:"solid 1px ".concat(v?f.a.DARK_GRAY2:f.a.LIGHT_GRAY3),gap:"8px"},children:[Object(ve.jsx)(Wt,{node:n,showType:!0}),Object(ve.jsx)("div",{className:le.a.FLEX_EXPANDER}),_,Object(ve.jsx)(h.d,{fill:!1,children:Object(ve.jsx)(pe.a,{content:Object(ve.jsx)(h.C,{children:R}),lazy:!0,placement:"right-start",children:Object(ve.jsx)(h.c,{icon:"more",minimal:!0,text:"Actions"})})})]}),D=Object(ve.jsxs)(h.j,{vertical:!0,children:[a&&F,Object(ve.jsx)(h.M,{onResize:y,observeParents:!0,children:Object(ve.jsx)(h.j,{style:{width:"100%",margin:"-12px 8px 8px 0px"},children:Object(ve.jsx)(Lt,{path:I,width:O})})}),r?Object(ve.jsx)(Rt,{node:n,columnName:r,nodeEvaluationResult:null===u||void 0===u?void 0:u.get(r),style:{margin:"0 -20px -20px -20px"}}):Object(ve.jsx)(h.P,{onChange:T,selectedTabId:C,renderActiveTabPanelOnly:!1,children:p.map((function(e){return function(e){var t=e.nodeEvaluationResults,n=e.node,o=e.columnName,a=null===t||void 0===t?void 0:t.get(o),r=Object(ve.jsx)(Rt,{node:n,columnName:o,nodeEvaluationResult:a,style:{margin:"-20px"}});return Object(ve.jsx)(h.O,{id:o,panel:r,title:Object(ve.jsxs)(ve.Fragment,{children:[o,"error"===(null===a||void 0===a?void 0:a.state)&&Object(ve.jsxs)(ve.Fragment,{children:["\xa0",Object(ve.jsx)(h.z,{icon:"warning-sign",intent:"warning"})]})]})},o)}({node:n,nodeEvaluationResults:u,columnName:e})}))})]});return Object(ve.jsxs)(Ce.Provider,{value:{node:n,nodeEvaluationResults:u},children:[L,Object(ve.jsx)(pe.a,{lazy:!0,interactionKind:"click",popoverClassName:je.a.POPOVER2_CONTENT_SIZING,minimal:!1,placement:"top",rootBoundary:"viewport",onOpening:function(){return x(0)},modifiers:{arrow:{enabled:!0},preventOverflow:{enabled:!0}},content:D,fill:!1,targetTagName:"span",children:Object(ve.jsx)(ln,{detailsButtonCaption:i,hasTypeIcon:c,style:e.buttonStyle})})]})}var un,dn=n(154),hn=p.a.button(un||(un=Object(s.a)(["\n  display: inline-block;\n  padding: 0.2em 0.4em;\n  cursor: pointer;\n  background: linear-gradient(\n    ",",\n    ","\n  );\n  border: 0.1em "," solid;\n  color: ",";\n  border-radius: 1em;\n"])),ye(f.a.BLUE4,.1),ye(f.a.BLUE4,.1),ye(f.a.BLUE1,.4),f.a.BLUE1);function bn(e){var t=e.object,n=t instanceof Date,o=Object(w.get)(t,"@type")||n&&"Date",a=Object(ve.jsx)("div",{style:{margin:"-20px",padding:"20px",overflow:"auto"},children:Object(ve.jsx)(dn.b,{data:t,name:o,expandLevel:0,theme:Object(c.a)(Object(c.a)({},dn.a),{},{TREENODE_FONT_FAMILY:'SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',TREENODE_FONT_SIZE:"14px",TREENODE_LINE_HEIGHT:"1.5",BASE_FONT_SIZE:"14px",BASE_LINE_HEIGHT:"1.5",OBJECT_NAME_COLOR:f.a.VIOLET3,OBJECT_VALUE_NULL_COLOR:f.a.RED4,OBJECT_VALUE_UNDEFINED_COLOR:f.a.RED4,OBJECT_VALUE_REGEXP_COLOR:f.a.RED4,OBJECT_VALUE_STRING_COLOR:f.a.RED4,OBJECT_VALUE_SYMBOL_COLOR:f.a.RED4,OBJECT_VALUE_NUMBER_COLOR:f.a.RED4,OBJECT_VALUE_BOOLEAN_COLOR:f.a.RED4,OBJECT_VALUE_FUNCTION_PREFIX_COLOR:f.a.RED4})})});return void 0!==o||n?Object(ve.jsx)(pe.a,{lazy:!0,interactionKind:"click",popoverClassName:je.a.POPOVER2_CONTENT_SIZING,minimal:!1,placement:"top",rootBoundary:"viewport",modifiers:{arrow:{enabled:!0},preventOverflow:{enabled:!0}},content:a,fill:!1,targetTagName:"span",children:Object(ve.jsx)(hn,{children:String(o)})}):a}function fn(e){var t=e.token,n=e.className;return Object(ve.jsx)("a",{href:"https://getodk.github.io/xforms-spec/#fn:".concat(t.text),className:n,target:"docs",children:t.text})}function pn(e){var t=e.expression,n=e.context,o=e.className,a=e.token,r=e.node,i=E(t.name,n,r)||k(t.name,n,n.survey);return!i||i instanceof Array?Object(ve.jsx)("var",{className:o,"data-referenced-node":i,children:a.text}):Object(ve.jsxs)("var",{children:["${",Object(ve.jsx)(sn,{node:i,editable:!1,nameOfOnlyShownTab:"calculation"}),"}"]})}function jn(e){var t=e.token,n=e.expression,a=e.parentExpression,r=e.node,i="token token-".concat(_[t.type]),c=o.useContext(fe);return t.type===_.NAME&&"call"===(null===a||void 0===a?void 0:a.kind)&&n instanceof $&&t===a.tokens[0]?Object(ve.jsx)(fn,{token:t,className:i}):t.type===_.NAME&&t.text.startsWith("$")&&n instanceof $&&c.evaluationContext?Object(ve.jsx)(pn,{expression:n,context:c.evaluationContext,className:i,token:t,node:r}):n instanceof Be&&Object(w.isObject)(n.value)&&"object"===n.type?Object(ve.jsx)(bn,{object:n.value}):Object(ve.jsx)("span",{className:i,children:t.text})}function vn(e){var t;if(!e.tokens)return Object(ve.jsx)(se,{style:e.style,className:"".concat(e.className||""," expression expression-invalid"),children:e.code});var n=e.tokens[e.tokens.length-1],o=n.index+n.text.length;return Object(ve.jsxs)(se,{style:e.style,className:"".concat(e.className||""," expression expression-invalid"),children:[e.tokens.map((function(t){return Object(ve.jsx)(jn,{token:t,node:e.node},t.index)})),Object(ve.jsx)("span",{className:le.a.TEXT_DISABLED,children:null===(t=e.code)||void 0===t?void 0:t.slice(o)})]})}function mn(e){if(!e.expression)return Object(ve.jsx)(vn,Object(c.a)({},e));var t=e.error instanceof D&&e.error.expression===e.expression;return Object(ve.jsx)(se,{style:e.style,className:"".concat(e.className||""," expression expression-").concat(e.expression.kind," ").concat(t?"has-error":""),children:e.expression.children.map((function(t,n){return t instanceof K?Object(ve.jsx)(mn,{expression:t,parentExpression:e.expression,error:e.error,node:e.node}):Object(ve.jsx)(jn,{token:t,expression:e.expression,parentExpression:e.parentExpression,node:e.node},t.index)}))})}function gn(e){var t,n=e.node,a=null===(t=o.useContext(fe).evaluationContext)||void 0===t?void 0:t.evaluationResults.get(n);if(!a)return Object(ve.jsx)(h.z,{icon:"calculator",intent:"none"});var r=Se.filter((function(e){var t;return null===(t=a.get(e))||void 0===t?void 0:t.error})),i=null===a||void 0===a?void 0:a.get("calculation"),c=Object(ve.jsx)(mn,{node:n,state:null===i||void 0===i?void 0:i.state,error:null===i||void 0===i?void 0:i.error,expression:Nt(null===i||void 0===i?void 0:i.result)}),l=r.length>0&&"Node has errors in the following columns: ".concat(r.map((function(e){return"\u2018".concat(e,"\u2019")})).join(", ")),s=l?Object(ve.jsxs)(ve.Fragment,{children:["\xa0",Object(ve.jsx)(j.a,{content:l,children:Object(ve.jsx)(h.z,{icon:"error",intent:"danger",title:l,htmlTitle:l})})]}):null;return Object(ve.jsxs)(h.j,{children:[c,s]})}function On(e,t,n){return 0===e.children.length?n({id:N(e,t).join("."),label:e.row.name,childNodes:[],nodeData:e}):n({id:N(e,t).join("."),label:e.row.name,childNodes:e.children.map((function(e){return On(e,t,n)})),nodeData:e})}function xn(e){var t=e.xlsForm,n=o.useContext(fe),a=n.evaluationContext,r=o.useMemo((function(){return t&&a?On(t.rootSurveyGroup,a,(function(e){var t,o=e.nodeData;if(!o)throw new Error("Encountered a tree node that is not associated with a node. Please fix this.");if(!n.evaluationContext)throw new Error("No context defined. Please define a context before using this component.");var a=Object(ve.jsx)(sn,{node:o,editable:!0,hasTypeIcon:!0,buttonStyle:{color:f.a.VIOLET3}});return Object(c.a)(Object(c.a)({},e),{},{label:a,key:o.row.name,isExpanded:!0,hasCaret:!(0===(null===(t=e.childNodes)||void 0===t?void 0:t.length)),secondaryLabel:o&&Object(ve.jsx)(gn,{node:o})})})):null}),[n.evaluationContext,a,t]);return r?Object(ve.jsx)(h.S,{contents:[r]}):Object(ve.jsx)("div",{})}function yn(e){var t=wn(e).onFileChange;return Object(ve.jsx)(h.n,{onInputChange:t,large:!0})}function wn(e){var t=e.setXLSFormWithPatches,n=e.setLanguage,a=o.useCallback(function(){var e=Object(_e.a)(Ie.a.mark((function e(o){var a,r,i;return Ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,jt(o);case 2:i=e.sent,t("Load Excel workbook",i,[],[]),n((null===(a=i.worksheets.settings)||void 0===a?void 0:a.rows[0].default_language)||Object(g.a)(null===(r=i.languages)||void 0===r?void 0:r.values())[0]||"English (en)");case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[n,t]);return{onFileChange:o.useCallback((function(e){var t=e.target.files[0],n=new De.Workbook,o=new FileReader;o.readAsArrayBuffer(t),o.onload=function(){var e=o.result;if(!(e instanceof ArrayBuffer))throw new Error("Buffer was not defined as Buffer object after reading.");n.xlsx.load(e).then((function(e){a(n)}))}}),[a])}}function kn(e){var t=e.setXLSFormWithPatches,n=e.setLanguage,a=Object(ve.jsx)(yn,{setXLSFormWithPatches:t,setLanguage:n}),r=Object(o.useCallback)(Object(_e.a)(Ie.a.mark((function e(){var n,o;return Ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new De.Workbook).addWorksheet("survey"),n.addWorksheet("choices"),(o=n.addWorksheet("settings")).addRow(["default_language"]),o.addRow(["English (en)"]),e.t0=t,e.next=9,jt(n);case 9:e.t1=e.sent,e.t2=[],e.t3=[],(0,e.t0)("Load empty XLSForm document",e.t1,e.t2,e.t3);case 13:case"end":return e.stop()}}),e)}))),[t]),i=Object(ve.jsxs)(h.j,{vertical:!0,children:[Object(ve.jsx)("p",{children:a}),Object(ve.jsx)("p",{children:"or"}),Object(ve.jsx)("p",{children:Object(ve.jsx)(h.c,{large:!0,onClick:r,children:"Start from scratch"})})]});return Object(ve.jsx)(h.G,{icon:"document-open",title:"Open an XLSForm Excel file to start.",action:i})}var En=o.createContext({undoHistory:{commands:[],index:-1},setDocumentWithPatches:function(){},undo:function(){},redo:function(){},gotoIndex:function(){},document:void 0});function Cn(){var e=a.a.useContext(En),t=e.undoHistory,n=t.commands[t.index+1],o=Object(ve.jsxs)(h.C,{children:[Object(ve.jsx)(h.E,{text:Object(ve.jsx)(Ct,{inline:!0,children:"Undo"}),labelElement:Object(ve.jsx)(h.B,{combo:"mod+z",minimal:!0}),onClick:e.undo}),Object(ve.jsx)(h.E,{text:n?Object(ve.jsx)(Ct,{inline:!0,children:"Redo"}):"Redo",labelElement:Object(ve.jsx)(h.B,{combo:"mod+shift+z",minimal:!0}),onClick:e.redo,disabled:!n}),Object(ve.jsx)(h.D,{}),Object(ve.jsx)(h.E,{text:"History",children:t.commands.map((function(n,o){return Object(ve.jsx)(h.E,{active:o===t.index,text:Object(ve.jsx)(Ct,{inline:!0,children:n.description}),onClick:function(){return e.gotoIndex(o)}},o)}))})]}),r=Object(ve.jsx)(h.c,{className:"bp3-minimal",rightIcon:"caret-down",text:"Edit"});return Object(ve.jsx)(ve.Fragment,{children:Object(ve.jsx)(pe.a,{content:o,lazy:!0,placement:"bottom-end",minimal:!0,children:r})})}function Tn(e){return Nn.apply(this,arguments)}function Nn(){return(Nn=Object(_e.a)(Ie.a.mark((function e(t){var n,o,a,r,i,c,l;return Ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(o=new De.Workbook).modified=o.created=new Date,o.creator="Sozialheld*innen Survey Editor",["survey","choices","settings"].forEach((function(e){var n=null===t||void 0===t?void 0:t.worksheets[e];if(n){var a=o.addWorksheet(e),r=Object(g.a)((null===n||void 0===n?void 0:n.rows)||[]),i=st(n.columnNames).map((function(e){return e.replace(/::/,".")}));a.columns=i.map((function(e){return{header:e,key:e,width:10}})),a.addRows(r.map((function(e){return i.map((function(t){return ct.includes(t)&&(t="".concat(t,".English (en)")),Object(w.get)(e,t)}))})))}})),a=(null===t||void 0===t||null===(n=t.worksheets.settings)||void 0===n?void 0:n.rows[0].form_title)||"Untitled XLSForm survey",o.model.title=a,e.next=9,o.xlsx.writeBuffer();case 9:r=e.sent,i=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c=document.createElement("a"),document.body.appendChild(c),l=window.URL.createObjectURL(i),c.href=l,c.download=a,c.click(),setTimeout((function(){window.URL.revokeObjectURL(l),document.body.removeChild(c)}),0);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Sn(e){var t=e.xlsForm,n=e.setXLSFormWithPatches,o=e.setLanguage,r=a.a.createRef(),i=wn({setXLSFormWithPatches:n,setLanguage:o}).onFileChange,c=a.a.useCallback((function(){n("Close current workbook",void 0,[],[])}),[n]),l=a.a.useCallback(Object(_e.a)(Ie.a.mark((function e(){return Ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return e.next=3,Tn(t);case 3:case"end":return e.stop()}}),e)}))),[t]),s=Object(ve.jsxs)(h.C,{children:[Object(ve.jsx)("label",{htmlFor:"open-file-input",children:Object(ve.jsx)(h.E,{icon:"import",text:"Import file\u2026"})}),Object(ve.jsx)(h.E,{text:"Export",icon:"export",children:Object(ve.jsx)(h.E,{text:"Microsoft Excel (.xlsx)",onClick:l,disabled:!t})}),Object(ve.jsx)(h.D,{}),Object(ve.jsx)(h.E,{text:"Close",onClick:c})]}),u=Object(ve.jsx)(h.c,{className:"bp3-minimal",rightIcon:"caret-down",text:"File"});return Object(ve.jsxs)(ve.Fragment,{children:[Object(ve.jsx)("input",{id:"open-file-input",type:"file",onChange:i,ref:r,style:{display:"none"}}),Object(ve.jsx)(pe.a,{content:s,lazy:!0,placement:"bottom-end",minimal:!0,children:u})]})}var An=n(485).a.ofType(),Rn=function(e,t){var n=e.match(/^(.*) \((.*)\)$/)||[],o=Object(l.a)(n,3),a=o[1],r=o[2];return Object(ve.jsx)(h.E,{text:a,label:r,onClick:t.handleClick,shouldDismissPopover:!1},r)};function Ln(e){var t=o.useCallback((function(t){e.onChange(t)}),[e]),n=e.language.match(/^(.*) \((.*)\)$/)||[],a=Object(l.a)(n,2)[1];return Object(ve.jsx)(An,{items:e.languages,itemRenderer:Rn,activeItem:e.language,noResults:Object(ve.jsx)(h.E,{disabled:!0,text:"No languages loaded yet."}),onItemSelect:t,filterable:!1,children:Object(ve.jsx)(h.c,{text:a,rightIcon:"double-caret-vertical",icon:"globe",minimal:!0})})}function In(e){return Object(ve.jsx)("div",Object(c.a)(Object(c.a)({},e),{},{style:Object(c.a)({overflow:"auto",flex:1},e.style),children:e.children}))}var _n={table:!1,debug:!0,json:!1};function Fn(e,t){return Re(t)?e.flatNodes.findIndex((function(e,n){return n>t.rowIndex&&Object(w.isEqual)(e,t)})):t.rowIndex}var Dn=0;var Mn=0;function Pn(e){return{beginMarkerRow:{type:"begin_group",name:"untitled_group_".concat(Mn+=1),label:we("",e.languages)},endMarkerRow:{type:"end_group"}}}function Un(e){var t,n,o=e.xlsForm,a=e.group,r=e.node,i=e.position,c=e.fieldType,l=function(e){return{type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text",name:"untitled_field_".concat(Dn++),label:we("",e.languages)}}(o,c),s=Pn(o),u=s.beginMarkerRow,d=s.endMarkerRow,h=a?[u,l,d]:[l],b=0,f=r&&Re(r);b=r&&f?{after:Fn(o,r)+1,before:r.rowIndex,inside:r.rowIndex+1}[i]:{after:r?r.rowIndex+1:0,before:r?r.rowIndex:0,inside:0}[i];var p=[];return(null===c||void 0===c?void 0:c.match(/^select/))&&!(null===o||void 0===o||null===(t=o.worksheets.choices)||void 0===t?void 0:t.rows.length)&&p.push(Pt(o)),p.push(Mt((null===(n=p[0])||void 0===n?void 0:n[0])||o,"survey",[{rowIndex:b,numberOfRowsToRemove:0,rowsToAdd:h}])),Ut(p)}var Bn=n(102);function Gn(e,t){if("string"!==typeof e){var n=Object(Bn.ordinalize)(String(t+1));throw new B("Expected a string value as ".concat(n," parameter, but got `").concat(e,"`."))}}function zn(e,t){if("number"!==typeof e){var n=Object(Bn.ordinalize)(String(t+1));throw new B("Expected a number value as ".concat(n," parameter, but got `").concat(e,"`."))}}function Vn(e,t){if("boolean"!==typeof e){var n=Object(Bn.ordinalize)(String(t+1));throw new B("Expected a boolean value as ".concat(n," parameter, but got `").concat(e,"`."))}}var Hn={if:function(e,t,n){return Vn(e,0),e?t:n},true:function(){return!0},false:function(){return!1},not:function(e){return Vn(e,0),!e},coalesce:function(e,t){return"undefined"!==typeof e&&""!==e?e:"undefined"!==typeof t&&""!==t?t:""},boolean:function(e){return"number"===typeof e?0!==e:"string"===typeof e?""!==e:e instanceof Array?e.length>0:"boolean"===typeof e&&e},position:function(e){throw new G("position")},once:function(e){throw new G("once")},selected:function(e,t){return void 0!==e&&(Gn(e,0),Gn(t,1),0!==e.length&&0!==t.length&&e.split(" ").includes(t))},"selected-at":function(e,t){throw new G("selected-at")},"count-selected":function(e){throw new G("count-selected")},"jr:choice-name":function(e,t){throw new G("jr:choice-name")},"indexed-repeat":function(e,t,n,o,a,r,i){throw new G("):")},count:function(e){throw new G("count")},"count-non-empty":function(e){throw new G("count-non-empty")},sum:function(e){throw new G("sum")},max:function(e){throw new G("max")},min:function(e){throw new G("min")},regex:function(e,t){return Gn(e,0),Gn(t,0),!!e.match(new RegExp(t))},contains:function(e,t){return Gn(e,0),Gn(t,1),!!e.match(t)},"starts-with":function(e,t){return Gn(e,0),Gn(t,1),e.startsWith(t)},"ends-with":function(e,t){return Gn(e,0),Gn(t,1),e.endsWith(t)},substr:function(e,t,n){return Gn(e,0),zn(t,1),zn(n,2),e.substring(t,n)},"substring-before":function(e,t){throw new G("substring-before")},"substring-after":function(e,t){throw new G("substring-after")},translate:function(e,t,n){throw new G("translate")},"string-length":function(e){return Gn(e,0),e.length},"normalize-space":function(e){return Gn(e,0),e.trim()},concat:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.join("")},join:function(e,t){throw new G("join")},"boolean-from-string":function(e){return"true"===e||"1"===e},string:function(e){return String(e)},round:function(e,t){return zn(e,0),zn(t,1),Math.round(e*Math.pow(10,t))/Math.pow(10,t)},int:function(e){return zn(e,0),Math.floor(e)},number:function(e){return"boolean"===typeof e?e?1:0:"string"===typeof e&&e.trim().match(/-?\d+(\.\d+)?/)?Number(e):"number"===typeof e?e:NaN},digest:function(e,t,n){throw new G("digest")},pow:function(e,t){return zn(e,0),zn(t,1),Math.pow(e,t)},log:function(e){return zn(e,0),Math.log(e)},log10:function(e){return zn(e,0),Math.log10(e)},abs:function(e){return zn(e,0),Math.abs(e)},sin:function(e){return zn(e,0),Math.sin(e)},cos:function(e){return zn(e,0),Math.cos(e)},tan:function(e){return zn(e,0),Math.tan(e)},asin:function(e){return zn(e,0),Math.asin(e)},acos:function(e){return zn(e,0),Math.acos(e)},atan:function(e){return zn(e,0),Math.atan(e)},atan2:function(e,t){return zn(e,0),zn(t,1),Math.atan2(e,t)},sqrt:function(e){return zn(e,0),Math.sqrt(e)},exp:function(e){return zn(e,0),Math.exp(e)},exp10:function(e){return zn(e,0),Math.pow(10,e)},pi:function(){return Math.PI},today:function(){var e=new Date;return e.setHours(0,0,0,0),e},now:function(){return(new Date).toISOString()},"decimal-date-time":function(e){throw new G("decimal-date-time")},date:function(e){throw new G("date")},"decimal-time":function(e){throw new G("decimal-time")},"format-date":function(e,t){throw new G("format-date")},"format-date-time":function(e,t){throw new G("format-date-time")},area:function(e){throw new G("area")},distance:function(e){throw new G("distance")},random:Math.random,randomize:function(e,t){throw new G("randomize")},uuid:function(e){throw new G("uuid")},checklist:function(e,t){throw new G("checklist")},"weighted-checklist":function(e,t,n){throw new G("weighted-checklist")}};function Wn(e,t,n){var o;if(t.stackDepth>1e4)throw new D("Stack overflow while evaluating `".concat(JSON.stringify(e),"`"),"stackOverflow",e,t,n);var a=Object(c.a)(Object(c.a)({},t),{},{stackDepth:t.stackDepth+1});if(e instanceof Be)o=function(e){return e.value}(e);else if(e instanceof $)o=$n(e,a,n);else if(e instanceof ze)o=function(e,t,n){var o=C(e.selector,t,n);if(o instanceof Array)return o.map((function(e){return Jn(e,t,"calculation",t.nodesToAnswers.get(e))}));return o&&Jn(o,t,"calculation",t.nodesToAnswers.get(o))}(e,a,n);else if(e instanceof q)o=function(e,t,n){var o,a,r=Wn(e.left,t,n),i=Wn(e.right,t,n),c=e.operatorToken.text;if("="===c)return r==i;if("!="===c)return r!=i;if("and"===c||"or"===c)switch("boolean"===typeof r&&(o=r),"number"===typeof r&&(o=Boolean(r)),"boolean"===typeof i&&(a=i),"number"===typeof i&&(a=Boolean(i)),Xn(o,r,e,t,n),Xn(a,i,e,t,n),c){case"or":return o||a;case"and":return o&&a}"number"===typeof r&&(o=r);"string"===typeof r&&(o=parseFloat(r));"number"===typeof i&&(a=i);"string"===typeof i&&(a=parseFloat(i));if("number"!==typeof o)throw new D("Left operand is `".concat(JSON.stringify(r),"`, which is no number. Arithmetic and relative comparison operators only work with operands that are numeric."),"invalidOperandType",e,t,n);if("number"!==typeof a)throw new D("Right operand is `".concat(JSON.stringify(i),"`, which no number. Arithmetic and relative comparison operators only work with operands that are numeric."),"invalidOperandType",e,t,n);switch(c){case"+":return o+a;case"-":return o-a;case"*":return o*a;case"div":return o/a;case"mod":return o%a;case">":return o>a;case">=":return o>=a;case"<":return o<a;case"<=":return o<=a;default:throw new D("The `".concat(c,"` operator is not supported"),"unsupportedOperator",e,t,n)}}(e,a,n);else{if(!(e instanceof J))throw new D("Don\u2019t know how to evaluate `".concat(e,"`."),"unsupportedExpressionType",e,a,n);o=function(e,t,n){var o=e.fn instanceof $?e.fn:String(Wn(e.fn,t,n)),a=void 0,r=function(o,a,r){throw new D(o,a,e,t,n,r)};o instanceof $?a=$n(o,t,n,!0,Hn):"string"===typeof o?a=Hn[o]:r("Can\u2019t call a function without knowing its name \u2014 the name must be either defined as string, return a name string or a function reference.","functionNotFound");if(!a){var i=Kn(o);r("Could not find a function named `".concat(i,"`()."),"functionNotFound")}var c=e.args.map((function(e,a){try{return Wn(e,t,n)}catch(l){var i=Object(Bn.ordinalize)(String(a+1)),c=Kn(o);r("Error in ".concat(i," argument in `").concat(c,"() function call`: ").concat(l.message),"functionEvalError",l)}}));if("function"!==typeof a)return void r("Found name `".concat(a,"`, but it is not a function."),"functionNotFound");try{return a.apply(t,c)}catch(s){var l="";e.print((function(e){return l+=e})),r("Error while calling `".concat(l,"`: ").concat(s.message),"functionEvalError",s)}}(e,a,n)}return t.stackDepth-=1,o}function Kn(e){if("string"===typeof e)return e;var t="";return e.print((function(e){return t+=e})),t}function Xn(e,t,n,o,a){if("boolean"!==typeof e)throw new D("Found operand `".concat(JSON.stringify(t),"` that is no boolean value, but ").concat(["a","e","i","o","u"].includes((typeof t).slice(0,1))?"an":"a"," ").concat(typeof t,". Boolean operators like `").concat(null===n||void 0===n?void 0:n.operatorToken.text,"` only work with values that are `true` or `false`."),"invalidOperandType",n,o,a)}function $n(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:t.knownLiteralsWithoutDollarSign;if(e.text.startsWith("$")){var r=E(e.name,t,n)||k(e.name,t);if(!r)throw new D("Could not find a node with name `".concat(e.name,"`."),"nodeNotFound",e,t,n);if(r instanceof Array)return r.map((function(e){return Jn(e,t,"calculation",t.nodesToAnswers.get(e))}));var i=Jn(r,t,"calculation",t.nodesToAnswers.get(r));if(i.error)throw new D("Error in expression ".concat(e.text,"."),"unsupportedNameExpression",e,t,n,i.error instanceof D?i.error:void 0);return i.result}if(e.text===e.name){var c=t.evaluateNonDollarNameFn?t.evaluateNonDollarNameFn({expression:e,context:t,scope:n}):a[e.name];if(void 0!==c||o)return c;var l="",s=E(e.name,t,n);throw s&&(l="\u2014 did you mean to type `${".concat(e.name,"}` instead of `").concat(e.name,"`?")),new D("`".concat(e.text,"` is not a known name or reference. ").concat(l),"unknownNameWithoutDollarSign",e,t,n)}throw new D("Don\u2019t know how to evaluate ".concat(e,"."),"unsupportedNameExpression",e,t,n)}function qn(e){if(!e)throw new B("Formula was not evaluated to an expression, but no error was encountered. This means an error handler is missing for this case.")}function Yn(e,t){var n,o,a,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.survey,i=new Ue(e),c=new We({tokens:i});try{if(!(a=c.parseExpression()))throw new U("Parsing given formula `".concat(e,"` returned an empty expression."));return o=Wn(a,t,r),qn(a),{parser:c,state:"success",expression:a,result:o,error:void 0}}catch(l){if(!(l instanceof F))throw l;n=l}return{parser:c,state:"error",expression:a,error:n,result:null}}function Jn(e,t,n,o,a){var r,i=a||(null===(r=e.row)||void 0===r?void 0:r[n]);if(void 0!==i&&"string"!==typeof i)throw new Error("Sorry, multilingual formulas are not supported yet.");var c=null===i||void 0===i?void 0:i.trim();if(""===c||void 0===c){var l=o,s="select_multiple"===e.type&&l instanceof Array?l.join(" "):l;return{state:"success",result:s,expression:Nt(s),error:void 0}}return Yn(c,t,e)}function Qn(e,t,n){var o,a={relevant:!0,calculation:t.nodesToAnswers.get(e),required:!1,readonly:!1,constraint:!0};Se.forEach((function(o){n(e,o,Jn(e,t,o,a[o]))})),null===(o=e.children)||void 0===o||o.forEach((function(e){return Qn(e,t,n)}))}function Zn(e,t){Qn(e.rootSurveyGroup,t,(function(e,n,o){var a,r=t.evaluationResults.get(e);r||(r=new Map,t.evaluationResults.set(e,r)),null===(a=r)||void 0===a||a.set(n,o)}))}function eo(e){return(null===e||void 0===e?void 0:e.row.name)||"node in row ".concat(e.rowIndex)}function to(e){var t=e.xlsForm,n=e.setXLSFormWithPatches,a=e.language,r=e.debug,i=Object(o.useState)(),s=Object(l.a)(i,2),u=s[0],d=s[1];Object(o.useEffect)((function(){d(t?function(e){if(e&&e.survey===t.rootSurveyGroup)return console.log("Context exists already and survey model is identical, keeping context."),e;var n=be(t.rootSurveyGroup);return n.nodesToAnswers=new Map,n.survey=t.rootSurveyGroup,n.stackDepth=0,n.knownLiteralsWithoutDollarSign=he,Zn(t,n),console.log("Setting up new evaluation context",n),n}:void 0)}),[t,null===t||void 0===t?void 0:t.rootSurveyGroup]);var h=o.useCallback((function(e,n){r&&Qt.show({message:Object(ve.jsxs)(ve.Fragment,{children:[n.schemaKey," \u2192"," ",Object(ve.jsx)(mn,{node:n.node,expression:Nt(e)})]})},"changeField"),t&&u&&d((function(o){if(o){var a=new Map(o.nodesToAnswers.entries());a.set(n.node,e);var r=Object(c.a)(Object(c.a)({},o),{},{nodesToAnswers:a});return Zn(t,r),r}}))}),[u,r,t]),b=o.useCallback((function(e,o,r,i,c,l){if(t&&u){var s=l||a;s&&n.apply(void 0,["Change `".concat(r,"` cell in `").concat(e,"` worksheet (Row #").concat(o,")")].concat(Object(g.a)(function(e){var t=e.worksheetName,n=e.xlsForm,o=e.rowIndex,a=e.node,r=e.context,i=e.language,c=e.columnName,l=e.value,s="survey"===t;if(s&&!a)throw new Error("This is a bug: Tried to change the `survey` worksheet, but no node was supplied.");var u=ct.includes(c)?[c,i]:[c];return Object(Dt.c)(n,(function(e){if(Object(w.set)(e,["worksheets",t,"rows",o].concat(u),l),s){Object(w.set)(e,["flatNodes",o,"row"].concat(u),l);var n=a&&R(a,r);n&&Object(w.set)(e,["rootSurveyGroup"].concat(Object(g.a)(n.map((function(e){return["children",e]})).flat()),["row"],u),l)}void 0===i||e.languages.has(i)||e.languages.add(i);var d=e.worksheets[t];if(d){void 0===i||d.languages.has(i)||d.languages.add(i),d.columnNames.includes(c)||d.columnNames.push(c);var h=st([c])[0];d.columnNamesNormalized.includes(h)||d.columnNamesNormalized.push(h)}}))}({worksheetName:e,xlsForm:t,node:c,rowIndex:o,columnName:r,language:s,value:i,context:u}))))}}),[t,u,a,n]),f=o.useCallback((function(e,o,a){t&&u&&n.apply(void 0,[a].concat(Object(g.a)(Mt(t,e,o))))}),[u,n,t]),p=o.useCallback((function(e){if(t&&u){if(!R(e,u))throw new Error("Can\u2019t remove a node that isn\u2019t reachable from survey root. Please ensure the node is actually part of the survey.");n.apply(void 0,["Remove `".concat(eo(e),"` node and its children")].concat(Object(g.a)(function(e,t){var n=Fn(e,t)-t.rowIndex+1;return Mt(e,"survey",[{rowIndex:t.rowIndex,numberOfRowsToRemove:n,rowsToAdd:[]}])}(t,e))))}}),[u,n,t]),j=o.useCallback((function(e,o){t&&n.apply(void 0,["Rename `".concat(eo(e),"` to `").concat(o,"`")].concat(Object(g.a)(function(e,t,n){var o=e,a=[],r=[];mt(e,t,n).forEach((function(e){var t=e.index,n=e.row,i=Mt(o,"survey",[{rowIndex:t,numberOfRowsToRemove:1,rowsToAdd:[Object(c.a)({},n)]}]),s=Object(l.a)(i,3),u=s[0],d=s[1],h=s[2];a.push.apply(a,Object(g.a)(d)),r.push.apply(r,Object(g.a)(h)),o=u}));var i=Mt(o,"survey",[{rowIndex:t.rowIndex,numberOfRowsToRemove:1,rowsToAdd:[Object(c.a)(Object(c.a)({},t.row),{},{name:n})]}]),s=Object(l.a)(i,3),u=s[0],d=s[1],h=s[2];return o=u,a.push.apply(a,Object(g.a)(d)),r.push.apply(r,Object(g.a)(h)),[o,a,r]}(t,e,o))))}),[n,t]),v=o.useCallback((function(e){t&&n.apply(void 0,["Nest `".concat(eo(e),"`")].concat(Object(g.a)(function(e,t){var n=Pn(e),o=n.beginMarkerRow,a=n.endMarkerRow,r=t.rowIndex;return Mt(e,"survey",[{rowIndex:Fn(e,t)+1,numberOfRowsToRemove:0,rowsToAdd:[a]},{rowIndex:r,numberOfRowsToRemove:0,rowsToAdd:[o]}])}(t,e))))}),[n,t]),m=o.useCallback((function(e){t&&n.apply(void 0,["Ungroup `".concat(eo(e),"`")].concat(Object(g.a)(function(e){var t=e.node,n=e.xlsForm,o=t.rowIndex;return Mt(n,"survey",[{rowIndex:Fn(n,t),numberOfRowsToRemove:1,rowsToAdd:[]},{rowIndex:o,numberOfRowsToRemove:1,rowsToAdd:[]}])}({node:e,xlsForm:t}))))}),[n,t]),O=o.useCallback((function(e){var o=e.position,a=e.node,r=e.group,i=e.fieldType;if(t){var c=r?"group":"`".concat(i,"` field"),l=a?"Add new ".concat(c," ").concat(o," `").concat(eo(a),"`"):"Add new ".concat(c);n.apply(void 0,[l].concat(Object(g.a)(Un({xlsForm:t,group:r,node:a,position:o,fieldType:i}))))}}),[n,t]),x=o.useCallback((function(e){e.sourcePath;var o=e.sourceNode,r=e.destinationNode;e.position;if(t&&u&&a){var i=function(e){var t,n=e.xlsForm,o=e.evaluationContext,a=e.sourceNode,r=e.destinationNode,i=e.onError;if(!(null===(t=I(r,o))||void 0===t?void 0:t.find((function(e){return Object(w.isEqual)(e,a)})))){var c=Fn(n,a)-a.rowIndex+1,l=Object(g.a)(n.worksheets.survey.rows).slice(a.rowIndex,a.rowIndex+c),s=r.rowIndex<a.rowIndex;return Mt(n,"survey",[{rowIndex:r.rowIndex,numberOfRowsToRemove:0,rowsToAdd:l},{rowIndex:a.rowIndex+(s?c:0),numberOfRowsToRemove:c,rowsToAdd:[]}])}i("Can\u2019t move a node into itself.")}({xlsForm:t,evaluationContext:u,sourceNode:o,destinationNode:r,onError:function(e){return Qt.show({intent:"warning",icon:"error",message:e},"cant-drop-node-on-itself")}});i&&n.apply(void 0,["Move `".concat(eo(o),"` before `").concat(eo(r),"`")].concat(Object(g.a)(i)))}}),[u,a,n,t]);return{evaluationContext:u,setEvaluationContext:d,setXLSFormWithPatches:n,onChangeAnswer:h,onChangeCell:b,onMoveNode:x,onSpliceRows:f,onRemoveRowAndChildren:p,onRenameNode:j,onNestNode:v,onUngroupNode:m,onAddNode:O}}function no(){var e,t,n,a,r=o.useContext(fe),i=null===(e=r.xlsForm)||void 0===e||null===(t=e.worksheets.settings)||void 0===t?void 0:t.rows[0].form_title,c=o.useState(),s=Object(l.a)(c,2),u=s[0],d=s[1],b=o.useCallback((function(e){void 0!==u&&""!==u&&(r.onChangeCell("settings",0,"form_title",u),d(void 0))}),[u,r]),f=null===(n=r.xlsForm)||void 0===n||null===(a=n.worksheets.settings)||void 0===a?void 0:a.rows[0].form_title,p=void 0!==f&&""!==f.trim();return Object(ve.jsx)(h.m,{onChange:d,onConfirm:b,confirmOnEnterKey:!0,className:[!p&&le.a.TEXT_MUTED,le.a.TEXT_LARGE].filter(Boolean).join(" "),placeholder:"Enter a survey title\u2026",value:void 0===u?i:u,minWidth:100})}function oo(){var e=Object(o.useContext)(fe),t=Object(o.useCallback)((function(){e.onAddNode({position:"after",group:!1,fieldType:"text"})}),[e]),n=Object(o.useCallback)((function(){e.onAddNode({position:"after",group:!0,fieldType:"text"})}),[e]),a=Object(ve.jsxs)(ve.Fragment,{children:[Object(ve.jsx)("p",{children:Object(ve.jsx)(h.c,{text:"Add a field",large:!0,intent:"primary",onClick:t})}),Object(ve.jsx)("p",{children:Object(ve.jsx)(h.c,{text:"Add a group of fields",intent:"none",onClick:n})})]});return Object(ve.jsx)(h.G,{title:"This survey is empty.",action:a})}var ao=n(159),ro=n(198),io=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var o;return Object(v.a)(this,n),(o=t.call(this,e)).state={error:null},o}return Object(m.a)(n,[{key:"componentDidCatch",value:function(e,t){console.error(e,t)}},{key:"render",value:function(){return this.state.error?Object(ve.jsx)(h.e,{intent:"danger",children:String(this.state.error)}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{error:e}}}]),n}(o.Component);function co(e){var t=e.value,n=e.labelElement,o=e.relevant,a=e.readonly;return void 0!==t&&"boolean"!==typeof t?Object(ve.jsx)(h.e,{intent:"warning",children:Object(ve.jsxs)("h4",{children:["Value must be a ",Object(ve.jsx)(h.h,{children:"boolean"})," for this field to work"]})}):Object(ve.jsx)(h.g,{large:!0,disabled:!1===o||a,labelElement:n,onChange:e.onInputChange,defaultChecked:"boolean"===typeof e.defaultValue?e.defaultValue:void 0})}function lo(e){var t=e.node,n=o.useContext(fe).evaluationContext,a=o.useContext(Ce).nodeEvaluationResults,r=o.useContext(fe),i=o.useState(),c=Object(l.a)(i,2),s=c[0],u=c[1],d=t.row.calculation,b=void 0===s?d:s,p=""===(null===b||void 0===b?void 0:b.trim())?void 0:b,j=void 0===s?null===a||void 0===a?void 0:a.get("calculation"):n&&Jn(t,n,"calculation","",p),v=o.useCallback((function(){u(void 0)}),[]),m=o.useCallback((function(e){r.onChangeCell("survey",t.rowIndex,"calculation",e,t),u(void 0)}),[t,r]);return Object(ve.jsxs)(h.j,{vertical:!0,children:[Object(ve.jsxs)(h.j,{style:{fontFamily:'SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',background:f.a.WHITE,padding:"8px",border:"1px solid ".concat(f.a.LIGHT_GRAY2)},fill:!0,children:[Object(ve.jsx)(h.z,{icon:"function",style:{marginRight:"16px"}}),Object(ve.jsx)(h.j,{fill:!0,children:Object(ve.jsx)(h.m,{placeholder:"Enter a literal or a formula\u2026",onChange:u,onCancel:v,onConfirm:m,value:p,multiline:!0})})]}),Object(ve.jsx)(Rt,{node:t,columnName:"calculation",nodeEvaluationResult:j,style:{}})]})}function so(e){var t,n=e.node,o=e.xlsForm,a=e.context,r=e.key,i=n.typeParameters,l=Object.keys(o.choicesByName),s=n.row.type;if(!(void 0!==l[0]))throw new B("Node `".concat(r,"` uses `").concat(s,"` as its `type`, but the \u2018choices\u2019 worksheet seems to be empty or invalid. Please define some valid choice lists first."));var u=o.choicesByName,d=Object(w.compact)(i.map((function(e){return e.trim().startsWith("$")?function(e,t,n){var o=Yn(e,t.context,t.node);if("error"===o.state)throw new D("Error evaluating `".concat(e,"` to determine available selection choices."),"invalidDynamicChoices",o.expression,t.context,t.node);if("string"!==typeof o.result)throw new D("Evaluating `".concat(e,"` did not yield a `string`. Please ensure the referenced field returns a string."),"invalidDynamicChoices",o.expression,t.context,t.node);var a=o.result;if(!n[a])throw new D("Evaluating `".concat(e,"` yielded string `'").concat(a,"'`, but the according choices list does not exist. Please ensure that the field calculates an existing list name."),"invalidDynamicChoices",o.expression,t.context,t.node);return a}(e,{node:n,xlsForm:o,context:a,key:r},u):e}))).filter((function(e){return void 0!==e&&""!==e})),h=d.map((function(e){return u[e]})).filter((function(e){return void 0!==e}));if(h.length!==d.length)throw new B("Node `".concat(r,"` (row #").concat(n.rowIndex+2,") refers to list names `").concat(d,"`. One of these lists is either not defined in the \u2018choices\u2019 worksheet, or could not be loaded correctly. Found list names:\n\n").concat(l.map((function(e){return"`".concat(e,"`")})).join(", ")));var b=null===(t=n.row.choice_filter)||void 0===t?void 0:t.trim();return b&&""!==b?function(e,t,n,o){var a=new Ue(e),r=new We({tokens:a}).parseExpression();return function(){return t.flatMap((function(e){return Object.values(e)})).filter((function(e){var t=Wn(r,Object(c.a)(Object(c.a)({},o),{},{evaluateNonDollarNameFn:function(t){return e[t.expression.name]||he[t.expression.name]}}),n);if("boolean"!==typeof t)throw new D("`choice_filter` formula did not evaluate to a `boolean`. Please ensure the formula returns a `boolean`.","invalidDynamicChoices",r,o,n);return t})).map((function(e){return e.name}))}}(b,h,n,a):h.flatMap((function(e){return Object.keys(e)}))}function uo(e){var t=e.value,n=e.node,a=e.relevant,r=e.readonly,i=o.useContext(fe),c=i.language,l=i.onChangeAnswer,s=i.xlsForm,u=void 0!==t&&"string"!==typeof t&&(!(t instanceof Array)||t.find((function(e){return"string"!==typeof e}))),d=o.useMemo((function(){return"string"===typeof t?new Set(""===t?[]:null===t||void 0===t?void 0:t.split(" ")):t instanceof Array||t instanceof Set?new Set(t):new Set}),[t]),b=o.useCallback((function(t){var n=t.currentTarget.name,o=new Set(d);t.currentTarget.checked?o.add(n):o.delete(n),l(Array.from(o),e)}),[e,l,d]);if("string"!==typeof c||void 0===i.evaluationContext||void 0===s)return null;if(u)return Object(ve.jsx)(h.e,{intent:"warning",children:Object(ve.jsxs)("h4",{children:["Value must be a ",Object(ve.jsx)(h.h,{children:"string"})," or Array of ",Object(ve.jsx)(h.h,{children:"string"}),"s for this field to work."]})});if(i.debug&&0===n.typeParameters.length)return Object(ve.jsx)(h.e,{intent:"warning",title:"No choice list set.",children:Object(ve.jsx)(Wt,{node:n,showType:!1})});var f=Object(w.compact)(n.typeParameters.map((function(e){var t;return null===(t=i.xlsForm)||void 0===t?void 0:t.choicesByName[e]}))),p=S(n,i.evaluationContext,"."),j=so({node:n,xlsForm:s,context:i.evaluationContext,key:p});j instanceof Array||(j=j());var v=new Set(j);return Object(ve.jsx)(h.j,{vertical:!0,children:f.flatMap((function(e){return Object.keys(e).map((function(t){var n;if(!v.has(t))return null;var o=e[t],i=null===o||void 0===o||null===(n=o.label)||void 0===n?void 0:n[c],l="undefined"===i?null===o||void 0===o?void 0:o.name:i;return Object(ve.jsx)(h.g,{disabled:!1===a||r,label:l,checked:"string"===typeof t&&d.has(t),name:t,inline:!0,large:!0,onChange:b})}))}))})}var ho=n(487),bo={formatDate:function(e){return e.toLocaleDateString()},parseDate:function(e){return e.length?new Date(e):null},placeholder:"YYYY-MM-DD"};function fo(e){var t=e.value,n=e.relevant,a=e.readonly,r=o.useContext(fe).onChangeAnswer,i=o.useCallback((function(t,n){n&&r(t,e)}),[e,r]);if(void 0!==t&&!(t instanceof Date))return Object(ve.jsx)(h.e,{intent:"warning",children:Object(ve.jsxs)("h4",{children:["Value must be a ",Object(ve.jsx)(h.h,{children:"Date"})," for this field to work"]})});var l=void 0;return"string"===typeof e.defaultValue?l=bo.parseDate(e.defaultValue):e.defaultValue instanceof Date&&(l=e.defaultValue),Object(ve.jsx)(ho.a,Object(c.a)(Object(c.a)({},bo),{},{onChange:i,defaultValue:l||void 0,disabled:!1===n||a}))}function po(e){var t,n=e.node,a=e.debug,r=o.useContext(fe),i=r.onChangeCell,c=r.language,s=o.useState(),u=Object(l.a)(s,2),d=u[0],b=u[1],f=o.useCallback((function(e){i("survey",n.rowIndex,"hint",e,n),b(void 0)}),[n,i]);if(void 0===c)return null;var p=null===(t=n.row.hint)||void 0===t?void 0:t[c],j=void 0===d?p:d,v=""===(null===j||void 0===j?void 0:j.trim())?void 0:j;return void 0!==p&&""!==p&&Object(ve.jsxs)(h.e,{intent:"primary",children:[a&&Object(ve.jsx)(h.m,{multiline:!0,onChange:b,onConfirm:f,placeholder:"Enter a hint text in ".concat(r.languageName,"\u2026"),value:v,minWidth:100}),!a&&p]})||null}function jo(e){var t,n=e.schema,a=e.schemaKey,r=e.node,i=e.debug,c=e.relevant,s=e.isEditable,u=e.children,d=o.useContext(fe),b=null===(t=r.row.label)||void 0===t?void 0:t[d.language||"English (en)"],f=n.get(a,"label"),p=o.useContext(fe).onChangeCell,j=d.evaluationContext&&N(r,d.evaluationContext).join("/"),v=o.useState(),m=Object(l.a)(v,2),g=m[0],O=m[1],x=o.useCallback((function(e){e===b||void 0===b&&""===e||(p("survey",r.rowIndex,"label",e,r),O(void 0))}),[b,r,p]),y=s&&i?Object(ve.jsx)(h.m,{onChange:O,onConfirm:x,placeholder:"Enter a title for `".concat(r.row.name,"` in ").concat(d.languageName,"\u2026"),value:void 0===g?b:g,minWidth:100,confirmOnEnterKey:!0,multiline:!0}):f;return u?Object(ve.jsxs)(h.j,{style:{alignItems:"center"},lang:d.languageCode,children:[Object(ve.jsx)("span",{id:j,className:c?"":le.a.TEXT_DISABLED,style:{flex:1},children:i?y:Object(ve.jsx)(Tt,{children:f})}),u]}):Object(ve.jsx)("span",{id:j,className:c?"":le.a.TEXT_DISABLED,style:{flex:1},lang:d.languageCode,children:i?y:Object(ve.jsx)(Tt,{children:f})})}var vo=n(76),mo=n(208),go=n(209),Oo={quality:.5,maxWidth:800,maxHeight:600,autoRotate:!0,debug:!1,mimeType:"image/jpeg"};function xo(e,t){return new Promise((function(n){var o=document.createElement("img"),a=Object.assign({},Oo,t);o.src=URL.createObjectURL(e),o.onload=function(){if(a.autoRotate){a.debug&&console.log("browser-image-resizer: detecting image orientation...");var t=new FileReader;t.onload=function(){var e,r;try{var i=t.result;if(!(i instanceof ArrayBuffer))throw new Error("Buffer was not defined as Buffer object after reading.");r=go.a.load(i).Orientation}catch(c){throw console.log("Could not determine image orientation:",c),new Error("Could not determine image orientation.")}a.debug&&console.log("browser-image-resizer: image orientation from EXIF tag = "+r),n(yo(o,a,null===(e=r)||void 0===e?void 0:e.value)),URL.revokeObjectURL(o.src)},t.readAsArrayBuffer(e)}else a.debug&&console.log("browser-image-resizer: ignoring EXIF orientation tag because autoRotate is false..."),n(yo(o,a)),URL.revokeObjectURL(o.src)}}))}function yo(e,t){return wo.apply(this,arguments)}function wo(){return(wo=Object(_e.a)(Ie.a.mark((function e(t,n){var o,a,r,i=arguments;return Ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=i.length>2&&void 0!==i[2]?i[2]:1,(a=document.createElement("canvas")).width=t.width,a.height=t.height,Eo(a,o,t),r=ko(n,a);a.width>=2*r;)a=To(a);return a.width>r&&(a=Co(a,r)),e.abrupt("return",new Promise((function(e,t){a.toBlob((function(n){null==n?t():e(n)}),n.mimeType,n.quality)})));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ko(e,t){var n=t.width/t.height,o=Math.min(t.width,e.maxWidth,n*e.maxHeight);if(void 0!==e.maxSize&&e.maxSize>0&&e.maxSize<t.width*t.height/1e3&&(o=Math.min(o,Math.floor(1e3*e.maxSize/t.height))),e.scaleRatio&&(o=Math.min(o,Math.floor(e.scaleRatio*t.width))),e.debug&&(console.log("browser-image-resizer: original image size = "+t.width+" px (width) X "+t.height+" px (height)"),console.log("browser-image-resizer: scaled image size = "+o+" px (width) X "+Math.floor(o/n)+" px (height)")),o<=0)throw new Error("Image size is too small.");return o}function Eo(e,t,n){var o=e.getContext("2d");if(o){o.save();var a=e.width,r=e.style.width,i=e.height,c=e.style.height;switch(t>4&&(e.width=i,e.style.width=c,e.height=a,e.style.height=r),t){case 2:o.translate(a,0),o.scale(-1,1);break;case 3:o.translate(a,i),o.rotate(Math.PI);break;case 4:o.translate(0,i),o.scale(1,-1);break;case 5:o.rotate(.5*Math.PI),o.scale(1,-1);break;case 6:o.rotate(.5*Math.PI),o.translate(0,-i);break;case 7:o.rotate(.5*Math.PI),o.translate(a,-i),o.scale(-1,1);break;case 8:o.rotate(-.5*Math.PI),o.translate(-a,0)}o.drawImage(n,0,0),o.restore()}}function Co(e,t){var n,o,a,r=document.createElement("canvas"),i=t/e.width;r.width=e.width*i,r.height=e.height*i;var c=null===(n=e.getContext("2d"))||void 0===n?void 0:n.getImageData(0,0,e.width,e.height);if(!c)throw new Error("Could not reduce image size (Could not get original image data).");var l=null===(o=r.getContext("2d"))||void 0===o?void 0:o.createImageData(r.width,r.height);if(!l)throw new Error("Could not reduce image size (Could not get resized image data).");return function(e,t,n){function o(e,t,n,o,a,r){var i=1-a,c=1-r;return e*i*c+t*a*c+n*i*r+o*a*r}var a,r,i,c,l,s,u,d,h,b,f,p,j,v,m,g,O,x,y;for(a=0;a<t.height;++a)for(i=a/n,c=Math.floor(i),l=Math.ceil(i)>e.height-1?e.height-1:Math.ceil(i),r=0;r<t.width;++r)s=r/n,u=Math.floor(s),d=Math.ceil(s)>e.width-1?e.width-1:Math.ceil(s),h=4*(r+t.width*a),b=4*(u+e.width*c),f=4*(d+e.width*c),p=4*(u+e.width*l),j=4*(d+e.width*l),v=s-u,m=i-c,g=o(e.data[b],e.data[f],e.data[p],e.data[j],v,m),t.data[h]=g,O=o(e.data[b+1],e.data[f+1],e.data[p+1],e.data[j+1],v,m),t.data[h+1]=O,x=o(e.data[b+2],e.data[f+2],e.data[p+2],e.data[j+2],v,m),t.data[h+2]=x,y=o(e.data[b+3],e.data[f+3],e.data[p+3],e.data[j+3],v,m),t.data[h+3]=y}(c,l,i),null===(a=r.getContext("2d"))||void 0===a||a.putImageData(l,0,0),r}function To(e){var t=document.createElement("canvas");t.width=e.width/2,t.height=e.height/2;var n=t.getContext("2d");if(!n)throw new Error("Could not reduce image size (<canvas> error).");return n.drawImage(e,0,0,t.width,t.height),t}var No={quality:.8,maxWidth:1600,maxHeight:1600,autoRotate:!0,debug:!0,mimeType:"image/jpeg"},So="https://v2.accessibility.cloud",Ao="bc47a6c8aef760ffff1fd80d7db38c8f";function Ro(e,t){return"".concat("https://v2.accessibility.cloud","/images/scale/").concat(e.remotePath,"?fitw=").concat(t,"&fith=").concat(t)}function Lo(){return(Lo=Object(_e.a)(Ie.a.mark((function e(t,n){var o,a,r,i,c,l;return Ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o="".concat(So,"/image-upload/survey-result/image?surveyResultId=").concat(t,"&appToken=").concat(Ao),e.next=3,xo(n,No);case 3:return a=e.sent,e.next=6,fetch(o,{method:"POST",headers:{Accept:"application/json","Content-Type":"image/jpeg"},body:a});case 6:return r=e.sent,e.next=9,r.json();case 9:if(i=e.sent,r.ok){e.next=12;break}throw new Error((null===(c=i.error)||void 0===c?void 0:c.reason)||i.error);case 12:if(i.success){e.next=15;break}throw l="Sorry, your upload failed: ".concat(String(i.error)),new Error(l);case 15:if(i.result){e.next=18;break}throw"Sorry, your upload failed: Empty server response.",new Error("Sorry, your upload failed: Empty server response.");case 18:return e.abrupt("return",i.result);case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Io(e){var t=e.contentUrl,n=e.uuid,o=e.onChangeCaption,a=e.onRemoveImage;return Object(ve.jsxs)(h.f,{interactive:!1,elevation:vo.a.ONE,children:[Object(ve.jsx)("img",{src:t,alt:"The image you uploaded",style:{maxWidth:"100%",maxHeight:"calc(40vh)",boxShadow:"0 0 1px rgba(0, 0, 0, 0.5)",marginBottom:"16px"}}),Object(ve.jsx)(h.j,{fill:!0,children:Object(ve.jsx)(h.o,{label:"Please describe what is on this image.",labelFor:"imagecaption-".concat(n),style:{display:"flex"},children:Object(ve.jsx)(h.A,{id:"imagecaption-".concat(n),placeholder:"",large:!0,onChange:o,pattern:"[\\w\\d_-]+"})})}),Object(ve.jsx)(h.j,{style:{},children:Object(ve.jsx)(h.c,{intent:"danger",icon:"trash",outlined:!0,onClick:a,large:!0,children:"Remove image"})})]})}function _o(e){var t=e.value,n=e.schemaKey,a=e.relevant,r=e.readonly,i=o.useContext(fe).onChangeAnswer,s=o.useState(Object(mo.uuid)()),u=Object(l.a)(s,1)[0],d=o.useCallback((function(n){var o=n.currentTarget.value;i(Object(c.a)(Object(c.a)({},t),{},{caption:o}),e)}),[i,e,t]),b=o.useCallback((function(){i(void 0,e)}),[i,e]),f=o.useCallback((function(t){var n,o=null===(n=t.currentTarget.files)||void 0===n?void 0:n[0];o?(!function(e){Qt.show({message:Object(ve.jsx)(ve.Fragment,{children:"Uploading image"}),icon:Object(ve.jsx)(h.j,{style:{alignSelf:"center",marginLeft:"8px"},children:Object(ve.jsx)(h.N,{size:h.N.SIZE_SMALL})}),timeout:0},e)}(u),i(function(e){return{"@type":"ImageObject",contentSize:String(e.size),contentUrl:URL.createObjectURL(e),encodingFormat:"image/jpeg"}}(o),e),function(e,t){return Lo.apply(this,arguments)}(u,o).then((function(t){i(function(e){return{"@type":"ImageObject",contentSize:String(e.contentSize),contentUrl:Ro(e,1600),encodingFormat:"image/jpeg",height:"".concat(e.dimensions.height,"px"),width:"".concat(e.dimensions.width,"px"),thumbnail:{"@type":"ImageObject",contentUrl:Ro(e,256),encodingFormat:"image/jpeg",height:"256px",width:"256px"}}}(t),e),Qt.show({message:"Upload successful!",intent:"success",timeout:5e3},u)})).catch((function(e){var t="Sorry, your upload failed: ".concat(e);console.error(t),function(e,t){Qt.show({message:e,intent:"danger",timeout:0},t)}(t,u),b()}))):b()}),[u,i,e,b]),p=t&&Object(ve.jsx)(Io,{contentUrl:t.contentUrl,onChangeCaption:d,onRemoveImage:b,uuid:u});return Object(ve.jsxs)(ve.Fragment,{children:[!t&&Object(ve.jsx)(h.n,{id:n,disabled:!1===a||r,large:!0,onInputChange:f,inputProps:{multiple:!1,accept:"image/jpeg, image/png"}}),p]})}var Fo=n(106),Do=n.n(Fo),Mo=(n(461),n(155)),Po=n(215);var Uo,Bo,Go,zo=function(e){var t;return t={},Object(Fe.a)(t,e,{type:Object}),Object(Fe.a)(t,"".concat(e,".@type"),{type:String,allowedValues:["GeoCoordinates"],defaultValue:"GeoCoordinates"}),Object(Fe.a)(t,"".concat(e,".latitude"),{type:Number}),Object(Fe.a)(t,"".concat(e,".longitude"),{type:Number}),t};Do.a.workerClass=Po.a,Do.a.accessToken="pk.eyJ1Ijoic296aWFsaGVsZGVuIiwiYSI6IkdUY09sSmsifQ.6vkpci46vdS7m5Jeb_YTbA";var Vo=p.a.section(Uo||(Uo=Object(s.a)(["\n  .mapboxgl-ctrl-group.geolocateControl {\n    display: inline-block;\n    margin: 8px;\n  }\n\n  > footer {\n    width: 100%;\n    margin-top: 8px;\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    justify-content: space-between;\n    label {\n      margin: 0.5rem;\n    }\n    input {\n      width: 8rem !important;\n    }\n  }\n"]))),Ho=p.a.section(Bo||(Bo=Object(s.a)(["\n  width: 100%;\n  height: 500px;\n  border: 1px solid rgba(0, 0, 0, 0.2);\n  overflow: hidden;\n  position: relative;\n"]))),Wo=p.a.div(Go||(Go=Object(s.a)(["\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n  width: 15px;\n  height: 15px;\n  border: 3px solid white;\n  border-radius: 10px;\n  box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2), 0 0 1px rgba(0, 0, 0, 0.4);\n  background-color: ",";\n"])),f.a.FOREST3);function Ko(e){return{"@type":"GeoCoordinates",longitude:Number(e[0].toFixed(6)),latitude:Number(e[1].toFixed(6))}}function Xo(e){return e.latitude}function $o(e){return e.longitude}var qo=function(e){var t,n=e.value;void 0!==(t=n)&&new de.a(zo("point")).validate({point:t});var a=o.useContext(fe),r=a.onChangeAnswer,i=o.useState({width:100,height:100,latitude:n&&Xo(n)||37.7577,longitude:n&&$o(n)||-122.4376,zoom:10}),s=Object(l.a)(i,2),u=s[0],d=s[1],b=o.useCallback(Object(w.throttle)((function(e,t){r(e,t)}),500),[r]),p=o.useCallback((function(t,n){if(d(Object(c.a)(Object(c.a)({},u),t)),u.longitude&&u.latitude){var o=Ko([u.longitude,u.latitude]);b(o,e)}}),[u,b,e]),j=o.useCallback((function(t,n){if(u.longitude&&u.latitude){d(Object(c.a)(Object(c.a)({},u),{},{latitude:t}));var o=Ko([u.longitude,t]);r(o,e)}}),[u,r,e]),v=o.useCallback((function(t,n){if(u.longitude&&u.latitude){d(Object(c.a)(Object(c.a)({},u),{},{longitude:t}));var o=Ko([t,u.latitude]);r(o,e)}}),[u,r,e]),m=Oe(),g=n&&Xo(n),O=n&&$o(n);return Object(ve.jsxs)(Vo,{children:[Object(ve.jsxs)(Ho,{children:[Object(ve.jsx)(Mo.b,Object(c.a)(Object(c.a)({longitude:O,latitude:g},u),{},{mapboxApiAccessToken:"pk.eyJ1Ijoic296aWFsaGVsZGVuIiwiYSI6IkdUY09sSmsifQ.6vkpci46vdS7m5Jeb_YTbA",width:"100%",height:"100%",onViewportChange:p,mapStyle:m?"mapbox://styles/mapbox/streets-dark-v10":"mapbox://styles/mapbox/streets-v10",children:Object(ve.jsx)(Mo.a,{style:{margin:"8px",boxShadow:"0 2px 2px ".concat(ye(f.a.DARK_GRAY4,.2),", 0 2px 10px ").concat(ye(f.a.DARK_GRAY4,.3))},className:"geolocateControl",positionOptions:{enableHighAccuracy:!0},trackUserLocation:!1,showUserLocation:!0})})),Object(ve.jsx)(Wo,{})]}),a.debug&&Object(ve.jsxs)(h.j,{style:{alignItems:"center",margin:"8px 0"},children:[Object(ve.jsxs)(h.j,{vertical:!0,children:[Object(ve.jsx)("label",{htmlFor:"".concat(e.schemaKey,"-latitude"),children:"Latitude"}),Object(ve.jsx)(h.H,{style:{width:"8em"},stepSize:.001,minorStepSize:1e-4,majorStepSize:.01,min:-90,max:90,value:g,asyncControl:!0,disabled:e.readonly,id:"".concat(e.schemaKey,"-latitude"),onValueChange:j})]}),Object(ve.jsxs)(h.j,{vertical:!0,style:{marginLeft:"16px"},children:[Object(ve.jsx)("label",{htmlFor:"".concat(e.schemaKey,"-longitude"),children:"Longitude"}),Object(ve.jsx)(h.H,{style:{width:"8em"},stepSize:.001,minorStepSize:1e-4,majorStepSize:.01,min:-180,max:180,asyncControl:!0,value:O,disabled:e.readonly,id:"".concat(e.schemaKey,"-longitude"),onValueChange:v})]})]})]})};function Yo(e){var t=e.value,n=e.schemaKey,a=e.relevant,r=e.readonly,i=o.useContext(fe).onChangeAnswer,c=o.useCallback((function(t){i(t,e)}),[e,i]);return void 0!==t&&"string"!==typeof t&&"number"!==typeof t?Object(ve.jsx)(h.e,{intent:"warning",children:Object(ve.jsxs)("h4",{children:["Value must be a ",Object(ve.jsx)(h.h,{children:"number"})," for this field to work."]})}):Object(ve.jsx)(h.H,{id:n,disabled:!1===a||r,name:n,large:!0,allowNumericCharactersOnly:!1,placeholder:"Enter a number\u2026",value:t,onValueChange:c,defaultValue:"number"===typeof e.defaultValue||"string"===typeof e.defaultValue?e.defaultValue:void 0})}var Jo,Qo,Zo,ea,ta,na=n(17);function oa(e){var t=e.value,n=e.onInputChange,a=e.node,r=e.relevant,i=e.readonly,c=o.useContext(fe),l=c.language,s=c.xlsForm,u=c.evaluationContext;if(void 0!==t&&"string"!==typeof t)return Object(ve.jsx)(h.e,{intent:"warning",children:Object(ve.jsxs)("h4",{children:["Value must be a ",Object(ve.jsx)(h.h,{children:"string"})," for this field to work"]})});if(void 0===l||void 0===s||void 0===c||void 0===u)return null;if(c.debug&&0===a.typeParameters.length)return Object(ve.jsx)(h.e,{intent:"warning",children:Object(ve.jsxs)(h.j,{fill:!0,children:[Object(ve.jsx)(h.s,{children:"No choice list set."}),Object(ve.jsx)("div",{className:na.FLEX_EXPANDER}),Object(ve.jsx)(Wt,{node:a,showType:!1})]})});var d=a.typeParameters.map((function(e){var t;return null===(t=c.xlsForm)||void 0===t?void 0:t.choicesByName[e]})),b=so({node:a,xlsForm:s,context:u,key:S(a,u,".")});b instanceof Array||(b=b());var f=new Set(b);return Object(ve.jsx)(h.L,{onChange:n,selectedValue:void 0!==t&&f.has(t)?t:void 0,inline:!0,disabled:!1===r||i,children:d.flatMap((function(e){return e&&Object.keys(e).flatMap((function(t){var n;if(!f.has(t))return null;var o=void 0===t||null===e||void 0===e?void 0:e[t],a=null===o||void 0===o||null===(n=o.label)||void 0===n?void 0:n[l],r="undefined"===a?null===o||void 0===o?void 0:o.name:a;return Object(ve.jsx)(h.K,{label:r,value:null===o||void 0===o?void 0:o.name,inline:!0,large:!0},null===o||void 0===o?void 0:o.name)})).filter(Boolean)}))})}function aa(e){var t=e.value,n=e.schemaKey,o=e.relevant,a=e.readonly;return void 0!==t&&"string"!==typeof t&&"number"!==typeof t?Object(ve.jsx)(h.e,{intent:"warning",children:Object(ve.jsxs)("h4",{children:["Value must be a ",Object(ve.jsx)(h.h,{children:"string"})," or ",Object(ve.jsx)(h.h,{children:"number"})," for this field to work."]})}):Object(ve.jsx)(h.A,{id:n,disabled:!1===o||a,name:n,placeholder:"",large:!0,onChange:e.onInputChange,defaultValue:"string"===typeof e.defaultValue?e.defaultValue:void 0})}function ra(e){var t=e.node,n={integer:Yo,decimal:Yo,range:Yo,text:aa,select_one:oa,select_one_from_file:oa,select_multiple:uo,select_multiple_from_file:uo,rank:aa,note:aa,geopoint:qo,geotrace:aa,geoshape:aa,date:fo,time:fo,datetime:fo,image:_o,audio:_o,video:_o,file:_o,barcode:aa,calculate:lo,acknowledge:co,hidden:aa,"xml-external":aa,start:fo,end:fo,today:fo,deviceid:aa,simserial:aa,subscriberid:aa,phonenumber:aa,username:aa,email:aa,audit:aa}[t.type]||aa;return Object(ve.jsx)(n,Object(c.a)({},e))}function ia(e){var t,n,a=e.node,r="acknowlege"===e.node.type,i=o.useContext(fe),l=i.language,s=i.debug,u=i.evaluationContext,d=i.onChangeAnswer,b=o.useCallback((function(t){var n=t.currentTarget,o={checkbox:n.checked,date:n.valueAsDate,number:n.valueAsNumber,text:n.value,radio:n.value}[n.type];d(o,e)}),[d,e]);if(!l||!u)return null;var f=Ne.includes(a.type);if(f&&!i.debug)return null;var p=Object(ve.jsx)(sn,Object(c.a)(Object(c.a)({},Object(c.a)({},e)),{},{editable:!0})),j=Object(ve.jsx)(po,{node:a,debug:s}),v=Object(ve.jsx)(jo,Object(c.a)(Object(c.a)({},Object(c.a)(Object(c.a)({},e),{},{debug:s,isEditable:!r&&!f})),{},{children:!r&&s&&p})),m=null===(t=i.evaluationContext)||void 0===t?void 0:t.evaluationResults.get(a),g=Object(c.a)(Object(c.a)({},e),{},{labelElement:v,onInputChange:b,value:null===m||void 0===m||null===(n=m.get("calculation"))||void 0===n?void 0:n.result,defaultValue:a.row.default}),O=Object(ve.jsx)(ra,Object(c.a)({},g));return r?Object(ve.jsxs)(h.o,{labelFor:a.row.name,style:{display:"flex"},children:[s&&p,O,j]}):"note"===a.type?Object(ve.jsx)(h.e,{intent:"primary",style:{marginBottom:"16px"},children:v}):Object(ve.jsx)(Ce.Provider,{value:{node:a,nodeEvaluationResults:m},children:Object(ve.jsx)(h.o,{label:v,labelFor:a.row.name,children:Object(ve.jsxs)(io,{children:[O,Object(ve.jsx)(po,{node:a,debug:s})]})})})}function ca(e){var t,n,a=o.useContext(fe).onChangeCell,r=e.schema,i=e.schemaKey,s=e.node,u=["image","audio","video","geopoint","geotrace","geoshape"].includes(s.type)?[]:r.objectKeys(i),d=o.useContext(fe),b=d.debug,f=r.get(i,"label"),p=d.evaluationContext&&N(s,d.evaluationContext).join("/"),j=o.useState(),v=Object(l.a)(j,2),m=v[0],g=v[1],O=o.useCallback((function(e){e===f||void 0===f&&""===e||(a("survey",s.rowIndex,"label",e,s),g(void 0))}),[s,a,f]),x=s!==(null===(t=d.evaluationContext)||void 0===t?void 0:t.survey)&&Object(ve.jsx)(h.m,{multiline:!0,onChange:g,onConfirm:O,confirmOnEnterKey:!0,placeholder:"Enter a title for `".concat(s.row.name,"`in ").concat(d.languageName,"\u2026"),value:void 0===m?f:m,minWidth:100}),y=[h.p,h.q,h.r,h.s,h.t][s.indentationLevel]||h.t;return Ae(s,d.evaluationContext)||b?Object(ve.jsxs)(h.j,{vertical:!0,style:{padding:"".concat(6/(s.indentationLevel+1),"rem 0")},children:[Object(ve.jsxs)(h.j,{fill:!1,style:{alignItems:"baseline"},children:[Object(ve.jsx)(y,{style:{flex:1},id:p,children:b?Object(ve.jsx)(ve.Fragment,{children:x}):f}),b&&s!==(null===(n=d.evaluationContext)||void 0===n?void 0:n.survey)&&Object(ve.jsx)(sn,Object(c.a)(Object(c.a)({},Object(c.a)({},e)),{},{editable:!0}))]}),Object(ve.jsx)(po,{node:s,debug:b}),u.map((function(t){return Object(ve.jsx)(fa,{schemaKey:[i,t].join("."),relevant:e.relevant,readonly:e.readonly},t)}))]}):null}function la(e){return Object(ve.jsx)(h.e,{intent:"warning",children:Object(ve.jsx)("h4",{children:"Object arrays are not implemented yet."})})}var sa=p.a.div(Jo||(Jo=Object(s.a)(['\n  &:after {\n    content: "";\n    position: absolute;\n    left: 0px;\n    width: 1px;\n    bottom: 0;\n    top: 0;\n    background-color: transparent;\n  }\n']))),ua=p.a.div(Qo||(Qo=Object(s.a)(["\n  position: absolute;\n  left: 0px;\n  height: 44px;\n  width: 44px;\n  background-color: transparent;\n  cursor: pointer;\n"]))),da=Object(p.a)(ua)(Zo||(Zo=Object(s.a)(["\n  top: 0;\n  &:hover {\n    background: linear-gradient(\n      135deg,\n      ",",\n      "," 50%\n    );\n  }\n"])),ye(f.a.BLUE3,.3),ye(f.a.BLUE3,0)),ha=Object(p.a)(ua)(ea||(ea=Object(s.a)(["\n  bottom: 0;\n  &:hover {\n    background: linear-gradient(\n      45deg,\n      ",",\n      "," 50%\n    );\n  }\n"])),ye(f.a.BLUE3,.3),ye(f.a.BLUE3,0)),ba=p.a.div(ta||(ta=Object(s.a)(["\n  padding: 16px 16px 8px;\n  margin: 0;\n  position: relative;\n\n  &:not(:hover):not(:focus-within) {\n    "," {\n      background: none;\n    }\n  }\n  &:hover,\n  :focus-within {\n    background: ",";\n\n    "," {\n      &:after {\n        background: ",";\n      }\n    }\n  }\n"])),sa,ye(f.a.BLUE3,.03),sa,ye(f.a.BLUE3,.1));function fa(e){var t=e.schemaKey,n=o.useContext(fe),a=n.schema,r=n.evaluationContext,i=n.debug,l=["."].concat(Object(g.a)(t.replace(/\.\$/g,"").split("."))),s=(null===r||void 0===r?void 0:r.survey)&&C(l,r,r.survey),u=nn(s instanceof Array?void 0:s),d=u.nodeActionMenuItems,b=u.nodeActionDialogs;if(!r||!a)return null;if(s instanceof Array)return i?Object(ve.jsx)(h.e,{intent:"warning",children:Object(ve.jsxs)(h.s,{children:["Found multiple nodes with path ",Object(ve.jsx)(h.h,{children:l.join("/")}),". This should not happen."]})}):null;if(!s)return i?Object(ve.jsx)(h.e,{intent:"warning",children:Object(ve.jsxs)(h.s,{children:["No node found for"," ",Object(ve.jsx)(h.h,{children:l[l.length-1]})]})}):null;var f=e.relevant;if("boolean"!==typeof f||!0===f){var p,j=null===(p=r.evaluationResults.get(s))||void 0===p?void 0:p.get("relevant");f="boolean"===typeof(null===j||void 0===j?void 0:j.result)?j.result:null!==(null===j||void 0===j?void 0:j.result)}var v=!1;if("undefined"!==typeof e.readonly||!0===e.readonly){var m,O=null===(m=r.evaluationResults.get(s))||void 0===m?void 0:m.get("readonly");v="boolean"===typeof(null===O||void 0===O?void 0:O.result)?O.result:e.readonly}var x,y={schema:a,node:s,schemaKey:t,relevant:f,readonly:v};if(!i&&!f)return null;switch(s.type){case void 0:case"":case"begin_group":x=Object(ve.jsx)(ca,Object(c.a)({},y));break;case"begin_repeat":x=Object(ve.jsx)(la,Object(c.a)({},y));break;default:x=Object(ve.jsx)(ia,Object(c.a)({},y))}if(i&&s!==r.survey){var w=Object(ve.jsx)(h.C,{children:d});return Object(ve.jsxs)(ve.Fragment,{children:[b,Object(ve.jsx)(ro.a,{content:w,children:Object(ve.jsxs)(ba,{children:[Object(ve.jsx)(sa,{}),Object(ve.jsx)(pe.a,{content:Object(ve.jsxs)("ul",{className:le.a.LIST_UNSTYLED,children:[Object(ve.jsx)(en,{icon:"arrow-up",node:s,position:"before",group:!1}),Object(ve.jsx)(en,{icon:"arrow-up",node:s,position:"before",group:!0}),Object(ve.jsx)(h.D,{}),d]}),lazy:!0,interactionKind:"click",placement:"left",renderTarget:function(e){e.isOpen;var t=e.ref,n=Object(ao.a)(e,["isOpen","ref"]);return Object(ve.jsx)(da,Object(c.a)(Object(c.a)({},n),{},{ref:t}))},hoverOpenDelay:0,hoverCloseDelay:0}),Object(ve.jsx)(pe.a,{content:Object(ve.jsxs)("ul",{className:le.a.LIST_UNSTYLED,children:[d,Object(ve.jsx)(h.D,{}),Object(ve.jsx)(en,{icon:"arrow-down",node:s,position:"after",group:!1}),Object(ve.jsx)(en,{icon:"arrow-down",node:s,position:"after",group:!0})]}),lazy:!0,interactionKind:"click",placement:"left",renderTarget:function(e){e.isOpen;var t=e.ref,n=Object(ao.a)(e,["isOpen","ref"]);return Object(ve.jsx)(ha,Object(c.a)(Object(c.a)({},n),{},{ref:t}))},hoverOpenDelay:0,hoverCloseDelay:0}),x]})})]})}return x}function pa(e){return Object(ve.jsx)("div",{props:e,style:Object(c.a)({margin:"".concat(e.horizontal,"rem ").concat(e.vertical,"rem")},e.style),children:e.children})}var ja,va,ma=n(486),ga=n(111),Oa=n(484),xa=n(216),ya=Object(p.a)(ma.a)(ja||(ja=Object(s.a)(["\n  flex: 1;\n  width: 33.33333vw;\n"])));function wa(e){var t=e.language,n=e.xlsForm,a=e.worksheetName,r=o.useContext(fe).onChangeCell,i=n.worksheets[e.worksheetName],l=null===i||void 0===i?void 0:i.rows.length,s=o.useMemo((function(){return Object(w.uniq)(null===i||void 0===i?void 0:i.columnNamesNormalized.map((function(e){return e.replace(/::.*$/,"")})))}),[i]),u=o.useCallback((function(e,t,o){if(void 0!==o&&void 0!==t){var c=null===i||void 0===i?void 0:i.rows[t];if(!c)throw new Error("Tried to change a row that doesn\u2019t exist");var l=s[o];c[l]!==e&&r(a,t,l,e,n.flatNodes[t])}}),[s,r,null===i||void 0===i?void 0:i.rows,a,n.flatNodes]),d=o.useMemo((function(){return function(e,n){return ct.includes(e)?Object(ve.jsxs)(ve.Fragment,{children:[e,Object(ve.jsxs)("span",{className:le.a.TEXT_MUTED,children:["::",t]})]}):Object(ve.jsx)(ve.Fragment,{children:e})}}),[t]),b=o.useMemo((function(){return function(e){return Object(ve.jsx)(ga.a,{nameRenderer:d,name:s[e]})}}),[d,s]),f=o.useMemo((function(){return function(e,r){var c=null===i||void 0===i?void 0:i.rows[e];if(!c)return Object(ve.jsx)(ve.Fragment,{});var l=s[r],d=c[l],h="survey"===a?n.flatNodes[e]:void 0,b=[a,e,l].join("-");return void 0!==d&&"string"!==typeof d?ct.includes(l)?Object(o.createElement)(Oa.a,{rowIndex:e,columnIndex:r,onConfirm:u,value:d[t],key:b}):Object(o.createElement)(Oa.a,{rowIndex:e,columnIndex:r,onConfirm:u,value:JSON.stringify(d),key:b}):Object(o.createElement)(Oa.a,{rowIndex:e,columnIndex:r,onConfirm:u,value:d,key:b,style:["type","name"].includes(l)?{paddingLeft:"".concat(4+8*((null===h||void 0===h?void 0:h.indentationLevel)||0),"px")}:{}},d)}}),[null===i||void 0===i?void 0:i.rows,s,a,n.flatNodes,u,t]);return i?Object(ve.jsx)(ya,{numRows:l,enableRowResizing:!1,children:s.map((function(e){return Object(ve.jsx)(xa.a,{name:e,cellRenderer:f,columnHeaderCellRenderer:b},e)}))}):Object(ve.jsx)(In,{style:Object(c.a)({},e.style),children:Object(ve.jsxs)(h.e,{intent:"warning",children:["No ",e.worksheetName," sheet defined"]})})}var ka=p.a.div(va||(va=Object(s.a)(['\n  /* background-color: #d5e0e7; */\n  .bp3-tabs {\n    display: flex;\n    flex-direction: column-reverse;\n    flex: 1;\n    overflow: hidden;\n    .bp3-tab-list {\n      padding: 0px 16px 0 16px;\n      .bp3-tab-indicator-wrapper {\n        background: #f6f7f7;\n        @media (prefers-color-scheme: dark) {\n          background: #30404d;\n        }\n        .bp3-tab-indicator {\n          /* bottom: unset; */\n          border-bottom-left-radius: 4px;\n          border-bottom-right-radius: 4px;\n          box-shadow: 0 0 0 1px rgba(16, 22, 26, 0.1),\n            0 2px 4px rgba(16, 22, 26, 0.2), 0 8px 24px rgba(16, 22, 26, 0.2);\n        }\n      }\n      [role="tab"] {\n        padding: 4px 16px 4px;\n        margin-bottom: 8px;\n        border-bottom-left-radius: 4px;\n        border-bottom-right-radius: 4px;\n      }\n    }\n    .bp3-tab-panel {\n      margin: 0;\n      overflow: auto;\n      flex: 1;\n      &[aria-hidden="false"] {\n        box-shadow: 0 0 0 1px rgba(159, 183, 194, 0.1),\n          0 2px 4px rgba(159, 183, 194, 0.2), 0 4px 8px rgba(159, 183, 194, 0.1);\n        @media (prefers-color-scheme: dark) {\n          box-shadow: 0 0 0 1px rgba(12, 20, 24, 0.1),\n            0 2px 4px rgba(12, 20, 24, 0.2), 0 4px 8px rgba(12, 20, 24, 0.1);\n        }\n        display: flex;\n      }\n    }\n  }\n'])));function Ea(e){var t=Object(o.useState)("survey"),n=Object(l.a)(t,2),a=n[0],r=n[1],i=Object(o.useCallback)((function(e){r(e)}),[]);return Object(ve.jsx)(ka,{style:e.style,children:Object(ve.jsxs)(h.P,{id:"TabsExample",onChange:i,selectedTabId:a,renderActiveTabPanelOnly:!1,children:[Object(ve.jsx)(h.O,{id:"survey",title:"Survey",panel:Object(ve.jsx)(wa,Object(c.a)({},Object(c.a)(Object(c.a)({},e),{},{worksheetName:"survey"})))}),Object(ve.jsx)(h.O,{id:"choices",title:"Choices",panel:Object(ve.jsx)(wa,Object(c.a)({},Object(c.a)(Object(c.a)({},e),{},{worksheetName:"choices"})))}),Object(ve.jsx)(h.O,{id:"settings",title:"Settings",panel:Object(ve.jsx)(wa,Object(c.a)({},Object(c.a)(Object(c.a)({},e),{},{worksheetName:"settings"})))})]})})}function Ca(e,t){return function(){return void 0!==e.row.relevant&&""!==e.row.relevant&&!Yn(e.row.relevant,t,e)||!(void 0===e.row.required||""===e.row.required||Yn(e.row.required,t,e))}}function Ta(e,t,n){return!!e.match(/\${([^}]+)}/)?function(){return e.replaceAll(/\${([^}]+)}/g,(function(e,o,a){try{var r=e,i=Wn(new $([{type:_.NAME,text:r,index:a}],o,e),t,n);return String(i)}catch(c){if(c instanceof F)return c.toMarkdown();throw c}}))}:e}var Na,Sa,Aa=function(e,t){var n;return n={},Object(Fe.a)(n,e,Object(c.a)({type:Object},t)),Object(Fe.a)(n,"".concat(e,".maxValue"),{type:Number,optional:!0}),Object(Fe.a)(n,"".concat(e,".minValue"),{type:Number,optional:!0}),Object(Fe.a)(n,"".concat(e,".unitCode"),{type:Text,optional:!0}),Object(Fe.a)(n,"".concat(e,".unitText"),{type:Text,optional:!0}),Object(Fe.a)(n,"".concat(e,".value"),{type:de.a.oneOf(Number,String,Boolean)}),n},Ra=function(e,t){var n;return Object(c.a)(Object(c.a)((n={},Object(Fe.a)(n,e,Object(c.a)({type:Object},t)),Object(Fe.a)(n,"".concat(e,".@type"),{type:String,allowedValues:["MediaObject"],defaultValue:"MediaObject"}),Object(Fe.a)(n,"".concat(e,".bitrate"),{type:String,label:"The bitrate of the media object.",optional:!0}),Object(Fe.a)(n,"".concat(e,".contentSize"),{type:String,label:"File size in (mega/kilo) bytes.",optional:!0}),Object(Fe.a)(n,"".concat(e,".contentUrl"),{type:String,regEx:de.a.RegEx.Url,label:"Actual bytes of the media object, for example the image file or video file."}),Object(Fe.a)(n,"".concat(e,".duration"),{type:String,label:"The duration of the item (movie, audio recording, event, etc.) in ISO 8601 date format.",optional:!0}),Object(Fe.a)(n,"".concat(e,".embedUrl"),{type:String,regEx:de.a.RegEx.Url,label:"A URL pointing to a player for a specific video. In general, this is the information in the src element of an embed tag and should not be the same as the content of the loc tag.",optional:!0}),Object(Fe.a)(n,"".concat(e,".encodingFormat"),{type:String,label:"Media type typically expressed using a MIME format (see IANA site and MDN reference) e.g. application/zip for a SoftwareApplication binary, audio/mpeg for .mp3 etc.)."}),Object(Fe.a)(n,"".concat(e,".endTime"),{type:Date,label:"the time offset of the end of a clip within a larger file.",optional:!0}),Object(Fe.a)(n,"".concat(e,".startTime"),{type:Date,label:"the time offset of the start of a clip within a larger file.",optional:!0}),Object(Fe.a)(n,"".concat(e,".uploadDate"),{type:Date,label:"Date when this media object was uploaded to this site.",optional:!0}),n),Aa("".concat(e,".height"),{type:de.a.oneOf(String,Object),label:"The height of the item.",optional:!0})),Aa("".concat(e,".width"),{type:de.a.oneOf(String,Object),label:"The width of the item.",optional:!0}))},La=function e(t){var n,o,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0;return Object(c.a)(Object(c.a)(Object(c.a)((n={},Object(Fe.a)(n,t,Object(c.a)({type:Object},r)),Object(Fe.a)(n,"".concat(t,".@type"),{type:String,allowedValues:["ImageObject"],defaultValue:"ImageObject"}),n),Ra(t)),{},(o={},Object(Fe.a)(o,"".concat(t,".exifData"),{type:Object,label:"EXIF data for this object.",blackbox:!0,optional:!0}),Object(Fe.a)(o,"".concat(t,".representativeOfPage"),{type:Boolean,label:"Indicates whether this image is representative of the content of the page.",optional:!0}),o),Ra("".concat(t,".caption"),{label:"The caption for this object. For downloadable machine formats (closed caption, subtitles etc.) use MediaObject and indicate the encodingFormat.",optional:!0})),a?e("".concat(t,".thumbnail"),!1,{label:"Thumbnail image for an image or video.",optional:!0}):{})},Ia={"":function(){return{}},integer:function(e){return Object(Fe.a)({},e.key,{type:de.a.Integer})},decimal:function(e){return Object(Fe.a)({},e.key,{type:Number})},range:function(e){return Object(Fe.a)({},e.key,{type:Number})},text:function(e){return Object(Fe.a)({},e.key,{type:String})},select_one:function(e){return Object(Fe.a)({},e.key,{type:String,allowedValues:so(e)})},select_multiple:function(e){var t;return t={},Object(Fe.a)(t,e.key,{type:Array}),Object(Fe.a)(t,e.key+".$",{type:String,allowedValues:so(e)}),t},select_one_from_file:function(e){return Object(Fe.a)({},e.key,{type:String})},select_multiple_from_file:function(e){var t;return t={},Object(Fe.a)(t,e.key,{type:Array}),Object(Fe.a)(t,e.key+".$",{type:String}),t},rank:function(e){return Object(Fe.a)({},e.key,{type:String})},note:function(e){return Object(Fe.a)({},e.key,{type:String})},geopoint:function(e){return zo(e.key)},geotrace:function(e){return function(e){var t;return t={},Object(Fe.a)(t,e,{type:Object}),Object(Fe.a)(t,"".concat(e,".@type"),{type:String,allowedValues:["GeoShape"],defaultValue:"GeoShape"}),Object(Fe.a)(t,"".concat(e,".line"),{type:String}),t}(e.key)},geoshape:function(e){return function(e){var t;return t={},Object(Fe.a)(t,e,{type:Object}),Object(Fe.a)(t,"".concat(e,".@type"),{type:String,allowedValues:["GeoShape"],defaultValue:"GeoShape"}),Object(Fe.a)(t,"".concat(e,".polygon"),{type:String}),t}(e.key)},date:function(e){return Object(Fe.a)({},e.key,{type:Date})},time:function(e){return Object(Fe.a)({},e.key,{type:Date})},datetime:function(e){return Object(Fe.a)({},e.key,{type:Date})},image:function(e){return La(e.key)},audio:function(e){return function(e,t){var n;return Object(c.a)(Object(c.a)((n={},Object(Fe.a)(n,e,Object(c.a)({type:Object},t)),Object(Fe.a)(n,"".concat(e,".@type"),{type:String,allowedValues:["AudioObject"],defaultValue:"AudioObject"}),n),Ra(e)),{},Object(Fe.a)({},"".concat(e,".transcript"),{type:String,optional:!0}),Ra("".concat(e,".caption"),{type:de.a.oneOf(String,Object),label:"The caption for this object. For downloadable machine formats (closed caption, subtitles etc.) use MediaObject and indicate the encodingFormat.",optional:!0}))}(e.key)},video:function(e){return function(e,t){var n,o;return Object(c.a)(Object(c.a)((n={},Object(Fe.a)(n,e,Object(c.a)({type:Object},t)),Object(Fe.a)(n,"".concat(e,".@type"),{type:String,allowedValues:["VideoObject"]}),n),Ra(e)),{},(o={},Object(Fe.a)(o,"".concat(e,".caption"),{type:Ra("".concat(e,".caption")),label:" or Text\tThe caption for this object. For downloadable machine formats (closed caption, subtitles etc.) use MediaObject and indicate the encodingFormat.",optional:!0}),Object(Fe.a)(o,"".concat(e,".transcript"),{type:String,label:"If this MediaObject is an AudioObject or VideoObject, the transcript of that object.",optional:!0}),Object(Fe.a)(o,"".concat(e,".videoFrameSize"),{type:String,label:"The frame size of the video.",optional:!0}),Object(Fe.a)(o,"".concat(e,".videoQuality"),{type:String,optional:!0}),o),La("".concat(e,".thumbnail"),!0,{label:"Thumbnail image for an image or video.",optional:!0}))}(e.key)},file:function(e){return Ra(e.key)},barcode:function(e){return Object(Fe.a)({},e.key,{type:String})},calculate:function(e){return Object(Fe.a)({},e.key,{type:String})},acknowledge:function(e){return Object(Fe.a)({},e.key,{type:Boolean})},hidden:function(e){return Object(Fe.a)({},e.key,{type:String})},"xml-external":function(e){return Object(Fe.a)({},e.key,{type:String})},start:function(e){return Object(Fe.a)({},e.key,{type:Date})},end:function(e){return Object(Fe.a)({},e.key,{type:Date})},today:function(e){return Object(Fe.a)({},e.key,{type:Date})},deviceid:function(e){return Object(Fe.a)({},e.key,{type:String})},simserial:function(e){return Object(Fe.a)({},e.key,{type:String})},subscriberid:function(e){return Object(Fe.a)({},e.key,{type:String})},phonenumber:function(e){return Object(Fe.a)({},e.key,{type:String})},username:function(e){return Object(Fe.a)({},e.key,{type:String})},email:function(e){return Object(Fe.a)({},e.key,{type:String,regEx:de.a.RegEx.EmailWithTLD})},audit:function(e){return Object(Fe.a)({},e.key,{type:String})}};function _a(e){var t,n,o,a=e.node,r=e.language,i=e.xlsForm,l=e.context,s=e.key,u={label:Ta((null===(t=a.row.label)||void 0===t?void 0:t[r])||"",l,a),optional:Ca(a,l)};if(null===(n=a.row)||void 0===n?void 0:n.type.match(/^begin_repeat$/)){var d=a.children.map((function(t){return _a(Object(c.a)(Object(c.a)({},e),{},{node:t,key:s+".$."+t.row.name}))}));o=Object.assign.apply(Object,[Object(Fe.a)({},s,Object(c.a)(Object(c.a)({},u),{},{type:Array}))].concat(Object(g.a)(d)))}else if(a.row.type.match(/^begin_group$/)||a===i.rootSurveyGroup){var h=a.children.map((function(t){return t.row,_a(Object(c.a)(Object(c.a)({},e),{},{node:t,key:s+"."+t.row.name}))}));o=Object.assign.apply(Object,[Object(Fe.a)({},s,Object(c.a)(Object(c.a)({},u),{},{type:Object}))].concat(Object(g.a)(h)))}else o=function(e,t,n,o,a){var r,i=e.row;if(!i)throw new Error("Node needs an associated row for creating a schema.");var l=(null===(r=i.label)||void 0===r?void 0:r[t])||"",s={type:String,label:Ta(l,o,e),optional:Ca(e,o)},u=Ia[e.type];if(!u)throw new Error("Could not find schema generator for node type ".concat(JSON.stringify(i)));var d=u({key:a,node:e,xlsForm:n,context:o}),h=d[Object.keys(d)[0]];return Object.assign(h,s,Object(c.a)({},h)),d}(a,r,i,l,s);return o}u.a.onlyShowFocusOnTabs();var Fa=Object(p.a)((function(e){var t=o.useContext(fe),n=t.languageCode,a=t.debug,r=0===e.xlsForm.flatNodes.length,i=Object(ve.jsx)(oo,{});return Object(ve.jsx)(pa,{horizontal:2,vertical:2,className:e.className,style:{maxWidth:a?"60rem":"50rem",padding:"4rem",margin:"auto"},lang:n,children:r?i:Object(ve.jsx)(fa,{schemaKey:"data"},"data")})}))(Na||(Na=Object(s.a)(["\n  max-width: 800px;\n  margin: auto;\n\n  font-size: 20px;\n  .bp3-small {\n    font-size: 16px;\n  }\n\n  .bp3-large {\n    font-size: 20px;\n  }\n\n  .bp3-form-helper-text {\n    font-size: 16px;\n  }\n\n  .bp3-form-group {\n    margin: 0 0 40px;\n  }\n\n  .bp3-control {\n    margin-bottom: 10px;\n  }\n"]))),Da=p.a.div(Sa||(Sa=Object(s.a)(["\n  flex: 1;\n  overflow: hidden;\n  display: flex;\n  flex-direction: row;\n  align-items: stretch;\n"])));var Ma=function(){var e=a.a.useState("English (en)"),t=Object(l.a)(e,2),n=t[0],r=t[1],i=function(){var e=o.useState({commands:[],index:-1}),t=Object(l.a)(e,2),n=t[0],a=t[1],r=o.useCallback((function(e,t,n,o){var r={description:e,document:t,patches:n,inversePatches:o};a((function(e){var t=e.commands,n=e.index;return{commands:[].concat(Object(g.a)(t.slice(0,n+1)),[r]),index:n+1}}))}),[]),i=o.useCallback((function(){return a((function(e){return Object(c.a)(Object(c.a)({},e),{},{index:Math.max(e.index-1,0)})}))}),[]),s=o.useCallback((function(){return a((function(e){return Object(c.a)(Object(c.a)({},e),{},{index:Math.min(e.index+1,e.commands.length-1)})}))}),[]),u=o.useMemo((function(){var e;return null===(e=n.commands[n.index])||void 0===e?void 0:e.document}),[n.commands,n.index]),d=o.useCallback((function(e){return a((function(t){return Object(c.a)(Object(c.a)({},t),{},{index:e})}))}),[]);return{setDocumentWithPatches:r,undoHistory:n,undo:i,redo:s,gotoIndex:d,document:u}}(),s=i.document,u=s&&Object(ve.jsx)(In,{className:"bp3-code-block",style:{padding:"1rem",margin:"0",whiteSpace:"pre"},children:Object(ve.jsx)(xn,{xlsForm:s})}),p=function(){var e=a.a.useState(_n),t=Object(l.a)(e,2),n=t[0],o=t[1],r=a.a.useCallback((function(){o(Object(c.a)(Object(c.a)({},n),{},{debug:!n.debug}))}),[n]),i=a.a.useCallback((function(){o(Object(c.a)(Object(c.a)({},n),{},{table:!n.table}))}),[n]),s=a.a.useCallback((function(){o(Object(c.a)(Object(c.a)({},n),{},{json:!n.json}))}),[n]);return{viewMenuButton:Object(ve.jsxs)(ve.Fragment,{children:[Object(ve.jsxs)(h.d,{children:[Object(ve.jsx)(h.c,{icon:"join-table",text:"Excel",active:n.table,onClick:i}),Object(ve.jsx)(h.c,{icon:"diagram-tree",text:"JSON",active:n.json,onClick:s})]}),Object(ve.jsx)(h.F.Divider,{}),Object(ve.jsxs)(h.d,{children:[Object(ve.jsx)(h.c,{icon:"settings",text:"Develop",active:n.debug,onClick:r}),Object(ve.jsx)(h.c,{icon:"presentation",text:"Preview",active:!n.debug,onClick:r})]})]}),viewOptions:n}}(),j=p.viewMenuButton,v=p.viewOptions,m=Oe(),O=i.setDocumentWithPatches,x=to({language:n,xlsForm:s,setXLSFormWithPatches:O,debug:v.debug}),y=x.evaluationContext,w=(null===n||void 0===n?void 0:n.match(/^(.*) \((\w+)\)$/))||[],k=Object(l.a)(w,3),E=k[1],C=k[2],T=a.a.useMemo((function(){if(s&&n&&y)return function(e,t,n){var o=_a({node:e.rootSurveyGroup,xlsForm:e,context:t,language:n,key:e.rootSurveyGroup.row.name});return new de.a(new de.a(o).mergedSchema())}(s,y,n)}),[s,n,y]),N=function(e){return a.a.useMemo((function(){return[{combo:"mod+z",global:!0,label:"Undo",onKeyDown:e.undo,allowInInput:!1,preventDefault:!0},{global:!0,combo:"mod+shift+z",label:"Redo",onKeyDown:e.redo,allowInInput:!1,preventDefault:!0}]}),[e.redo,e.undo])}(i);return Object(ve.jsx)(d.b,{children:Object(ve.jsx)(h.y,{hotkeys:N,children:function(e){var t=e.handleKeyDown,o=e.handleKeyUp;return Object(ve.jsx)(ge,{style:{height:"100%",display:"flex",flexDirection:"column"},onKeyDown:t,onKeyUp:o,children:Object(ve.jsx)(En.Provider,{value:i,children:Object(ve.jsx)(xt.Provider,{value:{onDropNode:x.onMoveNode},children:Object(ve.jsxs)(fe.Provider,{value:Object(c.a)({schema:T,language:n,languageCode:C,languageName:E,debug:v.debug,xlsForm:s},x),children:[s&&Object(ve.jsxs)(h.F,{children:[Object(ve.jsxs)(h.F.Group,{children:[Object(ve.jsx)(Sn,{setXLSFormWithPatches:O,setLanguage:r,xlsForm:s}),Object(ve.jsx)(Cn,{})]}),Object(ve.jsxs)(h.F.Group,{children:[Object(ve.jsx)(h.F.Divider,{}),Object(ve.jsx)(no,{})]}),Object(ve.jsxs)(h.F.Group,{align:b.a.RIGHT,children:[j,Object(ve.jsx)(h.F.Divider,{}),s&&n&&Object(ve.jsx)(Ln,{languages:Array.from(s.languages.values()),language:n,onChange:r})]})]}),Object(ve.jsxs)(Da,{children:[!s&&Object(ve.jsx)(In,{children:Object(ve.jsx)(kn,{setXLSFormWithPatches:O,setLanguage:r})}),s&&n&&v.table&&Object(ve.jsx)(Ea,{xlsForm:s,language:n,debug:v.debug,style:{flex:1,display:"flex"}}),s&&n&&Object(ve.jsx)(In,{style:{boxShadow:m?"0 0px 2px ".concat(ye(f.a.DARK_GRAY5,.8),", 0 0px 20px ").concat(ye(f.a.DARK_GRAY1,.3)):"0 0px 10px ".concat(ye(f.a.DARK_GRAY5,.3)),zIndex:1},children:Object(ve.jsx)(Fa,{xlsForm:s,language:n,debug:v.debug})}),s&&n&&v.json&&u]})]})})})})}})})},Pa=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,490)).then((function(t){var n=t.getCLS,o=t.getFID,a=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),o(e),a(e),r(e),i(e)}))};Object(Dt.a)(),Object(Dt.b)(),i.a.render(Object(ve.jsx)(a.a.StrictMode,{children:Object(ve.jsx)(Ma,{})}),document.getElementById("root")),Pa()}},[[462,1,2]]]);
//# sourceMappingURL=main.dd8a698c.chunk.js.map